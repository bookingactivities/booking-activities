$j(document).ready(function(){$j(".bookacti-booking-system-form").on("submit",function(f){f.preventDefault();var b=$j(this);var a=b.find(".bookacti-booking-system");b.find('.bookacti-booking-system-field-submit-container input[type="submit"]').prop("disabled",true);if(typeof bookacti_localized.current_user_id==="undefined"||bookacti_localized.current_user_id==null||bookacti_localized.current_user_id==0){a.siblings(".bookacti-notices").empty().append("<ul class='bookacti-error-list'><li>"+bookacti_localized.error_user_not_logged_in+"</li></ul>").show();b.find('.bookacti-booking-system-field-submit-container input[type="submit"]').prop("disabled",false);return false}var d=bookacti_validate_picked_events(a,b.find(".bookacti-quantity").val());if(!d){b.find('.bookacti-booking-system-field-submit-container input[type="submit"]').prop("disabled",false);return false}else{b.find(".bookacti-booking-system-container").trigger("bookacti_submit_booking_form");var c=b.serialize();bookacti_start_loading_booking_system(a);$j.ajax({url:bookacti_localized.ajaxurl,type:"POST",data:c,dataType:"json",success:function(g){b.find(".bookacti-booking-system-container").trigger("bookacti_booking_form_submitted",[g]);var i="";if(g.status==="success"){b.find('.bookacti-booking-system-field-container:not(.bookacti-booking-system-field-submit-container), .bookacti-booking-system-field-submit-container input[type="submit"]').hide();b.find(".bookacti-booking-system-field-submit-container").append('<input type="button" class="bookacti-new-booking-button" value="'+bookacti_localized.booking_form_new_booking_button+'" />');i="<ul class='bookacti-success-list bookacti-persistent-notice'><li>"+g.message+"</li></ul>";if(b.attr("action")!==""){window.location.replace(b.attr("action"))}else{var e=a.attr("id");var h=bookacti.booking_system[e]["method"];bookacti_booking_method_refetch_events(a,h)}}else{i="<ul class='bookacti-error-list'><li>"+g.message+"</li></ul>"}a.siblings(".bookacti-notices").empty().append(i).show()},error:function(h){var g="<ul class='bookacti-error-list'><li>AJAX "+bookacti_localized.error_book+"</li></ul>";a.siblings(".bookacti-notices").empty().append(g).show();console.log("AJAX "+bookacti_localized.error_book);console.log(h)},complete:function(){bookacti_stop_loading_booking_system(a);b.find('.bookacti-booking-system-field-submit-container input[type="submit"]').prop("disabled",false)}})}});$j(".bookacti-booking-system-form").on("click",".bookacti-new-booking-button",function(){var b=$j(this).parents("form");var a=b.find(".bookacti-booking-system");bookacti_clear_booking_system_displayed_info(a);b.find('.bookacti-booking-system-field-container:not(.bookacti-booking-system-field-submit-container), .bookacti-booking-system-field-submit-container input[type="submit"]').show();$j(this).remove()});$j(".bookacti-booking-system-form").on("keyup mouseup","input.bookacti-quantity",function(){var a=$j(this).parents("form").find(".bookacti-booking-system");if(a.length){bookacti_fill_picked_events_list(a)}});$j(".bookacti-booking-system-form").on("bookacti_picked_events_list_data",".bookacti-booking-system",function(f,c){if($j(this).parents("form").find("input.bookacti-quantity").length){var b=$j(this).attr("id");var d=parseInt($j(this).parents("form").find("input.bookacti-quantity").val());var a=0;if(bookacti.booking_system[b]["picked_events"].length>1){a=bookacti_get_group_availability($j(this),bookacti.booking_system[b]["picked_events"])}else{a=bookacti_get_event_availability($j(this),bookacti.booking_system[b]["picked_events"][0])}$j(this).parents("form").find("input.bookacti-quantity").attr("max",a);if(d>a){$j(this).parents("form").find("input.bookacti-quantity").val(a);d=a}c.quantity=d}});$j("form.bookacti-booking-system-form .bookacti-booking-system").on("bookacti_view_refreshed bookacti_displayed_info_cleared",function(b){var a=$j(this).parents("form");a.find('input[name="bookacti_quantity"]').attr("disabled",false);a.find('button[type="submit"]').attr("disabled",false)});$j("form.bookacti-booking-system-form .bookacti-booking-system").on("bookacti_error_displayed",function(b){var a=$j(this).parents("form");a.find('input[name="bookacti_quantity"]').attr("disabled",true);a.find('button[type="submit"]').attr("disabled",true)})});