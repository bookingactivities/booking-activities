function bookacti_init_form_editor_actions(){$j("#bookacti-form-editor-actions").on("click",".bookacti-form-editor-action",function(a){if($j(this).is("#bookacti-update-form-meta")){bookacti_dialog_update_form_meta()}if($j(this).is("#bookacti-insert-form-field")){bookacti_dialog_insert_form_field()}});$j("#bookacti-form-editor").on("click",".bookacti-form-editor-field-action",function(d){var c=$j(this).closest(".bookacti-form-editor-field").data("field-name");var b=$j(this).closest(".bookacti-form-editor-field").data("field-id");if($j(this).hasClass("bookacti-remove-form-field")){bookacti_dialog_remove_form_field(b,c)}if($j(this).hasClass("bookacti-edit-form-field")){bookacti_dialog_update_form_field(b,c)}if($j(this).hasClass("bookacti-export-events")){var a=$j("#bookacti-form-id").val();bookacti_dialog_export_events(a)}if($j(this).hasClass("bookacti-login-form-shortcode")){bookacti_dialog_login_form_shortcode()}if($j(this).hasClass("bookacti-display-help")){bookacti_dialog_calendar_field_help()}});$j('.bookacti_export_button input[type="button"]').on("click",function(){var a=$j(this).closest(".bookacti_export_url").find(".bookacti_export_url_field input").val();if(a){window.open(a,"_blank")}})}function bookacti_dialog_update_form_meta(){var a=$j("#bookacti-form-id").val();var b=$j.trim($j("#bookacti-form-meta-dialog").dialog("option","title").replace(/\(.*?\)/,""));$j("#bookacti-form-meta-dialog").dialog({title:b+" ("+bookacti_localized.edit_id+": "+a+")"});$j('form#bookacti-update-form-meta-form input[name="action"]').val("bookactiUpdateFormMeta");$j('form#bookacti-update-form-meta-form input[name="form_id"]').val(a);bookacti_fill_fields_from_array(bookacti.form_editor.form,"","form#bookacti-update-form-meta-form");$j("#bookacti-form-meta-dialog").trigger("bookacti_form_meta_update_dialog",[a]);if(bookacti_localized.is_qtranslate){$j("form#bookacti-update-form-meta-form .qtranxs-translatable").each(function(){bookacti_refresh_qtx_field(this)})}$j("#bookacti-form-meta-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_ok,click:function(){if(typeof tinyMCE!=="undefined"){if(tinyMCE){tinyMCE.triggerSave()}}var c=$j("form#bookacti-update-form-meta-form").serializeObject();bookacti_form_editor_enter_loading_state();$j.ajax({url:ajaxurl,type:"POST",data:c,dataType:"json",success:function(d){if(d.status==="success"){bookacti.form_editor.form=d.form_data;$j("#bookacti-form-editor").trigger("bookacti_form_meta_updated",[a])}else{if(d.status==="failed"){var e=typeof d.message!=="undefined"?d.message:bookacti_localized.error;console.log(e);console.log(d)}}},error:function(d){console.log("AJAX "+bookacti_localized.error);console.log(d)},complete:function(){bookacti_form_editor_exit_loading_state()}});$j(this).dialog("close")}}]);$j("#bookacti-form-meta-dialog").dialog("open")}function bookacti_dialog_insert_form_field(){$j("#bookacti-insert-form-field-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_ok,click:function(){var a=$j("#bookacti-form-id").val();var c=$j("#bookacti-field-to-insert").val();var b=$j("#nonce_insert_form_field").val();if(!c||!a||!b){return}$j("#bookacti-insert-form-field-dialog").find(".bookacti-loading-alt,.bookacti-notices").remove();bookacti_form_editor_enter_loading_state();var d='<div class="bookacti-loading-alt"><img class="bookacti-loader" src="'+bookacti_localized.plugin_path+'/img/ajax-loader.gif" title="'+bookacti_localized.loading+'" /><span class="bookacti-loading-alt-text" >'+bookacti_localized.loading+"</span></div>";$j("#bookacti-insert-form-field-dialog").append(d);$j.ajax({url:ajaxurl,type:"POST",data:{action:"bookactiInsertFormField",form_id:a,field_name:c,nonce:b},dataType:"json",success:function(e){if(e.status==="success"){$j("#bookacti-form-editor > .bookacti-form-editor-field:last").after(e.field_html);bookacti_init_tooltip();bookacti.form_editor.fields[e.field_id]=e.field_data;bookacti.form_editor.form.field_order=e.field_order;$j('#bookacti-field-to-insert option[value="'+c+'"][data-unique="1"]').attr("disabled",true);$j("#bookacti-field-to-insert").val($j("#bookacti-field-to-insert option:not([disabled]):first").val());$j("#bookacti-form-editor").trigger("bookacti_field_inserted",[e.field_id,c]);$j("#bookacti-insert-form-field-dialog").dialog("close")}else{if(e.status==="failed"){var f=typeof e.message!=="undefined"?e.message:bookacti_localized.error;$j("#bookacti-insert-form-field-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+f+"</li></ul></div>");console.log(f);console.log(e)}}},error:function(f){$j("#bookacti-insert-form-field-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>AJAX '+bookacti_localized.error+"</li></ul></div>");console.log("AJAX "+bookacti_localized.error);console.log(f)},complete:function(){$j("#bookacti-insert-form-field-dialog .bookacti-notices").show();$j("#bookacti-insert-form-field-dialog .bookacti-loading-alt").remove();bookacti_form_editor_exit_loading_state()}})}}]);$j("#bookacti-insert-form-field-dialog").dialog("open")}function bookacti_dialog_remove_form_field(a,b){var c=$j.trim($j("#bookacti-remove-form-field-dialog").dialog("option","title").replace(/\(.*?\)/,""));$j("#bookacti-remove-form-field-dialog").dialog({title:c+" ("+bookacti_localized.edit_id+": "+a+")"});$j("#bookacti-remove-form-field-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_ok,click:function(){var d=$j("#nonce_remove_form_field").val();if(!a||!d){return}bookacti_form_editor_enter_loading_state();$j.ajax({url:ajaxurl,type:"POST",data:{action:"bookactiRemoveFormField",field_id:a,nonce:d},dataType:"json",success:function(e){if(e.status==="success"){$j("#bookacti-form-editor-field-"+a).remove();delete bookacti.form_editor.fields[a];bookacti.form_editor.form.field_order=e.field_order;$j('#bookacti-field-to-insert option[value="'+b+'"]').attr("disabled",false);$j("#bookacti-form-editor").trigger("bookacti_field_removed",[a,b])}else{if(e.status==="failed"){var f=typeof e.message!=="undefined"?e.message:bookacti_localized.error;console.log(f);console.log(e)}}},error:function(f){console.log("AJAX "+bookacti_localized.error);console.log(f)},complete:function(){bookacti_form_editor_exit_loading_state()}});$j(this).dialog("close")}}]);$j("#bookacti-remove-form-field-dialog").dialog("open")}function bookacti_dialog_update_form_field(a,c){if($j("#bookacti-form-field-dialog-"+c).length){var b=$j("#bookacti-form-field-dialog-"+c).dialog("option","title");var d=$j.type(b)==="string"?$j.trim(b.replace(/\(.*?\)/,"")):"";if(d){$j("#bookacti-form-field-dialog-"+c).dialog({title:d+" ("+bookacti_localized.edit_id+": "+a+")"})}}$j("form#bookacti-form-field-form-"+c+' input[name="action"]').val("bookactiUpdateFormField");$j("form#bookacti-form-field-form-"+c+' input[name="field_id"]').val(a);bookacti_fill_fields_from_array(bookacti.form_editor.fields[a],"","form#bookacti-form-field-form-"+c);$j("#bookacti-form-editor").trigger("bookacti_field_update_dialog",[a,c]);if(bookacti_localized.is_qtranslate){$j("form#bookacti-form-field-form-"+c+" .qtranxs-translatable").each(function(){bookacti_refresh_qtx_field(this)})}$j("#bookacti-form-field-dialog-"+c).dialog("option","buttons",[{text:bookacti_localized.dialog_button_ok,click:function(){$j("#bookacti-form-field-dialog-"+c).find(".bookacti-loading-alt,.bookacti-notices").remove();if(typeof tinyMCE!=="undefined"){if(tinyMCE){tinyMCE.triggerSave()}}$j("form#bookacti-form-field-form-"+c+" select[multiple].bookacti-items-select-box option").prop("selected",true);var f=$j("form#bookacti-form-field-form-"+c).serializeObject();var e=$j("#bookacti-form-editor-field-"+a+" .bookacti-form-editor-field-body").is(":visible");bookacti_form_editor_enter_loading_state();var g='<div class="bookacti-loading-alt"><img class="bookacti-loader" src="'+bookacti_localized.plugin_path+'/img/ajax-loader.gif" title="'+bookacti_localized.loading+'" /><span class="bookacti-loading-alt-text" >'+bookacti_localized.loading+"</span></div>";$j("#bookacti-form-field-dialog-"+c).append(g);$j.ajax({url:ajaxurl,type:"POST",data:f,dataType:"json",success:function(h){if(h.status==="success"){if(c!=="calendar"){$j("#bookacti-form-editor-field-"+a).replaceWith(h.field_html);if(e){$j("#bookacti-form-editor-field-"+a+" .bookacti-form-editor-field-header").trigger("click")}}bookacti.form_editor.fields[a]=h.field_data;bookacti_init_tooltip();$j("#bookacti-form-editor").trigger("bookacti_field_updated",[a,c,h]);$j("#bookacti-form-field-dialog-"+c).dialog("close")}else{if(h.status==="failed"){var i=typeof h.message!=="undefined"?h.message:bookacti_localized.error;$j("#bookacti-form-field-dialog-"+c).append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+i+"</li></ul></div>");console.log(i);console.log(h)}}},error:function(h){$j("#bookacti-insert-form-field-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>AJAX '+bookacti_localized.error+"</li></ul></div>");console.log("AJAX "+bookacti_localized.error);console.log(h)},complete:function(){$j("#bookacti-form-field-dialog-"+c+" .bookacti-notices").show();$j("#bookacti-form-field-dialog-"+c+" .bookacti-loading-alt").remove();bookacti_form_editor_exit_loading_state()}})}},{text:bookacti_localized.dialog_button_reset,"class":"bookacti-dialog-delete-button bookacti-dialog-left-button",click:function(){if(typeof tinyMCE!=="undefined"){if(tinyMCE){tinyMCE.triggerSave()}}$j("form#bookacti-form-field-form-"+c+' input[name="action"]').val("bookactiResetFormField");var f=$j("form#bookacti-form-field-form-"+c).serializeObject();var e=$j("#bookacti-form-editor-field-"+a+" .bookacti-form-editor-field-body").is(":visible");bookacti_form_editor_enter_loading_state();$j.ajax({url:ajaxurl,type:"POST",data:f,dataType:"json",success:function(g){if(g.status==="success"){if(c!=="calendar"){$j("#bookacti-form-editor-field-"+a).replaceWith(g.field_html);if(e){$j("#bookacti-form-editor-field-"+a+" .bookacti-form-editor-field-header").trigger("click")}}bookacti.form_editor.fields[a]=g.field_data;bookacti_init_tooltip();$j("#bookacti-form-editor").trigger("bookacti_field_reset",[a,c,g])}else{if(g.status==="failed"){var h=typeof g.message!=="undefined"?g.message:bookacti_localized.error;console.log(h);console.log(g)}}},error:function(g){console.log("AJAX "+bookacti_localized.error);console.log(g)},complete:function(){bookacti_form_editor_exit_loading_state()}});$j(this).dialog("close")}}]);$j("#bookacti-form-field-dialog-"+c).dialog("open")}function bookacti_dialog_export_events(a){$j("#bookacti-export-events-dialog .bookacti-notices").remove();$j("#bookacti_export_events_url_secret").val($j("#bookacti_export_events_url_secret").data("value"));$j("#bookacti-export-events-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_ok,click:function(){$j("#bookacti-export-events-dialog .bookacti-notices").remove();$j(this).dialog("close")}},{text:bookacti_localized.dialog_button_reset,"class":"bookacti-dialog-delete-button bookacti-dialog-left-button",click:function(){var b=$j("#nonce_reset_export_events_url").val();if(!a||!b){return}$j("#bookacti-export-events-dialog .bookacti-notices").remove();bookacti_form_editor_enter_loading_state();$j.ajax({url:ajaxurl,type:"POST",data:{action:"bookactiResetExportEventsUrl",form_id:a,nonce:b},dataType:"json",success:function(c){if(c.status==="success"){var e=$j("#bookacti_export_events_url_secret").data("value").replace(c.old_secret_key,c.new_secret_key);$j("#bookacti_export_events_url_secret").data("value",e);$j("#bookacti_export_events_url_secret").attr("data-value",e);$j("#bookacti_export_events_url_secret").val(e);$j("#bookacti-export-events-dialog").append('<div class="bookacti-notices"><ul class="bookacti-success-list"><li>'+c.message+"</li></ul></div>").show();$j("#bookacti-form-editor").trigger("bookacti_export_events_url_reset",[a,c])}else{if(c.status==="failed"){var d=typeof c.message!=="undefined"?c.message:bookacti_localized.error;$j("#bookacti-export-events-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+d+"</li></ul></div>").show();console.log(d);console.log(c)}}},error:function(c){$j("#bookacti-export-events-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>AJAX '+bookacti_localized.error+"</li></ul></div>").show();console.log("AJAX "+bookacti_localized.error);console.log(c)},complete:function(){$j("#bookacti-export-events-dialog .bookacti-notices").show();bookacti_form_editor_exit_loading_state()}})}}]);$j("#bookacti-export-events-dialog").dialog("open")}function bookacti_dialog_calendar_field_help(){$j("#bookacti-calendar-field-help-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_ok,click:function(){$j(this).dialog("close")}}]);$j("#bookacti-calendar-field-help-dialog").dialog("open")}function bookacti_dialog_login_form_shortcode(){$j("#bookacti-login-form-shortcode-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_ok,click:function(){$j(this).dialog("close")}}]);$j("#bookacti-login-form-shortcode-dialog").dialog("open")};