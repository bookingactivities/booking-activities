function bookacti_init_form_editor_actions(){$j("#bookacti-form-editor-actions").on("click",".bookacti-form-editor-action",function(a){$j(this).is("#bookacti-update-form-meta")&&bookacti_dialog_update_form_meta();$j(this).is("#bookacti-insert-form-field")&&bookacti_dialog_insert_form_field()});$j("#bookacti-form-editor").on("click",".bookacti-form-editor-field-action",function(a){a=$j(this).closest(".bookacti-form-editor-field").data("field-name");var b=$j(this).closest(".bookacti-form-editor-field").data("field-id");
$j(this).hasClass("bookacti-remove-form-field")&&bookacti_dialog_remove_form_field(b,a);$j(this).hasClass("bookacti-edit-form-field")&&bookacti_dialog_update_form_field(b,a);$j(this).hasClass("bookacti-export-events")&&(a=$j("#bookacti-form-id").val(),bookacti_dialog_export_events(a));$j(this).hasClass("bookacti-login-form-shortcode")&&bookacti_dialog_login_form_shortcode();$j(this).hasClass("bookacti-display-help")&&bookacti_dialog_calendar_field_help()});$j('.bookacti_export_button input[type="button"]').on("click",
function(){var a=$j(this).closest(".bookacti_export_url").find(".bookacti_export_url_field input").val();a&&window.open(a,"_blank")})}
function bookacti_dialog_update_form_meta(){var a=$j("#bookacti-form-id").val(),b=$j.trim($j("#bookacti-form-meta-dialog").dialog("option","title").replace(/\(.*?\)/,""));$j("#bookacti-form-meta-dialog").dialog({title:b+" ("+bookacti_localized.edit_id+": "+a+")"});$j('form#bookacti-update-form-meta-form input[name="action"]').val("bookactiUpdateFormMeta");$j('form#bookacti-update-form-meta-form input[name="form_id"]').val(a);bookacti_fill_fields_from_array(bookacti.form_editor.form,"","form#bookacti-update-form-meta-form");
$j("#bookacti-form-meta-dialog").trigger("bookacti_form_meta_update_dialog",[a]);bookacti_localized.is_qtranslate&&$j("form#bookacti-update-form-meta-form .qtranxs-translatable").each(function(){bookacti_refresh_qtx_field(this)});$j("#bookacti-form-meta-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_ok,click:function(){"undefined"!==typeof tinyMCE&&tinyMCE&&tinyMCE.triggerSave();var d=bookacti_serialize_object($j("form#bookacti-update-form-meta-form"));bookacti_form_editor_enter_loading_state();
$j.ajax({url:ajaxurl,type:"POST",data:d,dataType:"json",success:function(c){"success"===c.status?(bookacti.form_editor.form=c.form_data,$j("#bookacti-form-editor").trigger("bookacti_form_meta_updated",[a])):"failed"===c.status&&(console.log("undefined"!==typeof c.message?c.message:bookacti_localized.error),console.log(c))},error:function(c){console.log("AJAX "+bookacti_localized.error);console.log(c)},complete:function(){bookacti_form_editor_exit_loading_state()}});$j(this).dialog("close")}}]);$j("#bookacti-form-meta-dialog").dialog("open")}
function bookacti_dialog_insert_form_field(){$j("#bookacti-field-to-insert option:not(:disabled):first").prop("selected",!0);$j("#bookacti-field-to-insert").trigger("change");$j("#bookacti-insert-form-field-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_ok,click:function(){var a=$j("#bookacti-form-id").val(),b=$j("#bookacti-field-to-insert").val(),d=$j('#bookacti-insert-form-field-form input[name="nonce"]').val();b&&a&&d&&($j("#bookacti-insert-form-field-dialog").find(".bookacti-notices").remove(),
bookacti_form_editor_enter_loading_state(),bookacti_add_loading_html($j("#bookacti-insert-form-field-dialog")),$j.ajax({url:ajaxurl,type:"POST",data:{action:"bookactiInsertFormField",form_id:a,field_name:b,nonce:d},dataType:"json",success:function(c){if("success"===c.status)$j("#bookacti-form-editor > .bookacti-form-editor-field:last").after(c.field_html),bookacti_init_tooltip(),bookacti.form_editor.fields[c.field_id]=c.field_data,bookacti.form_editor.form.field_order=c.field_order,$j('#bookacti-field-to-insert option[value="'+
b+'"][data-unique="1"]').attr("disabled",!0),$j("#bookacti-field-to-insert").val($j("#bookacti-field-to-insert option:not([disabled]):first").val()).trigger("change"),$j("#bookacti-form-editor").trigger("bookacti_field_inserted",[c.field_id,b]),$j("#bookacti-insert-form-field-dialog").dialog("close");else if("failed"===c.status){var f="undefined"!==typeof c.message?c.message:bookacti_localized.error;$j("#bookacti-insert-form-field-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+
f+"</li></ul></div>");console.log(f);console.log(c)}},error:function(c){$j("#bookacti-insert-form-field-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>AJAX '+bookacti_localized.error+"</li></ul></div>");console.log("AJAX "+bookacti_localized.error);console.log(c)},complete:function(){$j("#bookacti-insert-form-field-dialog .bookacti-notices").show();bookacti_remove_loading_html($j("#bookacti-insert-form-field-dialog"));bookacti_form_editor_exit_loading_state()}}))}}]);
$j("#bookacti-insert-form-field-dialog").dialog("open")}
function bookacti_dialog_remove_form_field(a,b){var d=$j.trim($j("#bookacti-remove-form-field-dialog").dialog("option","title").replace(/\(.*?\)/,""));$j("#bookacti-remove-form-field-dialog").dialog({title:d+" ("+bookacti_localized.edit_id+": "+a+")"});$j("#bookacti-remove-form-field-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_ok,click:function(){var c=$j('#bookacti-remove-form-field-form input[name="nonce"]').val();a&&c&&(bookacti_form_editor_enter_loading_state(),
$j.ajax({url:ajaxurl,type:"POST",data:{action:"bookactiRemoveFormField",field_id:a,nonce:c},dataType:"json",success:function(f){"success"===f.status?($j("#bookacti-form-editor-field-"+a).remove(),delete bookacti.form_editor.fields[a],bookacti.form_editor.form.field_order=f.field_order,$j('#bookacti-field-to-insert option[value="'+b+'"]').attr("disabled",!1),$j("#bookacti-form-editor").trigger("bookacti_field_removed",[a,b])):"failed"===f.status&&(console.log("undefined"!==typeof f.message?f.message:
bookacti_localized.error),console.log(f))},error:function(f){console.log("AJAX "+bookacti_localized.error);console.log(f)},complete:function(){bookacti_form_editor_exit_loading_state()}}),$j(this).dialog("close"))}}]);$j("#bookacti-remove-form-field-dialog").dialog("open")}
function bookacti_dialog_update_form_field(a,b){if($j("#bookacti-form-field-dialog-"+b).length){var d=$j("#bookacti-form-field-dialog-"+b).dialog("option","title");(d="string"===$j.type(d)?$j.trim(d.replace(/\(.*?\)/,"")):"")&&$j("#bookacti-form-field-dialog-"+b).dialog({title:d+" ("+bookacti_localized.edit_id+": "+a+")"})}$j("form#bookacti-form-field-form-"+b+' input[name="action"]').val("bookactiUpdateFormField");$j("form#bookacti-form-field-form-"+b+' input[name="field_id"]').val(a);bookacti_fill_fields_from_array(bookacti.form_editor.fields[a],
"","form#bookacti-form-field-form-"+b);$j("#bookacti-form-editor").trigger("bookacti_field_update_dialog",[a,b]);bookacti_localized.is_qtranslate&&$j("form#bookacti-form-field-form-"+b+" .qtranxs-translatable").each(function(){bookacti_refresh_qtx_field(this)});$j("#bookacti-form-field-dialog-"+b).dialog("option","buttons",[{text:bookacti_localized.dialog_button_ok,click:function(){$j("#bookacti-form-field-dialog-"+b).find(".bookacti-notices").remove();"undefined"!==typeof tinyMCE&&tinyMCE&&tinyMCE.triggerSave();
var c=bookacti_serialize_object($j("form#bookacti-form-field-form-"+b)),f=$j("#bookacti-form-editor-field-"+a+" .bookacti-form-editor-field-body").is(":visible");bookacti_form_editor_enter_loading_state();bookacti_add_loading_html($j("#bookacti-form-field-dialog-"+b));$j.ajax({url:ajaxurl,type:"POST",data:c,dataType:"json",success:function(e){if("success"===e.status)"calendar"!==b&&($j("#bookacti-form-editor-field-"+a).replaceWith(e.field_html),f&&$j("#bookacti-form-editor-field-"+a+" .bookacti-form-editor-field-header").trigger("click")),
bookacti.form_editor.fields[a]=e.field_data,bookacti_init_tooltip(),$j("#bookacti-form-editor").trigger("bookacti_field_updated",[a,b,e]),$j("#bookacti-form-field-dialog-"+b).dialog("close");else if("failed"===e.status){var g="undefined"!==typeof e.message?e.message:bookacti_localized.error;$j("#bookacti-form-field-dialog-"+b).append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+g+"</li></ul></div>");console.log(g);console.log(e)}},error:function(e){$j("#bookacti-insert-form-field-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>AJAX '+
bookacti_localized.error+"</li></ul></div>");console.log("AJAX "+bookacti_localized.error);console.log(e)},complete:function(){$j("#bookacti-form-field-dialog-"+b+" .bookacti-notices").show();bookacti_remove_loading_html($j("#bookacti-form-field-dialog-"+b));bookacti_form_editor_exit_loading_state()}})}},{text:bookacti_localized.dialog_button_reset,"class":"bookacti-dialog-delete-button bookacti-dialog-left-button",click:function(){"undefined"!==typeof tinyMCE&&tinyMCE&&tinyMCE.triggerSave();$j("form#bookacti-form-field-form-"+
b+' input[name="action"]').val("bookactiResetFormField");var c=bookacti_serialize_object($j("form#bookacti-form-field-form-"+b)),f=$j("#bookacti-form-editor-field-"+a+" .bookacti-form-editor-field-body").is(":visible");bookacti_form_editor_enter_loading_state();$j.ajax({url:ajaxurl,type:"POST",data:c,dataType:"json",success:function(e){"success"===e.status?("calendar"!==b&&($j("#bookacti-form-editor-field-"+a).replaceWith(e.field_html),f&&$j("#bookacti-form-editor-field-"+a+" .bookacti-form-editor-field-header").trigger("click")),
bookacti.form_editor.fields[a]=e.field_data,bookacti_init_tooltip(),$j("#bookacti-form-editor").trigger("bookacti_field_reset",[a,b,e])):"failed"===e.status&&(console.log("undefined"!==typeof e.message?e.message:bookacti_localized.error),console.log(e))},error:function(e){console.log("AJAX "+bookacti_localized.error);console.log(e)},complete:function(){bookacti_form_editor_exit_loading_state()}});$j(this).dialog("close")}}]);$j("#bookacti-form-field-dialog-"+b).dialog("open")}
function bookacti_dialog_export_events(a){$j("#bookacti_export_events_url_secret").val($j("#bookacti_export_events_url_secret").data("value"));$j("#bookacti-export-events-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_ok,click:function(){$j("#bookacti-export-events-dialog .bookacti-notices").remove();$j(this).dialog("close")}},{text:bookacti_localized.dialog_button_reset,"class":"bookacti-dialog-delete-button bookacti-dialog-left-button",click:function(){var b=$j('#bookacti-export-events-form input[name="nonce"]').val();
a&&b&&($j("#bookacti-export-events-dialog .bookacti-notices").remove(),bookacti_form_editor_enter_loading_state(),$j.ajax({url:ajaxurl,type:"POST",data:{action:"bookactiResetExportEventsUrl",form_id:a,nonce:b},dataType:"json",success:function(d){if("success"===d.status){var c=$j("#bookacti_export_events_url_secret").data("value").replace(d.old_secret_key,d.new_secret_key);$j("#bookacti_export_events_url_secret").data("value",c);$j("#bookacti_export_events_url_secret").attr("data-value",c);$j("#bookacti_export_events_url_secret").val(c);
$j("#bookacti-export-events-dialog").append('<div class="bookacti-notices"><ul class="bookacti-success-list"><li>'+d.message+"</li></ul></div>").show();$j("#bookacti-form-editor").trigger("bookacti_export_events_url_reset",[a,d])}else"failed"===d.status&&(c="undefined"!==typeof d.message?d.message:bookacti_localized.error,$j("#bookacti-export-events-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+c+"</li></ul></div>").show(),console.log(c),console.log(d))},error:function(d){$j("#bookacti-export-events-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>AJAX '+
bookacti_localized.error+"</li></ul></div>").show();console.log("AJAX "+bookacti_localized.error);console.log(d)},complete:function(){$j("#bookacti-export-events-dialog .bookacti-notices").show();bookacti_form_editor_exit_loading_state()}}))}}]);$j("#bookacti-export-events-dialog").dialog("open")}
function bookacti_dialog_calendar_field_help(){$j("#bookacti-calendar-field-help-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_ok,click:function(){$j(this).dialog("close")}}]);$j("#bookacti-calendar-field-help-dialog").dialog("open")}
function bookacti_dialog_login_form_shortcode(){$j("#bookacti-login-form-shortcode-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_ok,click:function(){$j(this).dialog("close")}}]);$j("#bookacti-login-form-shortcode-dialog").dialog("open")};
