function bookacti_init_form_editor_dialogs(){$j(".bookacti-form-dialog").dialog({modal:true,autoOpen:false,minHeight:300,minWidth:440,resize:"auto",show:true,hide:true,dialogClass:"bookacti-dialog",closeText:"&#10006;",beforeClose:function(){var b=".bookacti-form-dialog";var a=$j(this).attr("id");if(a){b="#"+a}bookacti_empty_all_dialog_forms(b)}});$j("#bookacti-form-field-dialog-free_text").dialog("option","width",540);$j(".ui-widget-overlay").live("click",function(){$j("div:ui-dialog:visible").dialog("close")});$j(".bookacti-form-dialog").on("keydown",function(a){if(!$j("textarea").is(":focus")&&a.keyCode==$j.ui.keyCode.ENTER){$j(this).parent().find(".ui-dialog-buttonpane button:first").focus();return false}})}function bookacti_init_form_editor_actions(){$j("#bookacti-form-editor-actions").on("click",".bookacti-form-editor-action",function(a){if($j(this).is("#bookacti-update-form-meta")){bookacti_dialog_update_form_meta()}if($j(this).is("#bookacti-insert-form-field")){bookacti_dialog_insert_form_field()}});$j("#bookacti-form-editor").on("click",".bookacti-form-editor-field-action",function(c){var b=$j(this).closest(".bookacti-form-editor-field").data("field-name");var a=$j(this).closest(".bookacti-form-editor-field").data("field-id");if($j(this).hasClass("bookacti-remove-form-field")){bookacti_dialog_remove_form_field(a,b)}if($j(this).hasClass("bookacti-edit-form-field")){bookacti_dialog_update_form_field(a,b)}})}function bookacti_dialog_update_form_meta(){var a=$j("#bookacti-form-id").val();$j('form#bookacti-update-form-meta-form input[name="action"]').val("bookactiUpdateFormMeta");$j('form#bookacti-update-form-meta-form input[name="form_id"]').val(a);bookacti_fill_fields_from_array(bookacti.form_editor.form,"","form#bookacti-update-form-meta-form");if(bookacti_localized.is_qtranslate){$j("form#bookacti-update-form-meta-form .qtranxs-translatable").each(function(){bookacti_refresh_qtx_field(this)})}$j("#bookacti-form-meta-dialog").dialog("open");$j("#bookacti-form-meta-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_ok,click:function(){if(tinyMCE){tinyMCE.triggerSave()}var b=$j("form#bookacti-update-form-meta-form").serializeObject();bookacti_form_editor_enter_loading_state();$j.ajax({url:ajaxurl,type:"POST",data:b,dataType:"json",success:function(d){if(d.status==="success"){bookacti.form_editor.form=d.form_data;$j("#bookacti-form-editor").trigger("bookacti_form_meta_updated")}else{if(d.status==="failed"){var c=bookacti_localized.error_update_form;if(d.error==="not_allowed"){c+="\n"+bookacti_localized.error_not_allowed}console.log(c);console.log(d)}}},error:function(c){console.log("AJAX "+bookacti_localized.error_update_form);console.log(c)},complete:function(){bookacti_form_editor_exit_loading_state()}});$j(this).dialog("close")}}])}function bookacti_dialog_insert_form_field(){$j("#bookacti-insert-form-field-dialog").dialog("open");$j("#bookacti-insert-form-field-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_ok,click:function(){var a=$j("#bookacti-form-id").val();var c=$j("#bookacti-field-to-insert").val();var b=$j("#nonce_insert_form_field").val();if(!c||!a||!b){return}bookacti_form_editor_enter_loading_state();$j.ajax({url:ajaxurl,type:"POST",data:{action:"bookactiInsertFormField",form_id:a,field_name:c,nonce:b},dataType:"json",success:function(e){if(e.status==="success"){$j("#bookacti-form-editor").append(e.field_html);bookacti.form_editor.fields[e.field_id]=e.field_data;bookacti.form_editor.form.field_order=e.field_order;$j('#bookacti-field-to-insert option[value="'+c+'"][data-unique="1"]').attr("disabled",true);$j("#bookacti-field-to-insert").val($j("#bookacti-field-to-insert option:not([disabled]):first").val());$j("#bookacti-form-editor").trigger("bookacti_field_inserted",[e.field_id])}else{if(e.status==="failed"){var d=bookacti_localized.error_insert_form_field;if(e.error==="not_allowed"){d+="\n"+bookacti_localized.error_not_allowed}console.log(d);console.log(e)}}},error:function(d){console.log("AJAX "+bookacti_localized.error_insert_form_field);console.log(d)},complete:function(){bookacti_form_editor_exit_loading_state()}});$j(this).dialog("close")}}])}function bookacti_dialog_remove_form_field(a,b){$j("#bookacti-remove-form-field-dialog").dialog("open");$j("#bookacti-remove-form-field-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_ok,click:function(){var c=$j("#nonce_remove_form_field").val();if(!a||!c){return}bookacti_form_editor_enter_loading_state();$j.ajax({url:ajaxurl,type:"POST",data:{action:"bookactiRemoveFormField",field_id:a,nonce:c},dataType:"json",success:function(e){if(e.status==="success"){$j("#bookacti-form-editor-field-"+a).remove();delete bookacti.form_editor.fields[a];bookacti.form_editor.form.field_order=e.field_order;$j('#bookacti-field-to-insert option[value="'+b+'"]').attr("disabled",false);$j("#bookacti-form-editor").trigger("bookacti_field_removed",[a])}else{if(e.status==="failed"){var d=bookacti_localized.error_remove_form_field;if(e.error==="not_allowed"){d+="\n"+bookacti_localized.error_not_allowed}console.log(d);console.log(e)}}},error:function(d){console.log("AJAX "+bookacti_localized.error_remove_form_field);console.log(d)},complete:function(){bookacti_form_editor_exit_loading_state()}});$j(this).dialog("close")}}])}function bookacti_dialog_update_form_field(a,b){$j("form#bookacti-form-field-form-"+b+' input[name="action"]').val("bookactiUpdateFormField");$j("form#bookacti-form-field-form-"+b+' input[name="field_id"]').val(a);console.log(bookacti.form_editor.fields[a]);if($j("form#bookacti-form-field-form-"+b+" .bookacti-multiple-select").length){$j("form#bookacti-form-field-form-"+b+" .bookacti-multiple-select").each(function(){var d=$j(this).data("select-id");var c=$j("#"+d).attr("name");if(!(c in bookacti.form_editor.fields[a])){return}if($j.isPlainObject(bookacti.form_editor.fields[a][c])||($j.isArray(bookacti.form_editor.fields[a][c])&&bookacti.form_editor.fields[a][c].length>1)){$j(this).prop("checked",true)}else{$j(this).prop("checked",false)}bookacti_switch_select_to_multiple(this)})}bookacti_fill_fields_from_array(bookacti.form_editor.fields[a],"","form#bookacti-form-field-form-"+b);if(bookacti_localized.is_qtranslate){$j("form#bookacti-form-field-form-"+b+" .qtranxs-translatable").each(function(){bookacti_refresh_qtx_field(this)})}$j("#bookacti-form-field-dialog-"+b).dialog("open");$j("#bookacti-form-field-dialog-"+b).dialog("option","buttons",[{text:bookacti_localized.dialog_button_ok,click:function(){if(tinyMCE){tinyMCE.triggerSave()}var d=$j("form#bookacti-form-field-form-"+b).serializeObject();var c=$j("#bookacti-form-editor-field-"+a+" .bookacti-form-editor-field-body").is(":visible");console.log(d);bookacti_form_editor_enter_loading_state();$j.ajax({url:ajaxurl,type:"POST",data:d,dataType:"json",success:function(f){if(f.status==="success"){$j("#bookacti-form-editor-field-"+a).replaceWith(f.field_html);bookacti.form_editor.fields[a]=f.field_data;bookacti_init_tooltip();if(c){$j("#bookacti-form-editor-field-"+a+" .bookacti-form-editor-field-header").trigger("click")}$j("#bookacti-form-editor").trigger("bookacti_field_updated",[a])}else{if(f.status==="failed"){var e=bookacti_localized.error_update_form_field;if(f.error==="not_allowed"){e+="\n"+bookacti_localized.error_not_allowed}console.log(e);console.log(f)}}},error:function(f){console.log("AJAX "+bookacti_localized.error_update_form_field);console.log(f)},complete:function(){bookacti_form_editor_exit_loading_state()}});$j(this).dialog("close")}}])};