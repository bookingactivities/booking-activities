$j(document).ready(function(){$j("form#bookacti-form-editor-page-form").length&&"undefined"!==typeof bookacti.form_editor&&($j("#bookacti-form-field-dialog-free_text").dialog("option","width",540),$j("#bookacti-form-field-dialog-terms").dialog("option","width",540),bookacti_init_form_editor_actions(),$j("#bookacti-form-editor").on("click",".bookacti-form-editor-field-header",function(a){if(!$j(a.target).closest(".bookacti-form-editor-field-action").length){var b=$j(this).find(".bookacti-field-toggle");
b.toggleClass("dashicons-arrow-up dashicons-arrow-down");b.closest(".bookacti-form-editor-field").find(".bookacti-form-editor-field-body").toggle();a=b.closest(".bookacti-form-editor-field").find(".bookacti-form-editor-field-body").is(":visible");b=b.closest(".bookacti-form-editor-field").find(".bookacti-booking-system");a&&b.length&&bookacti_booking_method_rerender_events(b)}}),$j("#bookacti-form-editor").sortable({items:".bookacti-form-editor-field:not(.ui-state-disabled):not(.bookacti-form-editor-promo-field)",
handle:".bookacti-form-editor-field-title",placeholder:"bookacti-form-editor-field-placeholder",update:function(a,b){bookacti_save_form_field_order()}}),$j("#bookacti-form-editor").disableSelection(),$j("form#bookacti-form-editor-page-form").on("submit",function(a){$j("form#bookacti-form-editor-page-form").length&&(a.preventDefault(),bookacti_save_form())}),$j("#bookacti-form-editor").on("bookacti_field_update_dialog",function(a,b,c){"calendar"===c&&(a=bookacti.form_editor.fields[b],$j.isArray(a.activities)&&
(a.activities.length||$j("#bookacti-form-field-dialog-calendar #bookacti-activities").val("all").trigger("change")),$j.isArray(a.group_categories)&&(a.group_categories.length||$j("#bookacti-form-field-dialog-calendar #bookacti-group_categories").val("all").trigger("change")),bookacti_delete_days_off_rows($j("#bookacti-form-field-dialog-calendar .bookacti-date-intervals-table-container")),$j("#bookacti-form-field-dialog-calendar input.bookacti-date-interval-from, #bookacti-form-field-dialog-calendar input.bookacti-date-interval-to").attr("min",
"").attr("max",""),a.hasOwnProperty("days_off")&&($j.isEmptyObject(a.days_off)||bookacti_fill_days_off($j("#bookacti-form-field-dialog-calendar .bookacti-date-intervals-table-container"),a.days_off)))}),$j("#bookacti-form-field-dialog-calendar").on("change","select#bookacti-calendars",function(){var a=$j("#bookacti-calendars").val(),b=$j("[data-bookacti-show-if-templates]");bookacti_show_hide_template_related_options(a,b);bookacti_refresh_redirect_url_by_activity_table();bookacti_refresh_redirect_url_by_group_category_table()}),
$j("#bookacti-calendars").length&&$j("#bookacti-calendars").trigger("change"),$j("#bookacti-form-field-dialog-calendar").on("change","select#bookacti-activities",function(){bookacti_refresh_redirect_url_by_activity_table()}),$j("#bookacti-form-field-dialog-calendar").on("change","select#bookacti-group_categories",function(){bookacti_refresh_redirect_url_by_group_category_table()}),$j("#bookacti-form-field-dialog-calendar").on("change","select#bookacti-group_categories",function(){"none"===$j(this).val()?
$j("#bookacti-groups_only-container, #bookacti-groups_single_events-container").hide():$j("#bookacti-groups_only-container, #bookacti-groups_single_events-container").show()}),$j("#bookacti-form-field-dialog-calendar").on("change","input#bookacti-bookings_only",function(){$j(this).is(":checked")?($j("#bookacti-status-container, #bookacti-user_id-container, #bookacti-booked-events-fieldset").show(),$j("#bookacti-hide_availability-container").hide()):($j("#bookacti-status-container, #bookacti-user_id-container").hide(),
$j("#bookacti-hide_availability-container").show())}),$j("#bookacti-form-field-dialog-calendar").on("change","select#bookacti-form_action",function(){$j(".bookacti-activities-actions-options-table, .bookacti-group-categories-actions-options-table").show();"default"===$j(this).val()?$j(".bookacti-activities-actions-options-table, .bookacti-group-categories-actions-options-table").hide():"redirect_to_url"===$j(this).val()&&$j(".bookacti-activities-actions-options-table .bookacti-column-redirect_url, .bookacti-group-categories-actions-options-table .bookacti-column-redirect_url").show();
"none"===$j("select#bookacti-group_categories").val()&&$j(".bookacti-group-categories-actions-options-table").hide()}),$j("#bookacti-form-field-dialog-calendar").on("change","select#bookacti-form_action",function(){$j(".bookacti-activities-actions-options-table .bookacti-column-product, .bookacti-group-categories-actions-options-table .bookacti-column-product").hide();if("redirect_to_product_page"===$j(this).val()||"add_product_to_cart"===$j(this).val())$j(".bookacti-activities-actions-options-table .bookacti-column-redirect_url, .bookacti-group-categories-actions-options-table .bookacti-column-redirect_url").hide(),
$j(".bookacti-activities-actions-options-table .bookacti-column-product, .bookacti-group-categories-actions-options-table .bookacti-column-product").show();"none"===$j("select#bookacti-group_categories").val()&&$j(".bookacti-group-categories-actions-options-table").hide()}),$j("#bookacti-form-field-dialog-calendar").on("change","#bookacti-availability_period_start-container .bookacti-duration-value",function(){0===parseInt($j(this).val())||""===$j(this).val()?$j("#bookacti-past_events-container").closest("fieldset").show():
$j("#bookacti-past_events-container").closest("fieldset").hide()}),$j("#bookacti-form-field-dialog-calendar").on("change","#bookacti-availability_period_start-container .bookacti-duration-value, #bookacti-availability_period_end-container .bookacti-duration-value",function(){$j("#bookacti-availability_period_start-container .bookacti-form-error, #bookacti-availability_period_end-container .bookacti-form-error").remove();var a=parseInt($j("#bookacti-availability_period_start-container .bookacti-duration-value").val()),
b=parseInt($j("#bookacti-availability_period_end-container .bookacti-duration-value").val());a&&b&&a>b&&$j(this).parent().append("<div class='bookacti-form-error'>"+bookacti_localized.error_availability_period+"</div>")}),$j("#bookacti-form-field-dialog-calendar").on("change","#bookacti-start, #bookacti-end",function(){$j("#bookacti-start-container .bookacti-form-error, #bookacti-end-container .bookacti-form-error").remove();var a=$j("#bookacti-start").val(),b=$j("#bookacti-end").val();a&&b&&(a=moment.utc(a),
b=moment.utc(b),a.isAfter(b)&&$j(this).parent().append("<div class='bookacti-form-error'>"+bookacti_localized.error_closing_before_opening+"</div>"))}),$j("#bookacti-form-field-dialog-calendar").on("change","input#bookacti-past_events",function(){$j(this).is(":checked")?$j("#bookacti-past_events_bookable-container").show():$j("#bookacti-past_events_bookable-container").hide()}),$j("#bookacti-form-editor").on("bookacti_field_updated bookacti_field_reset",function(a,b,c,d){"calendar"===c?(a=$j("#bookacti-form-editor-field-"+
b+" .bookacti-booking-system"),b=a.attr("id"),a.empty(),bookacti_clear_booking_system_displayed_info(a),bookacti.booking_system[b]=d.booking_system_attributes?d.booking_system_attributes:[],bookacti_reload_booking_system(a)):"login"===c&&(d=$j("#bookacti-form-editor .bookacti-form-field-container.bookacti-form-field-type-login"),bookacti_show_hide_register_fields(d))}),$j(window).on("beforeunload",function(a){if($j("#major-publishing-actions").data("popup"))return!0}),window.onerror=function(a,b,
c,d,e){$j("#bookacti-fatal-error").show()},$j("#bookacti-exit-loading").on("click",function(){bookacti_form_editor_exit_loading_state();var a=$j("#bookacti-booking-system-form-editor-container .bookacti-booking-system");a.length&&bookacti_stop_loading_booking_system(a,!0)}))});
function bookacti_save_form(){$j("#bookacti-form-editor-container").appendTo("#bookacti-form-editor-page-container");var a=$j("form#bookacti-form-editor-page-form"),b=a.find('input[name="is_active"]').val(),c=a.serialize();$j("#bookacti-form-editor-container").appendTo("#postdivrich");$j("#publishing-action .spinner").css("visibility","visible");bookacti_form_editor_enter_loading_state();$j.ajax({url:ajaxurl,data:c,type:"POST",dataType:"json",success:function(d){$j(".bookacti-form-notice").remove();
if("success"===d.status)$j("body").trigger("bookacti_form_updated"),0==b?($j("#major-publishing-actions").data("popup",0),window.location.replace(a.attr("action")+"&notice=published")):$j("#bookacti-form-editor-page-container").before('<div class="notice notice-success is-dismissible bookacti-form-notice" ><p>'+d.message+"</p></div>");else if("failed"===d.status){var e="undefined"!==typeof d.message?d.message:bookacti_localized.error;$j("#bookacti-form-editor-page-container").before('<div class="notice notice-error is-dismissible bookacti-form-notice" ><p>'+
e+"</p></div>");console.log(e);console.log(d)}},error:function(d){var e="AJAX "+bookacti_localized.error;$j("#bookacti-form-editor-page-container").before('<div class="notice notice-error is-dismissible bookacti-form-notice" ><p>'+e+"</p></div>");console.log(e);console.log(d)},complete:function(){$j("#publishing-action .spinner").css("visibility","hidden");bookacti_form_editor_exit_loading_state()}})}
function bookacti_save_form_field_order(){var a=$j("#bookacti-form-id").val();if($j.isNumeric(a)){var b=[];$j(".bookacti-form-editor-field").each(function(){b.push($j(this).data("field-id"))});b.length&&(a={action:"bookactiSaveFormFieldOrder",form_id:a,field_order:b,nonce:$j('#bookacti-form-editor-page-form input[name="nonce"]').val()},bookacti_form_editor_enter_loading_state(),$j.ajax({url:ajaxurl,data:a,type:"POST",dataType:"json",success:function(c){"success"===c.status?(bookacti.form_editor.form.field_order=
c.field_order,$j("#bookacti-form-editor").trigger("bookacti_form_field_order_updated")):"failed"===c.status&&(console.log("undefined"!==typeof c.message?c.message:bookacti_localized.error),console.log(c))},error:function(c){console.log("AJAX "+bookacti_localized.error);console.log(c)},complete:function(){bookacti_form_editor_exit_loading_state()}}))}}
function bookacti_form_editor_enter_loading_state(){$j(".bookacti-form-editor-action, .bookacti-form-editor-field-action").addClass("bookacti-disabled")}function bookacti_form_editor_exit_loading_state(){$j(".bookacti-form-editor-action, .bookacti-form-editor-field-action").removeClass("bookacti-disabled")}
function bookacti_refresh_redirect_url_by_activity_table(){var a=$j("select#bookacti-activities").val();"all"===a&&(a=[],$j("select#bookacti-activities").find("option:not(:disabled)").each(function(){var c=$j(this).attr("value");$j.isNumeric(c)&&a.push(c)}));if(a&&($j.isArray(a)||$j.isNumeric(a))){$j.isArray(a)||(a=[a]);var b=$j(".bookacti-activities-actions-options-table tbody");$j.each(a,function(c,d){c=$j("option#bookacti-activities_"+d).text();if(b.find('.bookacti-column-redirect_url input[name="redirect_url_by_activity['+
d+']"]').length){var e=b.find('.bookacti-column-redirect_url input[name="redirect_url_by_activity['+d+']"]').closest("tr");e.data("activity_id",d);e.attr("data-activity_id",d);e.find(".bookacti-column-activity").text(c).attr("title",c);e.find(":input").prop("disabled",!1);e.show();return!0}b.find("tr:first").clone().appendTo(b);b.find("tr:last .select2").remove();b.find("tr:last :input").each(function(){var f=$j(this).attr("name");f=f.substring(0,f.lastIndexOf("["));$j(this).attr("name",f+"["+d+"]");
$j(this).removeClass("select2-hidden-accessible")});b.find("tr:last td.bookacti-column-activity").text(c).attr("title",c);b.find("tr:last :input").val("").prop("disabled",!1);b.find("tr:last").closest("tr").data("activity_id",d);b.find("tr:last").closest("tr").attr("data-activity_id",d);bookacti_select2_init();b.find("tr:last").show()});b.find("tr").each(function(){var c=$j(this);if(!c.data("activity_id"))return $j(this).remove(),!0;var d=c.data("activity_id");-1===$j.inArray(d,a)&&(c.find(":input").prop("disabled",
!0),c.hide())})}}
function bookacti_refresh_redirect_url_by_group_category_table(){var a=$j("#bookacti-group_categories").val(),b=$j(".bookacti-group-categories-actions-options-table").is(":visible");"none"===a&&($j(".bookacti-group-categories-actions-options-table").hide(),$j(".bookacti-group-categories-actions-options-table :input").prop("disabled",!0));"all"===a&&(a=[],$j("#bookacti-group_categories").find("option:not(:disabled)").each(function(){var d=$j(this).attr("value");$j.isNumeric(d)&&a.push(d)}));if(a&&
($j.isArray(a)||$j.isNumeric(a))){$j.isArray(a)||(a=[a]);b||"default"===$j("select#bookacti-form_action").val()||$j(".bookacti-group-categories-actions-options-table").show();$j(".bookacti-group-categories-actions-options-table :input").prop("disabled",!1);var c=$j(".bookacti-group-categories-actions-options-table tbody");$j.each(a,function(d,e){d=$j("option#bookacti-group_categories_"+e).text();if(c.find('.bookacti-column-redirect_url input[name="redirect_url_by_group_category['+e+']"]').length){var f=
c.find('.bookacti-column-redirect_url input[name="redirect_url_by_group_category['+e+']"]').closest("tr");f.data("category_id",e);f.attr("data-category_id",e);f.find(".bookacti-column-group_category").text(d).attr("title",d);f.find(":input").prop("disabled",!1);f.show();return!0}c.find("tr:first").clone().appendTo(c);c.find("tr:last .select2").remove();c.find("tr:last :input").each(function(){var g=$j(this).attr("name");g=g.substring(0,g.lastIndexOf("["));$j(this).attr("name",g+"["+e+"]");$j(this).removeClass("select2-hidden-accessible")});
c.find("tr:last td.bookacti-column-group_category").text(d).attr("title",d);c.find("tr:last :input").val("").prop("disabled",!1);c.find("tr:last").closest("tr").data("category_id",e);c.find("tr:last").closest("tr").attr("data-category_id",e);bookacti_select2_init();c.find("tr:last").show()});c.find("tr").each(function(){var d=$j(this);if(!d.data("category_id"))return $j(this).remove(),!0;var e=d.data("category_id");-1===$j.inArray(e,a)&&(d.find(":input").prop("disabled",!0),d.hide())})}};
