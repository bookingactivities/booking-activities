$j(document).ready(function(){if(!$j("form#bookacti-form-editor-page-form").length||typeof bookacti.form_editor==="undefined"){return}bookacti_init_add_and_remove_items();$j("#bookacti-form-managers-select-box option").prop("selected",true);var b=$j("#bookacti-form-managers-select-box").val();$j("#bookacti-form-managers-select-box").empty();if(b){if(b.length){var c=$j("#bookacti-form-managers-container");bookacti_fill_items_selectbox(c,b)}}$j("#bookacti-form-field-dialog-free_text").dialog("option","width",540);$j("#bookacti-form-field-dialog-terms").dialog("option","width",540);bookacti_init_form_editor_actions();$j("#bookacti-form-editor").on("click",".bookacti-form-editor-field-header",function(i){if($j(i.target).closest(".bookacti-form-editor-field-action").length){return}var h=$j(this).find(".bookacti-field-toggle");h.toggleClass("dashicons-arrow-up dashicons-arrow-down");h.closest(".bookacti-form-editor-field").find(".bookacti-form-editor-field-body").toggle();var g=h.closest(".bookacti-form-editor-field").find(".bookacti-form-editor-field-body").is(":visible");var f=h.closest(".bookacti-form-editor-field").find(".bookacti-booking-system");if(g&&f.length){bookacti_booking_method_rerender_events(f)}});$j("#bookacti-form-editor").sortable({items:".bookacti-form-editor-field:not(.ui-state-disabled):not(.bookacti-form-editor-promo-field)",handle:".bookacti-form-editor-field-title",placeholder:"bookacti-form-editor-field-placeholder",update:function(g,f){bookacti_save_form_field_order()}});$j("#bookacti-form-editor").disableSelection();$j("form#bookacti-form-editor-page-form").on("submit",function(f){if(!$j("form#bookacti-form-editor-page-form").length){return}f.preventDefault();bookacti_save_form()});if($j("#bookacti-calendars").length){var d=$j("#bookacti-calendars").val();var a=$j("[data-bookacti-show-if-templates]");bookacti_show_hide_template_related_options(d,a)}$j("#bookacti-form-field-dialog-calendar").on("change","select#bookacti-calendars, select#bookacti-activities",function(){var g=$j("#bookacti-calendars").val();var f=$j("[data-bookacti-show-if-templates]");bookacti_show_hide_template_related_options(g,f);var h=$j("select#bookacti-activities").val();if(h==="all"){h=[];$j("select#bookacti-activities").find("option:not(:disabled)").each(function(){var i=$j(this).attr("value");if($j.isNumeric(i)){h.push(i)}})}if(!h||(!$j.isArray(h)&&!$j.isNumeric(h))){return}if(!$j.isArray(h)){h=[h]}var e=$j(".bookacti-activities-actions-options-table tbody");$j.each(h,function(k,l){var j=$j("option#bookacti-activities_"+l).text();if(e.find('.bookacti-column-redirect_url input[name="redirect_url_by_activity['+l+']"]').length){var m=e.find('.bookacti-column-redirect_url input[name="redirect_url_by_activity['+l+']"]').closest("tr");m.data("activity_id",l);m.attr("data-activity_id",l);m.find(".bookacti-column-activity").text(j).attr("title",j);m.find(":input").prop("disabled",false);m.show();return true}else{e.find("tr:first").clone().appendTo(e);e.find("tr:last .select2").remove();e.find("tr:last :input").each(function(){var n=$j(this).attr("name");var i=n.substring(0,n.lastIndexOf("["));$j(this).attr("name",i+"["+l+"]");$j(this).removeClass("select2-hidden-accessible")});e.find("tr:last td.bookacti-column-activity").text(j).attr("title",j);e.find("tr:last :input").val("").prop("disabled",false);e.find("tr:last").closest("tr").data("activity_id",l);e.find("tr:last").closest("tr").attr("data-activity_id",l);bookacti_select2_init();e.find("tr:last").show()}});e.find("tr").each(function(){var j=$j(this);if(!j.data("activity_id")){$j(this).remove();return true}var i=j.data("activity_id");if($j.inArray(i,h)===-1){j.find(":input").prop("disabled",true);j.hide()}})});$j("#bookacti-form-field-dialog-calendar").on("change","select#bookacti-calendars, select#bookacti-group_categories",function(){var g=$j("#bookacti-group_categories").val();var f=$j(".bookacti-group-categories-actions-options-table").is(":visible");if(g==="none"){$j(".bookacti-group-categories-actions-options-table").hide();$j(".bookacti-group-categories-actions-options-table :input").prop("disabled",true)}if(g==="all"){g=[];$j("#bookacti-group_categories").find("option:not(:disabled)").each(function(){var h=$j(this).attr("value");if($j.isNumeric(h)){g.push(h)}})}if(!g||(!$j.isArray(g)&&!$j.isNumeric(g))){return}if(!$j.isArray(g)){g=[g]}if(!f&&$j("select#bookacti-form_action").val()!=="default"){$j(".bookacti-group-categories-actions-options-table").show()}$j(".bookacti-group-categories-actions-options-table :input").prop("disabled",false);var e=$j(".bookacti-group-categories-actions-options-table tbody");$j.each(g,function(h,j){var k=$j("option#bookacti-group_categories_"+j).text();if(e.find('.bookacti-column-redirect_url input[name="redirect_url_by_group_category['+j+']"]').length){var l=e.find('.bookacti-column-redirect_url input[name="redirect_url_by_group_category['+j+']"]').closest("tr");l.data("category_id",j);l.attr("data-category_id",j);l.find(".bookacti-column-group_category").text(k).attr("title",k);l.find(":input").prop("disabled",false);l.show();return true}else{e.find("tr:first").clone().appendTo(e);e.find("tr:last .select2").remove();e.find("tr:last :input").each(function(){var m=$j(this).attr("name");var i=m.substring(0,m.lastIndexOf("["));$j(this).attr("name",i+"["+j+"]");$j(this).removeClass("select2-hidden-accessible")});e.find("tr:last td.bookacti-column-group_category").text(k).attr("title",k);e.find("tr:last :input").val("").prop("disabled",false);e.find("tr:last").closest("tr").data("category_id",j);e.find("tr:last").closest("tr").attr("data-category_id",j);bookacti_select2_init();e.find("tr:last").show()}});e.find("tr").each(function(){var i=$j(this);if(!i.data("category_id")){$j(this).remove();return true}var h=i.data("category_id");if($j.inArray(h,g)===-1){i.find(":input").prop("disabled",true);i.hide()}})});$j("#bookacti-form-field-dialog-calendar").on("change","select#bookacti-group_categories",function(){if($j(this).val()==="none"){$j("#bookacti-groups_only-container, #bookacti-groups_single_events-container").hide()}else{$j("#bookacti-groups_only-container, #bookacti-groups_single_events-container").show()}});$j("#bookacti-form-field-dialog-calendar").on("change","input#bookacti-bookings_only",function(){if($j(this).is(":checked")){$j("#bookacti-status-container, #bookacti-user_id-container, #bookacti-booked-events-fieldset").show();$j("#bookacti-hide_availability-container").hide()}else{$j("#bookacti-status-container, #bookacti-user_id-container").hide();$j("#bookacti-hide_availability-container").show()}});$j("#bookacti-form-field-dialog-calendar").on("change","select#bookacti-form_action",function(){$j(".bookacti-activities-actions-options-table, .bookacti-group-categories-actions-options-table").show();if($j(this).val()==="default"){$j(".bookacti-activities-actions-options-table, .bookacti-group-categories-actions-options-table").hide()}else{if($j(this).val()==="redirect_to_url"){$j(".bookacti-activities-actions-options-table .bookacti-column-redirect_url, .bookacti-group-categories-actions-options-table .bookacti-column-redirect_url").show()}}if($j("select#bookacti-group_categories").val()==="none"){$j(".bookacti-group-categories-actions-options-table").hide()}});$j("#bookacti-form-field-dialog-calendar").on("change","select#bookacti-form_action",function(){$j(".bookacti-activities-actions-options-table .bookacti-column-product, .bookacti-group-categories-actions-options-table .bookacti-column-product").hide();if($j(this).val()==="redirect_to_product_page"||$j(this).val()==="add_product_to_cart"){$j(".bookacti-activities-actions-options-table .bookacti-column-redirect_url, .bookacti-group-categories-actions-options-table .bookacti-column-redirect_url").hide();$j(".bookacti-activities-actions-options-table .bookacti-column-product, .bookacti-group-categories-actions-options-table .bookacti-column-product").show()}if($j("select#bookacti-group_categories").val()==="none"){$j(".bookacti-group-categories-actions-options-table").hide()}});$j("#bookacti-form-field-dialog-calendar").on("change","#bookacti-availability_period_start-container .bookacti-duration-value",function(){if(parseInt($j(this).val())===0||$j(this).val()===""){$j("#bookacti-past_events-container").closest("fieldset").show()}else{$j("#bookacti-past_events-container").closest("fieldset").hide()}});$j("#bookacti-form-field-dialog-calendar").on("change","#bookacti-availability_period_start-container .bookacti-duration-value, #bookacti-availability_period_end-container .bookacti-duration-value",function(){$j("#bookacti-availability_period_start-container .bookacti-form-error, #bookacti-availability_period_end-container .bookacti-form-error").remove();var f=parseInt($j("#bookacti-availability_period_start-container .bookacti-duration-value").val());var e=parseInt($j("#bookacti-availability_period_end-container .bookacti-duration-value").val());if(f&&e){if(f>e){$j(this).parent().append("<div class='bookacti-form-error'>"+bookacti_localized.error_availability_period+"</div>")}}});$j("#bookacti-form-field-dialog-calendar").on("change","#bookacti-start, #bookacti-end",function(){$j("#bookacti-start-container .bookacti-form-error, #bookacti-end-container .bookacti-form-error").remove();var e=$j("#bookacti-start").val();var f=$j("#bookacti-end").val();if(e&&f){e=moment.utc(e);f=moment.utc(f);if(e.isAfter(f)){$j(this).parent().append("<div class='bookacti-form-error'>"+bookacti_localized.error_closing_before_opening+"</div>")}}});$j("#bookacti-form-field-dialog-calendar").on("change","input#bookacti-past_events",function(){if($j(this).is(":checked")){$j("#bookacti-past_events_bookable-container").show()}else{$j("#bookacti-past_events_bookable-container").hide()}});$j("#bookacti-form-editor").on("bookacti_field_updated bookacti_field_reset",function(l,j,k,h){if(k==="calendar"){var g=$j("#bookacti-form-editor-field-"+j+" .bookacti-booking-system");var f=g.attr("id");g.empty();bookacti_clear_booking_system_displayed_info(g);bookacti.booking_system[f]=h.booking_system_attributes?h.booking_system_attributes:[];bookacti_reload_booking_system(g)}else{if(k==="login"){var i=$j("#bookacti-form-editor .bookacti-form-field-container.bookacti-form-field-type-login");bookacti_show_hide_register_fields(i)}}});$j(window).on("beforeunload",function(f){if($j("#major-publishing-actions").data("popup")){return true}else{f=null}});window.onerror=function(i,f,e,h,g){$j("#bookacti-fatal-error").show()};$j("#bookacti-exit-loading").on("click",function(){bookacti_form_editor_exit_loading_state();var e=$j("#bookacti-booking-system-form-editor-container .bookacti-booking-system");if(e.length){bookacti_stop_loading_booking_system(e,true)}})});function bookacti_save_form(){$j("#bookacti-form-managers-select-box option").prop("selected",true);$j("#bookacti-form-editor-container").appendTo("#bookacti-form-editor-page-container");var a=$j("form#bookacti-form-editor-page-form");var c=a.find('input[name="is_active"]').val();var b=a.serialize();$j("#bookacti-form-editor-container").appendTo("#postdivrich");$j("#publishing-action .spinner").css("visibility","visible");bookacti_form_editor_enter_loading_state();$j.ajax({url:ajaxurl,data:b,type:"POST",dataType:"json",success:function(d){$j(".bookacti-form-notice").remove();if(d.status==="success"){$j("body").trigger("bookacti_form_updated");if(c==0){$j("#major-publishing-actions").data("popup",0);window.location.replace(a.attr("action")+"&notice=published")}else{$j("#bookacti-form-editor-page-container").before('<div class="notice notice-success is-dismissible bookacti-form-notice" ><p>'+d.message+"</p></div>")}}else{if(d.status==="failed"){var e=typeof d.message!=="undefined"?d.message:bookacti_localized.error;$j("#bookacti-form-editor-page-container").before('<div class="notice notice-error is-dismissible bookacti-form-notice" ><p>'+e+"</p></div>");console.log(e);console.log(d)}}},error:function(f){var d="AJAX "+bookacti_localized.error;$j("#bookacti-form-editor-page-container").before('<div class="notice notice-error is-dismissible bookacti-form-notice" ><p>'+d+"</p></div>");console.log(d);console.log(f)},complete:function(){$j("#publishing-action .spinner").css("visibility","hidden");bookacti_form_editor_exit_loading_state()}})}function bookacti_save_form_field_order(){var a=$j("#bookacti-form-id").val();if(!$j.isNumeric(a)){return}var d=[];$j(".bookacti-form-editor-field").each(function(){d.push($j(this).data("field-id"))});if(!d.length){return}var b=$j("#bookacti_nonce_form_field_order").val();var c={action:"bookactiSaveFormFieldOrder",form_id:a,field_order:d,nonce:b};bookacti_form_editor_enter_loading_state();$j.ajax({url:ajaxurl,data:c,type:"POST",dataType:"json",success:function(e){if(e.status==="success"){bookacti.form_editor.form.field_order=e.field_order;$j("#bookacti-form-editor").trigger("bookacti_form_field_order_updated")}else{if(e.status==="failed"){var f=typeof e.message!=="undefined"?e.message:bookacti_localized.error;console.log(f);console.log(e)}}},error:function(g){var f="AJAX "+bookacti_localized.error;console.log(f);console.log(g)},complete:function(){bookacti_form_editor_exit_loading_state()}})}function bookacti_form_editor_enter_loading_state(){$j(".bookacti-form-editor-action, .bookacti-form-editor-field-action").addClass("bookacti-disabled")}function bookacti_form_editor_exit_loading_state(){$j(".bookacti-form-editor-action, .bookacti-form-editor-field-action").removeClass("bookacti-disabled")};