$j(document).ready(function(){if($j("form#bookacti-form-editor-page-form").length&&"undefined"!==typeof bookacti.form_editor){$j("#bookacti-form-managers-select-box option").prop("selected",!0);var c=$j("#bookacti-form-managers-select-box").val();$j("#bookacti-form-managers-select-box").empty();if(c&&c.length){var e=$j("#bookacti-form-managers-container");bookacti_fill_items_selectbox(e,c)}$j("#bookacti-form-field-dialog-free_text").dialog("option","width",540);$j("#bookacti-form-field-dialog-terms").dialog("option",
"width",540);bookacti_init_form_editor_actions();$j("#bookacti-form-editor").on("click",".bookacti-form-editor-field-header",function(b){if(!$j(b.target).closest(".bookacti-form-editor-field-action").length){var a=$j(this).find(".bookacti-field-toggle");a.toggleClass("dashicons-arrow-up dashicons-arrow-down");a.closest(".bookacti-form-editor-field").find(".bookacti-form-editor-field-body").toggle();b=a.closest(".bookacti-form-editor-field").find(".bookacti-form-editor-field-body").is(":visible");
a=a.closest(".bookacti-form-editor-field").find(".bookacti-booking-system");b&&a.length&&bookacti_booking_method_rerender_events(a)}});$j("#bookacti-form-editor").sortable({items:".bookacti-form-editor-field:not(.ui-state-disabled):not(.bookacti-form-editor-promo-field)",handle:".bookacti-form-editor-field-title",placeholder:"bookacti-form-editor-field-placeholder",update:function(b,a){bookacti_save_form_field_order()}});$j("#bookacti-form-editor").disableSelection();$j("form#bookacti-form-editor-page-form").on("submit",
function(b){$j("form#bookacti-form-editor-page-form").length&&(b.preventDefault(),bookacti_save_form())});$j("#bookacti-form-editor").on("bookacti_field_update_dialog",function(b,a,d){"calendar"===d&&(bookacti_delete_days_off_rows($j("#bookacti-form-field-dialog-calendar .bookacti-date-intervals-table-container")),$j("#bookacti-form-field-dialog-calendar input.bookacti-date-interval-from, #bookacti-form-field-dialog-calendar input.bookacti-date-interval-to").attr("min","").attr("max",""),b=bookacti.form_editor.fields[a],
b.hasOwnProperty("days_off")&&($j.isEmptyObject(b.days_off)||bookacti_fill_days_off($j("#bookacti-form-field-dialog-calendar .bookacti-date-intervals-table-container"),b.days_off)))});$j("#bookacti-form-field-dialog-calendar").on("change","select#bookacti-calendars",function(){var b=$j("#bookacti-calendars").val(),a=$j("[data-bookacti-show-if-templates]");bookacti_show_hide_template_related_options(b,a);bookacti_refresh_redirect_url_by_activity_table();bookacti_refresh_redirect_url_by_group_category_table()});
$j("#bookacti-calendars").length&&$j("#bookacti-calendars").trigger("change");$j("#bookacti-form-field-dialog-calendar").on("change","select#bookacti-activities",function(){bookacti_refresh_redirect_url_by_activity_table()});$j("#bookacti-form-field-dialog-calendar").on("change","select#bookacti-group_categories",function(){bookacti_refresh_redirect_url_by_group_category_table()});$j("#bookacti-form-field-dialog-calendar").on("change","select#bookacti-group_categories",function(){"none"===$j(this).val()?
$j("#bookacti-groups_only-container, #bookacti-groups_single_events-container").hide():$j("#bookacti-groups_only-container, #bookacti-groups_single_events-container").show()});$j("#bookacti-form-field-dialog-calendar").on("change","input#bookacti-bookings_only",function(){$j(this).is(":checked")?($j("#bookacti-status-container, #bookacti-user_id-container, #bookacti-booked-events-fieldset").show(),$j("#bookacti-hide_availability-container").hide()):($j("#bookacti-status-container, #bookacti-user_id-container").hide(),
$j("#bookacti-hide_availability-container").show())});$j("#bookacti-form-field-dialog-calendar").on("change","select#bookacti-form_action",function(){$j(".bookacti-activities-actions-options-table, .bookacti-group-categories-actions-options-table").show();"default"===$j(this).val()?$j(".bookacti-activities-actions-options-table, .bookacti-group-categories-actions-options-table").hide():"redirect_to_url"===$j(this).val()&&$j(".bookacti-activities-actions-options-table .bookacti-column-redirect_url, .bookacti-group-categories-actions-options-table .bookacti-column-redirect_url").show();
"none"===$j("select#bookacti-group_categories").val()&&$j(".bookacti-group-categories-actions-options-table").hide()});$j("#bookacti-form-field-dialog-calendar").on("change","select#bookacti-form_action",function(){$j(".bookacti-activities-actions-options-table .bookacti-column-product, .bookacti-group-categories-actions-options-table .bookacti-column-product").hide();if("redirect_to_product_page"===$j(this).val()||"add_product_to_cart"===$j(this).val())$j(".bookacti-activities-actions-options-table .bookacti-column-redirect_url, .bookacti-group-categories-actions-options-table .bookacti-column-redirect_url").hide(),
$j(".bookacti-activities-actions-options-table .bookacti-column-product, .bookacti-group-categories-actions-options-table .bookacti-column-product").show();"none"===$j("select#bookacti-group_categories").val()&&$j(".bookacti-group-categories-actions-options-table").hide()});$j("#bookacti-form-field-dialog-calendar").on("change","#bookacti-availability_period_start-container .bookacti-duration-value",function(){0===parseInt($j(this).val())||""===$j(this).val()?$j("#bookacti-past_events-container").closest("fieldset").show():
$j("#bookacti-past_events-container").closest("fieldset").hide()});$j("#bookacti-form-field-dialog-calendar").on("change","#bookacti-availability_period_start-container .bookacti-duration-value, #bookacti-availability_period_end-container .bookacti-duration-value",function(){$j("#bookacti-availability_period_start-container .bookacti-form-error, #bookacti-availability_period_end-container .bookacti-form-error").remove();var b=parseInt($j("#bookacti-availability_period_start-container .bookacti-duration-value").val()),
a=parseInt($j("#bookacti-availability_period_end-container .bookacti-duration-value").val());b&&a&&b>a&&$j(this).parent().append("<div class='bookacti-form-error'>"+bookacti_localized.error_availability_period+"</div>")});$j("#bookacti-form-field-dialog-calendar").on("change","#bookacti-start, #bookacti-end",function(){$j("#bookacti-start-container .bookacti-form-error, #bookacti-end-container .bookacti-form-error").remove();var b=$j("#bookacti-start").val(),a=$j("#bookacti-end").val();b&&a&&(b=moment.utc(b),
a=moment.utc(a),b.isAfter(a)&&$j(this).parent().append("<div class='bookacti-form-error'>"+bookacti_localized.error_closing_before_opening+"</div>"))});$j("#bookacti-form-field-dialog-calendar").on("change","input#bookacti-past_events",function(){$j(this).is(":checked")?$j("#bookacti-past_events_bookable-container").show():$j("#bookacti-past_events_bookable-container").hide()});$j("#bookacti-form-editor").on("bookacti_field_updated bookacti_field_reset",function(b,a,d,f){"calendar"===d?(b=$j("#bookacti-form-editor-field-"+
a+" .bookacti-booking-system"),a=b.attr("id"),b.empty(),bookacti_clear_booking_system_displayed_info(b),bookacti.booking_system[a]=f.booking_system_attributes?f.booking_system_attributes:[],bookacti_reload_booking_system(b)):"login"===d&&(f=$j("#bookacti-form-editor .bookacti-form-field-container.bookacti-form-field-type-login"),bookacti_show_hide_register_fields(f))});$j(window).on("beforeunload",function(b){if($j("#major-publishing-actions").data("popup"))return!0});window.onerror=function(b,a,
d,f,g){$j("#bookacti-fatal-error").show()};$j("#bookacti-exit-loading").on("click",function(){bookacti_form_editor_exit_loading_state();var b=$j("#bookacti-booking-system-form-editor-container .bookacti-booking-system");b.length&&bookacti_stop_loading_booking_system(b,!0)})}});
function bookacti_save_form(){$j("#bookacti-form-managers-select-box option").prop("selected",!0);$j("#bookacti-form-editor-container").appendTo("#bookacti-form-editor-page-container");var c=$j("form#bookacti-form-editor-page-form"),e=c.find('input[name="is_active"]').val(),b=c.serialize();$j("#bookacti-form-editor-container").appendTo("#postdivrich");$j("#publishing-action .spinner").css("visibility","visible");bookacti_form_editor_enter_loading_state();$j.ajax({url:ajaxurl,data:b,type:"POST",dataType:"json",
success:function(a){$j(".bookacti-form-notice").remove();if("success"===a.status)$j("body").trigger("bookacti_form_updated"),0==e?($j("#major-publishing-actions").data("popup",0),window.location.replace(c.attr("action")+"&notice=published")):$j("#bookacti-form-editor-page-container").before('<div class="notice notice-success is-dismissible bookacti-form-notice" ><p>'+a.message+"</p></div>");else if("failed"===a.status){var d="undefined"!==typeof a.message?a.message:bookacti_localized.error;$j("#bookacti-form-editor-page-container").before('<div class="notice notice-error is-dismissible bookacti-form-notice" ><p>'+
d+"</p></div>");console.log(d);console.log(a)}},error:function(a){var d="AJAX "+bookacti_localized.error;$j("#bookacti-form-editor-page-container").before('<div class="notice notice-error is-dismissible bookacti-form-notice" ><p>'+d+"</p></div>");console.log(d);console.log(a)},complete:function(){$j("#publishing-action .spinner").css("visibility","hidden");bookacti_form_editor_exit_loading_state()}})}
function bookacti_save_form_field_order(){var c=$j("#bookacti-form-id").val();if($j.isNumeric(c)){var e=[];$j(".bookacti-form-editor-field").each(function(){e.push($j(this).data("field-id"))});if(e.length){var b=$j("#bookacti_nonce_form_field_order").val();c={action:"bookactiSaveFormFieldOrder",form_id:c,field_order:e,nonce:b};bookacti_form_editor_enter_loading_state();$j.ajax({url:ajaxurl,data:c,type:"POST",dataType:"json",success:function(a){"success"===a.status?(bookacti.form_editor.form.field_order=
a.field_order,$j("#bookacti-form-editor").trigger("bookacti_form_field_order_updated")):"failed"===a.status&&(console.log("undefined"!==typeof a.message?a.message:bookacti_localized.error),console.log(a))},error:function(a){console.log("AJAX "+bookacti_localized.error);console.log(a)},complete:function(){bookacti_form_editor_exit_loading_state()}})}}}
function bookacti_form_editor_enter_loading_state(){$j(".bookacti-form-editor-action, .bookacti-form-editor-field-action").addClass("bookacti-disabled")}function bookacti_form_editor_exit_loading_state(){$j(".bookacti-form-editor-action, .bookacti-form-editor-field-action").removeClass("bookacti-disabled")}
function bookacti_refresh_redirect_url_by_activity_table(){var c=$j("select#bookacti-activities").val();"all"===c&&(c=[],$j("select#bookacti-activities").find("option:not(:disabled)").each(function(){var b=$j(this).attr("value");$j.isNumeric(b)&&c.push(b)}));if(c&&($j.isArray(c)||$j.isNumeric(c))){$j.isArray(c)||(c=[c]);var e=$j(".bookacti-activities-actions-options-table tbody");$j.each(c,function(b,a){b=$j("option#bookacti-activities_"+a).text();if(e.find('.bookacti-column-redirect_url input[name="redirect_url_by_activity['+
a+']"]').length){var d=e.find('.bookacti-column-redirect_url input[name="redirect_url_by_activity['+a+']"]').closest("tr");d.data("activity_id",a);d.attr("data-activity_id",a);d.find(".bookacti-column-activity").text(b).attr("title",b);d.find(":input").prop("disabled",!1);d.show();return!0}e.find("tr:first").clone().appendTo(e);e.find("tr:last .select2").remove();e.find("tr:last :input").each(function(){var f=$j(this).attr("name");f=f.substring(0,f.lastIndexOf("["));$j(this).attr("name",f+"["+a+"]");
$j(this).removeClass("select2-hidden-accessible")});e.find("tr:last td.bookacti-column-activity").text(b).attr("title",b);e.find("tr:last :input").val("").prop("disabled",!1);e.find("tr:last").closest("tr").data("activity_id",a);e.find("tr:last").closest("tr").attr("data-activity_id",a);bookacti_select2_init();e.find("tr:last").show()});e.find("tr").each(function(){var b=$j(this);if(!b.data("activity_id"))return $j(this).remove(),!0;var a=b.data("activity_id");-1===$j.inArray(a,c)&&(b.find(":input").prop("disabled",
!0),b.hide())})}}
function bookacti_refresh_redirect_url_by_group_category_table(){var c=$j("#bookacti-group_categories").val(),e=$j(".bookacti-group-categories-actions-options-table").is(":visible");"none"===c&&($j(".bookacti-group-categories-actions-options-table").hide(),$j(".bookacti-group-categories-actions-options-table :input").prop("disabled",!0));"all"===c&&(c=[],$j("#bookacti-group_categories").find("option:not(:disabled)").each(function(){var a=$j(this).attr("value");$j.isNumeric(a)&&c.push(a)}));if(c&&
($j.isArray(c)||$j.isNumeric(c))){$j.isArray(c)||(c=[c]);e||"default"===$j("select#bookacti-form_action").val()||$j(".bookacti-group-categories-actions-options-table").show();$j(".bookacti-group-categories-actions-options-table :input").prop("disabled",!1);var b=$j(".bookacti-group-categories-actions-options-table tbody");$j.each(c,function(a,d){a=$j("option#bookacti-group_categories_"+d).text();if(b.find('.bookacti-column-redirect_url input[name="redirect_url_by_group_category['+d+']"]').length){var f=
b.find('.bookacti-column-redirect_url input[name="redirect_url_by_group_category['+d+']"]').closest("tr");f.data("category_id",d);f.attr("data-category_id",d);f.find(".bookacti-column-group_category").text(a).attr("title",a);f.find(":input").prop("disabled",!1);f.show();return!0}b.find("tr:first").clone().appendTo(b);b.find("tr:last .select2").remove();b.find("tr:last :input").each(function(){var g=$j(this).attr("name");g=g.substring(0,g.lastIndexOf("["));$j(this).attr("name",g+"["+d+"]");$j(this).removeClass("select2-hidden-accessible")});
b.find("tr:last td.bookacti-column-group_category").text(a).attr("title",a);b.find("tr:last :input").val("").prop("disabled",!1);b.find("tr:last").closest("tr").data("category_id",d);b.find("tr:last").closest("tr").attr("data-category_id",d);bookacti_select2_init();b.find("tr:last").show()});b.find("tr").each(function(){var a=$j(this);if(!a.data("category_id"))return $j(this).remove(),!0;var d=a.data("category_id");-1===$j.inArray(d,c)&&(a.find(":input").prop("disabled",!0),a.hide())})}};
