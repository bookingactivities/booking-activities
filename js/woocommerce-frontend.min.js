$j(document).ready(function(){$j(".woocommerce-table").on("bookacti_booking_action_data","tr.order_item",function(f,d,a,b,c){d.context="wc_order_items"});if($j(".woocommerce form.cart.variations_form").length){$j(".woocommerce").on("bookacti_init_booking_sytem","form.cart.variations_form .bookacti-booking-system",function(c,b,a){if(b.load===false){return}if(typeof $j(this).closest(".bookacti-wc-form-fields")!=="undefined"){if($j(this).closest(".bookacti-wc-form-fields").data("default-variation-id")){b.load=false}}});$j(".woocommerce form.cart.variations_form").each(function(){var a=$j(this);if(a.find(".bookacti-booking-system").length&&!a.find(".bookacti-wc-form-fields").length){return true}if(typeof bookacti.form_fields==="undefined"){bookacti.form_fields=[]}a.on("reset_data",function(c){var b=a.find(".bookacti-wc-form-fields");b.data("form-id","");b.attr("data-form-id","");b.data("variation-id","");b.attr("data-variation-id","");b.empty()});a.find(".single_variation_wrap").on("show_variation",function(f,c){var b=a.find(".bookacti-wc-form-fields");bookacti_switch_product_variation_form(b,c);var d=c.bookacti_is_activity?bookacti_localized.add_booking_to_cart_button_text:bookacti_localized.add_product_to_cart_button_text;a.find(".single_add_to_cart_button").text(d)})})}$j(".woocommerce form.cart").on("bookacti_view_refreshed bookacti_displayed_info_cleared",".bookacti-booking-system",function(){$j(this).parents("form").find('input[name="quantity"]').attr("disabled",false);$j(this).parents("form").find('button[type="submit"]').attr("disabled",false)});$j(".woocommerce form.cart").on("bookacti_error_displayed",".bookacti-booking-system",function(){$j(this).parents("form").find('input[name="quantity"]').attr("disabled",true);$j(this).parents("form").find('button[type="submit"]').attr("disabled",true)});if($j(".woocommerce form.cart .single_add_to_cart_button").length){$j(".woocommerce form.cart").on("submit",function(){var c=$j(this);var d=false;if(c.hasClass("variations_form")){var b=c.find(".variation_id").val();if(b!==""&&typeof b!=="undefined"){d=bookacti.is_variation_activity[b]}}else{if(c.find(".bookacti-booking-system-container").length){d=true}}if(d){if(c.find(".bookacti-booking-system").length){var a=bookacti_validate_picked_events(c.find(".bookacti-booking-system"),c.find(".quantity input.qty").val());if(a){c.trigger("bookacti_before_submit_booking_form");return true}else{bookacti_scroll_to(c.find(".bookacti-booking-system-container .bookacti-notices"),500,"middle");return false}}}})}$j(".woocommerce form.cart").on("keyup mouseup change","input.qty",function(){var a=$j(this).parents("form.cart").find(".bookacti-booking-system");if(a.length){bookacti_fill_picked_events_list(a)}});$j(".woocommerce form.cart").on("bookacti_picked_events_list_data",".bookacti-booking-system",function(f,b,d){var a=$j(this);var c=a.parents("form").find(".quantity .qty");if(c.length){bookacti_set_min_and_max_quantity(a,c,b)}});if($j(".bookacti-countdown").length){setInterval(bookacti_countdown,1000)}});function bookacti_switch_product_variation_form(d,c){d.empty();if(!c.bookacti_is_activity||!c.is_in_stock||!c.variation_is_active||!c.variation_is_visible){return}bookacti.is_variation_activity[c.variation_id]=true;var b=parseInt(c.bookacti_form_id);if(!b){return}if(typeof bookacti.form_fields[b]!=="undefined"){bookacti_fill_product_variation_form(d,c,bookacti.form_fields[b]);return}var f='<div class="bookacti-loading-alt"><img class="bookacti-loader" src="'+bookacti_localized.plugin_path+'/img/ajax-loader.gif" title="'+bookacti_localized.loading+'" /><span class="bookacti-loading-alt-text" >'+bookacti_localized.loading+"</span></div>";d.append(f);var e={action:"bookactiGetForm",form_id:b,instance_id:"product-variation-"+c.variation_id,context:"wc_switch_variation"};var a=true;$j.each(c.attributes,function(h,g){if(g!==bookacti_get_url_parameter(h)){a=false;return false}});if(a){e.group_id=bookacti_get_url_parameter("bookacti_group_id");if(e.group_id===null){e.group_id=bookacti_get_url_parameter("event_group_id")}e.event_id=bookacti_get_url_parameter("bookacti_event_id");if(e.event_id===null){e.event_id=bookacti_get_url_parameter("event_id")}e.event_start=bookacti_get_url_parameter("bookacti_event_start");if(e.event_start===null){e.event_start=bookacti_get_url_parameter("event_start")}e.event_end=bookacti_get_url_parameter("bookacti_event_end");if(e.event_end===null){e.event_end=bookacti_get_url_parameter("event_end")}}$j.ajax({url:bookacti_localized.ajaxurl,type:"POST",data:e,dataType:"json",success:function(g){if(g.status==="success"){bookacti.form_fields[b]=g.form_html;bookacti_fill_product_variation_form(d,c,g.form_html)}else{var h=typeof g.message!=="undefined"?g.message:bookacti_localized.error;console.log(h);console.log(g)}},error:function(g){console.log("AJAX "+bookacti_localized.error);console.log(g)},complete:function(){d.find(".bookacti-loading-alt").remove()}})}function bookacti_fill_product_variation_form(c,b,d){c.empty();c.append(d);c.data("form-id",b.bookacti_form_id);c.attr("data-form-id",b.bookacti_form_id);c.data("variation-id",b.variation_id);c.attr("data-variation-id",b.variation_id);var a=c.find(".bookacti-booking-system");bookacti_booking_method_set_up(a);bookacti_init_booking_system_dialogs();bookacti_init_tooltip();a.find(".bookacti-loading-alt").remove();c.trigger("bookacti_product_variation_form_switched",[b])}function bookacti_countdown(){$j(".bookacti-countdown").each(function(){if($j(this).hasClass("bookacti-expired")){$j(this).html(bookacti_localized.expired);return true}var e=$j(this).data("expiration-date");if(!e){return true}e=moment.utc(e);var b=moment.utc();var a=e.diff(b,"seconds");var j=Math.max(Math.floor(a/86400),0);a-=j*86400;var g=Math.max(Math.floor(a/3600)%24,0);a-=g*3600;var c=Math.max(Math.floor(a/60)%60,0);a-=c*60;var h=Math.max(a%60,0);var i="";if(j>0){var f=bookacti_localized.days;if(j===1){f=bookacti_localized.day}i+=j+" "+f+" "}if(g>0||j>0){i+=g+":"}i+=bookacti_pad(c,2)+":"+bookacti_pad(h,2);if(j===0&&g===0&&c===0&&h===0){i=bookacti_localized.expired;$j(this).addClass("bookacti-expired");var d=this;setTimeout(function(){bookacti_refresh_cart_after_expiration(d)},2000)}$j(this).html(i)})}function bookacti_refresh_cart_after_expiration(b){var d=$j(b).closest(".checkout").length;var c=$j(b).closest(".woocommerce");var a=c.find("form").attr("action");if($j(b).closest(".bookacti-cart-expiration-container").length){$j(b).closest(".bookacti-cart-expiration-container").html(bookacti_localized.error_cart_expired)}if(!d){if($j(b).hasClass("bookacti-cart-expiration")){c.find(".bookacti-cart-item-expires-with-cart").closest(".cart_item").empty()}else{$j(b).closest(".cart_item").empty()}c.find(".cart-subtotal .amount, .shipping .amount, .order-total .amount, .includes_tax .amount").empty()}$j.ajax({url:a,type:"POST",data:{},dataType:"html",success:function(e){if(d){$j("body").trigger("update_checkout");return}if($j(e).find(".woocommerce form").length<=0){c.html($j(e).find(".woocommerce").html());return}if($j(e).find(".woocommerce-error").length){if(c.find(".woocommerce-error").length){$j(e).find(".woocommerce-error li").clone().appendTo(c.find(".woocommerce-error"))}else{$j(e).find(".woocommerce-error").clone().prependTo(c)}}c.find(".cart-subtotal .amount").html($j(e).find(".cart-subtotal .amount").html());c.find(".shipping .amount").html($j(e).find(".shipping .amount").html());c.find(".order-total .amount").html($j(e).find(".order-total .amount").html());c.find(".includes_tax .amount").html($j(e).find(".includes_tax .amount").html())},error:function(f){console.log("AJAX "+bookacti_localized.error);console.log(f)},complete:function(){}})};