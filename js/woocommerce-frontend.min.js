
$j(document).ready(function(){$j("body").on("bookacti_booking_rescheduled",function(h,k,b,g,f){var j=$j('.bookacti-booking-action[data-booking-id="'+k+'"]').parents("tr");j.find(".bookacti-booking-actions").html(f.actions_html);var a=j.find("ul.bookacti-booking-events-list");if(a.length){a.find(".bookacti-booking-event-start, .bookacti-booking-event-date-separator, .bookacti-booking-event-end").remove();var c=bookacti_format_event_duration(b,g);a.find("li").append(c)}else{var d=moment(b).locale(bookacti_localized.current_lang_code);var i=moment(g).locale(bookacti_localized.current_lang_code);if($j(".wc-item-meta-bookacti_event_start.wc-item-meta-value").length){j.find(".wc-item-meta-bookacti_event_start.wc-item-meta-value").html(d.format(bookacti_localized.date_format));j.find(".wc-item-meta-bookacti_event_end.wc-item-meta-value").html(i.format(bookacti_localized.date_format))}if($j("dd.variation-bookacti_event_start p").length){j.find("dd.variation-bookacti_event_start p").html(d.format(bookacti_localized.date_format));j.find("dd.variation-bookacti_event_end p").html(i.format(bookacti_localized.date_format))}}});if($j("body.woocommerce form.cart .bookacti-booking-system").length){$j(".bookacti-booking-system").each(function(){var b=$j(this);var a=b.attr("id");var c=b.parents(".variations_form").length;if(b.hasClass("bookacti-woocommerce-product-booking-system")&&c){b.parents(".variations_form").on("reset_data",function(){bookacti_deactivate_booking_system(b)});bookacti.parent_booking_system[a]=bookacti.booking_system[a];b.parents(".variations_form").find(".single_variation_wrap").on("show_variation",function(e,d){bookacti_switch_booking_system_according_to_variation(b,d);var f=d.bookacti_is_activity?bookacti_localized.add_booking_to_cart_button_text:bookacti_localized.add_product_to_cart_button_text;b.parents(".variations_form").find(".single_add_to_cart_button").text(f)})}})}$j("body.woocommerce form.cart").on("bookacti_view_refreshed bookacti_displayed_info_cleared",".bookacti-booking-system",function(a){$j(this).parents("form").find('input[name="quantity"]').attr("disabled",false);$j(this).parents("form").find('button[type="submit"]').attr("disabled",false)});$j("body.woocommerce form.cart").on("bookacti_error_displayed",".bookacti-booking-system",function(a){$j(this).parents("form").find('input[name="quantity"], input[name^="bookacti_quantity"]').attr("disabled",true);$j(this).parents("form").find('button[type="submit"]').attr("disabled",true)});if($j("body.woocommerce form.cart .single_add_to_cart_button").length){$j("body.woocommerce form.cart").on("submit",function(d){var c=$j(this);var f=false;if(c.hasClass("variations_form")){var b=c.find(".variation_id").val();if(b!==""&&typeof b!=="undefined"){f=bookacti.is_variation_activity[b]}}else{if(c.find(".bookacti-booking-system-container").length){f=true}}if(f){if(c.find(".bookacti-booking-system-container").length){var a=bookacti_validate_picked_events(c.find(".bookacti-booking-system"),c.find(".quantity input.qty").val());if(a){c.find(".bookacti-booking-system-container").trigger("bookacti_submit_booking_form");return true}else{return false}}}})}$j("body.woocommerce form.cart").on("keyup mouseup","input.qty",function(){var a=$j(this).parents("form.cart").find(".bookacti-booking-system");if(a.length){bookacti_fill_picked_events_list(a)}});$j("body.woocommerce form.cart").on("bookacti_picked_events_list_data",".bookacti-booking-system",function(f,c){if($j(this).parents("form").find(".quantity .qty").length){var b=$j(this).attr("id");var d=parseInt($j(this).parents("form").find(".quantity .qty").val());var a=0;if(bookacti.booking_system[b]["picked_events"].length>1){a=bookacti_get_group_availability($j(this),bookacti.booking_system[b]["picked_events"])}else{a=bookacti_get_event_availability($j(this),bookacti.booking_system[b]["picked_events"][0])}$j(this).parents("form").find(".quantity .qty").attr("max",a);if(d>a){$j(this).parents("form").find(".quantity .qty").val(a);d=a}c.quantity=d}});if($j(".bookacti-countdown").length){setInterval(bookacti_countdown,1000)}});function bookacti_switch_booking_system_according_to_variation(a,c){var g=a.attr("id");a.empty();bookacti_clear_booking_system_displayed_info(a);if(c.bookacti_is_activity&&c.is_in_stock&&c.variation_is_active&&c.variation_is_visible){bookacti.is_variation_activity[c.variation_id]=true;bookacti_activate_booking_system(a,c.variation_id);var f=$j.isArray(c.bookacti_template_id)?c.bookacti_template_id:[c.bookacti_template_id];var h=$j.isArray(c.bookacti_activity_id)?c.bookacti_activity_id:[c.bookacti_activity_id];var d=$j.isArray(c.bookacti_group_categories)?c.bookacti_group_categories:[c.bookacti_group_categories];var e=$j.inArray(c.bookacti_groups_only,[1,"1",true,"true","yes","ok"])>=0?true:false;var b=$j.inArray(c.bookacti_groups_single_events,[1,"1",true,"true","yes","ok"])>=0?true:false;var i=$j.inArray(c.bookacti_booking_method,bookacti_localized.available_booking_methods.push("parent","site"))?c.bookacti_booking_method:"calendar";if(f[0]==="parent"){f=bookacti.parent_booking_system[g].calendars}if(h[0]==="parent"){h=bookacti.parent_booking_system[g].activities}if(d[0]==="none"){d=false}else{if(d[0]==="parent"){d=bookacti.parent_booking_system[g].group_categories}}if(i==="parent"){i=bookacti.parent_booking_system[g].method}else{if(i==="site"){i=bookacti_localized.site_booking_method}}bookacti.booking_system[g]["method"]=i;bookacti.booking_system[g]["calendars"]=f;bookacti.booking_system[g]["activities"]=h;bookacti.booking_system[g]["group_categories"]=d;bookacti.booking_system[g]["groups_only"]=e;bookacti.booking_system[g]["groups_single_events"]=b;bookacti_reload_booking_system(a)}else{bookacti.is_variation_activity[c.variation_id]=false;bookacti_deactivate_booking_system(a)}}function bookacti_countdown(){$j(".bookacti-countdown").each(function(){if(!$j(this).hasClass("bookacti-expired")){var d=$j(this).data("expiration-date");if(d){d=moment.utc(d);var b=moment.utc();var a=d.diff(b,"seconds");var i=Math.max(Math.floor(a/86400),0);a-=i*86400;var f=Math.max(Math.floor(a/3600)%24,0);a-=f*3600;var c=Math.max(Math.floor(a/60)%60,0);a-=c*60;var g=Math.max(a%60,0);var h="";if(i>0){var e=bookacti_localized.days;if(i===1){e=bookacti_localized.day}h+=i+" "+e+" "}if(f>0||i>0){h+=f+":"}h+=bookacti_pad(c,2)+":"+bookacti_pad(g,2);if(i===0&&f===0&&c===0&&g===0){h=bookacti_localized.expired_min;$j(this).addClass("bookacti-expired");var h=this;setTimeout(function(){bookacti_refresh_cart_after_expiration(h)},2000)}$j(this).html(h)}}else{$j(this).html(bookacti_localized.expired_min)}})}function bookacti_refresh_cart_after_expiration(b){var d=$j(b).parents(".checkout").length;var c=$j(b).parents(".woocommerce");var a=c.find("form").attr("action");if($j(b).parents(".bookacti-cart-expiration-container").length){$j(b).parents(".bookacti-cart-expiration-container").html(bookacti_localized.error_cart_expired)}if(!d){if($j(b).hasClass("bookacti-cart-expiration")){c.find(".bookacti-cart-item-expires-with-cart").parents(".cart_item").empty()}else{$j(b).parents(".cart_item").empty()}c.find(".cart-subtotal .amount").empty();c.find(".shipping .amount").empty();c.find(".order-total .amount").empty();c.find(".includes_tax .amount").empty()}$j.ajax({url:a,type:"POST",data:{},dataType:"html",success:function(e){if(!d){if($j(e).find(".woocommerce form").length<=0){c.html($j(e).find(".woocommerce").html())}else{if($j(e).find(".woocommerce-error").length){if(c.find(".woocommerce-error").length){$j(e).find(".woocommerce-error li").clone().appendTo(c.find(".woocommerce-error"))}else{$j(e).find(".woocommerce-error").clone().prependTo(c)}}c.find(".cart-subtotal .amount").html($j(e).find(".cart-subtotal .amount").html());c.find(".shipping .amount").html($j(e).find(".shipping .amount").html());c.find(".order-total .amount").html($j(e).find(".order-total .amount").html());c.find(".includes_tax .amount").html($j(e).find(".includes_tax .amount").html())}}else{$j("body").trigger("update_checkout")}},error:function(f){console.log("AJAX "+bookacti_localized.error_remove_expired_cart_item);console.log(f)},complete:function(){}})}function bookacti_deactivate_booking_system(a){a.parent().hide();a.siblings(".bookacti-booking-system-inputs input").prop("disabled",true)}function bookacti_activate_booking_system(a){var b=bookacti.booking_system[a.attr("id")]["method"];a.parent().show();a.siblings(".bookacti-booking-system-inputs input").prop("disabled",false);bookacti_booking_method_rerender_events(a,b)};