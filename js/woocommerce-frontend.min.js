$j(document).ready(function(){$j(".woocommerce-table").on("bookacti_booking_action_data","tr.order_item",function(g,f,a,c,d){var b=false;if(typeof f.form_data!=="undefined"){if(f.form_data instanceof FormData){b=true}}if(b){f.form_data.append("context","wc_order_items")}else{f.context="wc_order_items"}});if(typeof bookacti.form_fields==="undefined"){bookacti.form_fields=[]}$j(".woocommerce").on("bookacti_init_booking_sytem","form.cart.variations_form .bookacti-booking-system",function(c,b,a){if(b.load===false){return}if(typeof $j(this).closest(".bookacti-wc-form-fields")!=="undefined"){if($j(this).closest(".bookacti-wc-form-fields").data("default-variation-id")){b.load=false}}});$j(".woocommerce form.cart.variations_form").on("reset_data",function(){if(!$j(this).find(".bookacti-wc-form-fields").length){return}var a=$j(this).find(".bookacti-wc-form-fields");a.data("form-id","");a.attr("data-form-id","");a.data("variation-id","");a.attr("data-variation-id","");a.empty()});$j(".woocommerce form.cart.variations_form").on("show_variation",function(d,b){if(!$j(this).find(".bookacti-wc-form-fields").length){return}var a=$j(this).find(".bookacti-wc-form-fields");bookacti_switch_product_variation_form(a,b);var c=b.bookacti_is_activity?bookacti_localized.add_booking_to_cart_button_text:bookacti_localized.add_product_to_cart_button_text;$j(this).find(".single_add_to_cart_button").text(c)});$j(".woocommerce form.cart").on("bookacti_view_refreshed bookacti_displayed_info_cleared",".bookacti-booking-system",function(){$j(this).closest("form").find('input[name="quantity"]').attr("disabled",false);$j(this).closest("form").find('button[type="submit"]').attr("disabled",false)});$j(".woocommerce form.cart").on("bookacti_error_displayed",".bookacti-booking-system",function(){$j(this).closest("form").find('input[name="quantity"]').attr("disabled",true);$j(this).closest("form").find('button[type="submit"]').attr("disabled",true)});if($j(".woocommerce form.cart .single_add_to_cart_button").length){$j(".woocommerce form.cart").on("submit",function(){var c=$j(this);var e=false;if(c.hasClass("variations_form")){var b=c.find(".variation_id").val();if(b!==""&&typeof b!=="undefined"){e=bookacti.is_variation_activity[b]}}else{if(c.find(".bookacti-booking-system-container").length){e=true}}if(e){if(c.find(".bookacti-booking-system").length){var a=bookacti_validate_picked_events(c.find(".bookacti-booking-system"),c.find("input.qty").val());if(a){var d={form_data:new FormData(c.get(0))};c.trigger("bookacti_before_submit_booking_form",[d]);if(!(d.form_data instanceof FormData)){return false}return true}else{bookacti_scroll_to(c.find(".bookacti-booking-system-container .bookacti-notices"),500,"middle");return false}}}})}$j(".woocommerce form.cart").on("keyup mouseup change","input.qty",function(){var b=$j(this).closest("form").length?$j(this).closest("form"):$j(this).closest(".bookacti-form-fields");if(!b.length){return}b.trigger("bookacti_booking_form_quantity_change",[$j(this).val(),$j(this)]);var a=b.find(".bookacti-booking-system");if(a.length){bookacti_set_min_and_max_quantity(a);bookacti_fill_picked_events_list(a)}});$j("body").on("bookacti_picked_events_list_item_data",".bookacti-booking-system",function(h,a,g){if(parseInt(a.price)!==0||a.quantity<=0||a.has_price){return}var c=$j(this);var b=$j(this).attr("id");var d=bookacti.booking_system[b];var f=c.closest("form").length?c.closest("form"):c.closest(".bookacti-form-fields");if(f.find('input[data-name="price"]').length){a.price=parseFloat(f.find('input[data-name="price"]').val())*parseInt(a.quantity)}if($j.inArray(d.form_action,["add_product_to_cart","redirect_to_product_page"])>=0){if(parseInt(a.group_id)>0){if(typeof d.product_price_by_group_category!=="undefined"){if(typeof d.product_price_by_group_category[a.category_id]!=="undefined"){a.price=parseFloat(d.product_price_by_group_category[a.category_id])*parseInt(a.quantity);a.has_price=true}}}else{if(typeof d.product_price_by_activity!=="undefined"){if(typeof d.product_price_by_activity[a.activity_id]!=="undefined"){a.price=parseFloat(d.product_price_by_activity[a.activity_id])*parseInt(a.quantity);a.has_price=true}}}}if(a.price>0&&!a.price_to_display){a.price_to_display=bookacti_format_price(a.price)}});if($j(".bookacti-countdown").length){setInterval(bookacti_countdown,1000)}});function bookacti_switch_product_variation_form(e,d){e.empty();if(!d.bookacti_is_activity||!d.is_in_stock||!d.variation_is_active||!d.variation_is_visible){return}bookacti.is_variation_activity[d.variation_id]=true;var a=parseInt(d.bookacti_form_id);if(!a){return}if(typeof bookacti.form_fields[a]!=="undefined"){bookacti_fill_product_variation_form(e,d,bookacti.form_fields[a]);return}var h='<div class="bookacti-loading-alt"><img class="bookacti-loader" src="'+bookacti_localized.plugin_path+'/img/ajax-loader.gif" title="'+bookacti_localized.loading+'" /><span class="bookacti-loading-alt-text" >'+bookacti_localized.loading+"</span></div>";e.append(h);var g={action:"bookactiGetForm",form_id:a,instance_id:"product-variation-"+d.variation_id,context:"wc_switch_variation"};var f=true;$j.each(d.attributes,function(j,i){if(i!==bookacti_get_url_parameter(j)){f=false;return false}});if(f){var c=$j.param(g);var b=window.location.search.substring(1);g=b+"&"+c}$j.ajax({url:bookacti_localized.ajaxurl,type:"POST",data:g,dataType:"json",success:function(i){if(i.status==="success"){bookacti.form_fields[a]=i.form_html;bookacti_fill_product_variation_form(e,d,i.form_html)}else{var j=typeof i.message!=="undefined"?i.message:bookacti_localized.error;console.log(j);console.log(i)}},error:function(i){console.log("AJAX "+bookacti_localized.error);console.log(i)},complete:function(){e.find(".bookacti-loading-alt").remove()}})}function bookacti_fill_product_variation_form(c,b,d){c.empty();c.append(d);c.data("form-id",b.bookacti_form_id);c.attr("data-form-id",b.bookacti_form_id);c.data("variation-id",b.variation_id);c.attr("data-variation-id",b.variation_id);var a=c.find(".bookacti-booking-system");bookacti_booking_method_set_up(a);bookacti_init_booking_system_dialogs();bookacti_init_tooltip();a.find(".bookacti-loading-alt").remove();c.trigger("bookacti_product_variation_form_switched",[b])}function bookacti_countdown(){$j(".bookacti-countdown").each(function(){if($j(this).hasClass("bookacti-expired")){$j(this).html(bookacti_localized.expired);return true}var e=$j(this).data("expiration-date");if(!e){return true}e=moment.utc(e);var b=moment.utc();var a=e.diff(b,"seconds");var j=Math.max(Math.floor(a/86400),0);a-=j*86400;var g=Math.max(Math.floor(a/3600)%24,0);a-=g*3600;var c=Math.max(Math.floor(a/60)%60,0);a-=c*60;var h=Math.max(a%60,0);var i="";if(j>0){var f=bookacti_localized.days;if(j===1){f=bookacti_localized.day}i+=j+" "+f+" "}if(g>0||j>0){i+=g+":"}i+=bookacti_pad(c,2)+":"+bookacti_pad(h,2);if(j===0&&g===0&&c===0&&h===0){i=bookacti_localized.expired;$j(this).addClass("bookacti-expired");var d=this;setTimeout(function(){bookacti_refresh_cart_after_expiration(d)},2000)}$j(this).html(i)})}function bookacti_refresh_cart_after_expiration(b){var d=$j(b).closest(".checkout").length;var c=$j(b).closest(".woocommerce");var a=c.find("form").attr("action");if($j(b).closest(".bookacti-cart-expiration-container").length){$j(b).closest(".bookacti-cart-expiration-container").html(bookacti_localized.error_cart_expired)}if(!d){if($j(b).hasClass("bookacti-cart-expiration")){c.find(".bookacti-cart-item-expires-with-cart").closest(".cart_item").empty()}else{$j(b).closest(".cart_item").empty()}c.find(".cart-subtotal .amount, .shipping .amount, .order-total .amount, .includes_tax .amount").empty()}$j.ajax({url:a,type:"POST",data:{},dataType:"html",success:function(e){if(d){$j("body").trigger("update_checkout");return}if($j(e).find(".woocommerce form").length<=0){c.html($j(e).find(".woocommerce").html());return}if($j(e).find(".woocommerce-error").length){if(c.find(".woocommerce-error").length){$j(e).find(".woocommerce-error li").clone().appendTo(c.find(".woocommerce-error"))}else{$j(e).find(".woocommerce-error").clone().prependTo(c)}}c.find(".cart-subtotal .amount").html($j(e).find(".cart-subtotal .amount").html());c.find(".shipping .amount").html($j(e).find(".shipping .amount").html());c.find(".order-total .amount").html($j(e).find(".order-total .amount").html());c.find(".includes_tax .amount").html($j(e).find(".includes_tax .amount").html())},error:function(f){console.log("AJAX "+bookacti_localized.error);console.log(f)},complete:function(){}})};