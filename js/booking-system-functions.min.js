function bookacti_fetch_events(b){var a=b.attr("id");var c=bookacti.booking_system[a];bookacti_start_loading_booking_system(b);$j.ajax({url:bookacti_localized.ajaxurl,type:"POST",data:{action:"bookactiFetchEvents",attributes:JSON.stringify(c),is_admin:bookacti_localized.is_admin,nonce:bookacti_localized.nonce_fetch_events},dataType:"json",success:function(d){if(d.status==="success"){bookacti.booking_system[a]["events"]=d.events;bookacti.booking_system[a]["exceptions"]=d.exceptions;bookacti.booking_system[a]["bookings"]=d.bookings;bookacti.booking_system[a]["activities_data"]=d.activities_data;bookacti.booking_system[a]["groups_events"]=d.groups_events;bookacti.booking_system[a]["groups_data"]=d.groups_data;bookacti.booking_system[a]["group_categories_data"]=d.group_categories_data;if(d.events.length&&(d.events.single.length||d.events.repeated.length)){bookacti_booking_method_fill_with_events(b,c.method)}else{bookacti_add_error_message(b,bookacti_localized.error_no_events_bookable)}}else{var e=bookacti_localized.error_display_event;if(d.error==="not_allowed"){e+="\n"+bookacti_localized.error_not_allowed}console.log(e);console.log(d)}},error:function(d){console.log("AJAX "+bookacti_localized.error_display_event);console.log(d)},complete:function(){bookacti_stop_loading_booking_system(b)}})}function bookacti_reload_booking_system(b){var a=b.attr("id");var c=bookacti.booking_system[a];bookacti_start_loading_booking_system(b);$j.ajax({url:bookacti_localized.ajaxurl,type:"POST",data:{action:"bookactiReloadBookingSystem",attributes:JSON.stringify(c),is_admin:bookacti_localized.is_admin,nonce:bookacti_localized.nonce_reload_booking_system},dataType:"json",success:function(d){if(d.status==="success"){b.empty();bookacti_clear_booking_system_displayed_info(b);bookacti.booking_system[a]["events"]=d.events;bookacti.booking_system[a]["exceptions"]=d.exceptions;bookacti.booking_system[a]["bookings"]=d.bookings;bookacti.booking_system[a]["activities_data"]=d.activities_data;bookacti.booking_system[a]["groups_events"]=d.groups_events;bookacti.booking_system[a]["groups_data"]=d.groups_data;bookacti.booking_system[a]["group_categories_data"]=d.group_categories_data;bookacti.booking_system[a]["settings"]=d.settings;b.append(d.html_elements);bookacti_booking_method_set_up(b)}else{var e=bookacti_localized.error_reload_booking_system;if(d.error==="not_allowed"){e+="\n"+bookacti_localized.error_not_allowed}console.log(e);console.log(d)}},error:function(d){console.log("AJAX "+bookacti_localized.error_reload_booking_system);console.log(d)},complete:function(){bookacti_stop_loading_booking_system(b)}})}function bookacti_get_event_sources(b,a,e){var c=bookacti_get_single_event_sources(b,a);var d=bookacti_get_repeated_event_sources(b,e);return $j.merge(c,d)}function bookacti_display_events(b,a,c){bookacti_display_single_events(b,a);bookacti_display_repeated_events(b,c)}function bookacti_display_single_events(a,h){var l=a.attr("id");h=h||bookacti.booking_system[l]["events"]["single"];if(!bookacti.booking_system[l]||!h){return[]}var f=100;function c(){return new Date().getTime()}var j=moment(bookacti.booking_system[l]["settings"]["start"]);var b=moment(bookacti.booking_system[l]["settings"]["end"]).add(1,"days");var e=moment(bookacti_localized.current_time);var g=Object.keys(h);var d=g.length;if(l==="bookacti-template-calendar"){bookacti_start_template_loading()}else{bookacti_start_loading_booking_system(a)}var i=0;function k(){var o=c();while(i<d&&(c()-o)<=f){var p=g[i];var q=h[p];var m=q.start.substr(0,10);if(!bookacti.booking_system[l]["past_events"]){if(e.isAfter(q.start)){if(!bookacti_localized.started_events_bookable||e.isAfter(q.end)){++i;continue}}}if(j.isAfter(m)||b.isBefore(m)){++i;continue}var n={id:"event_"+q.event_id,allDayDefault:false,color:q.color,durationEditable:q.is_resizable&&bookacti_localized.is_admin?true:false,events:[q]};if(n.events.length!==0){bookacti_booking_method_display_event_source(a,n)}++i}if(i<d){setTimeout(k,10)}else{if(l==="bookacti-template-calendar"){bookacti_stop_template_loading()}else{bookacti_stop_loading_booking_system(a)}}}k()}function bookacti_display_repeated_events(a,b){var l=a.attr("id");b=b||bookacti.booking_system[l]["events"]["repeated"];if(!bookacti.booking_system[l]||!b){return[]}var g=100;function d(){return new Date().getTime()}var j=moment(bookacti.booking_system[l]["settings"]["start"]);var c=moment(bookacti.booking_system[l]["settings"]["end"]);var f=moment(bookacti_localized.current_time);var h=Object.keys(b);var e=h.length;if(l==="bookacti-template-calendar"){bookacti_start_template_loading()}else{bookacti_start_loading_booking_system(a)}var i=0;function k(){var o=d();while(i<e&&(d()-o)<=g){var B=h[i];var q=moment(b[B].start);var x=moment(b[B].end);var y=Math.abs(x.diff(q,"seconds"));var A=q.format("HH:mm:ss");var s=q.date();var z=moment(b[B].repeat_from);var w=moment(b[B].repeat_to);var C={};if(!bookacti.booking_system[l]["past_events"]){if(f.isAfter(z)){var p=bookacti_localized.current_time.substr(0,10);var n=moment(p+" "+A);n.add(y,"seconds");if(bookacti_localized.started_events_bookable&&n.isAfter(f)){z=moment(p)}else{z=moment(p).add(1,"days")}}}if(j.isAfter(z)){z=j}if(c.isBefore(w)){w=c}switch(b[B].repeat_freq){case"daily":C={days:1};break;case"weekly":C={days:7};var v=q.isoWeekday();if(z.isoWeekday()<=v){z.isoWeekday(v)}else{z.add(1,"weeks").isoWeekday(v)}break;case"monthly":if(z.date()<=s){z.date(s)}else{z.add(1,"months").date(s);if(z.date()!==s){z.subtract(1,"months");if(s>z.daysInMonth()){z.endOf("month")}}}break;default:C={days:1}}if(l==="bookacti-template-calendar"){bookacti_start_template_loading()}else{bookacti_start_loading_booking_system(a)}var t=z;var m=0;var r=w.unix();function u(){var G=d();var I={id:b[B].id,title:b[B].title,multilingual_title:b[B].multilingual_title,template_id:b[B].template_id,activity_id:b[B].activity_id,availability:b[B].availability,repeat_freq:b[B].repeat_freq,event_settings:b[B].event_settings?b[B].event_settings:{}};var F={id:"event_"+b[B].id+"_"+m,allDayDefault:false,color:b[B].color,durationEditable:b[B].is_resizable&&bookacti_localized.is_admin?true:false,events:[]};while(t.unix()<r&&(d()-G)<=g){var D=moment(t.format("YYYY-MM-DD")+" "+A);var K=D.clone().add(y,"seconds");var E={start:D.format("YYYY-MM-DD HH:mm:ss"),end:K.format("YYYY-MM-DD HH:mm:ss")};E=$j.extend(E,I);F.events.push(E);if(b[B].repeat_freq==="monthly"){var J=t.clone().add(1,"months").date(s);if(J.date()!==s){J.subtract(1,"months");if(s>J.daysInMonth()){J.endOf("month")}}var H=Math.abs(J.diff(t,"days"));C={days:H}}t.add(C)}if(F.events.length!==0){bookacti_booking_method_display_event_source(a,F)}if(t.unix()<r){++m;setTimeout(u,10)}else{if(l==="bookacti-template-calendar"){bookacti_stop_template_loading()}else{bookacti_stop_loading_booking_system(a)}}}u();++i}if(i<e){setTimeout(k,20)}else{if(l==="bookacti-template-calendar"){bookacti_stop_template_loading()}else{bookacti_stop_loading_booking_system(a)}}}k()}function bookacti_display_group_events(b,g){var n=b.attr("id");g=g||bookacti.booking_system[n]["groups_events"];var k=bookacti.booking_system[n]["group_categories"];if($j.isEmptyObject(g)||k.length===0){return[]}var f=bookacti.booking_system[n]["activities"];var l=moment(bookacti.booking_system[n]["settings"]["start"]);var d=moment(bookacti.booking_system[n]["settings"]["end"]);var i=moment(bookacti_localized.current_time);var h=100;function c(){return new Date().getTime()}var m=Object.keys(g);var e=m.length;bookacti_start_loading_booking_system(b);var j=0;function a(){var q=c();while(j<e&&(c()-q)<=h){var s=m[j];var p=g[s];var r=p.length;var u=0;var o=0;function t(){var z=c();var y={id:"group_"+s+"_"+o,allDayDefault:false,durationEditable:false,events:[]};while(u<r&&(c()-z)<=h){var B=p[u];var v=B.start.substr(0,10);if(f.length&&$j.inArray(B.activity_id,f)){return true}if(!bookacti.booking_system[n]["past_events"]){if(i.isAfter(B.start)){if(!bookacti_localized.started_events_bookable||i.isAfter(B.end)){return true}}}if(l.isAfter(v)||d.isBefore(v)){return true}var x={};var w="";if(B.repeat_freq&&B.repeat_freq!=="none"){x=typeof bookacti.booking_system[n]["events"]["repeated"][B.id]["event_settings"]!=="undefined"?bookacti.booking_system[n]["events"]["repeated"][B.id]["event_settings"]:{};w=typeof bookacti.booking_system[n]["events"]["repeated"][B.id]["color"]!=="undefined"?bookacti.booking_system[n]["events"]["repeated"][B.id]["color"]:""}else{x=typeof bookacti.booking_system[n]["events"]["single"][B.id]["event_settings"]!=="undefined"?bookacti.booking_system[n]["events"]["single"][B.id]["event_settings"]:{};w=typeof bookacti.booking_system[n]["events"]["single"][B.id]["color"]!=="undefined"?bookacti.booking_system[n]["events"]["single"][B.id]["color"]:""}var A={id:B.id,title:B.title,start:B.start,end:B.end,template_id:B.template_id,activity_id:B.activity_id,availability:B.availability,repeat_freq:B.repeat_freq,color:w,event_settings:x};y.events.push(A);++u}if(y.events.length!==0){bookacti_booking_method_display_event_source(b,y)}if(u<r){++o;setTimeout(t,10)}else{bookacti_stop_loading_booking_system(b)}}t();++j}if(j<e){setTimeout(a,20)}else{bookacti_stop_loading_booking_system(b)}}a()}function bookacti_switch_booking_method(b,d){d=$j.inArray(d,bookacti_localized.available_booking_methods)===-1?"calendar":d;if(d===bookacti.booking_system[a]["method"]){return false}var a=b.attr("id");var c=bookacti.booking_system[a];bookacti_start_loading_booking_system(b);$j.ajax({url:bookacti_localized.ajaxurl,type:"POST",data:{action:"bookactiSwitchBookingMethod",booking_system_id:a,attributes:JSON.stringify(c),method:d,nonce:bookacti_localized.nonce_switch_booking_method},dataType:"json",success:function(e){if(e.status==="success"){bookacti.booking_system[a]["method"]=d;b.empty();b.append(e.html_elements);bookacti_booking_method_set_up(b)}else{var f=bookacti_localized.error_switch_booking_method;if(e.error==="not_allowed"){f+="\n"+bookacti_localized.error_not_allowed}console.log(f);console.log(e)}},error:function(f){console.log("AJAX "+bookacti_localized.error_switch_booking_method);console.log(f)},complete:function(){bookacti_stop_loading_booking_system(b)}})}function bookacti_event_click(b,d){var a=b.attr("id");var c=bookacti_get_event_group_ids(b,d);if(($j.isArray(c)&&c.length>1)||($j.isArray(c)&&c.length===1&&bookacti.booking_system[a]["groups_single_events"])){bookacti_dialog_choose_group_of_events(b,c,d)}else{bookacti_pick_events_of_group(b,c,d)}c=$j.isArray(c)&&c.length===1?c[0]:c;b.trigger("bookacti_event_click",[d,c])}function bookacti_get_event_group_ids(b,f){if(typeof f!=="object"){return false}else{if(typeof f.id==="undefined"||typeof f.start==="undefined"||typeof f.end==="undefined"){return false}}var a=b.attr("id");var g=f.id;var e=f.start instanceof moment?f.start.format("YYYY-MM-DD HH:mm:ss"):f.start;var c=f.end instanceof moment?f.end.format("YYYY-MM-DD HH:mm:ss"):f.end;var d=[];$j.each(bookacti.booking_system[a]["groups_events"],function(h,i){$j.each(i,function(j,k){if(k.id==g&&k.start===e&&k.end===c){d.push(h);return false}})});if(!d.length){d="single"}return d}function bookacti_fill_form_fields(b,d,c){c=$j.isArray(c)&&c.length===1?c[0]:c;c=$j.isNumeric(c)||c==="single"?c:false;var e=d.start instanceof moment?d.start.format("YYYY-MM-DD HH:mm:ss"):d.start;var a=d.end instanceof moment?d.end.format("YYYY-MM-DD HH:mm:ss"):d.end;if(c!==false){b.siblings(".bookacti-booking-system-inputs").find('input[name="bookacti_group_id"]').val(c)}b.siblings(".bookacti-booking-system-inputs").find('input[name="bookacti_event_id"]').val(d.id);b.siblings(".bookacti-booking-system-inputs").find('input[name="bookacti_event_start"]').val(e);b.siblings(".bookacti-booking-system-inputs").find('input[name="bookacti_event_end"]').val(a)}function bookacti_pick_events_of_group(b,d,c){d=$j.isArray(d)&&d.length===1?d[0]:d;d=$j.isNumeric(d)||d==="single"?d:false;if(d==="single"&&typeof c!=="object"){return false}if(!d&&typeof c!=="object"){return false}if(!d&&typeof c==="object"){d="single"}var a=b.attr("id");bookacti_unpick_all_events(b);if(d==="single"){bookacti_pick_event(b,c)}else{$j.each(bookacti.booking_system[a]["groups_events"][d],function(f,e){bookacti_pick_event(b,e)})}b.trigger("bookacti_events_picked",[d,c])}function bookacti_pick_event(b,c){var a=b.attr("id");if((typeof c!=="object")||(typeof c==="object"&&(typeof c.id==="undefined"||typeof c.start==="undefined"))){return false}var d={id:c.id,activity_id:c.activity_id,title:c.title,start:c.start instanceof moment?c.start.format("YYYY-MM-DD HH:mm:ss"):c.start,end:c.end instanceof moment?c.end.format("YYYY-MM-DD HH:mm:ss"):c.end,bookings:c.bookings,availability:c.availability};bookacti.booking_system[a]["picked_events"].push(d);b.trigger("bookacti_pick_event",[c])}function bookacti_unpick_event(b,e,g,d){var a=b.attr("id");d=d?true:false;g=typeof g!=="undefined"?g:false;if((typeof e!=="object"&&!$j.isNumeric(e))||(typeof e==="object"&&(typeof e.id==="undefined"||typeof e.start==="undefined"))||($j.isNumeric(e)&&!d&&typeof g==="undefined")){return false}if(!g&&typeof e==="object"){g=d?false:e.start}var c={id:typeof e==="object"?e.id:e,start:g instanceof moment?g.format("YYYY-MM-DD HH:mm:ss"):g};var f=$j.grep(bookacti.booking_system[a]["picked_events"],function(h){if(h.id==c.id&&(d||h.start.substr(0,10)===c.start.substr(0,10))){return false}return true});bookacti.booking_system[a]["picked_events"]=f;b.trigger("bookacti_unpick_event",[e,d])}function bookacti_unpick_all_events(b){var a=b.attr("id");bookacti.booking_system[a]["picked_events"]=[];b.trigger("bookacti_unpick_all_events")}function bookacti_fill_picked_events_list(c){var b=c.attr("id");var d=c.siblings(".bookacti-picked-events").find(".bookacti-picked-events-list-title");var a=c.siblings(".bookacti-picked-events").find(".bookacti-picked-events-list");a.empty();if(typeof bookacti.booking_system[b]["picked_events"]!=="undefined"){if(bookacti.booking_system[b]["picked_events"].length>0){if(bookacti.booking_system[b]["picked_events"].length>1){d.html(bookacti_localized.selected_events)}else{d.html(bookacti_localized.selected_event)}$j.each(bookacti.booking_system[b]["picked_events"],function(g,k){var f=bookacti_format_event_duration(k.start,k.end);var e={title:'<span class="bookacti-booking-event-title" >'+k.title+"</span>",duration:f,quantity:1};c.trigger("bookacti_picked_events_list_data",[e]);var j=bookacti_get_activity_unit(c,k.activity_id,e.quantity);if(j!==""){j='<span class="bookacti-booking-event-quantity-separator" > - </span><span class="bookacti-booking-event-quantity" >'+j+"</span>"}var h=$j("<li />",{html:e.title+'<span class="bookacti-booking-event-title-separator" > - </span>'+f+j});a.append(h)});c.siblings(".bookacti-picked-events").show();c.trigger("bookacti_picked_events_list_filled")}}}function bookacti_format_event_duration(h,b){h=h instanceof moment?h.format("YYYY-MM-DD HH:mm:ss"):h;b=b instanceof moment?b.format("YYYY-MM-DD HH:mm:ss"):b;var d=h.substr(0,10)===b.substr(0,10);var a=d?"bookacti-booking-event-end-same-day":"";var f=d?"LT":bookacti_localized.date_format;var g=moment(h).locale(bookacti_localized.current_lang_code);var e=moment(b).locale(bookacti_localized.current_lang_code);var c='<span class="bookacti-booking-event-start">'+g.format(bookacti_localized.date_format)+'</span><span class="bookacti-booking-event-date-separator '+a+'"> &rarr; </span><span class="bookacti-booking-event-end '+a+'">'+e.format(f)+"</span>";return c}function bookacti_get_activity_unit(b,c,f){var a=b.attr("id");var e=bookacti.booking_system[a]["activities_data"][c];f=$j.isNumeric(f)?parseInt(f):1;var d="";if(!c||typeof e==="undefined"||f===0){return""}if(typeof e!=="undefined"){if(typeof e.settings!=="undefined"){if(typeof e.settings["unit_name_plural"]!=="undefined"&&typeof e.settings["unit_name_singular"]!=="undefined"&&typeof e.settings["places_number"]!=="undefined"){if(e.settings["unit_name_plural"]!==""&&e.settings["unit_name_singular"]!==""){d+=f+" ";if(f>1){d+=e.settings["unit_name_plural"]}else{d+=e.settings["unit_name_singular"]}}if(e.settings["places_number"]!==""&&parseInt(e.settings["places_number"])>0){if(parseInt(e.settings["places_number"])>1){d+=" "+bookacti_localized.n_persons_per_booking.replace("%1$s",e.settings["places_number"])}else{d+=" "+bookacti_localized.one_person_per_booking}}if((e.settings["unit_name_plural"]!==""&&e.settings["unit_name_singular"]!=="")||(e.settings["places_number"]!==""&&parseInt(e.settings["places_number"])!==0)){d+="<br/>"}}}}return d}function bookacti_clear_booking_system_displayed_info(a){a.siblings(".bookacti-booking-system-inputs").find("input").val("");a.siblings(".bookacti-picked-events").find(".bookacti-picked-events-list").empty();a.siblings(".bookacti-picked-events").hide();bookacti_unpick_all_events(a);a.siblings(".bookacti-notices").hide();a.siblings(".bookacti-notices").empty();a.show();a.trigger("bookacti_displayed_info_cleared")}function bookacti_update_settings_from_database(b,c){var a=b.attr("id");if(a==="bookacti-template-calendar"){bookacti_start_template_loading()}else{bookacti_start_loading_booking_system(b)}$j.ajax({url:bookacti_localized.ajaxurl,data:{action:"bookactiGetBookingSystemData",template_ids:c,is_admin:bookacti_localized.is_admin,nonce:bookacti_localized.nonce_get_booking_system_data},type:"POST",dataType:"json",success:function(e){if(e.status==="success"&&e.settings){if(b.attr("id")==="bookacti-template-calendar"){bookacti_update_calendar_settings(b,e.settings)}else{var f=bookacti.booking_system[a]["method"];bookacti_booking_method_update_settings(b,f)}}else{var d=bookacti_localized.error_retrieve_template_data;if(e.error==="not_allowed"){d+="\n"+bookacti_localized.error_not_allowed}console.log(error_message);console.log(e)}},error:function(d){console.log("AJAX "+bookacti_localized.error_retrieve_template_data);console.log(d)},complete:function(){if(a==="bookacti-template-calendar"){bookacti_stop_template_loading()}else{bookacti_stop_loading_booking_system(b)}}})}function bookacti_get_event_number_of_bookings(c,b){var a=bookacti.booking_system[b]["bookings"];if(!a){return 0}a=bookacti.booking_system[b]["bookings"][c.id];if(!a){return 0}var d=0;$j.each(a,function(f,e){if(c.start.format("YYYY-MM-DD HH:mm:ss")===e.event_start&&c.end.format("YYYY-MM-DD HH:mm:ss")===e.event_end){d=parseInt(e.quantity);return false}});return d}function bookacti_get_event_availability(a){return parseInt(a.availability)-parseInt(a.bookings)}function bookacti_get_group_availability(b){if(!$j.isArray(b)||b.length<=0){return 0}var a=999999999999;$j.each(b,function(c,d){var e=bookacti_get_event_availability(d);a=e<a?e:a});return a}function bookacti_is_event_available(b,d){var a=b.attr("id");var e=bookacti_get_event_availability(d);var f=false;if(e>0){f=true;if(!bookacti.booking_system[a]["groups_single_events"]){var c=bookacti_get_event_group_ids(b,d);if($j.isArray(c)&&c.length>0){f=false;$j.each(c,function(h,j){var g=bookacti_get_group_availability(bookacti.booking_system[a]["groups_events"][j]);if(g>0){f=true;return false}})}}}return f}function bookacti_get_bookings_number_for_a_single_grouped_event(c,d,b){var f=c.start instanceof moment?c.start.format("YYYY-MM-DD HH:mm:ss"):c.start;var a=c.end instanceof moment?c.end.format("YYYY-MM-DD HH:mm:ss"):c.end;var e=0;$j.each(d,function(g,h){$j.each(b[h],function(k,j){if(c.id===j.id&&f===j.start&&a===j.end){e+=parseInt(j.group_bookings)}})});return parseInt(c.bookings)-e}function bookacti_get_event_availability_div(a,c){var i=a.attr("id");var g=bookacti_get_event_availability(c);var d="";if(c.activity_id){var f=bookacti.booking_system[i]["activities_data"][c.activity_id];if(f!==undefined){if(f.settings!==undefined){if(f.settings["unit_name_plural"]!==undefined&&f.settings["unit_name_singular"]!==undefined&&f.settings["show_unit_in_availability"]!==undefined){if(parseInt(f.settings["show_unit_in_availability"])){if(g>1){d=f.settings["unit_name_plural"]}else{d=f.settings["unit_name_singular"]}}}}}}var e=g>1?bookacti_localized.avails:bookacti_localized.avail;var j=g<c.availability?"bookacti-booked":"bookacti-not-booked";var h=g<=0?"bookacti-full":"";var b='<div class="bookacti-availability-container" ><span class="bookacti-available-places '+j+" "+h+'" ><span class="bookacti-available-places-number">'+g+'</span><span class="bookacti-available-places-unit-name"> '+d+'</span><span class="bookacti-available-places-avail-particle"> '+e+"</span></span></div>";return b}function bookacti_add_error_message(a,b){b=b||bookacti_localized.error_no_events_bookable;a.hide();a.siblings(".bookacti-notices").empty().append("<ul class='bookacti-error-list'><li>"+b+"</li></ul>").show();a.trigger("bookacti_error_displayed",[b])}function bookacti_sort_events_array_by_dates(c,b,a){a=a||false;b=b||false;c.sort(function(e,d){var f=b?0:new Date(e.start)-new Date(d.start);if(f===0){f=new Date(e.end)-new Date(d.end)}if(a===true){f=!f}return f});return c}function bookacti_booking_method_set_up(b,d,c){var a=b.attr("id");c=c||bookacti.booking_system[a]["method"];d=d?1:0;if(c==="calendar"||$j.inArray(c,bookacti_localized.available_booking_methods)===-1){bookacti_set_calendar_up(b,d)}else{b.trigger("bookacti_booking_method_set_up",[c,d])}}function bookacti_booking_method_fill_with_events(b,c){var a=b.attr("id");c=c||bookacti.booking_system[a]["method"];if(c==="calendar"||$j.inArray(c,bookacti_localized.available_booking_methods)===-1){bookacti_fill_calendar_with_events(b)}else{b.trigger("bookacti_booking_method_fill_with_events",[c])}}function bookacti_booking_method_display_event_source(b,c,d){var a=b.attr("id");d=d||bookacti.booking_system[a]["method"];if(d==="calendar"||$j.inArray(d,bookacti_localized.available_booking_methods)===-1){bookacti_display_event_source_on_calendar(b,c)}else{b.trigger("bookacti_booking_method_display_event_source",[d,c])}}function bookacti_booking_method_update_settings(b,c){var a=b.attr("id");c=c||bookacti.booking_system[a]["method"];if(c==="calendar"||$j.inArray(c,bookacti_localized.available_booking_methods)===-1){bookacti_update_calendar_settings(b.find(".bookacti-calendar:first"),bookacti.booking_system[a]["settings"])}else{b.trigger("bookacti_update_settings",[c])}}function bookacti_booking_method_refetch_events(b,c){var a=b.attr("id");c=c||bookacti.booking_system[a]["method"];if(c==="calendar"||$j.inArray(c,bookacti_localized.available_booking_methods)===-1){b.find(".bookacti-calendar").fullCalendar("removeEvents");bookacti_fetch_events(b)}else{b.trigger("bookacti_refetch_events",[c])}}function bookacti_booking_method_rerender_events(b,c){var a=b.attr("id");c=c||bookacti.booking_system[a]["method"];if(c==="calendar"||$j.inArray(c,bookacti_localized.available_booking_methods)===-1){bookacti_refresh_calendar_view(b);b.fullCalendar("rerenderEvents")}else{b.trigger("bookacti_rerender_events",[c])}}function bookacti_start_loading_booking_system(b){var a=b.attr("id");var c=bookacti.booking_system[a]["method"];var d='<div class="bookacti-loading-alt"><img class="bookacti-loader" src="'+bookacti_localized.plugin_path+'/img/ajax-loader.gif" title="'+bookacti_localized.loading+'" /><span class="bookacti-loading-alt-text" >'+bookacti_localized.loading+"</span></div>";if(!$j.isNumeric(bookacti.booking_system[a]["loading_number"])){bookacti.booking_system[a]["loading_number"]=0}if(c==="calendar"||$j.inArray(c,bookacti_localized.available_booking_methods)===-1){if(b.find(".bookacti-calendar.fc").length){if(bookacti.booking_system[a]["loading_number"]===0||!b.find(".bookacti-loading-overlay").length){b.find(".bookacti-loading-alt").remove();bookacti_enter_calendar_loading_state(b.find(".bookacti-calendar"))}}else{if(!b.find(".bookacti-loading-alt").length){b.append(d)}}}else{b.trigger("bookacti_start_loading",[c,d])}if(bookacti.booking_system[a]["loading_number"]===0){b.trigger("bookacti_enter_loading_state")}bookacti.booking_system[a]["loading_number"]++}function bookacti_stop_loading_booking_system(b,c){c=c||false;var a=b.attr("id");var d=bookacti.booking_system[a]["method"];bookacti.booking_system[a]["loading_number"]--;bookacti.booking_system[a]["loading_number"]=Math.max(bookacti.booking_system[a]["loading_number"],0);if(c){bookacti.booking_system[a]["loading_number"]=0}if(bookacti.booking_system[a]["loading_number"]===0){if(d==="calendar"||$j.inArray(d,bookacti_localized.available_booking_methods)===-1){bookacti_exit_calendar_loading_state(b.find(".bookacti-calendar"))}else{b.trigger("bookacti_stop_loading",[d])}b.find(".bookacti-loading-alt").remove();b.trigger("bookacti_exit_loading_state")}};