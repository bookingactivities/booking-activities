function bookacti_get_booking_system_data_by_interval(b,a){var c=b.attr("id"),e=$j.extend(!0,{},bookacti.booking_system[c]),d=bookacti_get_booking_system_attributes_without_data(b);a=a?a:$j.extend(!0,{},e.events_interval);bookacti.booking_system[c].events_interval=bookacti_get_extended_events_interval(b,a);bookacti_start_loading_booking_system(b);$j.ajax({url:bookacti_localized.ajaxurl,type:"POST",data:{action:"bookactiGetBookingSystemDataByInterval",attributes:JSON.stringify(d),interval:JSON.stringify(a)},
dataType:"json",success:function(f){"success"===f.status?($j.isEmptyObject(bookacti.booking_system[c].events)?bookacti.booking_system[c].events=f.booking_system_data.events:$j.extend(bookacti.booking_system[c].events,f.booking_system_data.events),$j.isEmptyObject(bookacti.booking_system[c].events_data)?bookacti.booking_system[c].events_data=f.booking_system_data.events_data:$j.extend(bookacti.booking_system[c].events_data,f.booking_system_data.events_data),$j.isEmptyObject(bookacti.booking_system[c].groups_events)?
bookacti.booking_system[c].groups_events=f.booking_system_data.groups_events:$j.extend(!0,bookacti.booking_system[c].groups_events,f.booking_system_data.groups_events),$j.isEmptyObject(bookacti.booking_system[c].groups_data)?bookacti.booking_system[c].groups_data=f.booking_system_data.groups_data:$j.extend(bookacti.booking_system[c].groups_data,f.booking_system_data.groups_data),$j.isEmptyObject(bookacti.booking_system[c].bookings)?bookacti.booking_system[c].bookings=f.booking_system_data.bookings:
$j.extend(!0,bookacti.booking_system[c].bookings,f.booking_system_data.bookings),$j.isEmptyObject(bookacti.booking_system[c].groups_bookings)?bookacti.booking_system[c].groups_bookings=f.booking_system_data.groups_bookings:$j.extend(!0,bookacti.booking_system[c].groups_bookings,f.booking_system_data.groups_bookings),$j.isEmptyObject(bookacti.booking_system[c].booking_lists)?bookacti.booking_system[c].booking_lists=f.booking_system_data.booking_lists:$j.extend(!0,bookacti.booking_system[c].booking_lists,
f.booking_system_data.booking_lists),f.booking_system_data.events.length&&bookacti_booking_method_display_events(b,f.booking_system_data.events),b.trigger("bookacti_booking_system_interval_data_loaded",[f,e,d,a])):(console.log("undefined"!==typeof f.message?f.message:bookacti_localized.error),console.log(f))},error:function(f){console.log("AJAX "+bookacti_localized.error);console.log(f)},complete:function(){bookacti_stop_loading_booking_system(b)}})}
function bookacti_reload_booking_system(b,a){a=a||!1;var c=b.attr("id"),e=$j.extend(!0,{},bookacti.booking_system[c]),d=bookacti_get_booking_system_attributes_without_data(b);a||delete d.picked_events;bookacti_start_loading_booking_system(b);$j.ajax({url:bookacti_localized.ajaxurl,type:"POST",data:{action:"bookactiReloadBookingSystem",attributes:JSON.stringify(d)},dataType:"json",success:function(f){"success"===f.status?(b.empty(),bookacti_clear_booking_system_displayed_info(b),bookacti.booking_system[c]=
f.booking_system_data,"undefined"!==typeof e.rescheduled_booking_data&&(bookacti.booking_system[c].rescheduled_booking_data=$j.extend(!0,{},e.rescheduled_booking_data)),"undefined"!==typeof e.templates_per_activities&&(bookacti.booking_system[c].templates_per_activities=$j.extend(!0,{},e.templates_per_activities)),b.append(f.html_elements),bookacti_booking_method_set_up(b),bookacti_fill_booking_system_fields(b),bookacti_fill_picked_events_list(b),b.trigger("bookacti_booking_system_reloaded",[f,e,
d])):(console.log("undefined"!==typeof f.message?f.message:bookacti_localized.error),console.log(f))},error:function(f){console.log("AJAX "+bookacti_localized.error);console.log(f)},complete:function(){bookacti_stop_loading_booking_system(b)}})}
function bookacti_get_booking_system_attributes_without_data(b){b=b.attr("id");var a=$j.extend(!0,{},bookacti.booking_system[b]),c=$j.extend(!0,{},bookacti.booking_system[b]),e=bookacti_localized.booking_system_attributes_keys;$j.each(a,function(d,f){-1===$j.inArray(d,e)&&delete c[d]});return c}
function bookacti_get_interval_of_events(b,a){var c=b.attr("id"),e=bookacti.booking_system[c].events_interval,d=bookacti_get_availability_period(b);c=parseInt(bookacti_localized.event_load_interval);var f=d.start?moment.utc(d.start):!1;d=d.end?moment.utc(d.end):!1;var g=moment.utc(a.start).clone(),k=moment.utc(a.end).clone();f&&g.isBefore(f)&&(g=f.clone());d&&k.isAfter(d)&&(k=d.clone());var l={},n={start:g.clone(),end:k.clone()};if($j.isEmptyObject(e))l=bookacti_get_new_interval_of_events(b,n);else{var p=
moment.utc(e.start).clone().locale("en");e=moment.utc(e.end).clone().locale("en");if(g.isBefore(p)||k.isAfter(e)){l=p.clone();var h=e.clone(),m=moment.utc(a.start).clone().subtract(1,"days").locale("en");a=moment.utc(a.end).clone().add(1,"days").locale("en");if((g.isBefore(p)&&k.isAfter(e)||k.isBefore(p)||g.isAfter(e))&&m.format("YYYY-MM-DD")+" 23:59:59"!==e.format("YYYY-MM-DD HH:mm:ss")&&a.format("YYYY-MM-DD")+" 00:00:00"!==p.format("YYYY-MM-DD HH:mm:ss"))bookacti_booking_method_clear_events(b),
l=bookacti_get_new_interval_of_events(b,n);else{if(g.isBefore(p)||a.format("YYYY-MM-DD")+" 00:00:00"===p.format("YYYY-MM-DD HH:mm:ss"))l.subtract(c,"days"),g.isBefore(l)&&(l=g.clone()),f&&l.isBefore(f)&&(l=f.clone()),h=moment.utc(p.clone().subtract(1,"days").format("YYYY-MM-DD")+" 23:59:59");else if(k.isAfter(e)||m.format("YYYY-MM-DD")+" 23:59:59"===e.format("YYYY-MM-DD HH:mm:ss"))h.add(c,"days"),k.isAfter(h)&&(h=k.clone()),d&&h.isAfter(d)&&(h=d.clone()),l=moment.utc(e.clone().add(1,"days").format("YYYY-MM-DD")+
" 00:00:00");l={start:l.locale("en").format("YYYY-MM-DD HH:mm:ss"),end:h.locale("en").format("YYYY-MM-DD HH:mm:ss")}}}}return l}
function bookacti_get_new_interval_of_events(b,a){var c=b.attr("id"),e=bookacti_get_availability_period(b);if("undefined"===typeof e.start||"undefined"===typeof e.end)return{};c=bookacti.booking_system[c].past_events;var d=moment.utc(bookacti_localized.current_time),f=d.locale("en").format("YYYY-MM-DD HH:mm:ss");b=e.start?moment.utc(e.start):!1;var g=e.end?moment.utc(e.end):!1;if(!c&&g&&g.isBefore(d))return[];$j.isEmptyObject(a)&&(b&&b.isAfter(d)&&(a={start:e.start,end:e.start}),g&&$j.isEmptyObject(a)&&
g.isBefore(d)&&(a={start:e.end,end:e.end}),$j.isEmptyObject(a)&&(a={start:f,end:f}));f=parseInt(bookacti_localized.event_load_interval);e=moment.utc(moment.utc(a.start).clone().locale("en").format("YYYY-MM-DD")+" 00:00:00");d=moment.utc(moment.utc(a.end).clone().locale("en").format("YYYY-MM-DD")+" 23:59:59");a=parseInt(Math.abs(moment.utc(a.end).diff(a.start,"days")));a>f&&(f=a);f=a=Math.round((f-a)/2);c?(e.subtract(a,"days"),b&&b.isAfter(e)&&(f+=Math.abs(e.diff(b,"days")))):f+=a;b&&b.isAfter(e)&&
(e=b.clone());d.add(f,"days");g&&g.isBefore(d)&&(d=g.clone());return{start:e.locale("en").format("YYYY-MM-DD HH:mm:ss"),end:d.locale("en").format("YYYY-MM-DD HH:mm:ss")}}function bookacti_get_extended_events_interval(b,a){b=b.attr("id");b=bookacti.booking_system[b].events_interval;return $j.isEmptyObject(a)?b:$j.isEmptyObject(b)?{start:a.start,end:a.end}:{start:moment.utc(a.start).isBefore(moment.utc(b.start))?a.start:b.start,end:moment.utc(a.end).isAfter(moment.utc(b.end))?a.end:b.end}}
function bookacti_get_availability_period(b){b=b.attr("id");b=bookacti.booking_system[b];return{start:b.start,end:b.end}}
function bookacti_refresh_booking_numbers(b){var a=b.attr("id"),c=bookacti.booking_system[a].calendars,e=bookacti.booking_system[a].groups_data,d=bookacti.booking_system[a].groups_events;bookacti_start_loading_booking_system(b);$j.ajax({url:bookacti_localized.ajaxurl,type:"POST",data:{action:"bookactiGetBookingNumbers",template_ids:c,groups_data:e,groups_events:d},dataType:"json",success:function(f){bookacti.booking_system[a].bookings=[];"undefined"!==typeof f.bookings&&(bookacti.booking_system[a].bookings=
f.bookings,bookacti.booking_system[a].groups_bookings=f.groups_bookings);bookacti_booking_method_rerender_events(b)},error:function(f){alert("AJAX "+bookacti_localized.error);console.log(f)},complete:function(){bookacti_stop_loading_booking_system(b)}})}
function bookacti_event_click(b,a){var c=b.attr("id"),e=bookacti.booking_system[c].multiple_bookings;if(!e||!bookacti_unpick_events(b,a)){var d={},f=[],g=0;"bookacti-booking-system-reschedule"!==c&&(d=bookacti_get_event_groups(b,a),g=bookacti_get_event_groups_nb(d),f=Object.keys(d));var k=!1;1<g||1===g&&bookacti.booking_system[c].groups_single_events?(k=!0,bookacti_dialog_choose_group_of_events(b,d,a)):(f=(c=f.length?f[0]:0)?Object.keys(d[c]):[],f=f.length?f[0]:"",e||bookacti_unpick_all_events(b),
bookacti_pick_events(b,a,c,f),c&&b.trigger("bookacti_group_of_events_chosen",[c,f,a]));b.trigger("bookacti_event_click",[a,d,k])}}
function bookacti_get_event_groups(b,a){var c={};if("object"!==typeof a||"undefined"===typeof a.id||"undefined"===typeof a.start||"undefined"===typeof a.end)return c;b=b.attr("id");var e="undefined"!==typeof a.groupId?parseInt(a.groupId):parseInt(a.id),d=moment.utc(a.start).clone().locale("en").format("YYYY-MM-DD HH:mm:ss"),f=moment.utc(a.end).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");$j.each(bookacti.booking_system[b].groups_events,function(g,k){$j.each(k,function(l,n){$j.each(n,function(p,
h){if(parseInt(h.id)===e&&h.start===d&&h.end===f)return"undefined"===typeof c[g]&&(c[g]={}),c[g][l]=n,!1})})});return c}function bookacti_get_event_groups_nb(b){var a=0;$j.each(b,function(c,e){$j.each(e,function(d,f){++a})});return a}
function bookacti_fill_booking_system_fields(b){var a=b.siblings(".bookacti-booking-system-inputs");if(a.length){a.find('input[name^="selected_events"]').remove();var c=0,e=b.attr("id");$j.each(bookacti.booking_system[e].picked_events,function(d,f){a.append('<input type="hidden" name="selected_events['+c+'][group_id]" value="'+f.group_id+'"/>');a.append('<input type="hidden" name="selected_events['+c+'][group_date]" value="'+f.group_date+'"/>');a.append('<input type="hidden" name="selected_events['+
c+'][id]" value="'+f.id+'"/>');a.append('<input type="hidden" name="selected_events['+c+'][start]" value="'+f.start+'"/>');a.append('<input type="hidden" name="selected_events['+c+'][end]" value="'+f.end+'"/>');++c;b.siblings(".bookacti-booking-system-inputs").find('input[name="bookacti_group_id"]').val(f.group_id?f.group_id:0);b.siblings(".bookacti-booking-system-inputs").find('input[name="bookacti_event_id"]').val(f.id);b.siblings(".bookacti-booking-system-inputs").find('input[name="bookacti_event_start"]').val(f.start);
b.siblings(".bookacti-booking-system-inputs").find('input[name="bookacti_event_end"]').val(f.end)});b.trigger("bookacti_fill_booking_system_fields")}}
function bookacti_pick_events(b,a,c,e){$j.isNumeric(a)&&(a={id:parseInt(a),start:"",end:""});c=$j.isNumeric(c)?parseInt(c):0;e=e?e:"";var d="undefined"!==typeof a.groupId?parseInt(a.groupId):"undefined"!==typeof a.id?parseInt(a.id):0,f=0;if(!c&&!d)return f;c?(d=b.attr("id"),"undefined"!==typeof bookacti.booking_system[d].groups_events[c]&&"undefined"!==typeof bookacti.booking_system[d].groups_events[c][e]&&(d=bookacti.booking_system[d].groups_events[c][e].slice(),$j.each(d,function(g,k){group_picked_nb=
bookacti_pick_event(b,k,c,e);f+=group_picked_nb}))):f=bookacti_pick_event(b,a);b.trigger("bookacti_events_picked",[a,c,e]);return f}
function bookacti_is_event_picked(b,a){b=b.attr("id");b=$j.extend(!0,{},bookacti.booking_system[b].picked_events);var c="undefined"!==typeof a.start?moment.utc(a.start).clone().locale("en").format("YYYY-MM-DD"):"",e=$j.isNumeric(a)?parseInt(a):"undefined"!==typeof a.groupId?parseInt(a.groupId):parseInt(a.id),d=!1;b&&$j.each(b,function(f,g){if(g.id==e&&($j.isNumeric(a)||g.start.substr(0,10)===c))return d=g,!1});return d}
function bookacti_pick_event(b,a,c,e){$j.isNumeric(a)&&(a={id:parseInt(a),start:"",end:""});c=$j.isNumeric(c)?parseInt(c):0;e=e?e:"";var d="undefined"!==typeof a.groupId?parseInt(a.groupId):"undefined"!==typeof a.id?parseInt(a.id):0,f=0;if(!c&&!d)return f;var g=b.attr("id"),k="undefined"!==typeof a.title?a.title:"",l="undefined"!==typeof a.activity_id?parseInt(a.activity_id):0;l||"undefined"===typeof bookacti.booking_system[g].events_data[d]||(k=bookacti.booking_system[g].events_data[d].title,l=bookacti.booking_system[g].events_data[d].activity_id);
var n="undefined"!==typeof a.start?a.start:"",p="undefined"!==typeof a.end?a.end:"";d={group_id:c,group_date:e?moment.utc(e).clone().locale("en").format("YYYY-MM-DD"):"",id:d,start:n?moment.utc(n).clone().locale("en").format("YYYY-MM-DD HH:mm:ss"):"",end:p?moment.utc(p).clone().locale("en").format("YYYY-MM-DD HH:mm:ss"):"",title:k,activity_id:parseInt(l)};bookacti.booking_system[g].picked_events.push(d);++f;bookacti.booking_system[g].picked_events.sort(function(h,m){h=moment.utc(h.start);m=moment.utc(m.start);
return h.isBefore(m)?-1:h.isAfter(m)?1:0});b.trigger("bookacti_pick_event",[a,c,e]);return f}
function bookacti_unpick_events(b,a,c,e){$j.isNumeric(a)&&(a={id:parseInt(a),start:"",end:""});c=$j.isNumeric(c)?parseInt(c):0;e=e?e:"";var d="undefined"!==typeof a.groupId?parseInt(a.groupId):"undefined"!==typeof a.id?parseInt(a.id):0,f=0;if(!c&&!d)return f;var g=b.attr("id"),k="undefined"!==typeof a.start?a.start:"",l=k?moment.utc(k).clone().locale("en").format("YYYY-MM-DD HH:mm:ss"):"",n=c,p=e?moment.utc(e).clone().locale("en").format("YYYY-MM-DD"):"",h=[];$j.each(bookacti.booking_system[g].picked_events,
function(m,q){if(!q.group_id)return!0;m=q.group_id+"_"+q.group_date;var u=n&&q.group_id==n?1:0,t=p&&q.group_date===p?1:0,A=d&&q.id==d?1:0;q=l&&q.start.substr(0,10)===l.substr(0,10)?1:0;d||!u||p&&!t||h.push(m);n||!A||l&&!q||h.push(m);A&&u&&(p&&!t||l&&!q||h.push(m))});k=$j.grep(bookacti.booking_system[g].picked_events,function(m){var q=m.group_id+"_"+m.group_date,u=d&&m.id==d?1:0;m=l&&m.start.substr(0,10)===l.substr(0,10)?1:0;return 0<=$j.inArray(q,h)||u&&!l||u&&m?(++f,!1):!0});bookacti.booking_system[g].picked_events=
k;b.trigger("bookacti_events_unpicked",[a,c,e]);return f}function bookacti_unpick_all_events(b){var a=b.attr("id");bookacti.booking_system[a].picked_events=[];b.siblings(".bookacti-booking-system-inputs").find('input[name^="selected_events"]').remove();b.siblings(".bookacti-booking-system-inputs").find("input").val("");b.siblings(".bookacti-picked-events").find(".bookacti-picked-events-list").empty();b.siblings(".bookacti-picked-events").hide();b.trigger("bookacti_unpick_all_events")}
function bookacti_get_picked_events_list_items(b){var a={},c=b.attr("id");qty_field=(b.closest("form").length?b.closest("form"):b.closest(".bookacti-form-fields")).find('input[name="quantity"], input.bookacti-quantity');var e=qty_field.length?parseInt(qty_field.val()):1;$j.each(bookacti.booking_system[c].picked_events,function(d,f){d=0;"undefined"!==typeof bookacti.booking_system[c].events_data&&0<parseInt(f.id)&&"undefined"!==typeof bookacti.booking_system[c].events_data[f.id]&&(d=bookacti.booking_system[c].events_data[f.id].activity_id);
var g=0;"undefined"!==typeof bookacti.booking_system[c].groups_data&&0<parseInt(f.group_id)&&"undefined"!==typeof bookacti.booking_system[c].groups_data[f.group_id]&&(g=bookacti.booking_system[c].groups_data[f.group_id].category_id);d={id:f.id,title:f.title,group_id:f.group_id,group_date:f.group_date,start:moment.utc(f.start).clone().locale("en").format("YYYY-MM-DD HH:mm:ss"),end:moment.utc(f.end).clone().locale("en").format("YYYY-MM-DD HH:mm:ss"),activity_id:parseInt(d),category_id:parseInt(g),quantity:e,
price:0,price_to_display:"",has_price:!1};b.trigger("bookacti_picked_events_list_item_data",[d,f]);f=0<parseInt(d.group_id)?"group_"+d.group_id+"_"+d.group_date:"event_"+d.id+"_"+d.start+"_"+d.end;g=$j("<li></li>",{html:'<span class="bookacti-booking-event-title" >'+d.title+"</span>"});var k=bookacti_format_event_duration(d.start,d.end);k&&g.append('<span class="bookacti-booking-event-title-separator" > - </span>'+k);0<d.quantity&&(k=bookacti_get_activity_unit(b,d.activity_id,d.quantity))&&g.append('<span class="bookacti-booking-event-quantity-separator" > - </span><span class="bookacti-booking-event-quantity" >'+
d.quantity+" "+k+"</span>");g.data("event-id",d.id).attr("data-event-id",d.id);g.data("event-start",d.start).attr("data-event-start",d.start);g.data("event-end",d.end).attr("data-event-end",d.end);0<parseInt(d.group_id)?"undefined"===typeof a[f]?(k="","undefined"!==typeof bookacti.booking_system[c].groups_data[d.group_id]&&(k='<span class="bookacti-picked-group-of-events-title">'+bookacti.booking_system[c].groups_data[d.group_id].title+"</span>"),g=$j("<li></li>",{html:k+'<ul class="bookacti-picked-group-of-events-list">'+
g[0].outerHTML+"</ul>"}),g.data("group-id",d.group_id).attr("data-group-id",d.group_id),g.data("group-date",d.group_date).attr("data-group-date",d.group_date),a[f]=$j.extend(!0,{},d),a[f].list_element=g):(a[f].end=d.end,a[f].list_element.find("ul").append(g)):(a[f]=$j.extend(!0,{},d),a[f].list_element=g)});b.trigger("bookacti_picked_events_list_items",[a]);return a}
function bookacti_fill_picked_events_list(b){var a=b.attr("id"),c=b.siblings(".bookacti-picked-events").find(".bookacti-picked-events-list-title"),e=b.siblings(".bookacti-picked-events").find(".bookacti-picked-events-list");e.empty();b.siblings(".bookacti-picked-events").hide();if("undefined"!==typeof bookacti.booking_system[a].picked_events&&bookacti.booking_system[a].picked_events.length){var d=bookacti.booking_system[a].multiple_bookings;c.html(1===bookacti.booking_system[a].picked_events.length?
bookacti_localized.selected_event:bookacti_localized.selected_events);a=bookacti_get_picked_events_list_items(b);$j.each(a,function(f,g){f=g.list_element;d&&(f.find(".bookacti-picked-group-of-events-title").length?f.find(".bookacti-picked-group-of-events-title").after('<span class="bookacti-unpick-event-icon"></span>'):f.append('<span class="bookacti-unpick-event-icon"></span>'));e.append(f)});e.is(":empty")||b.siblings(".bookacti-picked-events").show();b.trigger("bookacti_picked_events_list_filled")}}
function bookacti_set_tooltip_position(b,a,c){if(a.length){c=0<=$j.inArray(c,["below","above"])?c:"below";a.css("position","absolute");var e=$j(window).width();a.outerWidth()>e-40&&(a.css("min-width",e-40+"px"),a.outerWidth(e-40));var d=b.offset(),f=b.offset().left+b.outerWidth()/2;d.top+="above"===c?-1*(a.outerHeight()+15):b.height()+15;d.left=f-a.outerWidth()/2;0>d.left&&(d.left=20);b=d.left+a.outerWidth();b>e-20&&(d.left-=b-(e-20));a.offset(d);c="above"===c?"bookacti-tooltip-arrow-bottom":"bookacti-tooltip-arrow-top";
a.find(".bookacti-tooltip-arrow."+c).length||(a.find(".bookacti-tooltip-arrow").remove(),a.append('<div class="bookacti-tooltip-arrow '+c+'"></div>'));a=a.find(".bookacti-tooltip-arrow");d=f-d.left-a.outerWidth()/2;a.css("left",d+"px")}}
function bookacti_get_min_and_max_quantity(b){var a=b.attr("id"),c=bookacti.booking_system[a],e=[],d=1,f=999999999,g=999999999,k,l,n,p;$j.each(c.picked_events,function(h,m){l=k=0;n=1;p=!1;if(0<parseInt(m.group_id)){h=m.group_id+""+m.group_date;if(-1<$j.inArray(h,e))return!0;e.push(h);"undefined"!==typeof c.groups_data&&"undefined"!==typeof c.groups_data[m.group_id]&&(h=parseInt(c.groups_data[m.group_id].category_id),"undefined"!==typeof c.group_categories_data&&"undefined"!==typeof c.group_categories_data[h]&&
"undefined"!==typeof c.group_categories_data[h].settings&&(h=c.group_categories_data[h].settings,n="undefined"===typeof h.min_bookings_per_user?1:h.min_bookings_per_user?parseInt(h.min_bookings_per_user):1,p="undefined"===typeof h.max_bookings_per_user?!1:h.max_bookings_per_user?parseInt(h.max_bookings_per_user):!1));m.group_date&&"undefined"!==typeof c.groups_bookings[m.group_id]&&"undefined"!==typeof c.groups_bookings[m.group_id][m.group_date]&&(k=parseInt(c.groups_bookings[m.group_id][m.group_date].availability),
n||p)&&(l=parseInt(c.groups_bookings[m.group_id][m.group_date].current_user_bookings))}else"undefined"!==typeof c.events_data&&"undefined"!==typeof c.events_data[m.id]&&(k=bookacti_get_event_availability(b,m),h=parseInt(c.events_data[m.id].activity_id),"undefined"!==typeof c.activities_data&&"undefined"!==typeof c.activities_data[h]&&"undefined"!==typeof c.activities_data[h].settings&&(h=c.activities_data[h].settings,n="undefined"===typeof h.min_bookings_per_user?1:h.min_bookings_per_user?parseInt(h.min_bookings_per_user):
1,p="undefined"===typeof h.max_bookings_per_user?!1:h.max_bookings_per_user?parseInt(h.max_bookings_per_user):!1,n||p))&&(h=moment.utc(m.start).clone().locale("en").format("YYYY-MM-DD HH:mm:ss"),"undefined"!==typeof c.bookings[m.id]&&"undefined"!==typeof c.bookings[m.id][h]&&(l=parseInt(c.bookings[m.id][h].current_user_bookings)));p=p&&0!=p&&p-l<k?Math.max(p-l,0):k;n=n&&0!=n&&1<n&&l<n?Math.max(n-l,0):1;n>d&&(d=n);p&&p<f&&(f=p);k<g&&(g=k)});a={avail:g,min:d,max:f};b.trigger("bookacti_min_and_max_quantity",
[a]);return a}
function bookacti_set_min_and_max_quantity(b){var a=bookacti_get_min_and_max_quantity(b),c=b.closest("form").length?b.closest("form"):b.closest(".bookacti-form-fields");a.field=c.find('input[name="quantity"]');b.trigger("bookacti_update_quantity",[a]);if(!a.field.length)return a;c=parseInt(a.field.val());a.value=c;c>a.max&&(a.value=a.max);c<a.min&&(a.min>a.avail&&(a.max=a.min),a.value=a.min);a.field.attr("min",1);a.field.removeAttr("max");b=b.attr("id");if(!bookacti.booking_system[b].picked_events.length)return a;a.field.attr("max",
a.max);a.field.attr("min",a.min);a.field.val(a.value);c!==parseInt(a.value)&&a.field.trigger("bookacti_quantity_updated",[c,a]);return a}
function bookacti_format_event_duration(b,a){b=moment.utc(b).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");a=moment.utc(a).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");var c=moment.utc(b).clone().locale(bookacti_localized.current_lang_code),e=moment.utc(a).clone().locale(bookacti_localized.current_lang_code);b=(a=b.substr(0,10)===a.substr(0,10))?"bookacti-booking-event-end-same-day":"";e=a?e.formatPHP(bookacti_localized.time_format):e.formatPHP(bookacti_localized.date_format);a=a?bookacti_localized.date_time_separator:
bookacti_localized.dates_separator;return'<span class="bookacti-booking-event-start">'+c.formatPHP(bookacti_localized.date_format)+'</span><span class="bookacti-booking-event-date-separator '+b+'">'+a+'</span><span class="bookacti-booking-event-end '+b+'">'+e+"</span>"}
function bookacti_get_activity_unit(b,a,c){c=$j.isNumeric(c)?parseInt(c):1;if(!a||0===c)return"";b=b.attr("id");if("undefined"===typeof bookacti.booking_system[b].activities_data||"undefined"===typeof bookacti.booking_system[b].activities_data[a])return"";a=bookacti.booking_system[b].activities_data[a];if("undefined"===typeof a.settings||"undefined"===typeof a.settings.unit_name_plural||"undefined"===typeof a.settings.unit_name_singular||""===a.settings.unit_name_plural||""===a.settings.unit_name_singular)return"";
c=1===c?a.settings.unit_name_singular:a.settings.unit_name_plural;return"undefined"===typeof a.settings.places_number||""===a.settings.places_number||0===parseInt(a.settings.places_number)?c:c+=1===parseInt(a.settings.places_number)?" "+bookacti_localized.one_person_per_booking:" "+bookacti_localized.n_people_per_booking.replace("%1$s",a.settings.places_number)}
function bookacti_clear_booking_system_displayed_info(b,a){a||bookacti_unpick_all_events(b);b.siblings(".bookacti-notices").hide();b.siblings(".bookacti-notices").empty();b.show();b.trigger("bookacti_displayed_info_cleared")}
function bookacti_get_event_number_of_bookings(b,a){b=b.attr("id");b=bookacti.booking_system[b];var c="undefined"!==typeof a.groupId?parseInt(a.groupId):parseInt(a.id);a=moment.utc(a.start).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");var e=0;"undefined"!==typeof b.bookings&&"undefined"!==typeof b.bookings[c]&&"undefined"!==typeof b.bookings[c][a]&&"undefined"!==typeof b.bookings[c][a].quantity&&$j.isNumeric(b.bookings[c][a].quantity)&&(e=parseInt(b.bookings[c][a].quantity));return e}
function bookacti_get_event_availability(b,a){var c=b.attr("id"),e=bookacti.booking_system[c],d="undefined"!==typeof a.groupId?parseInt(a.groupId):parseInt(a.id);c=0;"undefined"!==typeof a.availability&&(c=a.availability);"undefined"!==typeof e.events_data[d]&&"undefined"!==typeof e.events_data[d].availability&&$j.isNumeric(e.events_data[d].availability)&&(c=parseInt(e.events_data[d].availability));b=bookacti_get_event_number_of_bookings(b,a);return c-b}
function bookacti_is_event_available(b,a){var c=b.attr("id"),e=bookacti.booking_system[c],d=e.past_events,f=e.past_events_bookable,g="undefined"!==typeof a.groupId?parseInt(a.groupId):parseInt(a.id),k=moment.utc(a.start).clone().locale("en"),l=moment.utc(a.end).clone().locale("en"),n=moment.utc(bookacti_localized.current_time),p=bookacti_get_event_availability(b,a),h=bookacti_get_availability_period(b),m=!1,q=!0;"undefined"!==typeof a.is_available&&(a.is_available||(q=!1));"undefined"!==typeof a.extendedProps&&
"undefined"!==typeof a.extendedProps.is_available&&(a.extendedProps.is_available||(q=!1));if(0>=p)return!1;b=bookacti_get_event_groups(b,a);a=0<bookacti_get_event_groups_nb(b);var u=e.groups_single_events;if("bookacti-booking-system-reschedule"===c){if(a&&!u)return!1;c="undefined"!==typeof e.rescheduled_booking_data?e.rescheduled_booking_data:[];if("undefined"!==typeof c.event_id&&"undefined"!==typeof c.event_start&&"undefined"!==typeof c.event_end&&c.event_id==g&&c.event_start===k.format("YYYY-MM-DD HH:mm:ss")&&
c.event_end===l.format("YYYY-MM-DD HH:mm:ss")||"undefined"!==typeof c.quantity&&parseInt(c.quantity)>p)return!1}(!a||a&&u)&&q&&"undefined"!==typeof e.events_data[g]&&(q=!1,d&&(f||!k.isBefore(n)||bookacti_localized.started_events_bookable&&l.isAfter(n)||(q=!0),f||(h.start&&k.isBefore(moment.utc(h.start))&&(q=!0),h.end&&l.isAfter(moment.utc(h.end))&&(q=!0))),!q)&&(d=parseInt(e.events_data[g].activity_id),q=e.activities_data[d].settings,d=max_qty_ok=max_users_ok=!0,event_start_formatted=k.format("YYYY-MM-DD HH:mm:ss"),
"undefined"!==typeof e.bookings[g]&&"undefined"!==typeof e.bookings[g][event_start_formatted]&&(k="undefined"===typeof q.min_bookings_per_user?0:q.min_bookings_per_user?parseInt(q.min_bookings_per_user):0,l="undefined"===typeof q.max_bookings_per_user?0:q.max_bookings_per_user?parseInt(q.max_bookings_per_user):0,q="undefined"===typeof q.max_users_per_event?0:q.max_users_per_event?parseInt(q.max_users_per_event):0,k||l||q)&&(g=e.bookings[g][event_start_formatted],c=parseInt(g.current_user_bookings),
q&&0===c&&g.distinct_users>=q&&(max_users_ok=!1),l&&c>=l&&(max_qty_ok=!1),k&&k>p+c&&(d=!1)),d&&max_qty_ok&&max_users_ok&&(m=!0));a&&!m&&$j.each(b,function(t,A){var D=e.groups_data[t],F=parseInt(D.category_id),r=e.group_categories_data[F].settings,E=parseInt(bookacti_localized.started_groups_bookable);"undefined"!==typeof r.started_groups_bookable&&0<=$j.inArray(r.started_groups_bookable,[0,1,"0","1",!0,!1])&&(E=$j.isNumeric(r.started_groups_bookable)?parseInt(r.started_groups_bookable):r.started_groups_bookable?
1:0);$j.each(A,function(v,w){var x=moment.utc(w[0].start).clone();w=moment.utc(w[w.length-1].end).clone();if(!(f||!x.isBefore(n)||E&&w.isAfter(n))||!f&&(h.start&&x.isBefore(moment.utc(h.start))||h.end&&x.isAfter(moment.utc(h.end))))return!0;var y;var z=x=y=w=0;"undefined"!==typeof e.groups_bookings[t]&&"undefined"!==typeof e.groups_bookings[t][v]&&(z=e.groups_bookings[t][v].is_available,x=e.groups_bookings[t][v].availability,y=e.groups_bookings[t][v].current_user_bookings,w=e.groups_bookings[t][v].distinct_users);
if(z&&0<x){v=max_qty_ok=max_users_ok=!0;if(null!=D){z="undefined"===typeof r.max_users_per_event?0:r.max_users_per_event?parseInt(r.max_users_per_event):0;var B="undefined"===typeof r.max_bookings_per_user?0:r.max_bookings_per_user?parseInt(r.max_bookings_per_user):0,C="undefined"===typeof r.min_bookings_per_user?0:r.min_bookings_per_user?parseInt(r.min_bookings_per_user):0;if(C||B||z)y=parseInt(y),z&&0===y&&parseInt(w)>=z&&(max_users_ok=!1),B&&y>=B&&(max_qty_ok=!1),C&&C>x+y&&(v=!1)}if(v&&max_qty_ok&&
max_users_ok)return m=!0,!1}})});return m}function bookacti_get_bookings_number_for_a_single_grouped_event(b,a,c){c=$j.isEmptyObject(c)?bookacti_get_event_groups(b,a):c;var e=b.attr("id"),d=bookacti.booking_system[e];b=bookacti_get_event_number_of_bookings(b,a);var f=0;$j.each(c,function(g,k){$j.each(k,function(l,n){"undefined"!==typeof d.groups_bookings[g]&&"undefined"!==typeof d.groups_bookings[g][l]&&(f+=d.groups_bookings[g][l].quantity)})});return b-f}
function bookacti_get_event_availability_div(b,a){var c=b.attr("id"),e=bookacti.booking_system[c];b=bookacti_get_event_availability(b,a);var d="undefined"!==typeof a.groupId?parseInt(a.groupId):parseInt(a.id),f=a=0;"undefined"!==typeof e.events_data[d]&&("undefined"!==typeof e.events_data[d].activity_id&&(a=bookacti.booking_system[c].events_data[d].activity_id),"undefined"!==typeof e.events_data[d].availability&&(f=bookacti.booking_system[c].events_data[d].availability));e="";a&&(a=bookacti.booking_system[c].activities_data[a],
void 0!==a&&void 0!==a.settings&&"undefined"!==typeof a.settings.unit_name_plural&&"undefined"!==typeof a.settings.unit_name_singular&&"undefined"!==typeof a.settings.show_unit_in_availability&&parseInt(a.settings.show_unit_in_availability)&&(e=1===b?a.settings.unit_name_singular:a.settings.unit_name_plural));a=1<b?bookacti_localized.avails:bookacti_localized.avail;d=(b<f?"bookacti-booked":"bookacti-not-booked")+(0>=b?" bookacti-full":"");var g="",k=1==bookacti.booking_system[c].bookings_only?!0:
!1,l=parseInt(b/f*100);c=parseInt(bookacti.booking_system[c].hide_availability);f=parseInt(bookacti_localized.hide_availability_fixed);l=100>c&&l>c;var n=0<f&&b>f;!k&&(0>=f&&l||100<=c&&n||l&&n)&&(b="",g="bookacti-hide-availability");k="";e&&(k="bookacti-has-unit-name");c=$j("<div></div>",{"class":"bookacti-availability-container "+g});d=$j("<div></div>",{"class":"bookacti-available-places "+d});b=$j("<span></span>",{"class":"bookacti-available-places-number",html:b});e=$j("<span></span>",{"class":"bookacti-available-places-unit-name "+
k,html:e});a=$j("<span></span>",{"class":"bookacti-available-places-avail-particle",html:a});d.append(b);d.append(e);d.append(a);c.append(d);return c}
function bookacti_get_event_number_of_bookings_div(b,a){var c=b.attr("id"),e=bookacti_get_event_number_of_bookings(b,a);b=bookacti_get_event_availability(b,a);a="undefined"!==typeof a.groupId?parseInt(a.groupId):parseInt(a.id);var d=0;"undefined"!==typeof bookacti.booking_system[c].events_data[a]&&"undefined"!==typeof bookacti.booking_system[c].events_data[a].availability&&(d=bookacti.booking_system[c].events_data[a].availability);b=(0===d?"bookacti-no-availability":"")+(0<e?" bookacti-booked":" bookacti-not-booked")+
(0>=b?" bookacti-full":"");c=$j("<div></div>",{"class":"bookacti-availability-container"});b=$j("<div></div>",{"class":"bookacti-available-places "+b});e=$j("<span></span>",{"class":"bookacti-active-bookings-number",html:e});b.append(e);c.append(b);return c}
function bookacti_sort_events_array_by_dates(b,a,c,e){a=a||!1;c=c||!1;e=e||{start:"start",end:"end"};b.sort(function(d,f){a||d[e.start]===f[e.start]?(d=moment.utc(d[e.end]),f=moment.utc(f[e.end])):(d=moment.utc(d[e.start]),f=moment.utc(f[e.start]));var g=0;d.isAfter(f)&&(g=1);d.isBefore(f)&&(g=-1);!0===c&&(g*=-1);return g});return b}
function bookacti_booking_method_set_up(b,a){a=a?1:0;var c=b.attr("id");booking_method=bookacti.booking_system[c].method;-1===$j.inArray(booking_method,bookacti_localized.available_booking_methods)&&(booking_method="calendar");bookacti.booking_system[c].no_events||(b.trigger("bookacti_booking_method_set_up",[booking_method,a]),bookacti.booking_system[c].picked_events.length&&"undefined"!==typeof bookacti.booking_system[c].events&&(bookacti_set_min_and_max_quantity(b),bookacti_fill_picked_events_list(b)))}
function bookacti_booking_method_display_events(b,a){var c=b.attr("id");booking_method=bookacti.booking_system[c].method;-1===$j.inArray(booking_method,bookacti_localized.available_booking_methods)&&(booking_method="calendar");b.trigger("bookacti_booking_method_display_events",[booking_method,a])}
function bookacti_booking_method_refetch_events(b){var a=b.attr("id");booking_method=bookacti.booking_system[a].method;-1===$j.inArray(booking_method,bookacti_localized.available_booking_methods)&&(booking_method="calendar");b.trigger("bookacti_refetch_events",[booking_method])}
function bookacti_booking_method_rerender_events(b){var a=b.attr("id");booking_method=bookacti.booking_system[a].method;-1===$j.inArray(booking_method,bookacti_localized.available_booking_methods)&&(booking_method="calendar");b.trigger("bookacti_rerender_events",[booking_method])}
function bookacti_booking_method_clear_events(b){var a=b.attr("id");booking_method=bookacti.booking_system[a].method;-1===$j.inArray(booking_method,bookacti_localized.available_booking_methods)&&(booking_method="calendar");bookacti.booking_system[a].events=[];bookacti.booking_system[a].events_data=[];bookacti.booking_system[a].events_interval=[];b.trigger("bookacti_clear_events",[booking_method])}
function bookacti_start_loading_booking_system(b){var a=b.attr("id");if("undefined"!==typeof bookacti.booking_system[a]){var c=bookacti.booking_system[a].method;-1===$j.inArray(c,bookacti_localized.available_booking_methods)&&(c="calendar");$j.isNumeric(bookacti.booking_system[a].loading_number)||(bookacti.booking_system[a].loading_number=0);b.trigger("bookacti_start_loading",[c]);bookacti.booking_system[a].loading_number++}}
function bookacti_stop_loading_booking_system(b,a){a=a?a:!1;var c=b.attr("id");if("undefined"!==typeof bookacti.booking_system[c]){var e=bookacti.booking_system[c].method;-1===$j.inArray(e,bookacti_localized.available_booking_methods)&&(e="calendar");bookacti.booking_system[c].loading_number--;bookacti.booking_system[c].loading_number=Math.max(bookacti.booking_system[c].loading_number,0);a&&(bookacti.booking_system[c].loading_number=0);0===bookacti.booking_system[c].loading_number&&b.trigger("bookacti_exit_loading_state",
[e,a])}}function bookacti_redirect_to_activity_url(b,a){var c=b.attr("id");c=bookacti.booking_system[c];a="undefined"!==typeof a.groupId?parseInt(a.groupId):parseInt(a.id);"undefined"!==typeof c.events_data[a]&&(a=c.events_data[a].activity_id,"undefined"!==typeof c.redirect_url_by_activity[a]&&bookacti_redirect_booking_system_to_url(b,c.redirect_url_by_activity[a]))}
function bookacti_redirect_to_group_category_url(b,a){var c=b.attr("id");c=bookacti.booking_system[c];"undefined"!==typeof c.groups_data[a]&&(a=c.groups_data[a].category_id,"undefined"!==typeof c.redirect_url_by_group_category[a]&&bookacti_redirect_booking_system_to_url(b,c.redirect_url_by_group_category[a]))}
function bookacti_redirect_booking_system_to_url(b,a){if(a){var c=b.closest("form").length?b.closest("form"):b.closest(".bookacti-form-fields"),e=c.find('input[type="submit"]');e.length&&e.prop("disabled",!0);bookacti_start_loading_booking_system(b);e.length&&bookacti_add_loading_html(e,"after");a={method:"post",action:a,"class":"bookacti-temporary-form",id:"","data-redirect-timeout":15E3};b.trigger("bookacti_before_redirect",[a]);if(b.closest("form").length){var d={};$j.each(a,function(f,g){d[f]=
c.attr(f)});c.attr(a);c.submit();c.attr(d)}else b.closest(".bookacti-form-fields").wrap("<form></form>"),b.closest("form").attr(a).submit(),b.closest(".bookacti-form-fields").unwrap("form.bookacti-temporary-form");b.trigger("bookacti_after_redirect",[a]);setTimeout(function(){bookacti_stop_loading_booking_system(b);e.length&&(bookacti_remove_loading_html(b),e.prop("disabled",!1))},a["data-redirect-timeout"])}};
