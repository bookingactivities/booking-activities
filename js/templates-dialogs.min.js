function bookacti_init_template_dialogs(){$j(".bookacti-template-dialog").dialog({modal:true,autoOpen:false,minHeight:300,minWidth:520,resize:"auto",show:true,hide:true,dialogClass:"bookacti-dialog",closeText:"&#10006;",beforeClose:function(){var b=".bookacti-template-dialog";var a=$j(this).attr("id");if(a){b="#"+a}bookacti_empty_all_dialog_forms(b)}});$j("body").on("click",".ui-widget-overlay",function(){$j("div:ui-dialog:visible").dialog("close")});$j(".bookacti-template-dialog").on("keydown",function(a){if(!$j("textarea").is(":focus")&&a.keyCode==$j.ui.keyCode.ENTER){$j(this).parent().find(".ui-dialog-buttonpane button:first").focus();return false}});$j("#bookacti-unbind-event-dialog, #bookacti-unbind-group-of-events-dialog").dialog({beforeClose:function(){}});$j('input[type="radio"][name="unbind_action"]').on("change",function(){$j(".bookacti-unbind-action small").hide();$j('input[type="radio"][name="unbind_action"]:checked').closest(".bookacti-unbind-action").find("small").show()});bookacti_init_add_and_remove_items();$j("select#template-import-bound-activities").on("change",function(){bookacti_load_activities_bound_to_template($j("select#template-import-bound-activities").val())});$j("#bookacti-template-container").on("click","#bookacti-insert-template, #bookacti-add-first-template-button",function(){bookacti_dialog_add_new_template()});$j("#bookacti-template-duplicated-template-id").on("change",function(){var c=parseInt($j(this).val());if(!c){return}var a=parseInt($j("#bookacti-template-picker").val());var b=bookacti.booking_system["bookacti-template-calendar"]["template_data"];if(!$j.isEmptyObject(b.settings)&&a===c){bookacti_fill_fields_from_array(b.settings,"","#bookacti-template-data-dialog")}});$j("#bookacti-template-activity-list").on("click",".bookacti-activity-settings",function(){var a=$j(this).closest(".bookacti-activity").data("activity-id");bookacti_dialog_update_activity(a)});$j("#bookacti-template-groups-of-events-container").on("click","#bookacti-template-add-first-group-of-events-button, #bookacti-insert-group-of-events",function(){bookacti_dialog_create_group_of_events()});$j(document).on("keydown",function(a){if(a.ctrlKey&&a.keyCode==71){a.preventDefault();a.stopPropagation();if(bookacti.booking_system["bookacti-template-calendar"]["selected_events"].length>=2){bookacti_dialog_create_group_of_events()}}});$j("#bookacti-template-groups-of-events-container").on("click",".bookacti-update-group-of-events",function(){var a=$j(this).closest(".bookacti-group-of-events").data("group-id");var c=$j(this).closest(".bookacti-group-of-events").hasClass("bookacti-selected-group");var b=c;if(!c){b=bookacti_select_events_of_group(a)}if(b){bookacti_dialog_update_group_of_events(a)}});$j("#bookacti-group-of-events-occurrences-prev").on("click",function(){var a=$j("#bookacti-group-categories").find(".bookacti-group-of-events.bookacti-selected-group").data("group-id");if(a){bookacti_navigate_through_group_occurrences(a,"prev")}});$j("#bookacti-group-of-events-occurrences-next").on("click",function(){var a=$j("#bookacti-group-categories").find(".bookacti-group-of-events.bookacti-selected-group").data("group-id");if(a){bookacti_navigate_through_group_occurrences(a,"next")}});$j("#bookacti-group-of-events-occurrences-reset").on("click",function(){var a=$j("#bookacti-group-categories").find(".bookacti-group-of-events.bookacti-selected-group").data("group-id");if(a){bookacti_navigate_through_group_occurrences(a,"reset")}});$j("#bookacti-group-categories").on("click",".bookacti-update-group-category",function(){var a=$j(this).closest(".bookacti-group-category").data("group-category-id");bookacti_dialog_update_group_category(a)});$j(".bookacti-template-dialog form").on("submit",function(a){a.preventDefault()});$j("#bookacti-group-of-events-category-selectbox").on("change blur",function(){if($j(this).val()==="new"){$j("#bookacti-group-of-events-new-category-title").show()}else{$j("#bookacti-group-of-events-new-category-title").hide()}});$j("body").on("change",'input[name="repeat_step"], select[name="repeat_freq"]',function(){var a=parseInt($j(this).closest(".bookacti-field-container").find('input[name="repeat_step"]').val())>1&&$j(this).closest(".bookacti-field-container").find('select[name="repeat_freq"]').val()==="weekly";$j(this).closest(".bookacti-field-container").find(".bookacti-repeat-freq-start-of-week-notice").toggle(a)});$j("#bookacti-delete-event-cancel_bookings").on("change",function(){$j("#bookacti-delete-event-send_notifications-container").toggle($j("#bookacti-delete-event-cancel_bookings").is(":checked"))});$j("#bookacti-delete-group-of-events-cancel_bookings").on("change",function(){$j("#bookacti-delete-group-of-events-send_notifications-container").toggle($j("#bookacti-delete-group-of-events-cancel_bookings").is(":checked"))});$j("#bookacti-delete-event-cancel_bookings, #bookacti-delete-event-send_notifications").on("change",function(){$j("#bookacti-delete-event-dialog .bookacti-banp-promo-admin-message").toggle($j("#bookacti-delete-event-cancel_bookings").is(":checked")&&$j("#bookacti-delete-event-send_notifications").is(":checked"))});$j("#bookacti-delete-group-of-events-cancel_bookings, #bookacti-delete-group-of-events-send_notifications").on("change",function(){$j("#bookacti-delete-group-of-events-dialog .bookacti-banp-promo-admin-message").toggle($j("#bookacti-delete-group-of-events-cancel_bookings").is(":checked")&&$j("#bookacti-delete-group-of-events-send_notifications").is(":checked"))});$j("#bookacti-update-booked-event-dates-send_notifications").on("change",function(){$j("#bookacti-update-booked-event-dates-dialog .bookacti-banp-promo-admin-message").toggle($j("#bookacti-update-booked-event-dates-send_notifications").is(":checked"))})}function bookacti_dialog_add_new_template(){var a=$j.trim($j("#bookacti-template-data-dialog").dialog("option","title").replace(/\(.*?\)/,""));$j("#bookacti-template-data-dialog").dialog({title:a+" ("+bookacti_localized.create_new+")"});$j("#bookacti-template-data-dialog .bookacti-notices").remove();$j("#bookacti-mintime").val("00:00");$j("#bookacti-maxtime").val("00:00");$j("#bookacti-snapduration").val("00:05");$j("#bookacti-template-data-dialog").trigger("bookacti_default_template_settings");if($j("#bookacti-template-duplicated-template-id option").length>1){$j("#bookacti-template-duplicated-template-id-container").show();$j("#bookacti-template-duplicated-template-id").attr("disabled",false)}else{$j("#bookacti-template-duplicated-template-id-container").hide();$j("#bookacti-template-duplicated-template-id").attr("disabled",true)}$j("#bookacti-template-data-dialog").trigger("bookacti_template_data_dialog");$j("#bookacti-template-data-dialog").dialog("open");$j("#bookacti-template-data-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_ok,click:function(){$j("#bookacti-template-data-dialog .bookacti-notices").remove();$j("#bookacti-template-data-form-action").val("bookactiInsertTemplate");$j("#bookacti-template-data-form select[multiple].bookacti-items-select-box option").prop("selected",true);var e=$j("#bookacti-template-title").val();if(typeof tinyMCE!=="undefined"){if(tinyMCE){tinyMCE.triggerSave()}}var d=bookacti_validate_template_form();if(d){var b=$j("#bookacti-template-data-form").serializeObject();$j("#bookacti-template-data-dialog").trigger("bookacti_insert_template_before",[b]);if($j("#bookacti-template-calendar").length){bookacti_start_template_loading()}else{if($j("#bookacti-add-first-template-button").length){$j("#bookacti-add-first-template-button").removeClass("dashicons dashicons-plus-alt").addClass("spinner")}}var c='<div class="bookacti-loading-alt"><img class="bookacti-loader" src="'+bookacti_localized.plugin_path+'/img/ajax-loader.gif" title="'+bookacti_localized.loading+'" /><span class="bookacti-loading-alt-text" >'+bookacti_localized.loading+"</span></div>";$j("#bookacti-template-data-dialog").append(c);$j.ajax({url:ajaxurl,data:b,type:"POST",dataType:"json",success:function(f){if(f.status==="success"){if($j("#bookacti-first-template-container").is(":visible")){$j("#bookacti-first-template-container").before($j('<div id="bookacti-template-calendar" ></div>'));$j("#bookacti-first-template-container").hide();$j(".bookacti-no-template").removeClass("bookacti-no-template");bookacti_load_template_calendar($j("#bookacti-template-calendar"));bookacti_start_template_loading()}$j("#bookacti-template-picker").append("<option value='"+f.template_id+"'>"+e+"</option>");$j("select.bookacti-template-select-box").append("<option value='"+f.template_id+"'>"+e+"</option>");if($j("#bookacti-template-picker option").length===2){bookacti_bind_template_dialogs()}$j("#bookacti-template-data-dialog").trigger("bookacti_template_inserted",[f,b]);$j("#bookacti-template-data-dialog").dialog("close");bookacti_switch_template(f.template_id)}else{if(f.status==="failed"){var g=typeof f.message!=="undefined"?f.message:bookacti_localized.error;$j("#bookacti-template-data-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+g+"</li></ul></div>");$j("#bookacti-template-data-dialog .bookacti-notices").show();console.log(f)}}},error:function(f){alert("AJAX "+bookacti_localized.error);console.log(f)},complete:function(){if($j("#bookacti-add-first-template-button").length){$j("#bookacti-add-first-template-button").removeClass("spinner").addClass("dashicons dashicons-plus-alt")}bookacti_stop_template_loading();$j("#bookacti-template-data-dialog .bookacti-loading-alt").remove()}})}}}])}function bookacti_dialog_update_template(a){if(!a){return false}var e=$j.trim($j("#bookacti-template-data-dialog").dialog("option","title").replace(/\(.*?\)/,""));$j("#bookacti-template-data-dialog").dialog({title:e+" ("+bookacti_localized.edit_id+": "+a+")"});$j("#bookacti-template-data-dialog .bookacti-notices").remove();$j("#bookacti-template-duplicated-template-id-container").hide();$j("#bookacti-template-duplicated-template-id").attr("disabled",true);var b=bookacti.booking_system["bookacti-template-calendar"]["template_data"];var d=$j("#bookacti-template-calendar").fullCalendar("clientEvents");$j("#bookacti-template-title").val(b.title);if(b.admin.length){var c=$j("#bookacti-template-managers-container");bookacti_fill_items_selectbox(c,b.admin)}$j("#bookacti-template-data-dialog").trigger("bookacti_default_template_settings");if(!$j.isEmptyObject(b.settings)){bookacti_fill_fields_from_array(b.settings,"","#bookacti-template-data-dialog")}$j("#bookacti-template-data-dialog").trigger("bookacti_template_data_dialog",[a]);$j("#bookacti-template-data-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_ok,click:function(){$j("#bookacti-template-data-dialog .bookacti-notices").remove();$j("#bookacti-template-data-form-template-id").val(a);$j("#bookacti-template-data-form-action").val("bookactiUpdateTemplate");$j("#bookacti-template-data-form select[multiple].bookacti-items-select-box option").prop("selected",true);if(typeof tinyMCE!=="undefined"){if(tinyMCE){tinyMCE.triggerSave()}}var h=bookacti_validate_template_form();if(!h){return}var f=$j("#bookacti-template-data-form").serializeObject();$j("#bookacti-template-data-dialog").trigger("bookacti_update_template_before",[f]);bookacti_start_template_loading();var g='<div class="bookacti-loading-alt"><img class="bookacti-loader" src="'+bookacti_localized.plugin_path+'/img/ajax-loader.gif" title="'+bookacti_localized.loading+'" /><span class="bookacti-loading-alt-text" >'+bookacti_localized.loading+"</span></div>";$j("#bookacti-template-data-dialog").append(g);$j.ajax({url:ajaxurl,data:f,type:"POST",dataType:"json",success:function(i){if(i.status==="success"){bookacti.booking_system["bookacti-template-calendar"]["template_data"]=i.template_data;bookacti.booking_system["bookacti-template-calendar"]["display_data"]=i.template_data.settings;$j("#bookacti-template-picker option[value="+a+"]").html(i.template_data.title);$j("#bookacti-template-calendar").replaceWith('<div id="bookacti-template-calendar" class="bookacti-calendar"></div>');bookacti_load_template_calendar($j("#bookacti-template-calendar"));$j("#bookacti-template-calendar").fullCalendar("addEventSource",d);$j("#bookacti-template-data-dialog").trigger("bookacti_template_updated",[i,f]);$j("#bookacti-template-data-dialog").dialog("close")}else{var j=typeof i.message!=="undefined"?i.message:bookacti_localized.error;$j("#bookacti-template-data-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+j+"</li></ul></div>");$j("#bookacti-template-data-dialog .bookacti-notices").show();console.log(i)}},error:function(i){alert("AJAX "+bookacti_localized.error);console.log(i)},complete:function(){bookacti_stop_template_loading();$j("#bookacti-template-data-dialog .bookacti-loading-alt").remove()}})}},{text:bookacti_localized.dialog_button_delete,"class":"bookacti-dialog-delete-button bookacti-dialog-left-button",click:function(){bookacti_dialog_deactivate_template(a)}}]);$j("#bookacti-template-data-dialog").dialog("open")}function bookacti_dialog_deactivate_template(a){if(!a){return false}$j("#bookacti-delete-template-dialog .bookacti-notices").remove();$j("#bookacti-delete-template-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_delete,"class":"bookacti-dialog-delete-button",click:function(){$j("#bookacti-delete-template-dialog .bookacti-notices").remove();var b={action:"bookactiDeactivateTemplate",template_id:a,nonce:$j("#nonce_edit_template").val()};$j("#bookacti-delete-template-dialog").trigger("bookacti_deactivate_template_before",[b]);bookacti_start_template_loading();var c='<div class="bookacti-loading-alt"><img class="bookacti-loader" src="'+bookacti_localized.plugin_path+'/img/ajax-loader.gif" title="'+bookacti_localized.loading+'" /><span class="bookacti-loading-alt-text" >'+bookacti_localized.loading+"</span></div>";$j("#bookacti-delete-template-dialog").append(c);$j.ajax({url:ajaxurl,data:b,type:"POST",dataType:"json",success:function(e){if(e.status==="success"){$j("#bookacti-template-picker option[value="+a+"]").remove();var d=$j("#bookacti-template-picker option:first").val();$j("select.bookacti-template-select-box option[value="+a+"]").remove();if($j("#bookacti-template-picker option").length===1){bookacti_bind_template_dialogs()}$j("#bookacti-delete-template-dialog").trigger("bookacti_template_deactivated",[e,b]);$j("#bookacti-delete-template-dialog").dialog("close");$j("#bookacti-template-data-dialog").dialog("close");bookacti_switch_template(d)}else{var f=typeof e.message!=="undefined"?e.message:bookacti_localized.error;$j("#bookacti-delete-template-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+f+"</li></ul></div>");$j("#bookacti-delete-template-dialog .bookacti-notices").show();console.log(e)}},error:function(d){alert("AJAX "+bookacti_localized.error);console.log(d)},complete:function(){bookacti_stop_template_loading();$j("#bookacti-delete-template-dialog .bookacti-loading-alt").remove()}})}},{text:bookacti_localized.dialog_button_cancel,click:function(){$j("#bookacti-delete-template-dialog").dialog("close")}}]);$j("#bookacti-delete-template-dialog").dialog("open")}function bookacti_dialog_update_booked_event_dates(d,e,b){e=typeof e!=="undefined"?e:{_days:0,_milliseconds:0};b=typeof b!=="undefined"&&b!==false?b:false;$j("#bookacti-update-booked-event-dates-dialog .bookacti-bookings-nb").remove();$j("#bookacti-update-booked-event-dates-send_notifications-container .bookacti-notifications-nb").remove();$j(".bookacti-update-booked-repeated-event-dates-warning").hide();$j("#bookacti-update-booked-event-dates-dialog .bookacti-notices").remove();$j("#bookacti-update-booked-event-dates-send_notifications").prop("checked",false).trigger("change");$j("#bookacti-update-booked-event-dates-dialog").trigger("bookacti_update_booked_event_dates_dialog",[d,e,b]);var c=[{text:bookacti_localized.dialog_button_ok,click:function(){bookacti_update_event_dates(d,e,b,"booked")}},{text:bookacti_localized.dialog_button_cancel,click:function(){if(b!==false){b()}$j(this).dialog("close")}}];var a=bookacti.booking_system["bookacti-template-calendar"]["events_data"][d.id]["repeat_freq"]!=="none";if(a){$j(".bookacti-update-booked-repeated-event-dates-warning").show();c.push({text:bookacti_localized.dialog_button_unbind,"class":"bookacti-dialog-left-button",click:function(){if(b!==false){b()}var f=bookacti.booking_system["bookacti-template-calendar"]["events_data"][d.id]["start"].substr(11,8);var g=bookacti.booking_system["bookacti-template-calendar"]["events_data"][d.id]["end"].substr(11,8);d.start=moment.utc(moment.utc(d.start).clone().subtract(e._days,"days").format("YYYY-MM-DD")+" "+f);d.end=moment.utc(moment.utc(d.end).clone().subtract(e._days,"days").format("YYYY-MM-DD")+" "+g);$j(this).dialog("close");bookacti_dialog_unbind_event_occurrences(d)}})}$j("#bookacti-update-booked-event-dates-dialog").off("dialogbeforeclose").on("dialogbeforeclose",function(){if(b!==false){b()}});$j("#bookacti-update-booked-event-dates-dialog").dialog("option","buttons",c);$j("#bookacti-update-booked-event-dates-dialog").dialog("open")}function bookacti_dialog_update_event(f){$j("#bookacti-event-data-dialog .bookacti-notices").remove();var h=$j.trim($j("#bookacti-event-data-dialog").dialog("option","title").replace(/\(.*?\)/,""));$j("#bookacti-event-data-dialog").dialog({title:h+" ("+bookacti_localized.edit_id+": "+f.id+")"});var b=bookacti.booking_system["bookacti-template-calendar"]["events_data"][f.id];$j("#bookacti-event-data-dialog").data("event-id",f.id);$j("#bookacti-event-data-dialog").attr("data-event-id",f.id);$j("#bookacti-event-title").val(b.multilingual_title);$j("#bookacti-event-availability").val(b.availability);bookacti_fill_repetition_fields(f.id,"event");if(typeof b.settings!=="undefined"){bookacti_fill_fields_from_array(b.settings,"","#bookacti-event-data-dialog")}$j("#bookacti-event-data-dialog").trigger("bookacti_event_update_dialog",[f]);if(bookacti_localized.is_qtranslate){$j("#bookacti-event-data-dialog .qtranxs-translatable").each(function(){bookacti_refresh_qtx_field(this)})}bookacti_validate_event_form();var e=[];var d={text:bookacti_localized.dialog_button_ok,click:function(){$j("#bookacti-event-data-dialog .bookacti-notices").remove();var i=moment.utc(f.start).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");var l=moment.utc(f.end).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");$j("#bookacti-event-data-form-event-id").val(f.id);$j("#bookacti-event-data-form-event-start").val(i);$j("#bookacti-event-data-form-event-end").val(l);$j("#bookacti-event-data-form-action").val("bookactiUpdateEvent");$j("#bookacti-event-data-form select[multiple]#bookacti-event-exceptions-selectbox option").prop("selected",true);if(typeof tinyMCE!=="undefined"){if(tinyMCE){tinyMCE.triggerSave()}}var m=bookacti_validate_event_form();if(!m){return}var j=$j("#bookacti-event-data-form").serializeObject();j.interval=bookacti.booking_system["bookacti-template-calendar"]["events_interval"];$j("#bookacti-event-data-dialog").trigger("bookacti_update_event_before",[f,j]);bookacti_start_template_loading();var k='<div class="bookacti-loading-alt"><img class="bookacti-loader" src="'+bookacti_localized.plugin_path+'/img/ajax-loader.gif" title="'+bookacti_localized.loading+'" /><span class="bookacti-loading-alt-text" >'+bookacti_localized.loading+"</span></div>";$j("#bookacti-event-data-dialog").append(k);$j.ajax({url:ajaxurl,data:j,type:"POST",dataType:"json",success:function(n){if(n.status==="success"){var p=f.id;bookacti_unselect_event(f,true);bookacti.booking_system["bookacti-template-calendar"]["events_data"][p]=n.events_data[p];bookacti.booking_system["bookacti-template-calendar"]["groups_data"]=n.groups_data;bookacti.booking_system["bookacti-template-calendar"]["groups_events"]=[];$j("#bookacti-template-calendar").fullCalendar("removeEvents",p);$j("#bookacti-template-calendar").fullCalendar("addEventSource",n.events);$j("#bookacti-event-data-dialog").trigger("bookacti_event_updated",[f,n,j])}else{if(n.status==="failed"){var o=typeof n.message!=="undefined"?n.message:bookacti_localized.error;$j("#bookacti-event-data-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+o+"</li></ul></div>");$j("#bookacti-event-data-dialog .bookacti-notices").show();console.log(n)}}if(n.status!=="failed"){$j("#bookacti-event-data-dialog").dialog("close")}},error:function(n){alert("AJAX "+bookacti_localized.error);console.log(n)},complete:function(){$j("#bookacti-event-data-dialog .bookacti-loading-alt").remove();bookacti_stop_template_loading()}})}};e.push(d);var c={text:bookacti_localized.dialog_button_delete,"class":"bookacti-dialog-delete-button bookacti-dialog-left-button",click:function(){$j("#bookacti-event-data-dialog .bookacti-notices").remove();var i={action:"bookactiBeforeDeleteEvent",event_id:f.id,nonce:$j("#nonce_delete_event").val()};$j("#bookacti-event-data-dialog").trigger("bookacti_before_deactivate_event",[f,i]);bookacti_start_template_loading();var j='<div class="bookacti-loading-alt"><img class="bookacti-loader" src="'+bookacti_localized.plugin_path+'/img/ajax-loader.gif" title="'+bookacti_localized.loading+'" /><span class="bookacti-loading-alt-text" >'+bookacti_localized.loading+"</span></div>";$j("#bookacti-event-data-dialog").append(j);$j.ajax({url:ajaxurl,data:i,type:"POST",dataType:"json",success:function(k){if(k.status==="success"){$j("#bookacti-event-data-dialog").dialog("close");bookacti_dialog_delete_event(f);$j("#bookacti-delete-booked-event-options").toggle(parseInt(k.has_bookings)?true:false);$j("#bookacti-delete-event-cancel_bookings").prop("checked",parseInt(k.has_bookings)?true:false).trigger("change");$j("#bookacti-delete-event-cancel_bookings-container").append('<span class="bookacti-bookings-nb">'+k.bookings_nb+"</span>");$j("#bookacti-delete-event-send_notifications-container").append('<span class="bookacti-notifications-nb">'+k.notifications_nb+"</span>")}else{if(k.status==="failed"){var l=typeof k.message!=="undefined"?k.message:bookacti_localized.error;$j("#bookacti-event-data-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+l+"</li></ul></div>");$j("#bookacti-event-data-dialog .bookacti-notices").show();console.log(k)}}},error:function(k){alert("AJAX "+bookacti_localized.error);console.log(k)},complete:function(){$j("#bookacti-event-data-dialog .bookacti-loading-alt").remove();bookacti_stop_template_loading()}})}};e.push(c);var g={};if(b.repeat_freq!=="none"){g={text:bookacti_localized.dialog_button_unbind,"class":"bookacti-dialog-unbind-button bookacti-dialog-left-button",click:function(){$j("#bookacti-event-data-dialog").dialog("close");bookacti_dialog_unbind_event_occurrences(f)}};e.push(g)}var a={text:bookacti_localized.dialog_button_move,"class":"bookacti-dialog-move-button bookacti-dialog-left-button",click:function(){$j("#bookacti-event-data-dialog").dialog("close");bookacti_dialog_update_event_dates(f)}};e.push(a);$j("#bookacti-event-data-dialog").dialog("option","buttons",e);$j("#bookacti-event-data-dialog").dialog("open")}function bookacti_dialog_update_event_dates(c){$j("#bookacti-update-event-dates-dialog .bookacti-selected-event-start, #bookacti-update-event-dates-dialog .bookacti-selected-event-end").empty();$j(".bookacti-update-repeated-event-dates-warning").hide();$j("#bookacti-update-event-dates-dialog .bookacti-notices").remove();$j("#bookacti-update-event-dates-dialog .bookacti-selected-event-start").html(c.start.format("LLLL"));$j("#bookacti-update-event-dates-dialog .bookacti-selected-event-end").html(c.end.format("LLLL"));$j("#bookacti-update-event-dates-start_date").val(moment.utc(c.start).clone().locale("en").format("YYYY-MM-DD"));$j("#bookacti-update-event-dates-start_time").val(moment.utc(c.start).clone().locale("en").format("HH:mm"));$j("#bookacti-update-event-dates-end_date").val(moment.utc(c.end).clone().locale("en").format("YYYY-MM-DD"));$j("#bookacti-update-event-dates-end_time").val(moment.utc(c.end).clone().locale("en").format("HH:mm"));var b=[{text:bookacti_localized.dialog_button_ok,click:function(){$j("#bookacti-update-event-dates-dialog .bookacti-notices").remove();var e=moment.utc(moment.utc(c.start).clone().locale("en").format("YYYY-MM-DD HH:mm:ss"));var i=moment.utc(moment.utc(c.end).clone().locale("en").format("YYYY-MM-DD HH:mm:ss"));var h=moment.utc($j("#bookacti-update-event-dates-start_date").val()+" "+$j("#bookacti-update-event-dates-start_time").val());var f=moment.utc($j("#bookacti-update-event-dates-end_date").val()+" "+$j("#bookacti-update-event-dates-end_time").val());var j=moment.duration(h.diff(e));j._days=moment.utc(moment.utc(h).clone().locale("en").format("YYYY-MM-DD")).diff(moment.utc(moment.utc(e).clone().locale("en").format("YYYY-MM-DD")),"days");var d=$j.extend({},c);d.start=h;d.end=f;var g="";if(f.isSameOrBefore(h)){g=bookacti_localized.error_end_before_start}if(e.isSame(h)&&i.isSame(f)){g=bookacti_localized.error_fill_field}if(g){$j("#bookacti-update-event-dates-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+g+"</li></ul></div>");$j("#bookacti-update-event-dates-dialog .bookacti-notices").show();return}bookacti_update_event_dates(d,j,false,"normal")}},{text:bookacti_localized.dialog_button_cancel,click:function(){$j(this).dialog("close")}}];var a=bookacti.booking_system["bookacti-template-calendar"]["events_data"][c.id]["repeat_freq"]!=="none";if(a){$j(".bookacti-update-repeated-event-dates-warning").show();b.push({text:bookacti_localized.dialog_button_unbind,"class":"bookacti-dialog-left-button",click:function(){$j(this).dialog("close");bookacti_dialog_unbind_event_occurrences(c)}})}$j("#bookacti-update-event-dates-dialog").dialog("option","buttons",b);$j("#bookacti-update-event-dates-dialog").dialog("open")}function bookacti_dialog_delete_event(c){$j("#bookacti-delete-event-cancel_bookings-container .bookacti-bookings-nb").remove();$j("#bookacti-delete-event-send_notifications-container .bookacti-notifications-nb").remove();$j(".bookacti-delete-booked-repeated-event-warning").hide();$j("#bookacti-delete-event-dialog .bookacti-notices").remove();$j("#bookacti-delete-booked-event-options").show();$j("#bookacti-delete-event-cancel_bookings").prop("checked",true).trigger("change");$j("#bookacti-delete-event-send_notifications").prop("checked",false).trigger("change");$j("#bookacti-delete-event-dialog").trigger("bookacti_delete_event_dialog",[c]);var b=[{text:bookacti_localized.dialog_button_delete,"class":"bookacti-dialog-delete-button",click:function(){$j("#bookacti-delete-event-dialog .bookacti-notices").remove();var d=$j("#bookacti-delete-event-form").serializeObject();d.event_id=c.id;$j("#bookacti-delete-event-dialog").trigger("bookacti_deactivate_event_before",[c,d]);bookacti_start_template_loading();var e='<div class="bookacti-loading-alt"><img class="bookacti-loader" src="'+bookacti_localized.plugin_path+'/img/ajax-loader.gif" title="'+bookacti_localized.loading+'" /><span class="bookacti-loading-alt-text" >'+bookacti_localized.loading+"</span></div>";$j("#bookacti-delete-event-dialog").append(e);$j.ajax({url:ajaxurl,data:d,type:"POST",dataType:"json",success:function(f){if(f.status==="success"){bookacti_unselect_event(c);bookacti.booking_system["bookacti-template-calendar"]["groups_data"]=f.groups_data;bookacti.booking_system["bookacti-template-calendar"]["groups_events"]=[];if(c._id!==undefined){if(c._id.indexOf("_")>=0){$j("#bookacti-template-calendar").fullCalendar("removeEvents",c._id)}}$j("#bookacti-template-calendar").fullCalendar("removeEvents",c.id);$j("#bookacti-template-calendar").fullCalendar("refetchEvents");$j("#bookacti-delete-event-dialog").trigger("bookacti_event_deactivated",[c,f,d]);$j("#bookacti-delete-event-dialog").dialog("close")}else{var g=typeof f.message!=="undefined"?f.message:bookacti_localized.error;$j("#bookacti-delete-event-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+g+"</li></ul></div>");$j("#bookacti-delete-event-dialog .bookacti-notices").show();console.log(f)}},error:function(f){alert("AJAX "+bookacti_localized.error);console.log(f)},complete:function(){$j("#bookacti-delete-event-dialog .bookacti-loading-alt").remove();bookacti_stop_template_loading()}})}},{text:bookacti_localized.dialog_button_cancel,click:function(){$j(this).dialog("close")}}];var a=bookacti.booking_system["bookacti-template-calendar"]["events_data"][c.id]["repeat_freq"]!=="none";if(a){$j(".bookacti-delete-booked-repeated-event-warning").show();b.push({text:bookacti_localized.dialog_button_unbind,"class":"bookacti-dialog-left-button",click:function(){$j(this).dialog("close");bookacti_dialog_unbind_event_occurrences(c)}})}$j("#bookacti-delete-event-dialog").dialog("option","buttons",b);$j("#bookacti-delete-event-dialog").dialog("open")}function bookacti_dialog_unbind_event_occurrences(b){$j("#bookacti-unbind-event-dialog .bookacti-notices").remove();$j("#bookacti-unbind-event-dialog .bookacti-form-error").remove();$j("#bookacti-unbind-event-dialog .bookacti-input-warning").removeClass("bookacti-input-warning");$j("#bookacti-unbind-event-dialog .bookacti-selected-event-start").html(b.start.format("LLLL"));$j("#bookacti-unbind-event-dialog .bookacti-selected-event-end").html(b.end.format("LLLL"));$j('input[type="radio"][name="unbind_action"][value="selected"]').prop("checked",true).trigger("change");var a=[{text:bookacti_localized.dialog_button_unbind,"class":"bookacti-dialog-delete-button",click:function(){$j("#bookacti-unbind-event-dialog .bookacti-notices").remove();$j("#bookacti-unbind-event-dialog .bookacti-form-error").remove();$j("#bookacti-unbind-event-dialog .bookacti-input-warning").removeClass("bookacti-input-warning");var f=$j("#bookacti-unbind-event-form").serializeObject();var c=moment.utc(b.start).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");var d=$j.extend({event_id:b.id,event_start:c,event_end:moment.utc(b.end).clone().locale("en").format("YYYY-MM-DD HH:mm:ss"),interval:bookacti.booking_system["bookacti-template-calendar"]["events_interval"]},f);$j("#bookacti-template-container").trigger("bookacti_unbind_event_occurrences_before",[d,b]);bookacti_start_template_loading();var e='<div class="bookacti-loading-alt"><img class="bookacti-loader" src="'+bookacti_localized.plugin_path+'/img/ajax-loader.gif" title="'+bookacti_localized.loading+'" /><span class="bookacti-loading-alt-text" >'+bookacti_localized.loading+"</span></div>";$j("#bookacti-unbind-event-dialog").append(e);$j.ajax({url:ajaxurl,data:d,type:"POST",dataType:"json",success:function(g){if(g.status==="success"){bookacti_unselect_event(b,true);bookacti.booking_system["bookacti-template-calendar"]["groups_data"]=g.groups_data;bookacti.booking_system["bookacti-template-calendar"]["groups_events"]=[];bookacti.booking_system["bookacti-template-calendar"]["bookings"]=g.bookings;var h=g.new_events_ids;$j.each(h,function(k,j){if(typeof g.events_data[j]!=="undefined"){bookacti.booking_system["bookacti-template-calendar"]["events_data"][j]=g.events_data[j]}else{if(typeof bookacti.booking_system["bookacti-template-calendar"]["events_data"][j]!=="undefined"){delete bookacti.booking_system["bookacti-template-calendar"]["events_data"][j]}}});$j("#bookacti-template-calendar").fullCalendar("removeEvents",b.id);$j("#bookacti-template-calendar").fullCalendar("addEventSource",g.events);$j("#bookacti-template-container").trigger("bookacti_event_occurrences_unbound",[g,d,b]);$j("#bookacti-unbind-event-dialog").dialog("close")}else{var i=typeof g.message!=="undefined"?g.message:bookacti_localized.error;$j("#bookacti-unbind-event-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+i+"</li></ul></div>");$j("#bookacti-unbind-event-dialog .bookacti-notices").show();console.log(g)}},error:function(g){alert("AJAX "+bookacti_localized.error);console.log(g)},complete:function(){$j("#bookacti-unbind-event-dialog .bookacti-loading-alt").remove();bookacti_stop_template_loading()}})}},{text:bookacti_localized.dialog_button_cancel,click:function(){$j(this).dialog("close")}}];$j("#bookacti-unbind-event-dialog").dialog("option","buttons",a);$j("#bookacti-unbind-event-dialog").dialog("open")}function bookacti_fill_repetition_fields(u,o){if(o!=="group"&&o!=="event"){return}if(o==="group"&&typeof bookacti.booking_system["bookacti-template-calendar"]["selected_events"][0]==="undefined"){return}else{if(o==="event"&&typeof bookacti.booking_system["bookacti-template-calendar"]["picked_events"][0]==="undefined"){return}}var s=o==="group"?bookacti.booking_system["bookacti-template-calendar"]["selected_events"][0]:bookacti.booking_system["bookacti-template-calendar"]["picked_events"][0];var c=moment.utc(s.start).clone();var b={repeat_freq:"none",repeat_step:1,repeat_from:"",repeat_to:"",repeat_on:"",exceptions_dates:[]};if(u){b=o==="group"?bookacti.booking_system["bookacti-template-calendar"]["groups_data"][u]:bookacti.booking_system["bookacti-template-calendar"]["events_data"][u]}var f=b.exceptions_dates;var q=c.clone().add(28,"d").locale("en");var t=c.clone().locale("en").format("YYYY-MM-DD");var r=q.isBefore(moment.utc("2037-12-31"))?q.format("YYYY-MM-DD"):"2037-12-31";if(b.repeat_from&&b.repeat_from!=="0000-00-00"){t=b.repeat_from}if(b.repeat_to&&b.repeat_to!=="0000-00-00"){r=b.repeat_to}var m=b.repeat_step&&$j.isNumeric(b.repeat_step)?Math.max(1,parseInt(b.repeat_step)):1;var l=b.repeat_freq==="weekly"&&b.repeat_on?b.repeat_on.split("_"):[parseInt(c.format("d"))];var a=b.repeat_freq==="monthly"&&b.repeat_on&&$j.inArray(b.repeat_on,["nth_day_of_month","nth_day_of_week","last_day_of_month","last_day_of_week"])>=0?b.repeat_on:"nth_day_of_month";var i=false;var h=moment.utc(t).add(1,"d").locale("en");var k=moment.utc(r).subtract(1,"d").locale("en");if(h.isAfter(k)){i=true}var e=o==="group"?"#bookacti-group-of-events-dialog":"#bookacti-event-data-dialog";$j(e+' select[name="repeat_freq"] option[value="'+b.repeat_freq+'"]').prop("selected",true);$j(e+' select[name="repeat_monthly_type"] option[value="'+a+'"]').prop("selected",true);$j(e+' input[name="repeat_step"]').val(m).trigger("change");$j(e+' input[name="repeat_freq"]').trigger("change");$j(e+' input[name="repeat_from"]').val(t);$j(e+' input[name="repeat_to"]').val(r);$j(e+' select[name="exceptions_dates[]"]').empty();$j(e+" .bookacti-exception-date-picker").val(t);if(!i){$j(e+" .bookacti-exception-date-picker").attr("disabled",false);$j(e+" .bookacti-exception-date-picker").attr("min",h.format("YYYY-MM-DD"));$j(e+" .bookacti-exception-date-picker").attr("max",k.format("YYYY-MM-DD"))}else{$j(e+" .bookacti-exception-date-picker").attr("disabled",true)}if(typeof f!=="undefined"){$j.each(f,function(w,x){$j(e+' select[name="exceptions_dates[]"]').append("<option class='bookacti-exception' value='"+x+"' >"+x+"</option>")})}if($j.isArray(l)){$j.each(l,function(x,w){$j(e+' input[type="checkbox"][name="repeat_days[]"][value="'+w+'"]').prop("checked",true).trigger("change")})}var n=c.format("Do");var j=c.format("dddd");c.locale("en");var p=Math.ceil(parseInt(c.format("DD"))/7);var g=moment.utc(c.format("YYYY")+"-0"+p+"-01").format("Mo");var d=parseInt(c.format("D"))===parseInt(c.daysInMonth())?true:false;var v=parseInt(c.format("D"))>=(parseInt(c.daysInMonth())-6)?true:false;$j(e+' select[name="repeat_monthly_type"] option').each(function(){var w=$j(this).data("default-label");if(w){var x=w.replace("{nth_day_of_month}",n).replace("{nth_day_of_week}",g).replace("{day_of_week}",j);$j(this).html(x)}});$j(e+' select[name="repeat_monthly_type"] option[value="last_day_of_month"]').toggle(d);$j(e+' select[name="repeat_monthly_type"] option[value="last_day_of_week"]').toggle(v)}function bookacti_fill_selected_events_list(){$j(".bookacti-selected-events-list").empty();$j(".bookacti-selected-events-list").removeClass("bookacti-input-warning");$j("#bookacti-group-of-events-summary-preview-notice").hide();bookacti.booking_system["bookacti-template-calendar"]["selected_events"]=bookacti_sort_events_array_by_dates(bookacti.booking_system["bookacti-template-calendar"]["selected_events"]);$j.each(bookacti.booking_system["bookacti-template-calendar"]["selected_events"],function(c,f){var e=moment.utc(f.start);var b=moment.utc(f.end);var a=e.formatPHP(bookacti_localized.date_format)+bookacti_localized.dates_separator+b.formatPHP(bookacti_localized.date_format);if(f.start.substr(0,10)===f.end.substr(0,10)){a=e.formatPHP(bookacti_localized.date_format)+bookacti_localized.date_time_separator+b.formatPHP(bookacti_localized.time_format)}var d=$j("<option></option>",{html:a+" - "+f.title});d.attr("title",d.text());d.appendTo(".bookacti-selected-events-list")})}function bookacti_navigate_through_group_occurrences(b,d){d=$j.inArray(d,["prev","next","reset"])>=0?d:"reset";var a="";if(bookacti.booking_system["bookacti-template-calendar"]["selected_events"].length){a=bookacti.booking_system["bookacti-template-calendar"]["selected_events"][0]["start"].substr(0,10)}else{if(bookacti.booking_system["bookacti-template-calendar"]["groups_data"][b]["events"].length){a=bookacti.booking_system["bookacti-template-calendar"]["groups_data"][b]["events"][0]["start"].substr(0,10)}}var f="";if(d!=="reset"&&a){var e=moment.utc(a);var c="";$j.each(bookacti.booking_system["bookacti-template-calendar"]["groups_events"][b],function(h,g){f=h;var i=c?moment.utc(c):moment.utc(h);var j=moment.utc(h);if(d==="next"&&c&&i.isSameOrAfter(e)){return false}if(d==="prev"&&j.isSameOrAfter(e)){if(c){f=c}return false}c=h})}if(f!==a){bookacti_select_events_of_group(b,f);bookacti_fill_selected_events_list();bookacti_refresh_selected_events_display();$j("#bookacti-group-of-events-summary").addClass("bookacti-input-warning");$j("#bookacti-group-of-events-summary-preview-notice").show()}}function bookacti_dialog_choose_activity_creation_type(){if(!bookacti.selected_template){return}var a={text:bookacti_localized.dialog_button_create_activity,click:function(){$j(this).dialog("close");bookacti_dialog_create_activity()}};var d={text:bookacti_localized.dialog_button_import_activity,click:function(){$j(this).dialog("close");bookacti_dialog_import_activity()}};var b={text:bookacti_localized.dialog_button_cancel,click:function(){$j(this).dialog("close")}};var c=[a,d,b];if($j("#bookacti-template-picker option").length<=1){c.unshift(d)}$j("#bookacti-activity-create-method-dialog").dialog("option","buttons",c);$j("#bookacti-activity-create-method-dialog").dialog("open")}function bookacti_dialog_import_activity(){if(!bookacti.selected_template){return}$j("#bookacti-activity-import-dialog .bookacti-notices").remove();$j("#template-import-bound-activities option").attr("disabled",false);$j('#template-import-bound-activities option[value="'+bookacti.selected_template+'"]').attr("disabled",true);$j("#template-import-bound-activities").children("option:enabled").eq(0).prop("selected",true);$j("#template-import-bound-activities").trigger("change");$j("#bookacti-activity-import-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_ok,click:function(){$j("#bookacti-activity-import-dialog .bookacti-notices").remove();var a=$j("select#bookacti-activities-to-import").val();if($j.isEmptyObject(a)){$j("#bookacti-activity-import-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+bookacti_localized.error_fill_field+"</li></ul></div>");return}var b={action:"bookactiImportActivities",activity_ids:a,template_id:bookacti.selected_template,nonce:$j("#nonce_import_activity").val()};$j("#bookacti-activity-import-dialog").trigger("bookacti_import_activities_before",[b]);bookacti_start_template_loading();var c='<div class="bookacti-loading-alt"><img class="bookacti-loader" src="'+bookacti_localized.plugin_path+'/img/ajax-loader.gif" title="'+bookacti_localized.loading+'" /><span class="bookacti-loading-alt-text" >'+bookacti_localized.loading+"</span></div>";$j("#bookacti-activity-import-dialog").append(c);$j.ajax({url:ajaxurl,data:b,type:"POST",dataType:"json",success:function(d){if(d.status==="success"){bookacti.booking_system["bookacti-template-calendar"]["activities_data"]=d.activities_data;if(d.activity_list){$j("#bookacti-template-activity-list").empty().append(d.activity_list)}$j.each(a,function(f,g){$j('select#bookacti-activities-to-import option[value="'+g+'"]').remove()});bookacti_init_activities();$j("#bookacti-activity-import-dialog").trigger("bookacti_activities_imported",[d,b]);$j("#bookacti-activity-import-dialog").dialog("close");$j("#bookacti-activity-create-method-dialog").dialog("close")}else{var e=typeof d.message!=="undefined"?d.message:bookacti_localized.error;$j("#bookacti-activity-import-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+e+"</li></ul></div>");$j("#bookacti-activity-import-dialog .bookacti-notices").show();console.log(d)}},error:function(d){alert("AJAX "+bookacti_localized.error);console.log(d)},complete:function(){bookacti_stop_template_loading();$j("#bookacti-activity-import-dialog .bookacti-loading-alt").remove()}})}},{text:bookacti_localized.dialog_button_cancel,click:function(){$j("#bookacti-activity-import-dialog").dialog("close")}}]);$j("#bookacti-activity-import-dialog").dialog("open")}function bookacti_dialog_create_activity(){if(!bookacti.selected_template){return}var a=$j.trim($j("#bookacti-activity-data-dialog").dialog("option","title").replace(/\(.*?\)/,""));$j("#bookacti-activity-data-dialog").dialog({title:a+" ("+bookacti_localized.create_new+")"});$j("#bookacti-activity-data-dialog .bookacti-notices").remove();$j("#bookacti-activity-template-id").val(bookacti.selected_template);$j("#bookacti-activity-activity-id").val("");$j("#bookacti-activity-color").val("#3a87ad");$j("#bookacti-activity-action").val("bookactiInsertActivity");$j("#bookacti-activity-data-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_ok,click:function(){$j("#bookacti-activity-data-dialog .bookacti-notices").remove();$j("#bookacti-activity-data-form select[multiple].bookacti-items-select-box option").prop("selected",true);if(typeof tinyMCE!=="undefined"){if(tinyMCE){tinyMCE.triggerSave()}}var d=bookacti_validate_activity_form();if(!d){return}var b=$j("#bookacti-activity-data-form").serializeObject();$j("#bookacti-activity-data-dialog").trigger("bookacti_insert_activity_before",[b]);bookacti_start_template_loading();var c='<div class="bookacti-loading-alt"><img class="bookacti-loader" src="'+bookacti_localized.plugin_path+'/img/ajax-loader.gif" title="'+bookacti_localized.loading+'" /><span class="bookacti-loading-alt-text" >'+bookacti_localized.loading+"</span></div>";$j("#bookacti-activity-data-dialog").append(c);$j.ajax({url:ajaxurl,data:b,type:"POST",dataType:"json",success:function(e){if(e.status==="success"){bookacti.booking_system["bookacti-template-calendar"]["activities_data"][e.activity_id]=e.activity_data;if(e.activity_list){$j("#bookacti-template-activity-list").empty().append(e.activity_list)}bookacti_init_activities();$j("#bookacti-activity-data-dialog").trigger("bookacti_activity_inserted",[e,b]);$j("#bookacti-activity-data-dialog").dialog("close");$j("#bookacti-activity-create-method-dialog").dialog("close")}else{if(e.status==="failed"){var f=typeof e.message!=="undefined"?e.message:bookacti_localized.error;$j("#bookacti-activity-data-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+f+"</li></ul></div>");$j("#bookacti-activity-data-dialog .bookacti-notices").show();console.log(e)}}},error:function(f){alert("AJAX "+bookacti_localized.error);console.log(f)},complete:function(){bookacti_stop_template_loading();$j("#bookacti-activity-data-dialog .bookacti-loading-alt").remove()}})}}]);$j("#bookacti-activity-data-dialog").dialog("open")}function bookacti_dialog_update_activity(c){if(!bookacti.selected_template||!c){return}var e=$j.trim($j("#bookacti-activity-data-dialog").dialog("option","title").replace(/\(.*?\)/,""));$j("#bookacti-activity-data-dialog").dialog({title:e+" ("+bookacti_localized.edit_id+": "+c+")"});var d=bookacti.booking_system["bookacti-template-calendar"]["activities_data"][c];$j("#bookacti-activity-data-dialog .bookacti-notices").remove();$j("#bookacti-activity-template-id").val(bookacti.selected_template);$j("#bookacti-activity-activity-id").val(c);$j("#bookacti-activity-action").val("bookactiUpdateActivity");$j("#bookacti-activity-data-dialog .bookacti-add-new-items-select-box option").show().attr("disabled",false);$j("#bookacti-activity-title").val(d.multilingual_title);$j("#bookacti-activity-color").val(d.color);$j("#bookacti-activity-availability").val(d.availability);var a=d.duration?d.duration:"000.01:00:00";$j("#bookacti-activity-duration-days").val(a.substr(0,3)).trigger("change");$j("#bookacti-activity-duration-hours").val(a.substr(4,2)).trigger("change");$j("#bookacti-activity-duration-minutes").val(a.substr(7,2)).trigger("change");if(d.admin.length){var b=$j("#bookacti-activity-managers-container");bookacti_fill_items_selectbox(b,d.admin)}if(d.settings){bookacti_fill_fields_from_array(d.settings,"","#bookacti-activity-data-dialog");$j("#bookacti-activity-unit-name-singular").val(d.settings.multilingual_unit_name_singular);$j("#bookacti-activity-unit-name-plural").val(d.settings.multilingual_unit_name_plural)}$j("#bookacti-activity-data-dialog").trigger("bookacti_activity_update_dialog",[c]);if(bookacti_localized.is_qtranslate){$j("#bookacti-activity-data-dialog .qtranxs-translatable").each(function(){bookacti_refresh_qtx_field(this)})}$j("#bookacti-activity-data-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_ok,click:function(){$j("#bookacti-activity-data-dialog .bookacti-notices").remove();$j("#bookacti-activity-data-form select[multiple].bookacti-items-select-box option").prop("selected",true);if(typeof tinyMCE!=="undefined"){if(tinyMCE){tinyMCE.triggerSave()}}var h=bookacti_validate_activity_form();if(!h){return}var f=$j("#bookacti-activity-data-form").serializeObject();$j("#bookacti-activity-data-dialog").trigger("bookacti_update_activity_before",[f]);bookacti_start_template_loading();var g='<div class="bookacti-loading-alt"><img class="bookacti-loader" src="'+bookacti_localized.plugin_path+'/img/ajax-loader.gif" title="'+bookacti_localized.loading+'" /><span class="bookacti-loading-alt-text" >'+bookacti_localized.loading+"</span></div>";$j("#bookacti-activity-data-dialog").append(g);$j.ajax({url:ajaxurl,data:f,type:"POST",dataType:"json",success:function(i){if(i.status==="success"){bookacti.booking_system["bookacti-template-calendar"]["activities_data"][c]=i.activity_data;if(i.activity_list){$j("#bookacti-template-activity-list").empty().append(i.activity_list)}bookacti_init_activities();bookacti_refetch_events_on_calendar_editor();$j("#bookacti-activity-data-dialog").trigger("bookacti_activity_updated",[i,f]);$j("#bookacti-activity-data-dialog").dialog("close")}else{if(i.status==="failed"){var j=typeof i.message!=="undefined"?i.message:bookacti_localized.error;$j("#bookacti-activity-data-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+j+"</li></ul></div>");$j("#bookacti-activity-data-dialog .bookacti-notices").show();console.log(i)}}},error:function(i){alert("AJAX "+bookacti_localized.error);console.log(i)},complete:function(){bookacti_stop_template_loading();$j("#bookacti-activity-data-dialog .bookacti-loading-alt").remove()}})}},{text:bookacti_localized.dialog_button_delete,"class":"bookacti-dialog-delete-button bookacti-dialog-left-button",click:function(){bookacti_dialog_delete_activity(c)}}]);$j("#bookacti-activity-data-dialog").dialog("open")}function bookacti_dialog_delete_activity(a){if(!a){return}$j("#bookacti-delete-activity-dialog .bookacti-notices").remove();$j("#bookacti-delete-activity-events").prop("checked",false);$j("#bookacti-delete-activity-dialog").dialog("open");$j("#bookacti-delete-activity-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_delete,"class":"bookacti-dialog-delete-button",click:function(){$j("#bookacti-delete-activity-dialog .bookacti-notices").remove();var b={action:"bookactiDeactivateActivity",activity_id:a,template_id:bookacti.selected_template,delete_events:$j("#bookacti-delete-activity-events").is(":checked")?1:0,nonce:$j("#nonce_deactivate_activity").val()};$j("#bookacti-delete-activity-dialog").trigger("bookacti_deactivate_activity_before",[b]);bookacti_start_template_loading();var c='<div class="bookacti-loading-alt"><img class="bookacti-loader" src="'+bookacti_localized.plugin_path+'/img/ajax-loader.gif" title="'+bookacti_localized.loading+'" /><span class="bookacti-loading-alt-text" >'+bookacti_localized.loading+"</span></div>";$j("#bookacti-delete-activity-dialog").append(c);$j.ajax({url:ajaxurl,data:b,type:"POST",dataType:"json",success:function(d){if(d.status==="success"){delete bookacti.booking_system["bookacti-template-calendar"]["activities_data"][a];$j('.bookacti-activity[data-activity-id="'+a+'"]').remove();if(b.delete_events){bookacti.booking_system["bookacti-template-calendar"]["groups_data"]=d.groups_data;bookacti.booking_system["bookacti-template-calendar"]["groups_events"]=[];bookacti_refetch_events_on_calendar_editor()}bookacti_display_activity_tuto_if_no_activity_available();$j("#bookacti-delete-activity-dialog").trigger("bookacti_activity_deactivated",[d,b]);$j("#bookacti-delete-activity-dialog").dialog("close");$j("#bookacti-activity-data-dialog").dialog("close");$j("#bookacti-activity-create-method-dialog").dialog("close")}else{var e=typeof d.message!=="undefined"?d.message:bookacti_localized.error;$j("#bookacti-delete-activity-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+e+"</li></ul></div>");$j("#bookacti-delete-activity-dialog .bookacti-notices").show();console.log(d)}},error:function(d){alert("AJAX "+bookacti_localized.error);console.log(d)},complete:function(){bookacti_stop_template_loading();$j("#bookacti-delete-activity-dialog .bookacti-loading-alt").remove()}})}},{text:bookacti_localized.dialog_button_cancel,click:function(){$j("#bookacti-delete-activity-dialog").dialog("close")}}])}function bookacti_dialog_create_group_of_events(a){a=a?a:bookacti.selected_category;var b=$j.trim($j("#bookacti-group-of-events-dialog").dialog("option","title").replace(/\(.*?\)/,""));$j("#bookacti-group-of-events-dialog").dialog({title:b+" ("+bookacti_localized.create_new+")"});$j("#bookacti-group-of-events-dialog .bookacti-notices").remove();if($j("#bookacti-group-of-events-category-selectbox option").length>1){a=$j('#bookacti-group-of-events-category-selectbox option[value="'+a+'"]').length?a:"new";$j("#bookacti-group-of-events-category-selectbox").val(a).trigger("change")}else{$j("#bookacti-group-of-events-new-category-title").show()}$j("#bookacti-group-of-events-occurrences-navigation").hide();bookacti_fill_repetition_fields(0,"group");bookacti_fill_selected_events_list();bookacti_validate_group_of_events_form();$j("#bookacti-group-of-events-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_ok,click:function(){$j("#bookacti-group-of-events-dialog .bookacti-notices").remove();$j("#bookacti-group-of-events-action").val("bookactiInsertGroupOfEvents");$j("#bookacti-group-of-events-form select[multiple].bookacti-items-select-box option").prop("selected",true);$j("#bookacti-group-of-events-form select[multiple]#bookacti-group-of-events-exceptions-selectbox option").prop("selected",true);var c=$j("#bookacti-group-of-events-category-selectbox").val();bookacti.selected_category=c;if(typeof tinyMCE!=="undefined"){if(tinyMCE){tinyMCE.triggerSave()}}var f=bookacti_validate_group_of_events_form();if(f){var d=$j("#bookacti-group-of-events-form").serializeObject();d.template_id=bookacti.selected_template;d.interval=JSON.stringify(bookacti.booking_system["bookacti-template-calendar"]["events_interval"]);d.events=JSON.stringify(bookacti.booking_system["bookacti-template-calendar"]["selected_events"]);$j("#bookacti-group-of-events-dialog").trigger("bookacti_insert_group_of_events_before",[d]);bookacti_start_template_loading();var e='<div class="bookacti-loading-alt"><img class="bookacti-loader" src="'+bookacti_localized.plugin_path+'/img/ajax-loader.gif" title="'+bookacti_localized.loading+'" /><span class="bookacti-loading-alt-text" >'+bookacti_localized.loading+"</span></div>";$j("#bookacti-group-of-events-dialog").append(e);$j.ajax({url:ajaxurl,data:d,type:"POST",dataType:"json",success:function(g){if(g.status==="success"){bookacti.booking_system["bookacti-template-calendar"]["groups_data"][g.group_id]=g.group_data;bookacti.booking_system["bookacti-template-calendar"]["groups_events"][g.group_id]=g.group_events;bookacti.booking_system["bookacti-template-calendar"]["group_categories_data"][g.category_id]=g.category;bookacti.booking_system["bookacti-template-calendar"]["selected_events"]=[];$j("#bookacti-template-add-first-group-of-events-container").hide();if(c==="new"){bookacti_add_group_category(g.category_id,g.category.title)}bookacti_add_group_of_events(g.group_id,g.group_title_raw,g.category_id);bookacti_unselect_all_events();$j("#bookacti-template-calendar").fullCalendar("rerenderEvents");$j("#bookacti-group-of-events-dialog").trigger("bookacti_group_of_events_inserted",[g,d]);$j("#bookacti-group-of-events-dialog").dialog("close")}else{var h=typeof g.message!=="undefined"?g.message:bookacti_localized.error;$j("#bookacti-group-of-events-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+h+"</li></ul></div>");$j("#bookacti-group-of-events-dialog .bookacti-notices").show();console.log(g)}},error:function(g){alert("AJAX "+bookacti_localized.error);console.log(g)},complete:function(){bookacti_stop_template_loading();$j("#bookacti-group-of-events-dialog .bookacti-loading-alt").remove()}})}}}]);$j("#bookacti-group-of-events-dialog").dialog("open")}function bookacti_dialog_update_group_of_events(k){$j("#bookacti-group-of-events-dialog .bookacti-notices").remove();var c=$j.trim($j("#bookacti-group-of-events-dialog").dialog("option","title").replace(/\(.*?\)/,""));$j("#bookacti-group-of-events-dialog").dialog({title:c+" ("+bookacti_localized.edit_id+": "+k+")"});var a=$j('.bookacti-group-of-events[data-group-id="'+k+'"]').closest(".bookacti-group-category").data("group-category-id");var f=a?a:"new";$j("#bookacti-group-of-events-category-selectbox").val(a).trigger("change");var d=bookacti.booking_system["bookacti-template-calendar"]["selected_events"].slice();bookacti_fill_selected_events_list();var h=bookacti.booking_system["bookacti-template-calendar"]["groups_data"][k];var j=[];if(typeof bookacti.booking_system["bookacti-template-calendar"]["groups_events"][k]!=="undefined"){j=$j.extend({},bookacti.booking_system["bookacti-template-calendar"]["groups_events"][k])}var e=Object.keys(j);$j("#bookacti-group-of-events-title-field").val(h.multilingual_title);$j("#bookacti-group-of-events-occurrences-prev, #bookacti-group-of-events-occurrences-next").toggle(e.length>1);$j("#bookacti-group-of-events-occurrences-navigation").show();if(!e.length){bookacti_get_group_of_events_occurrences(k)}bookacti_fill_repetition_fields(k,"group");if(h.settings){bookacti_fill_fields_from_array(h.settings,"","#bookacti-group-of-events-dialog")}$j("#bookacti-group-of-events-dialog").trigger("bookacti_group_of_events_update_dialog",[k]);if(bookacti_localized.is_qtranslate){$j("#bookacti-group-of-events-dialog .qtranxs-translatable").each(function(){bookacti_refresh_qtx_field(this)})}bookacti_validate_group_of_events_form();var g=[];var l={text:bookacti_localized.dialog_button_ok,click:function(){$j("#bookacti-group-of-events-dialog .bookacti-notices").remove();$j("#bookacti-group-of-events-action").val("bookactiUpdateGroupOfEvents");$j("#bookacti-group-of-events-form select[multiple].bookacti-items-select-box option").prop("selected",true);$j("#bookacti-group-of-events-form select[multiple]#bookacti-group-of-events-exceptions-selectbox option").prop("selected",true);bookacti.booking_system["bookacti-template-calendar"]["selected_events"]=d.slice();bookacti_fill_selected_events_list();bookacti_refresh_selected_events_display();$j("#bookacti-template-calendar").fullCalendar("gotoDate",d[0]["start"]);var m=$j("#bookacti-group-of-events-category-selectbox").val();bookacti.selected_category=m;if(typeof tinyMCE!=="undefined"){if(tinyMCE){tinyMCE.triggerSave()}}var p=bookacti_validate_group_of_events_form();if(p){var n=$j("#bookacti-group-of-events-form").serializeObject();n.group_id=k;n.interval=JSON.stringify(bookacti.booking_system["bookacti-template-calendar"]["events_interval"]);n.events=JSON.stringify(bookacti.booking_system["bookacti-template-calendar"]["selected_events"]);$j("#bookacti-group-of-events-dialog").trigger("bookacti_update_group_of_events_before",[n,k]);bookacti_start_template_loading();var o='<div class="bookacti-loading-alt"><img class="bookacti-loader" src="'+bookacti_localized.plugin_path+'/img/ajax-loader.gif" title="'+bookacti_localized.loading+'" /><span class="bookacti-loading-alt-text" >'+bookacti_localized.loading+"</span></div>";$j("#bookacti-group-of-events-dialog").append(o);$j.ajax({url:ajaxurl,data:n,type:"POST",dataType:"json",success:function(q){if(q.status==="success"){bookacti.booking_system["bookacti-template-calendar"]["groups_data"][k]=q.group_data;bookacti.booking_system["bookacti-template-calendar"]["groups_events"][k]=q.group_events;bookacti.booking_system["bookacti-template-calendar"]["group_categories_data"][q.category_id]=q.category;bookacti.booking_system["bookacti-template-calendar"]["selected_events"]=[];if(m==="new"){bookacti_add_group_category(q.category_id,q.category.title)}if(f!=m){$j('.bookacti-group-of-events[data-group-id="'+k+'"]').remove();bookacti_add_group_of_events(k,q.group_title_raw,q.category_id)}else{$j('.bookacti-group-of-events[data-group-id="'+k+'"] .bookacti-group-of-events-title').attr("title",q.group_title_raw);$j('.bookacti-group-of-events[data-group-id="'+k+'"] .bookacti-group-of-events-title').html(q.group_title_raw)}bookacti_unselect_all_events();$j("#bookacti-template-calendar").fullCalendar("rerenderEvents");$j("#bookacti-group-of-events-dialog").trigger("bookacti_group_of_events_updated",[q,n,k])}else{if(q.status==="failed"){var r=typeof q.message!=="undefined"?q.message:bookacti_localized.error;$j("#bookacti-group-of-events-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+r+"</li></ul></div>");$j("#bookacti-group-of-events-dialog .bookacti-notices").show();console.log(q)}}if(q.status!=="failed"){$j("#bookacti-group-of-events-dialog").dialog("close")}},error:function(q){alert("AJAX "+bookacti_localized.error);console.log(q)},complete:function(){bookacti_stop_template_loading();$j("#bookacti-group-of-events-dialog .bookacti-loading-alt").remove()}})}}};g.push(l);var i={text:bookacti_localized.dialog_button_delete,"class":"bookacti-dialog-delete-button bookacti-dialog-left-button",click:function(){$j("#bookacti-group-of-events-dialog .bookacti-notices").remove();bookacti.booking_system["bookacti-template-calendar"]["selected_events"]=d.slice();bookacti_fill_selected_events_list();bookacti_refresh_selected_events_display();$j("#bookacti-template-calendar").fullCalendar("gotoDate",d[0]["start"]);var m={action:"bookactiBeforeDeleteGroupOfEvents",group_id:k,nonce:$j("#nonce_delete_group_of_events").val()};$j("#bookacti-group-of-events-dialog").trigger("bookacti_before_deactivate_group_of_events",[event,m]);bookacti_start_template_loading();var n='<div class="bookacti-loading-alt"><img class="bookacti-loader" src="'+bookacti_localized.plugin_path+'/img/ajax-loader.gif" title="'+bookacti_localized.loading+'" /><span class="bookacti-loading-alt-text" >'+bookacti_localized.loading+"</span></div>";$j("#bookacti-group-of-events-dialog").append(n);$j.ajax({url:ajaxurl,data:m,type:"POST",dataType:"json",success:function(o){if(o.status==="success"){$j("#bookacti-group-of-events-dialog").dialog("close");bookacti_dialog_delete_group_of_events(k);$j("#bookacti-delete-booked-group-of-events-options").toggle(parseInt(o.has_bookings)?true:false);$j("#bookacti-delete-group-of-events-cancel_bookings").prop("checked",parseInt(o.has_bookings)?true:false).trigger("change");$j("#bookacti-delete-group-of-events-cancel_bookings-container").append('<span class="bookacti-bookings-nb">'+o.booking_groups_nb+" ("+o.bookings_nb+")</span>");$j("#bookacti-delete-group-of-events-send_notifications-container").append('<span class="bookacti-notifications-nb">'+o.notifications_nb+"</span>")}else{if(o.status==="failed"){var p=typeof o.message!=="undefined"?o.message:bookacti_localized.error;$j("#bookacti-group-of-events-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+p+"</li></ul></div>");$j("#bookacti-group-of-events-dialog .bookacti-notices").show();console.log(o)}}},error:function(o){alert("AJAX "+bookacti_localized.error);console.log(o)},complete:function(){bookacti_stop_template_loading();$j("#bookacti-group-of-events-dialog .bookacti-loading-alt").remove()}})}};g.push(i);var b=bookacti.booking_system["bookacti-template-calendar"]["groups_data"][k]["repeat_freq"]!=="none";if(b){g.push({text:bookacti_localized.dialog_button_unbind,"class":"bookacti-dialog-left-button",click:function(){$j(this).dialog("close");bookacti_dialog_unbind_group_of_events_occurrences(k)}})}$j("#bookacti-group-of-events-dialog").dialog("option","buttons",g);$j("#bookacti-group-of-events-dialog").off("dialogbeforeclose").on("dialogbeforeclose",function(){$j('.bookacti-group-of-events[data-group-id="'+k+'"]').removeClass("bookacti-selected-group")});$j("#bookacti-group-of-events-occurrences-undo").off("click").on("click",function(){bookacti.booking_system["bookacti-template-calendar"]["selected_events"]=d.slice();bookacti_fill_selected_events_list();bookacti_refresh_selected_events_display();$j("#bookacti-template-calendar").fullCalendar("gotoDate",d[0]["start"])});$j("#bookacti-group-of-events-dialog").dialog("open")}function bookacti_get_group_of_events_occurrences(a){var b={action:"bookactiGetGroupOfEvents",group_id:a,interval:JSON.stringify(bookacti.booking_system["bookacti-template-calendar"]["events_interval"]),nonce:$j("#nonce_insert_or_update_group_of_events").val()};$j("#bookacti-group-of-events-dialog").trigger("bookacti_get_group_of_events_occurrences_before",[b,a]);var c='<span class="bookacti-loading-alt"><img class="bookacti-loader" src="'+bookacti_localized.plugin_path+'/img/ajax-loader.gif" title="'+bookacti_localized.loading+'" /></span>';$j("#bookacti-group-of-events-occurrences-navigation, #bookacti-group-of-events-add-exception-container").append(c);$j.ajax({url:ajaxurl,data:b,type:"POST",dataType:"json",success:function(e){if(e.status==="success"){bookacti.booking_system["bookacti-template-calendar"]["groups_data"][a]=e.group_data;bookacti.booking_system["bookacti-template-calendar"]["groups_events"][a]=e.group_events;bookacti_fill_repetition_fields(a,"group");var d=Object.keys(e.group_events);$j("#bookacti-group-of-events-occurrences-prev, #bookacti-group-of-events-occurrences-next").toggle(d.length>1);$j("#bookacti-group-of-events-dialog").trigger("bookacti_group_of_events_occurrences_retrieved",[e,b,a])}else{if(e.status==="failed"){var f=typeof e.message!=="undefined"?e.message:bookacti_localized.error;$j("#bookacti-group-of-events-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+f+"</li></ul></div>");$j("#bookacti-group-of-events-dialog .bookacti-notices").show();console.log(e)}}},error:function(d){alert("AJAX "+bookacti_localized.error);console.log(d)},complete:function(){$j("#bookacti-group-of-events-occurrences-navigation .bookacti-loading-alt, #bookacti-group-of-events-add-exception-container .bookacti-loading-alt").remove()}})}function bookacti_dialog_delete_group_of_events(a){$j("#bookacti-delete-group-of-events-cancel_bookings-container .bookacti-bookings-nb").remove();$j("#bookacti-delete-group-of-events-send_notifications-container .bookacti-notifications-nb").remove();$j("#bookacti-delete-group-of-events-dialog .bookacti-notices").remove();$j("#bookacti-delete-booked-group-of-events-options").show();$j("#bookacti-delete-group-of-events-cancel_bookings").prop("checked",true).trigger("change");$j("#bookacti-delete-group-of-events-send_notifications").prop("checked",false).trigger("change");$j("#bookacti-delete-group-of-events-dialog").trigger("bookacti_delete_group_of_events_dialog",[a]);$j("#bookacti-delete-group-of-events-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_delete,"class":"bookacti-dialog-delete-button",click:function(){$j("#bookacti-delete-group-of-events-dialog .bookacti-notices").remove();var b=$j("#bookacti-delete-group-of-events-form").serializeObject();b.cancel_bookings=$j("#bookacti-delete-group-of-events-cancel_bookings").is(":checked")?1:0;b.group_id=a;$j("#bookacti-delete-group-of-events-dialog").trigger("bookacti_deactivate_group_of_events_before",[b,a]);bookacti_start_template_loading();var c='<div class="bookacti-loading-alt"><img class="bookacti-loader" src="'+bookacti_localized.plugin_path+'/img/ajax-loader.gif" title="'+bookacti_localized.loading+'" /><span class="bookacti-loading-alt-text" >'+bookacti_localized.loading+"</span></div>";$j("#bookacti-delete-group-of-events-dialog").append(c);$j.ajax({url:ajaxurl,data:b,type:"POST",dataType:"json",success:function(d){if(d.status==="success"){delete bookacti.booking_system["bookacti-template-calendar"]["groups_data"][a];delete bookacti.booking_system["bookacti-template-calendar"]["groups_events"][a];bookacti.booking_system["bookacti-template-calendar"]["selected_events"]=[];$j('.bookacti-group-of-events[data-group-id="'+a+'"]').remove();if(b.cancel_bookings&&typeof d.bookings!=="undefined"){bookacti.booking_system["bookacti-template-calendar"]["bookings"]=d.bookings}$j("#bookacti-template-calendar").fullCalendar("rerenderEvents");$j("#bookacti-insert-group-of-events").css("visibility","hidden");$j("#bookacti-delete-group-of-events-dialog").trigger("bookacti_group_of_events_deactivated",[d,b,a]);$j("#bookacti-delete-group-of-events-dialog").dialog("close")}else{var e=typeof d.message!=="undefined"?d.message:bookacti_localized.error;$j("#bookacti-delete-group-of-events-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+e+"</li></ul></div>");$j("#bookacti-delete-group-of-events-dialog .bookacti-notices").show();console.log(d)}},error:function(d){alert("AJAX "+bookacti_localized.error);console.log(d)},complete:function(){$j("#bookacti-delete-group-of-events-dialog .bookacti-loading-alt").remove();bookacti_stop_template_loading()}})}},{text:bookacti_localized.dialog_button_cancel,click:function(){$j(this).dialog("close")}}]);$j("#bookacti-delete-group-of-events-dialog").dialog("open")}function bookacti_dialog_unbind_group_of_events_occurrences(b){$j("#bookacti-unbind-group-of-events-dialog .bookacti-notices").remove();$j("#bookacti-unbind-group-of-events-dialog .bookacti-form-error").remove();$j("#bookacti-unbind-group-of-events-dialog .bookacti-input-warning").removeClass("bookacti-input-warning");bookacti_fill_selected_events_list();var c="";$j.each(bookacti.booking_system["bookacti-template-calendar"]["selected_events"],function(d,e){c=moment.utc(e.start).format("YYYY-MM-DD");return false});$j('input[type="radio"][name="unbind_action"][value="selected"]').prop("checked",true).trigger("change");var a=[{text:bookacti_localized.dialog_button_unbind,"class":"bookacti-dialog-delete-button",click:function(){$j("#bookacti-unbind-group-of-events-dialog .bookacti-notices").remove();$j("#bookacti-unbind-group-of-events-dialog .bookacti-form-error").remove();$j("#bookacti-unbind-group-of-events-dialog .bookacti-input-warning").removeClass("bookacti-input-warning");var f=$j("#bookacti-unbind-group-of-events-form").serializeObject();var d=$j.extend({group_id:b,group_date:c},f);$j("#bookacti-template-container").trigger("bookacti_unbind_group_of_events_occurrences_before",[d,b,c]);bookacti_start_template_loading();var e='<div class="bookacti-loading-alt"><img class="bookacti-loader" src="'+bookacti_localized.plugin_path+'/img/ajax-loader.gif" title="'+bookacti_localized.loading+'" /><span class="bookacti-loading-alt-text" >'+bookacti_localized.loading+"</span></div>";$j("#bookacti-unbind-group-of-events-dialog").append(e);$j.ajax({url:ajaxurl,data:d,type:"POST",dataType:"json",success:function(g){if(g.status==="success"){bookacti_unselect_all_events();bookacti.booking_system["bookacti-template-calendar"]["groups_data"]=g.groups_data;bookacti.booking_system["bookacti-template-calendar"]["groups_events"]=[];bookacti.booking_system["bookacti-template-calendar"]["bookings"]=g.bookings;var i=$j('.bookacti-group-of-events[data-group-id="'+b+'"]').closest(".bookacti-group-category");if(i.length){i.replaceWith(g.groups_list)}else{$j(".bookacti-group-categories").append(g.groups_list)}$j("#bookacti-template-groups-of-events-container .dashicons").toggleClass("bookacti-disabled",bookacti.booking_system["bookacti-template-calendar"]["loading_number"]>0);bookacti_make_group_categories_sortable();bookacti_make_groups_of_events_sortable();$j("#bookacti-template-container").trigger("bookacti_group_of_events_occurrences_unbound",[g,d,b,c]);$j("#bookacti-unbind-group-of-events-dialog").dialog("close")}else{var h=typeof g.message!=="undefined"?g.message:bookacti_localized.error;$j("#bookacti-unbind-group-of-events-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+h+"</li></ul></div>");$j("#bookacti-unbind-group-of-events-dialog .bookacti-notices").show();console.log(g)}},error:function(g){alert("AJAX "+bookacti_localized.error);console.log(g)},complete:function(){$j("#bookacti-unbind-group-of-events-dialog .bookacti-loading-alt").remove();bookacti_stop_template_loading()}})}},{text:bookacti_localized.dialog_button_cancel,click:function(){$j(this).dialog("close")}}];$j("#bookacti-unbind-group-of-events-dialog").dialog("option","buttons",a);$j("#bookacti-unbind-group-of-events-dialog").dialog("open")}function bookacti_dialog_update_group_category(b){var c=$j.trim($j("#bookacti-group-category-dialog").dialog("option","title").replace(/\(.*?\)/,""));$j("#bookacti-group-category-dialog").dialog({title:c+" ("+bookacti_localized.edit_id+": "+b+")"});$j("#bookacti-group-category-dialog .bookacti-notices").remove();var a=bookacti.booking_system["bookacti-template-calendar"]["group_categories_data"][b];$j("#bookacti-group-category-template-id").val(bookacti.selected_template);$j("#bookacti-group-category-category-id").val(b);$j("#bookacti-group-category-title-field").val(a.multilingual_title);if(a.settings){bookacti_fill_fields_from_array(a.settings,"","#bookacti-group-category-dialog")}$j("#bookacti-group-category-dialog").trigger("bookacti_group_category_update_dialog",[b]);if(bookacti_localized.is_qtranslate){$j("#bookacti-group-category-dialog .qtranxs-translatable").each(function(){bookacti_refresh_qtx_field(this)})}$j("#bookacti-group-category-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_ok,click:function(){$j("#bookacti-group-category-dialog .bookacti-notices").remove();$j("#bookacti-group-category-action").val("bookactiUpdateGroupCategory");$j("#bookacti-group-category-form select[multiple].bookacti-items-select-box option").prop("selected",true);if(typeof tinyMCE!=="undefined"){if(tinyMCE){tinyMCE.triggerSave()}}var f=bookacti_validate_group_category_form();if(f){var d=$j("#bookacti-group-category-form").serializeObject();$j("#bookacti-group-category-dialog").trigger("bookacti_update_group_category_before",[d]);bookacti_start_template_loading();var e='<div class="bookacti-loading-alt"><img class="bookacti-loader" src="'+bookacti_localized.plugin_path+'/img/ajax-loader.gif" title="'+bookacti_localized.loading+'" /><span class="bookacti-loading-alt-text" >'+bookacti_localized.loading+"</span></div>";$j("#bookacti-group-category-dialog").append(e);$j.ajax({url:ajaxurl,data:d,type:"POST",dataType:"json",success:function(g){if(g.status==="success"){bookacti.booking_system["bookacti-template-calendar"]["group_categories_data"][b]=g.category;var h=g.category.title.length>16?g.category.title.substr(0,16)+"&#8230;":g.category.title;$j('.bookacti-group-category[data-group-category-id="'+b+'"] .bookacti-group-category-title').attr("title",g.category.title);$j('.bookacti-group-category[data-group-category-id="'+b+'"] .bookacti-group-category-title span').html(h);$j('#bookacti-group-of-events-category-selectbox option[value="'+b+'"]').html(g.category.title);$j("#bookacti-group-category-dialog").trigger("bookacti_group_category_updated",[g,d]);$j("#bookacti-group-category-dialog").dialog("close")}else{if(g.status==="failed"){var i=typeof g.message!=="undefined"?g.message:bookacti_localized.error;$j("#bookacti-group-category-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+i+"</li></ul></div>");$j("#bookacti-group-category-dialog .bookacti-notices").show();console.log(g)}}},error:function(g){alert("AJAX "+bookacti_localized.error);console.log(g)},complete:function(){bookacti_stop_template_loading();$j("#bookacti-group-category-dialog .bookacti-loading-alt").remove()}})}}},{text:bookacti_localized.dialog_button_delete,"class":"bookacti-dialog-delete-button bookacti-dialog-left-button",click:function(){bookacti_dialog_delete_group_category(b)}}]);$j("#bookacti-group-category-dialog").dialog("open")}function bookacti_dialog_delete_group_category(a){$j("#bookacti-delete-group-category-dialog .bookacti-notices").remove();$j("#bookacti-delete-group-category-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_delete,"class":"bookacti-dialog-delete-button",click:function(){$j("#bookacti-delete-group-category-dialog .bookacti-notices").remove();var b={action:"bookactiDeleteGroupCategory",category_id:a,nonce:$j("#nonce_delete_group_category").val()};$j("#bookacti-delete-group-category-dialog").trigger("bookacti_deactivate_group_category_before",[b]);bookacti_start_template_loading();var c='<div class="bookacti-loading-alt"><img class="bookacti-loader" src="'+bookacti_localized.plugin_path+'/img/ajax-loader.gif" title="'+bookacti_localized.loading+'" /><span class="bookacti-loading-alt-text" >'+bookacti_localized.loading+"</span></div>";$j("#bookacti-delete-group-category-dialog").append(c);$j.ajax({url:ajaxurl,data:b,type:"POST",dataType:"json",success:function(d){if(d.status==="success"){delete bookacti.booking_system["bookacti-template-calendar"]["group_categories_data"][a];bookacti.booking_system["bookacti-template-calendar"]["selected_events"]=[];$j.each(bookacti.booking_system["bookacti-template-calendar"]["groups_data"],function(g,f){if(f.category_id==a){delete bookacti.booking_system["bookacti-template-calendar"]["groups_events"][f.id];delete bookacti.booking_system["bookacti-template-calendar"]["groups_data"][f.id]}});$j('.bookacti-group-category[data-group-category-id="'+a+'"]').remove();$j('#bookacti-group-of-events-category-selectbox option[value="'+a+'"]').remove();$j("#bookacti-template-calendar").fullCalendar("rerenderEvents");$j("#bookacti-insert-group-of-events").css("visibility","hidden");if(!$j(".bookacti-group-category").length){$j("#bookacti-template-add-group-of-events-tuto-select-events").show()}$j("#bookacti-delete-group-category-dialog").trigger("bookacti_group_category_deactivated",[d,b]);$j("#bookacti-delete-group-category-dialog").dialog("close");$j("#bookacti-group-category-dialog").dialog("close")}else{var e=typeof d.message!=="undefined"?d.message:bookacti_localized.error;$j("#bookacti-delete-group-category-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+e+"</li></ul></div>");$j("#bookacti-delete-group-category-dialog .bookacti-notices").show();console.log(d)}},error:function(d){alert("AJAX "+bookacti_localized.error);console.log(d)},complete:function(){bookacti_stop_template_loading();$j("#bookacti-delete-group-category-dialog .bookacti-loading-alt").remove()}})}},{text:bookacti_localized.dialog_button_cancel,click:function(){$j("#bookacti-delete-group-category-dialog").dialog("close")}}]);$j("#bookacti-delete-group-category-dialog").dialog("open")};