function bookacti_init_template_dialogs(){$j("#bookacti-unbind-event-dialog, #bookacti-unbind-group-of-events-dialog").dialog({beforeClose:function(){}});$j('input[type="radio"][name="unbind_action"]').on("change",function(){$j(".bookacti-unbind-action small").hide();$j('input[type="radio"][name="unbind_action"]:checked').closest(".bookacti-unbind-action").find("small").show()});$j("select#template-import-bound-activities").on("change",function(){var a=$j("select#template-import-bound-activities").val();
a&&bookacti_load_activities_bound_to_template(a)});$j("#bookacti-template-container").on("click","#bookacti-insert-template, #bookacti-add-first-template-button",function(){bookacti_dialog_add_new_template()});$j("#bookacti-template-duplicated-template-id").on("change",function(){var a=parseInt($j(this).val());if(a){var c=parseInt($j("#bookacti-template-picker").val()),b=bookacti.booking_system["bookacti-template-calendar"].template_data;$j.isEmptyObject(b.settings)||c!==a||bookacti_fill_fields_from_array(b.settings,
"","#bookacti-template-data-dialog")}});$j("#bookacti-template-activity-list").on("click",".bookacti-activity-settings",function(){var a=$j(this).closest(".bookacti-activity").data("activity-id");a&&bookacti_dialog_update_activity(a)});$j("#bookacti-template-groups-of-events-container").on("click","#bookacti-template-add-first-group-of-events-button, #bookacti-insert-group-of-events",function(){bookacti_dialog_create_group_of_events()});$j(document).on("keydown",function(a){a.ctrlKey&&71==a.keyCode&&
(a.preventDefault(),a.stopPropagation(),2<=bookacti.booking_system["bookacti-template-calendar"].selected_events.length&&bookacti_dialog_create_group_of_events())});$j("#bookacti-template-groups-of-events-container").on("click",".bookacti-update-group-of-events",function(){var a=$j(this).closest(".bookacti-group-of-events").data("group-id");if(a){var c=$j(this).closest(".bookacti-group-of-events").hasClass("bookacti-selected-group"),b=c;c||(b=bookacti_select_events_of_group(a));b&&bookacti_dialog_update_group_of_events(a)}});
$j("#bookacti-group-of-events-occurrences-prev").on("click",function(){var a=$j("#bookacti-group-categories").find(".bookacti-group-of-events.bookacti-selected-group").data("group-id");a&&bookacti_navigate_through_group_occurrences(a,"prev")});$j("#bookacti-group-of-events-occurrences-next").on("click",function(){var a=$j("#bookacti-group-categories").find(".bookacti-group-of-events.bookacti-selected-group").data("group-id");a&&bookacti_navigate_through_group_occurrences(a,"next")});$j("#bookacti-group-of-events-occurrences-reset").on("click",
function(){var a=$j("#bookacti-group-categories").find(".bookacti-group-of-events.bookacti-selected-group").data("group-id");a&&bookacti_navigate_through_group_occurrences(a,"reset")});$j("#bookacti-group-categories").on("click",".bookacti-update-group-category",function(){var a=$j(this).closest(".bookacti-group-category").data("group-category-id");a&&bookacti_dialog_update_group_category(a)});$j("#bookacti-group-of-events-category-selectbox").on("change blur",function(){"new"===$j(this).val()?$j("#bookacti-group-of-events-new-category-title").show():
$j("#bookacti-group-of-events-new-category-title").hide()});$j("body").on("change",'input[name="repeat_step"], select[name="repeat_freq"]',function(){var a=1<parseInt($j(this).closest(".bookacti-field-container").find('input[name="repeat_step"]').val())&&"weekly"===$j(this).closest(".bookacti-field-container").find('select[name="repeat_freq"]').val();$j(this).closest(".bookacti-field-container").find(".bookacti-repeat-freq-start-of-week-notice").toggle(a)});$j("#bookacti-delete-event-cancel_bookings").on("change",
function(){$j("#bookacti-delete-event-send_notifications-container").toggle($j("#bookacti-delete-event-cancel_bookings").is(":checked"))});$j("#bookacti-delete-group-of-events-cancel_bookings").on("change",function(){$j("#bookacti-delete-group-of-events-send_notifications-container").toggle($j("#bookacti-delete-group-of-events-cancel_bookings").is(":checked"))});$j("#bookacti-delete-event-cancel_bookings, #bookacti-delete-event-send_notifications").on("change",function(){$j("#bookacti-delete-event-dialog .bookacti-banp-promo-admin-message").toggle($j("#bookacti-delete-event-cancel_bookings").is(":checked")&&
$j("#bookacti-delete-event-send_notifications").is(":checked"))});$j("#bookacti-delete-group-of-events-cancel_bookings, #bookacti-delete-group-of-events-send_notifications").on("change",function(){$j("#bookacti-delete-group-of-events-dialog .bookacti-banp-promo-admin-message").toggle($j("#bookacti-delete-group-of-events-cancel_bookings").is(":checked")&&$j("#bookacti-delete-group-of-events-send_notifications").is(":checked"))});$j("#bookacti-update-booked-event-dates-send_notifications").on("change",
function(){$j("#bookacti-update-booked-event-dates-dialog .bookacti-banp-promo-admin-message").toggle($j("#bookacti-update-booked-event-dates-send_notifications").is(":checked"))})}
function bookacti_dialog_add_new_template(){var a=$j.trim($j("#bookacti-template-data-dialog").dialog("option","title").replace(/\(.*?\)/,""));$j("#bookacti-template-data-dialog").dialog({title:a+" ("+bookacti_localized.create_new+")"});$j("#bookacti-slotmintime").val("00:00");$j("#bookacti-slotmaxtime").val("00:00");$j("#bookacti-snapduration").val("00:05");$j("#bookacti-template-data-dialog").trigger("bookacti_default_template_settings");1<$j("#bookacti-template-duplicated-template-id option").length?
($j("#bookacti-template-duplicated-template-id-container").show(),$j("#bookacti-template-duplicated-template-id").attr("disabled",!1)):($j("#bookacti-template-duplicated-template-id-container").hide(),$j("#bookacti-template-duplicated-template-id").attr("disabled",!0));$j("#bookacti-template-data-dialog").trigger("bookacti_template_data_dialog");$j("#bookacti-template-data-dialog").dialog("open");$j("#bookacti-template-data-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_ok,
click:function(){$j("#bookacti-template-data-dialog .bookacti-notices").remove();$j("#bookacti-template-data-form-action").val("bookactiInsertTemplate");var c=$j("#bookacti-template-title").val();"undefined"!==typeof tinyMCE&&tinyMCE&&tinyMCE.triggerSave();if(bookacti_validate_template_form()){var b=bookacti_serialize_object($j("#bookacti-template-data-form"));$j("#bookacti-template-data-dialog").trigger("bookacti_insert_template_before",[b]);$j("#bookacti-template-calendar").length?bookacti_start_template_loading():
$j("#bookacti-add-first-template-button").length&&$j("#bookacti-add-first-template-button").removeClass("dashicons dashicons-plus-alt").addClass("spinner");bookacti_add_loading_html($j("#bookacti-template-data-dialog"));$j.ajax({url:ajaxurl,data:b,type:"POST",dataType:"json",success:function(d){if("success"===d.status){var e=!1;$j("#bookacti-first-template-container").is(":visible")&&($j("#bookacti-first-template-container").before($j('<div class="bookacti-booking-system-editor" id="bookacti-template-calendar"><div class="bookacti-calendar"></div>')),
$j("#bookacti-first-template-container").hide(),$j(".bookacti-no-template").removeClass("bookacti-no-template"),bookacti_load_template_calendar(),bookacti_start_template_loading(),e=!0);$j("#bookacti-template-picker").append("<option value='"+d.template_id+"'>"+c+"</option>");$j("select.bookacti-template-select-box").append("<option value='"+d.template_id+"'>"+c+"</option>");2===$j("#bookacti-template-picker option").length&&bookacti_bind_template_dialogs();$j("#bookacti-template-data-dialog").trigger("bookacti_template_inserted",
[d,b]);$j("#bookacti-template-data-dialog").dialog("close");bookacti_switch_template(d.template_id);e&&bookacti_stop_template_loading()}else"failed"===d.status&&(e="undefined"!==typeof d.message?d.message:bookacti_localized.error,$j("#bookacti-template-data-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+e+"</li></ul></div>"),$j("#bookacti-template-data-dialog .bookacti-notices").show(),console.log(d))},error:function(d){alert("AJAX "+bookacti_localized.error);
console.log(d)},complete:function(){$j("#bookacti-add-first-template-button").length&&$j("#bookacti-add-first-template-button").removeClass("spinner").addClass("dashicons dashicons-plus-alt");bookacti_stop_template_loading();bookacti_remove_loading_html($j("#bookacti-template-data-dialog"))}})}}}])}
function bookacti_dialog_update_template(a){if(!a)return!1;var c=$j.trim($j("#bookacti-template-data-dialog").dialog("option","title").replace(/\(.*?\)/,""));$j("#bookacti-template-data-dialog").dialog({title:c+" ("+bookacti_localized.edit_id+": "+a+")"});$j("#bookacti-template-duplicated-template-id-container").hide();$j("#bookacti-template-duplicated-template-id").attr("disabled",!0);c=bookacti.booking_system["bookacti-template-calendar"].template_data;$j("#bookacti-template-title").val(c.multilingual_title);
var b=$j("#bookacti-template-managers-selectbox");bookacti_fill_items_selectbox(b,c.admin);$j("#bookacti-template-data-dialog").trigger("bookacti_default_template_settings");$j.isEmptyObject(c.settings)||bookacti_fill_fields_from_array(c.settings,"","#bookacti-template-data-dialog");$j("#bookacti-template-data-dialog").trigger("bookacti_template_data_dialog",[a]);bookacti_localized.is_qtranslate&&$j("#bookacti-template-data-dialog .qtranxs-translatable").each(function(){bookacti_refresh_qtx_field(this)});
$j("#bookacti-template-data-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_ok,click:function(){$j("#bookacti-template-data-dialog .bookacti-notices").remove();$j("#bookacti-template-data-form-template-id").val(a);$j("#bookacti-template-data-form-action").val("bookactiUpdateTemplate");"undefined"!==typeof tinyMCE&&tinyMCE&&tinyMCE.triggerSave();if(bookacti_validate_template_form()){var d=bookacti_serialize_object($j("#bookacti-template-data-form"));$j("#bookacti-template-data-dialog").trigger("bookacti_update_template_before",
[d,a]);bookacti_start_template_loading();bookacti_add_loading_html($j("#bookacti-template-data-dialog"));$j.ajax({url:ajaxurl,data:d,type:"POST",dataType:"json",success:function(e){if("success"===e.status)bookacti.booking_system["bookacti-template-calendar"].template_data=e.template_data,bookacti.booking_system["bookacti-template-calendar"].display_data=e.template_data.settings,$j("#bookacti-template-picker option[value="+a+"]").html(e.template_data.title),bookacti_load_template_calendar(),bookacti_get_calendar_editor_data_by_interval(),
$j("#bookacti-template-data-dialog").trigger("bookacti_template_updated",[e,d,a]),$j("#bookacti-template-data-dialog").dialog("close");else{var f="undefined"!==typeof e.message?e.message:bookacti_localized.error;$j("#bookacti-template-data-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+f+"</li></ul></div>");$j("#bookacti-template-data-dialog .bookacti-notices").show();console.log(e)}},error:function(e){alert("AJAX "+bookacti_localized.error);console.log(e)},complete:function(){bookacti_stop_template_loading();
bookacti_remove_loading_html($j("#bookacti-template-data-dialog"))}})}}},{text:bookacti_localized.dialog_button_delete,"class":"bookacti-dialog-delete-button bookacti-dialog-left-button",click:function(){bookacti_dialog_deactivate_template(a)}}]);$j("#bookacti-template-data-dialog").dialog("open")}
function bookacti_dialog_deactivate_template(a){a&&($j("#bookacti-delete-template-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_delete,"class":"bookacti-dialog-delete-button",click:function(){$j("#bookacti-delete-template-dialog .bookacti-notices").remove();var c={action:"bookactiDeactivateTemplate",template_id:a,nonce:$j("#bookacti-edit-template-nonce").val()};$j("#bookacti-delete-template-dialog").trigger("bookacti_deactivate_template_before",[c,a]);bookacti_start_template_loading();
bookacti_add_loading_html($j("#bookacti-delete-template-dialog"));$j.ajax({url:ajaxurl,data:c,type:"POST",dataType:"json",success:function(b){if("success"===b.status){$j("#bookacti-template-picker option[value="+a+"]").remove();var d=$j("#bookacti-template-picker option:first").val();$j("select.bookacti-template-select-box option[value="+a+"]").remove();1===$j("#bookacti-template-picker option").length&&bookacti_bind_template_dialogs();$j("#bookacti-delete-template-dialog").trigger("bookacti_template_deactivated",
[b,c,a]);$j("#bookacti-delete-template-dialog").dialog("close");$j("#bookacti-template-data-dialog").dialog("close");bookacti_switch_template(d)}else d="undefined"!==typeof b.message?b.message:bookacti_localized.error,$j("#bookacti-delete-template-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+d+"</li></ul></div>"),$j("#bookacti-delete-template-dialog .bookacti-notices").show(),console.log(b)},error:function(b){alert("AJAX "+bookacti_localized.error);console.log(b)},
complete:function(){bookacti_stop_template_loading();bookacti_remove_loading_html($j("#bookacti-delete-template-dialog"))}})}},{text:bookacti_localized.dialog_button_cancel,click:function(){$j("#bookacti-delete-template-dialog").dialog("close")}}]),$j("#bookacti-delete-template-dialog").dialog("open"))}
function bookacti_dialog_update_booked_event_dates(a,c,b){b="undefined"!==typeof b?b:!1;$j("#bookacti-update-booked-event-dates-dialog .bookacti-bookings-nb").remove();$j("#bookacti-update-booked-event-dates-send_notifications-container .bookacti-notifications-nb").remove();$j(".bookacti-update-booked-repeated-event-dates-warning").hide();$j("#bookacti-update-booked-event-dates-send_notifications").prop("checked",!1).trigger("change");$j("#bookacti-update-booked-event-dates-dialog").trigger("bookacti_update_booked_event_dates_dialog",
[a,c,b]);var d=[{text:bookacti_localized.dialog_button_ok,click:function(){bookacti_update_event_dates(a,c,b,"booked")}},{text:bookacti_localized.dialog_button_cancel,click:function(){!1!==b&&b();$j(this).dialog("close")}}];"none"!==bookacti.booking_system["bookacti-template-calendar"].events_data[a.groupId].repeat_freq&&($j(".bookacti-update-booked-repeated-event-dates-warning").show(),d.push({text:bookacti_localized.dialog_button_unbind,"class":"bookacti-dialog-left-button",click:function(){!1!==
b&&b();$j(this).dialog("close");bookacti_dialog_unbind_event_occurrences(c)}}));$j("#bookacti-update-booked-event-dates-dialog").off("dialogbeforeclose").on("dialogbeforeclose",function(){!1!==b&&b()});$j("#bookacti-update-booked-event-dates-dialog").dialog("option","buttons",d);$j("#bookacti-update-booked-event-dates-dialog").dialog("open")}
function bookacti_dialog_update_event(a){var c=$j.trim($j("#bookacti-event-data-dialog").dialog("option","title").replace(/\(.*?\)/,""));$j("#bookacti-event-data-dialog").dialog({title:c+" ("+bookacti_localized.edit_id+": "+a.groupId+")"});c=bookacti.booking_system["bookacti-template-calendar"].events_data[a.groupId];$j("#bookacti-event-data-dialog").data("event-id",a.groupId);$j("#bookacti-event-data-dialog").attr("data-event-id",a.groupId);$j("#bookacti-event-title").val(c.multilingual_title);$j("#bookacti-event-availability").val(c.availability);
bookacti_fill_repetition_fields(a.groupId,"event");"undefined"!==typeof c.settings&&bookacti_fill_fields_from_array(c.settings,"","#bookacti-event-data-dialog");$j("#bookacti-event-data-dialog").trigger("bookacti_event_update_dialog",[a]);bookacti_localized.is_qtranslate&&$j("#bookacti-event-data-dialog .qtranxs-translatable").each(function(){bookacti_refresh_qtx_field(this)});bookacti_validate_event_form();var b=[];b.push({text:bookacti_localized.dialog_button_ok,click:function(){$j("#bookacti-event-data-dialog .bookacti-notices").remove();
var e=moment.utc(a.start).clone().locale("en").format("YYYY-MM-DD HH:mm:ss"),f=moment.utc(a.end).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");$j("#bookacti-event-data-form-event-id").val(a.groupId);$j("#bookacti-event-data-form-event-start").val(e);$j("#bookacti-event-data-form-event-end").val(f);$j("#bookacti-event-data-form-action").val("bookactiUpdateEvent");"undefined"!==typeof tinyMCE&&tinyMCE&&tinyMCE.triggerSave();if(bookacti_validate_event_form()){var g=bookacti_serialize_object($j("#bookacti-event-data-form"));
g.interval=bookacti.booking_system["bookacti-template-calendar"].events_interval;$j("#bookacti-event-data-dialog").trigger("bookacti_update_event_before",[g,a]);bookacti_start_template_loading();bookacti_add_loading_html($j("#bookacti-event-data-dialog"));$j.ajax({url:ajaxurl,data:g,type:"POST",dataType:"json",success:function(h){if("success"===h.status)bookacti_unselect_event(a,!0),bookacti.booking_system["bookacti-template-calendar"].events_data[a.groupId]=h.events_data[a.groupId],bookacti.booking_system["bookacti-template-calendar"].groups_data=
h.groups_data,bookacti.booking_system["bookacti-template-calendar"].groups_events=[],bookacti_fc_remove_events_by_groupId($j("#bookacti-template-calendar"),a.groupId),bookacti_fc_add_events($j("#bookacti-template-calendar"),h.events),$j("#bookacti-event-data-dialog").trigger("bookacti_event_updated",[h,g,a]);else if("failed"===h.status){var l="undefined"!==typeof h.message?h.message:bookacti_localized.error;$j("#bookacti-event-data-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+
l+"</li></ul></div>");$j("#bookacti-event-data-dialog .bookacti-notices").show();console.log(h)}"failed"!==h.status&&$j("#bookacti-event-data-dialog").dialog("close")},error:function(h){alert("AJAX "+bookacti_localized.error);console.log(h)},complete:function(){bookacti_stop_template_loading();bookacti_remove_loading_html($j("#bookacti-event-data-dialog"))}})}}});b.push({text:bookacti_localized.dialog_button_delete,"class":"bookacti-dialog-delete-button bookacti-dialog-left-button",click:function(){$j("#bookacti-event-data-dialog .bookacti-notices").remove();
var e={action:"bookactiBeforeDeleteEvent",event_id:a.groupId,nonce:$j('#bookacti-delete-event-form input[name="nonce"]').val()};$j("#bookacti-event-data-dialog").trigger("bookacti_before_deactivate_event",[e,a]);bookacti_start_template_loading();bookacti_add_loading_html($j("#bookacti-event-data-dialog"));$j.ajax({url:ajaxurl,data:e,type:"POST",dataType:"json",success:function(f){if("success"===f.status)$j("#bookacti-event-data-dialog").dialog("close"),bookacti_dialog_delete_event(a),$j("#bookacti-delete-booked-event-options").toggle(parseInt(f.has_bookings)?
!0:!1),$j("#bookacti-delete-event-cancel_bookings").prop("checked",parseInt(f.has_bookings)?!0:!1).trigger("change"),$j("#bookacti-delete-event-cancel_bookings-container").append('<span class="bookacti-bookings-nb">'+f.bookings_nb+"</span>"),$j("#bookacti-delete-event-send_notifications-container").append('<span class="bookacti-notifications-nb">'+f.notifications_nb+"</span>");else if("failed"===f.status){var g="undefined"!==typeof f.message?f.message:bookacti_localized.error;$j("#bookacti-event-data-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+
g+"</li></ul></div>");$j("#bookacti-event-data-dialog .bookacti-notices").show();console.log(f)}},error:function(f){alert("AJAX "+bookacti_localized.error);console.log(f)},complete:function(){bookacti_stop_template_loading();bookacti_remove_loading_html($j("#bookacti-event-data-dialog"))}})}});var d={};"none"!==c.repeat_freq&&(d={text:bookacti_localized.dialog_button_unbind,"class":"bookacti-dialog-unbind-button bookacti-dialog-left-button",click:function(){$j("#bookacti-event-data-dialog").dialog("close");
bookacti_dialog_unbind_event_occurrences(a)}},b.push(d));b.push({text:bookacti_localized.dialog_button_move,"class":"bookacti-dialog-move-button bookacti-dialog-left-button",click:function(){$j("#bookacti-event-data-dialog").dialog("close");bookacti_dialog_update_event_dates(a)}});$j("#bookacti-event-data-dialog").dialog("option","buttons",b);$j("#bookacti-event-data-dialog").dialog("open")}
function bookacti_dialog_update_event_dates(a){$j("#bookacti-update-event-dates-dialog .bookacti-selected-event-start, #bookacti-update-event-dates-dialog .bookacti-selected-event-end").empty();$j(".bookacti-update-repeated-event-dates-warning").hide();$j("#bookacti-update-event-dates-dialog .bookacti-selected-event-start").html(moment.utc(a.start).format("LLLL"));$j("#bookacti-update-event-dates-dialog .bookacti-selected-event-end").html(moment.utc(a.end).format("LLLL"));$j("#bookacti-update-event-dates-start_date").val(moment.utc(a.start).clone().locale("en").format("YYYY-MM-DD"));
$j("#bookacti-update-event-dates-start_time").val(moment.utc(a.start).clone().locale("en").format("HH:mm"));$j("#bookacti-update-event-dates-end_date").val(moment.utc(a.end).clone().locale("en").format("YYYY-MM-DD"));$j("#bookacti-update-event-dates-end_time").val(moment.utc(a.end).clone().locale("en").format("HH:mm"));var c=[{text:bookacti_localized.dialog_button_ok,click:function(){$j("#bookacti-update-event-dates-dialog .bookacti-notices").remove();var b=moment.utc(moment.utc(a.start).clone().locale("en").format("YYYY-MM-DD HH:mm:ss")),
d=moment.utc(moment.utc(a.end).clone().locale("en").format("YYYY-MM-DD HH:mm:ss")),e=moment.utc($j("#bookacti-update-event-dates-start_date").val()+" "+$j("#bookacti-update-event-dates-start_time").val()),f=moment.utc($j("#bookacti-update-event-dates-end_date").val()+" "+$j("#bookacti-update-event-dates-end_time").val()),g="";f.isSameOrBefore(e)&&(g=bookacti_localized.error_end_before_start);b.isSame(e)&&d.isSame(f)&&(g=bookacti_localized.error_fill_field);g?($j("#bookacti-update-event-dates-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+
g+"</li></ul></div>"),$j("#bookacti-update-event-dates-dialog .bookacti-notices").show()):(b={id:a.groupId,groupId:a.groupId,start:a.start,end:a.end},e={id:a.groupId,groupId:a.groupId,start:e.toDate(),end:f.toDate()},bookacti_update_event_dates(e,b,!1,"normal"))}},{text:bookacti_localized.dialog_button_cancel,click:function(){$j(this).dialog("close")}}];"none"!==bookacti.booking_system["bookacti-template-calendar"].events_data[a.groupId].repeat_freq&&($j(".bookacti-update-repeated-event-dates-warning").show(),
c.push({text:bookacti_localized.dialog_button_unbind,"class":"bookacti-dialog-left-button",click:function(){$j(this).dialog("close");bookacti_dialog_unbind_event_occurrences(a)}}));$j("#bookacti-update-event-dates-dialog").dialog("option","buttons",c);$j("#bookacti-update-event-dates-dialog").dialog("open")}
function bookacti_dialog_delete_event(a){$j("#bookacti-delete-event-cancel_bookings-container .bookacti-bookings-nb").remove();$j("#bookacti-delete-event-send_notifications-container .bookacti-notifications-nb").remove();$j(".bookacti-delete-booked-repeated-event-warning").hide();$j("#bookacti-delete-booked-event-options").show();$j("#bookacti-delete-event-cancel_bookings").prop("checked",!0).trigger("change");$j("#bookacti-delete-event-send_notifications").prop("checked",!1).trigger("change");$j("#bookacti-delete-event-dialog").trigger("bookacti_delete_event_dialog",
[a]);var c=[{text:bookacti_localized.dialog_button_delete,"class":"bookacti-dialog-delete-button",click:function(){$j("#bookacti-delete-event-dialog .bookacti-notices").remove();var b=bookacti_serialize_object($j("#bookacti-delete-event-form"));b.event_id=a.groupId;$j("#bookacti-delete-event-dialog").trigger("bookacti_deactivate_event_before",[b,a]);bookacti_start_template_loading();bookacti_add_loading_html($j("#bookacti-delete-event-dialog"));$j.ajax({url:ajaxurl,data:b,type:"POST",dataType:"json",
success:function(d){if("success"===d.status)bookacti_unselect_event(a),bookacti.booking_system["bookacti-template-calendar"].groups_data=d.groups_data,bookacti.booking_system["bookacti-template-calendar"].groups_events=[],bookacti_fc_remove_events_by_groupId($j("#bookacti-template-calendar"),a.groupId),$j("#bookacti-delete-event-dialog").trigger("bookacti_event_deactivated",[d,b,a]),$j("#bookacti-delete-event-dialog").dialog("close");else{var e="undefined"!==typeof d.message?d.message:bookacti_localized.error;
$j("#bookacti-delete-event-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+e+"</li></ul></div>");$j("#bookacti-delete-event-dialog .bookacti-notices").show();console.log(d)}},error:function(d){alert("AJAX "+bookacti_localized.error);console.log(d)},complete:function(){bookacti_stop_template_loading();bookacti_remove_loading_html($j("#bookacti-delete-event-dialog"))}})}},{text:bookacti_localized.dialog_button_cancel,click:function(){$j(this).dialog("close")}}];
"none"!==bookacti.booking_system["bookacti-template-calendar"].events_data[a.groupId].repeat_freq&&($j(".bookacti-delete-booked-repeated-event-warning").show(),c.push({text:bookacti_localized.dialog_button_unbind,"class":"bookacti-dialog-left-button",click:function(){$j(this).dialog("close");bookacti_dialog_unbind_event_occurrences(a)}}));$j("#bookacti-delete-event-dialog").dialog("option","buttons",c);$j("#bookacti-delete-event-dialog").dialog("open")}
function bookacti_dialog_unbind_event_occurrences(a){$j("#bookacti-unbind-event-dialog .bookacti-selected-event-start, #bookacti-unbind-event-dialog .bookacti-selected-event-end").empty();$j("#bookacti-unbind-event-dialog .bookacti-selected-event-start").html(moment.utc(a.start).format("LLLL"));$j("#bookacti-unbind-event-dialog .bookacti-selected-event-end").html(moment.utc(a.end).format("LLLL"));$j('input[type="radio"][name="unbind_action"][value="selected"]').prop("checked",!0).trigger("change");
var c=[{text:bookacti_localized.dialog_button_unbind,"class":"bookacti-dialog-delete-button",click:function(){$j("#bookacti-unbind-event-dialog .bookacti-notices").remove();$j("#bookacti-unbind-event-dialog .bookacti-form-error").remove();$j("#bookacti-unbind-event-dialog .bookacti-input-warning").removeClass("bookacti-input-warning");var b=bookacti_serialize_object($j("#bookacti-unbind-event-form")),d=moment.utc(a.start).clone().locale("en").format("YYYY-MM-DD HH:mm:ss"),e=$j.extend({event_id:a.groupId,
event_start:d,event_end:moment.utc(a.end).clone().locale("en").format("YYYY-MM-DD HH:mm:ss"),interval:bookacti.booking_system["bookacti-template-calendar"].events_interval},b);$j("#bookacti-template-container").trigger("bookacti_unbind_event_occurrences_before",[e,a]);bookacti_start_template_loading();bookacti_add_loading_html($j("#bookacti-unbind-event-dialog"));$j.ajax({url:ajaxurl,data:e,type:"POST",dataType:"json",success:function(f){if("success"===f.status)bookacti_unselect_event(a,!0),bookacti.booking_system["bookacti-template-calendar"].groups_data=
f.groups_data,bookacti.booking_system["bookacti-template-calendar"].groups_events=[],bookacti.booking_system["bookacti-template-calendar"].bookings=f.bookings,$j.each(f.new_events_ids,function(h,l){"undefined"!==typeof f.events_data[l]?bookacti.booking_system["bookacti-template-calendar"].events_data[l]=f.events_data[l]:"undefined"!==typeof bookacti.booking_system["bookacti-template-calendar"].events_data[l]&&delete bookacti.booking_system["bookacti-template-calendar"].events_data[l]}),bookacti_fc_remove_events_by_groupId($j("#bookacti-template-calendar"),
a.groupId),bookacti_fc_add_events($j("#bookacti-template-calendar"),f.events),$j("#bookacti-template-container").trigger("bookacti_event_occurrences_unbound",[f,e,a]),$j("#bookacti-unbind-event-dialog").dialog("close");else{var g="undefined"!==typeof f.message?f.message:bookacti_localized.error;$j("#bookacti-unbind-event-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+g+"</li></ul></div>");$j("#bookacti-unbind-event-dialog .bookacti-notices").show();console.log(f)}},
error:function(f){alert("AJAX "+bookacti_localized.error);console.log(f)},complete:function(){bookacti_stop_template_loading();bookacti_remove_loading_html($j("#bookacti-unbind-event-dialog"))}})}},{text:bookacti_localized.dialog_button_cancel,click:function(){$j(this).dialog("close")}}];$j("#bookacti-unbind-event-dialog").dialog("option","buttons",c);$j("#bookacti-unbind-event-dialog").dialog("open")}
function bookacti_fill_repetition_fields(a,c){if("group"===c||"event"===c)if("group"!==c||"undefined"!==typeof bookacti.booking_system["bookacti-template-calendar"].selected_events[0])if("event"!==c||"undefined"!==typeof bookacti.booking_system["bookacti-template-calendar"].picked_events[0]){var b=moment.utc(("group"===c?bookacti.booking_system["bookacti-template-calendar"].selected_events[0]:bookacti.booking_system["bookacti-template-calendar"].picked_events[0]).start).clone(),d={repeat_freq:"none",
repeat_step:1,repeat_from:"",repeat_to:"",repeat_on:"",repeat_exceptions:[]};a&&(d="group"===c?bookacti.booking_system["bookacti-template-calendar"].groups_data[a]:bookacti.booking_system["bookacti-template-calendar"].events_data[a]);var e=b.clone().add(28,"d").locale("en");a=b.clone().locale("en").format("YYYY-MM-DD");e=e.format("YYYY-MM-DD");d.repeat_from&&"0000-00-00"!==d.repeat_from&&(a=d.repeat_from);d.repeat_to&&"0000-00-00"!==d.repeat_to&&(e=d.repeat_to);var f=d.repeat_step&&$j.isNumeric(d.repeat_step)?
Math.max(1,parseInt(d.repeat_step)):1,g="weekly"===d.repeat_freq&&d.repeat_on?d.repeat_on.split("_"):[parseInt(b.format("d"))],h="monthly"===d.repeat_freq&&d.repeat_on&&0<=$j.inArray(d.repeat_on,["nth_day_of_month","nth_day_of_week","last_day_of_month","last_day_of_week"])?d.repeat_on:"nth_day_of_month",l=!1,n=moment.utc(a).add(1,"d").locale("en"),p=moment.utc(e).subtract(1,"d").locale("en");n.isAfter(p)&&(l=!0);var k="group"===c?"#bookacti-group-of-events-dialog":"#bookacti-event-data-dialog";$j(k+
' select[name="repeat_freq"] option[value="'+d.repeat_freq+'"]').prop("selected",!0);$j(k+' select[name="repeat_monthly_type"] option[value="'+h+'"]').prop("selected",!0);$j(k+' input[name="repeat_step"]').val(f).trigger("change");$j(k+' input[name="repeat_freq"]').trigger("change");$j(k+' input[name="repeat_from"]').val(a);$j(k+' input[name="repeat_to"]').val(e);bookacti_delete_days_off_rows($j(k+" .bookacti-date-intervals-table-container"));$j(k+" input.bookacti-date-interval-from, "+k+" input.bookacti-date-interval-to").attr("min",
"").attr("max","");l||$j(k+" input.bookacti-date-interval-from, "+k+" input.bookacti-date-interval-to").attr("min",n.format("YYYY-MM-DD")).attr("max",p.format("YYYY-MM-DD"));$j.isEmptyObject(d.repeat_exceptions)||bookacti_fill_days_off($j(k+" .bookacti-date-intervals-table-container"),d.repeat_exceptions);$j.isArray(g)&&$j.each(g,function(m,q){$j(k+' input[type="checkbox"][name="repeat_days[]"][value="'+q+'"]').prop("checked",!0).trigger("change")});var r=b.format("Do"),t=b.format("dddd");b.locale("en");
c=Math.ceil(parseInt(b.format("DD"))/7);var u=moment.utc(b.format("YYYY")+"-0"+c+"-01").format("Mo");c=parseInt(b.format("D"))===parseInt(b.daysInMonth())?!0:!1;b=parseInt(b.format("D"))>=parseInt(b.daysInMonth())-6?!0:!1;$j(k+' select[name="repeat_monthly_type"] option').each(function(){var m=$j(this).data("default-label");m&&(m=m.replace("{nth_day_of_month}",r).replace("{nth_day_of_week}",u).replace("{day_of_week}",t),$j(this).html(m))});$j(k+' select[name="repeat_monthly_type"] option[value="last_day_of_month"]').toggle(c);
$j(k+' select[name="repeat_monthly_type"] option[value="last_day_of_week"]').toggle(b)}}
function bookacti_fill_selected_events_list(){$j(".bookacti-selected-events-list").empty();$j(".bookacti-selected-events-list").removeClass("bookacti-input-warning");$j("#bookacti-group-of-events-summary-preview-notice").hide();bookacti.booking_system["bookacti-template-calendar"].selected_events=bookacti_sort_events_array_by_dates(bookacti.booking_system["bookacti-template-calendar"].selected_events);$j.each(bookacti.booking_system["bookacti-template-calendar"].selected_events,function(a,c){a=moment.utc(c.start);
var b=moment.utc(c.end),d=a.formatPHP(bookacti_localized.date_format)+bookacti_localized.dates_separator+b.formatPHP(bookacti_localized.date_format);c.start.substr(0,10)===c.end.substr(0,10)&&(d=a.formatPHP(bookacti_localized.date_format)+bookacti_localized.date_time_separator+b.formatPHP(bookacti_localized.time_format));c=$j("<option></option>",{html:d+" - "+c.title});c.attr("title",c.text());c.appendTo(".bookacti-selected-events-list")})}
function bookacti_navigate_through_group_occurrences(a,c){c=0<=$j.inArray(c,["prev","next","reset"])?c:"reset";var b="";bookacti.booking_system["bookacti-template-calendar"].selected_events.length?b=bookacti.booking_system["bookacti-template-calendar"].selected_events[0].start.substr(0,10):bookacti.booking_system["bookacti-template-calendar"].groups_data[a].events.length&&(b=bookacti.booking_system["bookacti-template-calendar"].groups_data[a].events[0].start.substr(0,10));var d="";if("reset"!==c&&
b){var e=moment.utc(b),f="";$j.each(bookacti.booking_system["bookacti-template-calendar"].groups_events[a],function(g,h){d=g;h=f?moment.utc(f):moment.utc(g);var l=moment.utc(g);if("next"===c&&f&&h.isSameOrAfter(e))return!1;if("prev"===c&&l.isSameOrAfter(e))return f&&(d=f),!1;f=g})}d!==b&&(bookacti_select_events_of_group(a,d),bookacti_fill_selected_events_list(),bookacti_refresh_selected_events_display(),$j("#bookacti-group-of-events-summary").addClass("bookacti-input-warning"),$j("#bookacti-group-of-events-summary-preview-notice").show())}
function bookacti_dialog_choose_activity_creation_type(){if(bookacti.selected_template){var a={text:bookacti_localized.dialog_button_import_activity,click:function(){$j(this).dialog("close");bookacti_dialog_import_activity()}},c=[{text:bookacti_localized.dialog_button_create_activity,click:function(){$j(this).dialog("close");bookacti_dialog_create_activity()}},a,{text:bookacti_localized.dialog_button_cancel,click:function(){$j(this).dialog("close")}}];1>=$j("#bookacti-template-picker option").length&&
c.unshift(a);$j("#bookacti-activity-create-method-dialog").dialog("option","buttons",c);$j("#bookacti-activity-create-method-dialog").dialog("open")}}
function bookacti_dialog_import_activity(){bookacti.selected_template&&($j("#template-import-bound-activities option").attr("disabled",!1),$j('#template-import-bound-activities option[value="'+bookacti.selected_template+'"]').attr("disabled",!0),$j("#template-import-bound-activities").children("option:enabled").eq(0).prop("selected",!0),$j("#template-import-bound-activities").trigger("change"),$j("#bookacti-activity-import-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_ok,
click:function(){$j("#bookacti-activity-import-dialog .bookacti-notices").remove();var a=$j("select#bookacti-activities-to-import").val();if($j.isEmptyObject(a))$j("#bookacti-activity-import-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+bookacti_localized.error_fill_field+"</li></ul></div>");else{var c={action:"bookactiImportActivities",activity_ids:a,template_id:bookacti.selected_template,nonce:$j('#bookacti-activity-import-dialog input[name="nonce"]').val()};
$j("#bookacti-activity-import-dialog").trigger("bookacti_import_activities_before",[c]);bookacti_start_template_loading();bookacti_add_loading_html($j("#bookacti-activity-import-dialog"));$j.ajax({url:ajaxurl,data:c,type:"POST",dataType:"json",success:function(b){if("success"===b.status)bookacti.booking_system["bookacti-template-calendar"].activities_data=b.activities_data,b.activity_list&&$j("#bookacti-template-activity-list").empty().append(b.activity_list),$j.each(a,function(e,f){$j('select#bookacti-activities-to-import option[value="'+
f+'"]').remove()}),bookacti_refresh_activity_list(),$j("#bookacti-activity-import-dialog").trigger("bookacti_activities_imported",[b,c]),$j("#bookacti-activity-import-dialog").dialog("close"),$j("#bookacti-activity-create-method-dialog").dialog("close");else{var d="undefined"!==typeof b.message?b.message:bookacti_localized.error;$j("#bookacti-activity-import-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+d+"</li></ul></div>");$j("#bookacti-activity-import-dialog .bookacti-notices").show();
console.log(b)}},error:function(b){alert("AJAX "+bookacti_localized.error);console.log(b)},complete:function(){bookacti_stop_template_loading();bookacti_remove_loading_html($j("#bookacti-activity-import-dialog"))}})}}},{text:bookacti_localized.dialog_button_cancel,click:function(){$j("#bookacti-activity-import-dialog").dialog("close")}}]),$j("#bookacti-activity-import-dialog").dialog("open"))}
function bookacti_dialog_create_activity(){if(bookacti.selected_template){var a=$j.trim($j("#bookacti-activity-data-dialog").dialog("option","title").replace(/\(.*?\)/,""));$j("#bookacti-activity-data-dialog").dialog({title:a+" ("+bookacti_localized.create_new+")"});$j("#bookacti-activity-template-id").val(bookacti.selected_template);$j("#bookacti-activity-activity-id").val("");$j("#bookacti-activity-color").val("#3a87ad");$j("#bookacti-activity-action").val("bookactiInsertActivity");$j("#bookacti-activity-data-dialog").trigger("bookacti_activity_insert_dialog");
$j("#bookacti-activity-data-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_ok,click:function(){$j("#bookacti-activity-data-dialog .bookacti-notices").remove();"undefined"!==typeof tinyMCE&&tinyMCE&&tinyMCE.triggerSave();if(bookacti_validate_activity_form()){var c=bookacti_serialize_object($j("#bookacti-activity-data-form"));$j("#bookacti-activity-data-dialog").trigger("bookacti_insert_activity_before",[c]);bookacti_start_template_loading();bookacti_add_loading_html($j("#bookacti-activity-data-dialog"));
$j.ajax({url:ajaxurl,data:c,type:"POST",dataType:"json",success:function(b){if("success"===b.status)bookacti.booking_system["bookacti-template-calendar"].activities_data[b.activity_id]=b.activity_data,b.activity_list&&$j("#bookacti-template-activity-list").empty().append(b.activity_list),bookacti_refresh_activity_list(),$j("#bookacti-activity-data-dialog").trigger("bookacti_activity_inserted",[b,c]),$j("#bookacti-activity-data-dialog").dialog("close"),$j("#bookacti-activity-create-method-dialog").dialog("close");
else if("failed"===b.status){var d="undefined"!==typeof b.message?b.message:bookacti_localized.error;$j("#bookacti-activity-data-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+d+"</li></ul></div>");$j("#bookacti-activity-data-dialog .bookacti-notices").show();console.log(b)}},error:function(b){alert("AJAX "+bookacti_localized.error);console.log(b)},complete:function(){bookacti_stop_template_loading();bookacti_remove_loading_html($j("#bookacti-activity-data-dialog"))}})}}}]);
$j("#bookacti-activity-data-dialog").dialog("open")}}
function bookacti_dialog_update_activity(a){if(bookacti.selected_template&&a){var c=$j.trim($j("#bookacti-activity-data-dialog").dialog("option","title").replace(/\(.*?\)/,""));$j("#bookacti-activity-data-dialog").dialog({title:c+" ("+bookacti_localized.edit_id+": "+a+")"});c=bookacti.booking_system["bookacti-template-calendar"].activities_data[a];$j("#bookacti-activity-template-id").val(bookacti.selected_template);$j("#bookacti-activity-activity-id").val(a);$j("#bookacti-activity-action").val("bookactiUpdateActivity");
$j("#bookacti-activity-title").val(c.multilingual_title);$j("#bookacti-activity-color").val(c.color);$j("#bookacti-activity-availability").val(c.availability);var b=c.duration?c.duration:"000.01:00:00";$j("#bookacti-activity-duration-days").val(b.substr(0,3)).trigger("change");$j("#bookacti-activity-duration-hours").val(b.substr(4,2)).trigger("change");$j("#bookacti-activity-duration-minutes").val(b.substr(7,2)).trigger("change");b=$j("#bookacti-activity-managers-selectbox");bookacti_fill_items_selectbox(b,
c.admin);c.settings&&(bookacti_fill_fields_from_array(c.settings,"","#bookacti-activity-data-dialog"),$j("#bookacti-activity-unit-name-singular").val(c.settings.multilingual_unit_name_singular),$j("#bookacti-activity-unit-name-plural").val(c.settings.multilingual_unit_name_plural));$j("#bookacti-activity-data-dialog").trigger("bookacti_activity_update_dialog",[a]);bookacti_localized.is_qtranslate&&$j("#bookacti-activity-data-dialog .qtranxs-translatable").each(function(){bookacti_refresh_qtx_field(this)});
$j("#bookacti-activity-data-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_ok,click:function(){$j("#bookacti-activity-data-dialog .bookacti-notices").remove();"undefined"!==typeof tinyMCE&&tinyMCE&&tinyMCE.triggerSave();if(bookacti_validate_activity_form()){var d=bookacti_serialize_object($j("#bookacti-activity-data-form"));$j("#bookacti-activity-data-dialog").trigger("bookacti_update_activity_before",[d,a]);bookacti_start_template_loading();bookacti_add_loading_html($j("#bookacti-activity-data-dialog"));
$j.ajax({url:ajaxurl,data:d,type:"POST",dataType:"json",success:function(e){if("success"===e.status)bookacti.booking_system["bookacti-template-calendar"].activities_data[a]=e.activity_data,e.activity_list&&$j("#bookacti-template-activity-list").empty().append(e.activity_list),bookacti_refresh_activity_list(),bookacti_refetch_events_on_calendar_editor(),$j("#bookacti-activity-data-dialog").trigger("bookacti_activity_updated",[e,d,a]),$j("#bookacti-activity-data-dialog").dialog("close");else if("failed"===
e.status){var f="undefined"!==typeof e.message?e.message:bookacti_localized.error;$j("#bookacti-activity-data-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+f+"</li></ul></div>");$j("#bookacti-activity-data-dialog .bookacti-notices").show();console.log(e)}},error:function(e){alert("AJAX "+bookacti_localized.error);console.log(e)},complete:function(){bookacti_stop_template_loading();bookacti_remove_loading_html($j("#bookacti-activity-data-dialog"))}})}}},{text:bookacti_localized.dialog_button_delete,
"class":"bookacti-dialog-delete-button bookacti-dialog-left-button",click:function(){bookacti_dialog_delete_activity(a)}}]);$j("#bookacti-activity-data-dialog").dialog("open")}}
function bookacti_dialog_delete_activity(a){a&&($j("#bookacti-delete-activity-events").prop("checked",!1),$j("#bookacti-delete-activity-dialog").dialog("open"),$j("#bookacti-delete-activity-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_delete,"class":"bookacti-dialog-delete-button",click:function(){$j("#bookacti-delete-activity-dialog .bookacti-notices").remove();var c={action:"bookactiDeactivateActivity",activity_id:a,template_id:bookacti.selected_template,delete_events:$j("#bookacti-delete-activity-events").is(":checked")?
1:0,nonce:$j('#bookacti-delete-activity-dialog input[name="nonce"]').val()};$j("#bookacti-delete-activity-dialog").trigger("bookacti_deactivate_activity_before",[c,a]);bookacti_start_template_loading();bookacti_add_loading_html($j("#bookacti-delete-activity-dialog"));$j.ajax({url:ajaxurl,data:c,type:"POST",dataType:"json",success:function(b){if("success"===b.status)delete bookacti.booking_system["bookacti-template-calendar"].activities_data[a],$j('.bookacti-activity[data-activity-id="'+a+'"]').remove(),
c.delete_events&&(bookacti.booking_system["bookacti-template-calendar"].groups_data=b.groups_data,bookacti.booking_system["bookacti-template-calendar"].groups_events=[],bookacti_refetch_events_on_calendar_editor()),bookacti_display_activity_tuto_if_no_activity_available(),$j("#bookacti-delete-activity-dialog").trigger("bookacti_activity_deactivated",[b,c,a]),$j("#bookacti-delete-activity-dialog").dialog("close"),$j("#bookacti-activity-data-dialog").dialog("close"),$j("#bookacti-activity-create-method-dialog").dialog("close");
else{var d="undefined"!==typeof b.message?b.message:bookacti_localized.error;$j("#bookacti-delete-activity-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+d+"</li></ul></div>");$j("#bookacti-delete-activity-dialog .bookacti-notices").show();console.log(b)}},error:function(b){alert("AJAX "+bookacti_localized.error);console.log(b)},complete:function(){bookacti_stop_template_loading();bookacti_remove_loading_html($j("#bookacti-delete-activity-dialog"))}})}},{text:bookacti_localized.dialog_button_cancel,
click:function(){$j("#bookacti-delete-activity-dialog").dialog("close")}}]))}
function bookacti_dialog_create_group_of_events(a){a=a?a:bookacti.selected_category;var c=$j.trim($j("#bookacti-group-of-events-dialog").dialog("option","title").replace(/\(.*?\)/,""));$j("#bookacti-group-of-events-dialog").dialog({title:c+" ("+bookacti_localized.create_new+")"});1<$j("#bookacti-group-of-events-category-selectbox option").length?(a=$j('#bookacti-group-of-events-category-selectbox option[value="'+a+'"]').length?a:"new",$j("#bookacti-group-of-events-category-selectbox").val(a).trigger("change")):
$j("#bookacti-group-of-events-new-category-title").show();$j("#bookacti-group-of-events-occurrences-navigation").hide();bookacti_fill_repetition_fields(0,"group");bookacti_fill_selected_events_list();bookacti_validate_group_of_events_form();$j("#bookacti-group-of-events-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_ok,click:function(){$j("#bookacti-group-of-events-dialog .bookacti-notices").remove();$j("#bookacti-group-of-events-action").val("bookactiInsertGroupOfEvents");
var b=$j("#bookacti-group-of-events-category-selectbox").val();bookacti.selected_category=b;"undefined"!==typeof tinyMCE&&tinyMCE&&tinyMCE.triggerSave();if(bookacti_validate_group_of_events_form()){var d=bookacti_serialize_object($j("#bookacti-group-of-events-form"));d.action="bookactiInsertGroupOfEvents";d.template_id=bookacti.selected_template;d.interval=JSON.stringify(bookacti.booking_system["bookacti-template-calendar"].events_interval);d.events=JSON.stringify(bookacti.booking_system["bookacti-template-calendar"].selected_events);
$j("#bookacti-group-of-events-dialog").trigger("bookacti_insert_group_of_events_before",[d,a]);bookacti_start_template_loading();bookacti_add_loading_html($j("#bookacti-group-of-events-dialog"));$j.ajax({url:ajaxurl,data:d,type:"POST",dataType:"json",success:function(e){if("success"===e.status)bookacti.booking_system["bookacti-template-calendar"].groups_data[e.group_id]=e.group_data,bookacti.booking_system["bookacti-template-calendar"].groups_events[e.group_id]=e.group_events,bookacti.booking_system["bookacti-template-calendar"].group_categories_data[e.category_id]=
e.category,bookacti.booking_system["bookacti-template-calendar"].selected_events=[],$j("#bookacti-template-add-first-group-of-events-container").hide(),"new"===b&&bookacti_add_group_category(e.category_id,e.category.title),bookacti_add_group_of_events(e.group_id,e.group_title_raw,e.category_id),bookacti_unselect_all_events(),bookacti.fc_calendar["bookacti-template-calendar"].render(),$j("#bookacti-group-of-events-dialog").trigger("bookacti_group_of_events_inserted",[e,d,a]),$j("#bookacti-group-of-events-dialog").dialog("close");
else{var f="undefined"!==typeof e.message?e.message:bookacti_localized.error;$j("#bookacti-group-of-events-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+f+"</li></ul></div>");$j("#bookacti-group-of-events-dialog .bookacti-notices").show();console.log(e)}},error:function(e){alert("AJAX "+bookacti_localized.error);console.log(e)},complete:function(){bookacti_stop_template_loading();bookacti_remove_loading_html($j("#bookacti-group-of-events-dialog"))}})}}}]);$j("#bookacti-group-of-events-dialog").dialog("open")}
function bookacti_dialog_update_group_of_events(a){var c=$j.trim($j("#bookacti-group-of-events-dialog").dialog("option","title").replace(/\(.*?\)/,""));$j("#bookacti-group-of-events-dialog").dialog({title:c+" ("+bookacti_localized.edit_id+": "+a+")"});var b=(c=$j('.bookacti-group-of-events[data-group-id="'+a+'"]').closest(".bookacti-group-category").data("group-category-id"))?c:"new";$j("#bookacti-group-of-events-category-selectbox").val(c).trigger("change");var d=bookacti.booking_system["bookacti-template-calendar"].selected_events.slice();
bookacti_fill_selected_events_list();if("undefined"===typeof bookacti.booking_system["bookacti-template-calendar"].groups_data[a])$j('.bookacti-group-of-events[data-group-id="'+a+'"]').remove();else{c=bookacti.booking_system["bookacti-template-calendar"].groups_data[a];var e=[];"undefined"!==typeof bookacti.booking_system["bookacti-template-calendar"].groups_events[a]&&(e=$j.extend({},bookacti.booking_system["bookacti-template-calendar"].groups_events[a]));e=Object.keys(e);$j("#bookacti-group-of-events-title-field").val(c.multilingual_title);
$j("#bookacti-group-of-events-occurrences-prev, #bookacti-group-of-events-occurrences-next").toggle(1<e.length);$j("#bookacti-group-of-events-occurrences-navigation").show();e.length||bookacti_get_group_of_events_occurrences(a);bookacti_fill_repetition_fields(a,"group");c.settings&&bookacti_fill_fields_from_array(c.settings,"","#bookacti-group-of-events-dialog");$j("#bookacti-group-of-events-dialog").trigger("bookacti_group_of_events_update_dialog",[a]);bookacti_localized.is_qtranslate&&$j("#bookacti-group-of-events-dialog .qtranxs-translatable").each(function(){bookacti_refresh_qtx_field(this)});
bookacti_validate_group_of_events_form();c=[];c.push({text:bookacti_localized.dialog_button_ok,click:function(){$j("#bookacti-group-of-events-dialog .bookacti-notices").remove();$j("#bookacti-group-of-events-action").val("bookactiUpdateGroupOfEvents");bookacti.booking_system["bookacti-template-calendar"].selected_events=d.slice();bookacti_fill_selected_events_list();bookacti_refresh_selected_events_display();var f=$j("#bookacti-group-of-events-category-selectbox").val();bookacti.selected_category=
f;"undefined"!==typeof tinyMCE&&tinyMCE&&tinyMCE.triggerSave();if(bookacti_validate_group_of_events_form()){var g=bookacti_serialize_object($j("#bookacti-group-of-events-form"));g.action="bookactiUpdateGroupOfEvents";g.group_id=a;g.interval=JSON.stringify(bookacti.booking_system["bookacti-template-calendar"].events_interval);g.events=JSON.stringify(bookacti.booking_system["bookacti-template-calendar"].selected_events);$j("#bookacti-group-of-events-dialog").trigger("bookacti_update_group_of_events_before",
[g,a]);bookacti_start_template_loading();bookacti_add_loading_html($j("#bookacti-group-of-events-dialog"));$j.ajax({url:ajaxurl,data:g,type:"POST",dataType:"json",success:function(h){if("success"===h.status)bookacti.booking_system["bookacti-template-calendar"].groups_data[a]=h.group_data,bookacti.booking_system["bookacti-template-calendar"].groups_events[a]=h.group_events,bookacti.booking_system["bookacti-template-calendar"].group_categories_data[h.category_id]=h.category,bookacti.booking_system["bookacti-template-calendar"].selected_events=
[],"new"===f&&bookacti_add_group_category(h.category_id,h.category.title),b!=f?($j('.bookacti-group-of-events[data-group-id="'+a+'"]').remove(),bookacti_add_group_of_events(a,h.group_title_raw,h.category_id)):($j('.bookacti-group-of-events[data-group-id="'+a+'"] .bookacti-group-of-events-title').attr("title",h.group_title_raw),$j('.bookacti-group-of-events[data-group-id="'+a+'"] .bookacti-group-of-events-title').html(h.group_title_raw)),bookacti_unselect_all_events(),bookacti.fc_calendar["bookacti-template-calendar"].render(),
$j("#bookacti-group-of-events-dialog").trigger("bookacti_group_of_events_updated",[h,g,a]);else if("failed"===h.status){var l="undefined"!==typeof h.message?h.message:bookacti_localized.error;$j("#bookacti-group-of-events-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+l+"</li></ul></div>");$j("#bookacti-group-of-events-dialog .bookacti-notices").show();console.log(h)}"failed"!==h.status&&$j("#bookacti-group-of-events-dialog").dialog("close")},error:function(h){alert("AJAX "+
bookacti_localized.error);console.log(h)},complete:function(){bookacti_stop_template_loading();bookacti_remove_loading_html($j("#bookacti-group-of-events-dialog"))}})}}});c.push({text:bookacti_localized.dialog_button_delete,"class":"bookacti-dialog-delete-button bookacti-dialog-left-button",click:function(){$j("#bookacti-group-of-events-dialog .bookacti-notices").remove();bookacti.booking_system["bookacti-template-calendar"].selected_events=d.slice();bookacti_fill_selected_events_list();bookacti_refresh_selected_events_display();
bookacti.fc_calendar["bookacti-template-calendar"].gotoDate(d[0].start);var f={action:"bookactiBeforeDeleteGroupOfEvents",group_id:a,nonce:$j('#bookacti-delete-group-of-events-form input[name="nonce"]').val()};$j("#bookacti-group-of-events-dialog").trigger("bookacti_before_deactivate_group_of_events",[f,a]);bookacti_start_template_loading();bookacti_add_loading_html($j("#bookacti-group-of-events-dialog"));$j.ajax({url:ajaxurl,data:f,type:"POST",dataType:"json",success:function(g){if("success"===g.status)$j("#bookacti-group-of-events-dialog").dialog("close"),
bookacti_dialog_delete_group_of_events(a),$j("#bookacti-delete-booked-group-of-events-options").toggle(parseInt(g.has_bookings)?!0:!1),$j("#bookacti-delete-group-of-events-cancel_bookings").prop("checked",parseInt(g.has_bookings)?!0:!1).trigger("change"),$j("#bookacti-delete-group-of-events-cancel_bookings-container").append('<span class="bookacti-bookings-nb">'+g.booking_groups_nb+" ("+g.bookings_nb+")</span>"),$j("#bookacti-delete-group-of-events-send_notifications-container").append('<span class="bookacti-notifications-nb">'+
g.notifications_nb+"</span>");else if("failed"===g.status){var h="undefined"!==typeof g.message?g.message:bookacti_localized.error;$j("#bookacti-group-of-events-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+h+"</li></ul></div>");$j("#bookacti-group-of-events-dialog .bookacti-notices").show();console.log(g)}},error:function(g){alert("AJAX "+bookacti_localized.error);console.log(g)},complete:function(){bookacti_stop_template_loading();bookacti_remove_loading_html($j("#bookacti-group-of-events-dialog"))}})}});
"none"!==bookacti.booking_system["bookacti-template-calendar"].groups_data[a].repeat_freq&&c.push({text:bookacti_localized.dialog_button_unbind,"class":"bookacti-dialog-left-button",click:function(){$j(this).dialog("close");bookacti_dialog_unbind_group_of_events_occurrences(a)}});$j("#bookacti-group-of-events-dialog").dialog("option","buttons",c);$j("#bookacti-group-of-events-dialog").off("dialogbeforeclose").on("dialogbeforeclose",function(){$j('.bookacti-group-of-events[data-group-id="'+a+'"]').removeClass("bookacti-selected-group")});
$j("#bookacti-group-of-events-occurrences-undo").off("click").on("click",function(){bookacti.booking_system["bookacti-template-calendar"].selected_events=d.slice();bookacti_fill_selected_events_list();bookacti_refresh_selected_events_display();bookacti.fc_calendar["bookacti-template-calendar"].gotoDate(d[0].start)});$j("#bookacti-group-of-events-dialog").dialog("open")}}
function bookacti_get_group_of_events_occurrences(a){var c={action:"bookactiGetGroupOfEvents",group_id:a,nonce:$j('#bookacti-group-of-events-form input[name="nonce"]').val()};$j("#bookacti-group-of-events-dialog").trigger("bookacti_get_group_of_events_occurrences_before",[c,a]);$j("#bookacti-group-of-events-occurrences-navigation > .button").hide();bookacti_add_loading_html($j("#bookacti-group-of-events-occurrences-navigation"));$j.ajax({url:ajaxurl,data:c,type:"POST",dataType:"json",success:function(b){if("success"===
b.status){bookacti.booking_system["bookacti-template-calendar"].groups_data[a]=b.group_data;bookacti.booking_system["bookacti-template-calendar"].groups_events[a]=b.group_events;bookacti_fill_repetition_fields(a,"group");var d=Object.keys(b.group_events);$j("#bookacti-group-of-events-occurrences-prev, #bookacti-group-of-events-occurrences-next").toggle(1<d.length);$j("#bookacti-group-of-events-dialog").trigger("bookacti_group_of_events_occurrences_retrieved",[b,c,a])}else"failed"===b.status&&(d="undefined"!==
typeof b.message?b.message:bookacti_localized.error,$j("#bookacti-group-of-events-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+d+"</li></ul></div>"),$j("#bookacti-group-of-events-dialog .bookacti-notices").show(),console.log(b))},error:function(b){alert("AJAX "+bookacti_localized.error);console.log(b)},complete:function(){bookacti_remove_loading_html($j("#bookacti-group-of-events-occurrences-navigation"));$j("#bookacti-group-of-events-occurrences-navigation > .button").show()}})}
function bookacti_dialog_delete_group_of_events(a){$j("#bookacti-delete-group-of-events-cancel_bookings-container .bookacti-bookings-nb").remove();$j("#bookacti-delete-group-of-events-send_notifications-container .bookacti-notifications-nb").remove();$j("#bookacti-delete-booked-group-of-events-options").show();$j("#bookacti-delete-group-of-events-cancel_bookings").prop("checked",!0).trigger("change");$j("#bookacti-delete-group-of-events-send_notifications").prop("checked",!1).trigger("change");$j("#bookacti-delete-group-of-events-dialog").trigger("bookacti_delete_group_of_events_dialog",
[a]);$j("#bookacti-delete-group-of-events-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_delete,"class":"bookacti-dialog-delete-button",click:function(){$j("#bookacti-delete-group-of-events-dialog .bookacti-notices").remove();var c=bookacti_serialize_object($j("#bookacti-delete-group-of-events-form"));c.cancel_bookings=$j("#bookacti-delete-group-of-events-cancel_bookings").is(":checked")?1:0;c.group_id=a;$j("#bookacti-delete-group-of-events-dialog").trigger("bookacti_deactivate_group_of_events_before",
[c,a]);bookacti_start_template_loading();bookacti_add_loading_html($j("#bookacti-delete-group-of-events-dialog"));$j.ajax({url:ajaxurl,data:c,type:"POST",dataType:"json",success:function(b){if("success"===b.status)delete bookacti.booking_system["bookacti-template-calendar"].groups_data[a],delete bookacti.booking_system["bookacti-template-calendar"].groups_events[a],bookacti.booking_system["bookacti-template-calendar"].selected_events=[],$j('.bookacti-group-of-events[data-group-id="'+a+'"]').remove(),
c.cancel_bookings&&"undefined"!==typeof b.bookings&&(bookacti.booking_system["bookacti-template-calendar"].bookings=b.bookings),bookacti.fc_calendar["bookacti-template-calendar"].render(),$j("#bookacti-insert-group-of-events").css("visibility","hidden"),$j("#bookacti-delete-group-of-events-dialog").trigger("bookacti_group_of_events_deactivated",[b,c,a]),$j("#bookacti-delete-group-of-events-dialog").dialog("close");else{var d="undefined"!==typeof b.message?b.message:bookacti_localized.error;$j("#bookacti-delete-group-of-events-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+
d+"</li></ul></div>");$j("#bookacti-delete-group-of-events-dialog .bookacti-notices").show();console.log(b)}},error:function(b){alert("AJAX "+bookacti_localized.error);console.log(b)},complete:function(){bookacti_stop_template_loading();bookacti_remove_loading_html($j("#bookacti-delete-group-of-events-dialog"))}})}},{text:bookacti_localized.dialog_button_cancel,click:function(){$j(this).dialog("close")}}]);$j("#bookacti-delete-group-of-events-dialog").dialog("open")}
function bookacti_dialog_unbind_group_of_events_occurrences(a){bookacti_fill_selected_events_list();var c="";$j.each(bookacti.booking_system["bookacti-template-calendar"].selected_events,function(d,e){c=moment.utc(e.start).format("YYYY-MM-DD");return!1});$j('input[type="radio"][name="unbind_action"][value="selected"]').prop("checked",!0).trigger("change");var b=[{text:bookacti_localized.dialog_button_unbind,"class":"bookacti-dialog-delete-button",click:function(){$j("#bookacti-unbind-group-of-events-dialog .bookacti-notices").remove();
$j("#bookacti-unbind-group-of-events-dialog .bookacti-form-error").remove();$j("#bookacti-unbind-group-of-events-dialog .bookacti-input-warning").removeClass("bookacti-input-warning");var d=bookacti_serialize_object($j("#bookacti-unbind-group-of-events-form")),e=$j.extend({group_id:a,group_date:c},d);$j("#bookacti-template-container").trigger("bookacti_unbind_group_of_events_occurrences_before",[e,a,c]);bookacti_start_template_loading();bookacti_add_loading_html($j("#bookacti-unbind-group-of-events-dialog"));
$j.ajax({url:ajaxurl,data:e,type:"POST",dataType:"json",success:function(f){if("success"===f.status){bookacti_unselect_all_events();bookacti.booking_system["bookacti-template-calendar"].groups_data=f.groups_data;bookacti.booking_system["bookacti-template-calendar"].groups_events=[];bookacti.booking_system["bookacti-template-calendar"].bookings=f.bookings;var g=$j('.bookacti-group-of-events[data-group-id="'+a+'"]').closest(".bookacti-group-category");g.length?g.replaceWith(f.groups_list):$j(".bookacti-group-categories").append(f.groups_list);
$j("#bookacti-template-groups-of-events-container .dashicons").toggleClass("bookacti-disabled",0<bookacti.booking_system["bookacti-template-calendar"].loading_number);bookacti_make_group_categories_sortable();bookacti_make_groups_of_events_sortable();$j("#bookacti-template-container").trigger("bookacti_group_of_events_occurrences_unbound",[f,e,a,c]);$j("#bookacti-unbind-group-of-events-dialog").dialog("close")}else g="undefined"!==typeof f.message?f.message:bookacti_localized.error,$j("#bookacti-unbind-group-of-events-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+
g+"</li></ul></div>"),$j("#bookacti-unbind-group-of-events-dialog .bookacti-notices").show(),console.log(f)},error:function(f){alert("AJAX "+bookacti_localized.error);console.log(f)},complete:function(){bookacti_stop_template_loading();bookacti_remove_loading_html($j("#bookacti-unbind-group-of-events-dialog"))}})}},{text:bookacti_localized.dialog_button_cancel,click:function(){$j(this).dialog("close")}}];$j("#bookacti-unbind-group-of-events-dialog").dialog("option","buttons",b);$j("#bookacti-unbind-group-of-events-dialog").dialog("open")}
function bookacti_dialog_update_group_category(a){var c=$j.trim($j("#bookacti-group-category-dialog").dialog("option","title").replace(/\(.*?\)/,""));$j("#bookacti-group-category-dialog").dialog({title:c+" ("+bookacti_localized.edit_id+": "+a+")"});c=bookacti.booking_system["bookacti-template-calendar"].group_categories_data[a];$j("#bookacti-group-category-template-id").val(bookacti.selected_template);$j("#bookacti-group-category-category-id").val(a);$j("#bookacti-group-category-title-field").val(c.multilingual_title);
c.settings&&bookacti_fill_fields_from_array(c.settings,"","#bookacti-group-category-dialog");$j("#bookacti-group-category-dialog").trigger("bookacti_group_category_update_dialog",[a]);bookacti_localized.is_qtranslate&&$j("#bookacti-group-category-dialog .qtranxs-translatable").each(function(){bookacti_refresh_qtx_field(this)});$j("#bookacti-group-category-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_ok,click:function(){$j("#bookacti-group-category-dialog .bookacti-notices").remove();
$j("#bookacti-group-category-action").val("bookactiUpdateGroupCategory");"undefined"!==typeof tinyMCE&&tinyMCE&&tinyMCE.triggerSave();if(bookacti_validate_group_category_form()){var b=bookacti_serialize_object($j("#bookacti-group-category-form"));$j("#bookacti-group-category-dialog").trigger("bookacti_update_group_category_before",[b,a]);bookacti_start_template_loading();bookacti_add_loading_html($j("#bookacti-group-category-dialog"));$j.ajax({url:ajaxurl,data:b,type:"POST",dataType:"json",success:function(d){if("success"===
d.status){bookacti.booking_system["bookacti-template-calendar"].group_categories_data[a]=d.category;var e=16<d.category.title.length?d.category.title.substr(0,16)+"&#8230;":d.category.title;$j('.bookacti-group-category[data-group-category-id="'+a+'"] .bookacti-group-category-title').attr("title",d.category.title);$j('.bookacti-group-category[data-group-category-id="'+a+'"] .bookacti-group-category-title span').html(e);$j('#bookacti-group-of-events-category-selectbox option[value="'+a+'"]').html(d.category.title);
$j("#bookacti-group-category-dialog").trigger("bookacti_group_category_updated",[d,b,a]);$j("#bookacti-group-category-dialog").dialog("close")}else"failed"===d.status&&(e="undefined"!==typeof d.message?d.message:bookacti_localized.error,$j("#bookacti-group-category-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+e+"</li></ul></div>"),$j("#bookacti-group-category-dialog .bookacti-notices").show(),console.log(d))},error:function(d){alert("AJAX "+bookacti_localized.error);
console.log(d)},complete:function(){bookacti_stop_template_loading();bookacti_remove_loading_html($j("#bookacti-group-category-dialog"))}})}}},{text:bookacti_localized.dialog_button_delete,"class":"bookacti-dialog-delete-button bookacti-dialog-left-button",click:function(){bookacti_dialog_delete_group_category(a)}}]);$j("#bookacti-group-category-dialog").dialog("open")}
function bookacti_dialog_delete_group_category(a){$j("#bookacti-delete-group-category-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_delete,"class":"bookacti-dialog-delete-button",click:function(){$j("#bookacti-delete-group-category-dialog .bookacti-notices").remove();var c={action:"bookactiDeleteGroupCategory",category_id:a,nonce:$j('#bookacti-delete-group-category-dialog input[name="nonce"]').val()};$j("#bookacti-delete-group-category-dialog").trigger("bookacti_deactivate_group_category_before",
[c,a]);bookacti_start_template_loading();bookacti_add_loading_html($j("#bookacti-delete-group-category-dialog"));$j.ajax({url:ajaxurl,data:c,type:"POST",dataType:"json",success:function(b){if("success"===b.status)delete bookacti.booking_system["bookacti-template-calendar"].group_categories_data[a],bookacti.booking_system["bookacti-template-calendar"].selected_events=[],$j.each(bookacti.booking_system["bookacti-template-calendar"].groups_data,function(e,f){if("undefined"===typeof f)return!0;f.category_id==
a&&(delete bookacti.booking_system["bookacti-template-calendar"].groups_events[f.id],delete bookacti.booking_system["bookacti-template-calendar"].groups_data[f.id])}),$j('.bookacti-group-category[data-group-category-id="'+a+'"]').remove(),$j('#bookacti-group-of-events-category-selectbox option[value="'+a+'"]').remove(),bookacti.fc_calendar["bookacti-template-calendar"].render(),$j("#bookacti-insert-group-of-events").css("visibility","hidden"),$j(".bookacti-group-category").length||$j("#bookacti-template-add-group-of-events-tuto-select-events").show(),
$j("#bookacti-delete-group-category-dialog").trigger("bookacti_group_category_deactivated",[b,c,a]),$j("#bookacti-delete-group-category-dialog").dialog("close"),$j("#bookacti-group-category-dialog").dialog("close");else{var d="undefined"!==typeof b.message?b.message:bookacti_localized.error;$j("#bookacti-delete-group-category-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+d+"</li></ul></div>");$j("#bookacti-delete-group-category-dialog .bookacti-notices").show();
console.log(b)}},error:function(b){alert("AJAX "+bookacti_localized.error);console.log(b)},complete:function(){bookacti_stop_template_loading();bookacti_remove_loading_html($j("#bookacti-delete-group-category-dialog"))}})}},{text:bookacti_localized.dialog_button_cancel,click:function(){$j("#bookacti-delete-group-category-dialog").dialog("close")}}]);$j("#bookacti-delete-group-category-dialog").dialog("open")};
