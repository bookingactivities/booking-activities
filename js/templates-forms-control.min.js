$j(document).ready(function(){$j("#bookacti-template-data-dialog :input").on("keyup mouseup change",function(){bookacti_validate_template_form()});$j("#bookacti-activity-data-dialog :input").on("keyup mouseup change",function(){bookacti_validate_activity_form()});$j('select[name="repeat_freq"], input[name="repeat_from"], input[name="repeat_to"]').on("keyup mouseup change",function(){var a=$j(this).closest("#bookacti-group-of-events-dialog").length?"group":"event";bookacti_validate_event_repetition_data(a)});$j(".bookacti-days-off-container").on("click",".bookacti-add-days-off",function(){console.log($j(this).closest(".bookacti-days-off-container").find(".bookacti-days-off-table-container").length);bookacti_add_days_off_row($j(this).closest(".bookacti-days-off-container").find(".bookacti-days-off-table-container"))});$j(".bookacti-days-off-container").on("click",".bookacti-delete-days-off",function(){bookacti_delete_days_off_row($j(this).closest(".bookacti-days-off-container").find(".bookacti-days-off-table-container"),$j(this).closest("tr"))});$j("#bookacti-template-data-dialog").on("bookacti_default_template_settings",function(){bookacti_delete_days_off_rows($j("#bookacti-template-data-dialog .bookacti-days-off-table-container"));var a=bookacti.booking_system["bookacti-template-calendar"]["template_data"];if(!$j.isEmptyObject(a.settings)){if(!$j.isEmptyObject(a.settings.days_off)){bookacti_fill_days_off($j("#bookacti-template-data-dialog .bookacti-days-off-table-container"),a.settings.days_off)}}});$j("body").on("bookacti_empty_all_dialogs_forms",function(b,a){bookacti_delete_days_off_rows($j(a+" .bookacti-days-off-table-container"))})});function bookacti_validate_template_form(){var d=$j("#bookacti-template-title").val();var c=$j("#bookacti-template-duplicated-template-id").val();var b=$j("#bookacti-snapduration").val();var a={isTitle:false,isSnapFreqFormatted:false,isDuplicateIdPositive:false,send:false};if(d!==""){a.isTitle=true}if(c!==""&&$j.isNumeric(c)&&parseInt(c)>=0){a.isDuplicateIdPositive=true}if(/^([0-1][0-9]|2[0-3]):([0-5][0-9])$/.test(b)){a.isSnapFreqFormatted=true}if(a.isTitle&&a.isDuplicateIdPositive&&a.isSnapFreqFormatted){a.send=true}$j("#bookacti-template-data-dialog .bookacti-form-error, #bookacti-template-data-dialog .bookacti-notices").remove();$j("#bookacti-template-data-dialog input, #bookacti-template-data-dialog select").removeClass("bookacti-input-error");if(!a.send){$j("#bookacti-template-data-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+bookacti_localized.error_on_a_form_field+"</li></ul></div>");$j("#bookacti-template-data-dialog .bookacti-notices").show()}$j("#bookacti-template-data-dialog").trigger("bookacti_validate_template_form",[a]);if(!a.isTitle){$j("#bookacti-template-title").addClass("bookacti-input-error");$j("#bookacti-template-title").parent().append("<div class='bookacti-form-error'>"+bookacti_localized.error_fill_field+"</div>")}if(!a.isDuplicateIdPositive){$j("#bookacti-template-duplicated-template-id").addClass("bookacti-input-error");$j("#bookacti-template-duplicated-template-id").parent().append("<div class='bookacti-form-error'>"+bookacti_localized.error_invalid_value+"</div>")}if(!a.isSnapFreqFormatted){$j("#bookacti-snapduration").addClass("bookacti-input-error");$j("#bookacti-snapduration").parent().append("<div class='bookacti-form-error'>"+bookacti_localized.error_time_format+"</div>")}return a.send}function bookacti_validate_activity_form(){var f=$j("#bookacti-activity-title").val();var b=$j("#bookacti-activity-color").val();var e=$j("#bookacti-activity-availability").val();var g=$j("#bookacti-activity-duration-days").val();var a=$j("#bookacti-activity-duration-hours").val();var d=$j("#bookacti-activity-duration-minutes").val();var c={isTitle:false,isColor:false,isColorWhite:false,isAvail:false,isAvailPositive:false,isDays:false,isHours:false,isMinutes:false,isDaysInfTo365:false,isHoursInfTo23:false,isMinutesInfTo59:false,isSupToZero:false,send:false};if(f.length){c.isTitle=true}if(b.length){c.isColor=true}if(c.isColor&&b==="#ffffff"){c.isColorWhite=true}if(e.length){c.isAvail=true}if(c.isAvail&&parseInt(e)>=0){c.isAvailPositive=true}if(g.length){c.isDays=true}if(a.length){c.isHours=true}if(d.length){c.isMinutes=true}if(c.isDays&&g<=365&&g>=0){c.isDaysInfTo365=true}if(c.isHours&&a<=23&&a>=0){c.isHoursInfTo23=true}if(c.isMinutes&&d<=59&&d>=0){c.isMinutesInfTo59=true}if(g>0||a>0||d>0){c.isSupToZero=true}if(c.isTitle&&c.isColor&&c.isAvailPositive&&c.isDaysInfTo365&&c.isHoursInfTo23&&c.isMinutesInfTo59&&c.isSupToZero){c.send=true}$j("#bookacti-activity-data-dialog .bookacti-form-error, #bookacti-activity-data-dialog .bookacti-notices").remove();$j("#bookacti-activity-data-dialog *").removeClass("bookacti-input-error bookacti-input-warning");if(!c.send){$j("#bookacti-activity-data-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+bookacti_localized.error_on_a_form_field+"</li></ul></div>");$j("#bookacti-activity-data-dialog .bookacti-notices").show()}$j("#bookacti-activity-data-dialog").trigger("bookacti_validate_activity_form",[c]);if(!c.isTitle){$j("#bookacti-activity-title").addClass("bookacti-input-error");$j("#bookacti-activity-title").parent().append("<div class='bookacti-form-error'>"+bookacti_localized.error_fill_field+"</div>")}if(!c.isColor){$j("#bookacti-activity-color").addClass("bookacti-input-error");$j("#bookacti-activity-color").parent().append("<div class='bookacti-form-error'>"+bookacti_localized.error_fill_field+"</div>")}if(!c.isAvail||!c.isAvailPositive){$j("#bookacti-activity-availability").addClass("bookacti-input-error");$j("#bookacti-activity-availability").parent().append("<div class='bookacti-form-error'>"+bookacti_localized.error_fill_field+"</div>")}if(c.isDays&&!c.isDaysInfTo365){$j("#bookacti-activity-duration-days").addClass("bookacti-input-error");$j("#bookacti-activity-duration-container").append("<div class='bookacti-form-error'>"+bookacti_localized.error_days_sup_to_365+"</div>")}if(c.isHours&&!c.isHoursInfTo23){$j("#bookacti-activity-duration-hours").addClass("bookacti-input-error");$j("#bookacti-activity-duration-container").append("<div class='bookacti-form-error'>"+bookacti_localized.error_hours_sup_to_23+"</div>")}if(c.isMinutes&&!c.isMinutesInfTo59){$j("#bookacti-activity-duration-minutes").addClass("bookacti-input-error");$j("#bookacti-activity-duration-container").append("<div class='bookacti-form-error'>"+bookacti_localized.error_minutes_sup_to_59+"</div>")}if(!c.isSupToZero){$j("#bookacti-activity-duration-days, #bookacti-activity-duration-hours, #bookacti-activity-duration-minutes").addClass("bookacti-input-error");$j("#bookacti-activity-duration-container").append("<div class='bookacti-form-error'>"+bookacti_localized.error_activity_duration_is_null+"</div>")}if(c.isColorWhite){$j("#bookacti-activity-color").addClass("bookacti-input-warning")}if(!c.isDays){$j("#bookacti-activity-duration-days").addClass("bookacti-input-warning");$j("#bookacti-activity-duration-days").val(0)}if(!c.isHours){$j("#bookacti-activity-duration-hours").addClass("bookacti-input-warning");$j("#bookacti-activity-duration-hours").val(0)}if(!c.isMinutes){$j("#bookacti-activity-duration-minutes").addClass("bookacti-input-warning");$j("#bookacti-activity-duration-minutes").val(0)}return c.send}function bookacti_validate_event_form(){$j("#bookacti-event-data-dialog .bookacti-notices").remove();var a={isGeneralValid:bookacti_validate_event_general_data(),isRepetitionValid:bookacti_validate_event_repetition_data("event"),send:false};if(a.isRepetitionValid&&a.isGeneralValid){a.send=true}$j("#bookacti-event-data-dialog").trigger("bookacti_validate_event_form",[a]);return a.send}function bookacti_validate_event_general_data(){var c=$j("#bookacti-event-data-dialog #bookacti-event-title").val();var b=parseInt($j("#bookacti-event-data-dialog #bookacti-event-availability").val());var a={isTitle:false,isAvailPositive:false,send:false};if(c!==""){a.isTitle=true}if(b>=0){a.isAvailPositive=true}if(a.isTitle&&a.isAvailPositive){a.send=true}$j("#bookacti-event-title-container .bookacti-form-error, #bookacti-event-availability-container .bookacti-form-error, #bookacti-event-data-dialog .bookacti-form-field-error").remove();$j("#bookacti-event-title, #bookacti-event-availability").removeClass("bookacti-input-error");if(!a.send){if(!$j("#bookacti-event-data-dialog .bookacti-error-list").length){$j("#bookacti-event-data-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"></ul></div>')}$j("#bookacti-event-data-dialog .bookacti-error-list").append('<li class="bookacti-form-field-error">'+bookacti_localized.error_on_a_form_field+"</li>");$j("#bookacti-event-data-dialog .bookacti-notices").show()}$j("#bookacti-event-data-dialog").trigger("bookacti_validate_event_general_data",[a]);if(!a.isTitle){$j("#bookacti-event-title").addClass("bookacti-input-error");$j("#bookacti-event-title-container").append("<div class='bookacti-form-error'>"+bookacti_localized.error_fill_field+"</div>")}if(!a.isAvailPositive){$j("#bookacti-event-availability").addClass("bookacti-input-error");$j("#bookacti-event-availability-container").append("<div class='bookacti-form-error'>"+bookacti_localized.error_fill_field+"</div>")}return a.send}function bookacti_validate_event_repetition_data(h){if(h!=="group"&&h!=="event"){return}if(h==="group"&&typeof bookacti.booking_system["bookacti-template-calendar"]["selected_events"][0]==="undefined"){return}else{if(h==="event"&&typeof bookacti.booking_system["bookacti-template-calendar"]["picked_events"][0]==="undefined"){return}}var a=h==="group"?bookacti.booking_system["bookacti-template-calendar"]["selected_events"][0]:bookacti.booking_system["bookacti-template-calendar"]["picked_events"][0];var b=moment.utc(a.start).clone().locale("en");var j=h==="group"?"#bookacti-group-of-events-dialog":"#bookacti-event-data-dialog";var k=$j(j+' select[name="repeat_freq"]').val()?$j(j+' select[name="repeat_freq"]').val():"none";var g=moment.utc($j(j+' input[name="repeat_from"]').val()).locale("en");var f=moment.utc($j(j+' input[name="repeat_to"]').val()).locale("en");var e={isRepeated:false,isRepeatFrom:false,isRepeatTo:false,isFromBeforeTo:false,isEventBetweenFromAndTo:false,areExcep:false,areExcepBetweenFromAndTo:true,send:false};if(k!=="none"){e.isRepeated=true}if(!isNaN(g)&&g!==""&&g!==null){e.isRepeatFrom=true}if(!isNaN(f)&&f!==""&&f!==null){e.isRepeatTo=true}if(e.isRepeatFrom&&e.isRepeatTo&&g<f){e.isFromBeforeTo=true}if(e.isRepeated&&g.isSameOrBefore(b,"day")&&f.isSameOrAfter(b,"day")){e.isEventBetweenFromAndTo=true}if($j(j+" .exception").length){e.areExcep=true}if(!e.isRepeated||(e.isRepeated&&e.isRepeatFrom&&e.isRepeatTo&&e.isFromBeforeTo&&e.isEventBetweenFromAndTo)){e.send=true}if(!e.isRepeated){$j(j+' input[name="repeat_from"]').prop("disabled",true);$j(j+' input[name="repeat_to"]').prop("disabled",true)}$j(j+" input.bookacti-exception-date-picker").prop("disabled",true);$j(j+" input.bookacti-add-exception-button").prop("disabled",true);$j(j+" select.bookacti-exceptions-selectbox").prop("disabled",true);$j(j+' div[id$="-repeat-days-container"]').hide();$j(j+' div[id$="-repeat-monthly_type-container"]').hide();$j(j+' div[id$="-repeat-from-container"]').hide();$j(j+' div[id$="-repeat-to-container"]').hide();$j(j+" .bookacti-exceptions-container").hide();$j("#bookacti-group-of-events-repetition-first-event-notice").hide();var d=false;var i=moment.utc(g).add(1,"d");var c=moment.utc(f).subtract(1,"d");if(i.isAfter(c)){d=true}if(!d){if(e.isRepeatFrom){$j(j+" input.bookacti-exception-date-picker").attr("min",i.format("YYYY-MM-DD"))}if(e.isRepeatTo){$j(j+" input.bookacti-exception-date-picker").attr("max",c.format("YYYY-MM-DD"))}}$j(j+" .exception").removeClass("bookacti-error-exception bookacti-out-of-period-exception");$j(j+" .exception").each(function(){var l=moment.utc($j(this).val());if(e.isFromBeforeTo&&(l<g||l>f)){e.areExcepBetweenFromAndTo=false;$j(this).addClass("bookacti-error-exception bookacti-out-of-period-exception")}});$j(j+" .bookacti-input-error, "+j+" .bookacti-input-warning").removeClass("bookacti-input-error bookacti-input-warning");$j(j+" .bookacti-repeat-error").remove();if(!e.send&&!$j(j+" .bookacti-error-list").length){$j(j).append('<div class="bookacti-notices"><ul class="bookacti-error-list"></ul></div>')}$j(j).trigger("bookacti_validate_event_repetition_data",[e]);if(e.isRepeated){$j(j+' input[name="repeat_from"]').prop("disabled",false);$j(j+' input[name="repeat_to"]').prop("disabled",false);$j(j+' div[id$="-repeat-from-container"]').show();$j(j+' div[id$="-repeat-to-container"]').show();$j("#bookacti-group-of-events-repetition-first-event-notice").show();if(k==="weekly"){$j(j+' div[id$="-repeat-days-container"]').show()}else{if(k==="monthly"){$j(j+' div[id$="-repeat-monthly_type-container"]').show()}}if(e.isFromBeforeTo&&e.isEventBetweenFromAndTo){$j(j+" input.bookacti-exception-date-picker").prop("disabled",d);$j(j+" input.bookacti-add-exception-button").prop("disabled",false);$j(j+" select.bookacti-exceptions-selectbox").prop("disabled",false);$j(j+" .bookacti-exceptions-container").show()}else{$j(j+' input[name="repeat_from"], '+j+' input[name="repeat_to"]').addClass("bookacti-input-error");if(!e.isFromBeforeTo){$j(j+" .bookacti-error-list").append('<li class="bookacti-repeat-error">'+bookacti_localized.error_repeat_end_before_begin+"</li>")}else{if(!e.isEventBetweenFromAndTo){$j(j+" .bookacti-error-list").append('<li class="bookacti-repeat-error">'+bookacti_localized.error_event_not_btw_from_and_to+"</li>")}}}}if(e.areExcep&&!e.areExcepBetweenFromAndTo){$j(j+" select.bookacti-exceptions-selectbox").addClass("bookacti-input-warning");$j(j+" .bookacti-error-list").append('<li class="bookacti-repeat-error">'+bookacti_localized.error_excep_not_btw_from_and_to+"</li>")}$j(j+" .bookacti-notices").toggle($j(j+" .bookacti-notices li").length>0);return e.send}function bookacti_validate_group_of_events_form(){$j("#bookacti-group-of-events-dialog .bookacti-notices").remove();var a={isGeneralValid:bookacti_validate_group_of_events_general_data(),isRepetitionValid:bookacti_validate_event_repetition_data("group"),send:false};if(a.isRepetitionValid&&a.isGeneralValid){a.send=true}$j("#bookacti-group-of-events-dialog").trigger("bookacti_validate_group_of_events_form",[a]);return a.send}function bookacti_validate_group_of_events_general_data(){var d=$j("#bookacti-group-of-events-title-field").val();var b=$j("#bookacti-group-of-events-category-selectbox").val();var c=$j("#bookacti-group-of-events-category-title-field").val();var a={isTitle:false,isCategory:false,isCategoryTitle:false,isSelectedEvents:false,send:false};if(typeof d==="string"&&d!==""){a.isTitle=true}if(typeof b==="string"&&b!=="new"){a.isCategory=true}if(typeof c==="string"&&c!==""){a.isCategoryTitle=true}if(bookacti.booking_system["bookacti-template-calendar"]["selected_events"].length>=2){a.isSelectedEvents=true}if(a.isTitle&&(a.isCategory||a.isCategoryTitle)&&a.isSelectedEvents){a.send=true}$j("#bookacti-group-of-events-dialog .bookacti-form-error, #bookacti-group-of-events-dialog .bookacti-form-field-error").remove();$j("#bookacti-group-of-events-dialog input, #bookacti-group-of-events-dialog select").removeClass("bookacti-input-error");if(!a.send){if(!$j("#bookacti-group-of-events-dialog .bookacti-error-list").length){$j("#bookacti-group-of-events-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"></ul></div>')}$j("#bookacti-group-of-events-dialog .bookacti-error-list").append('<li class="bookacti-form-field-error">'+bookacti_localized.error_on_a_form_field+"</li>");$j("#bookacti-group-of-events-dialog .bookacti-notices").show()}$j("#bookacti-group-of-events-dialog").trigger("bookacti_validate_group_of_events_general_data",[a]);if(!a.isTitle){$j("#bookacti-group-of-events-title-field").addClass("bookacti-input-error");$j("#bookacti-group-of-events-title-field").parent().append("<div class='bookacti-form-error'>"+bookacti_localized.error_fill_field+"</div>")}if(!a.isCategory&&!a.isCategoryTitle){$j("#bookacti-group-of-events-category-title-field").addClass("bookacti-input-error");$j("#bookacti-group-of-events-category-title-field").parent().append("<div class='bookacti-form-error'>"+bookacti_localized.error_fill_field+"</div>")}if(!a.isSelectedEvents){$j("#bookacti-group-of-events-summary").addClass("bookacti-input-error");$j("#bookacti-group-of-events-summary").parent().append("<div class='bookacti-form-error'>"+bookacti_localized.error_select_at_least_two_events+"</div>")}return a.send}function bookacti_validate_group_category_form(){var b=$j("#bookacti-group-category-title-field").val();var a={isTitle:false,send:false};if(typeof b==="string"&&b!==""){a.isTitle=true}if(a.isTitle){a.send=true}$j("#bookacti-group-category-dialog .bookacti-form-error, #bookacti-group-category-dialog .bookacti-notices").remove();$j("#bookacti-group-category-dialog input, #bookacti-template-data-dialog select").removeClass("bookacti-input-error");if(!a.send){$j("#bookacti-group-category-dialog").append('<div class="bookacti-notices"><ul><li>'+bookacti_localized.error_on_a_form_field+"</li></ul></div>");$j("#bookacti-group-category-dialog .bookacti-notices").show()}$j("#bookacti-group-category-dialog").trigger("bookacti_validate_group_category_form",[a]);if(!a.isTitle){$j("#bookacti-group-category-title-field").addClass("bookacti-input-error");$j("#bookacti-group-category-title-field").parent().append("<div class='bookacti-form-error'>"+bookacti_localized.error_fill_field+"</div>")}return a.send}function bookacti_fill_days_off(b,a){if(typeof a==="undefined"){return}if(!$j.isArray(a)&&!$j.isPlainObject(a)){return}if(a.length<=0){return}bookacti_delete_days_off_rows(b);var c=b.find("tbody");var d=0;$j.each(a,function(e,f){if(d>0){bookacti_add_days_off_row(b)}c.find("tr:last .bookacti-days-off-from").val(f.from);c.find("tr:last .bookacti-days-off-to").val(f.to);++d})}function bookacti_add_days_off_row(a){var c=a.find("tbody");var b=a.data("name")+"["+c.find("tr").length+"]";c.find("tr:first").clone().appendTo(c);c.find("tr:last .bookacti-days-off-from").attr("name",b+"[from]").val("");c.find("tr:last .bookacti-days-off-to").attr("name",b+"[to]").val("")}function bookacti_delete_days_off_row(a,e){e=e||null;var c=a.find("tbody");if(c.find("tr").length<=1){c.find("tr:first .bookacti-days-off-from, tr:first .bookacti-days-off-to").val("")}else{if(e!=null){e.remove();var d=0;var b=a.data("name");c.find("tr").each(function(){var f=b+"["+d+"]";$j(this).find(".bookacti-days-off-from").attr("name",f+"[from]");$j(this).find(".bookacti-days-off-to").attr("name",f+"[to]");++d})}}}function bookacti_delete_days_off_rows(a){var b=a.find("tbody");b.find("tr:not(:first)").remove();bookacti_delete_days_off_row(a,b.find("tr:first"))};