$j(document).ready(function(){$j("#bookacti-template-data-dialog :input").on("keyup mouseup change",function(){bookacti_validate_template_form()});$j("#bookacti-activity-data-dialog :input").on("keyup mouseup change",function(){bookacti_validate_activity_form()});$j("#bookacti-event-data-dialog, #bookacti-group-of-events-dialog").on("keyup mouseup change",'select[name="repeat_freq"], input[name="repeat_from"], input[name="repeat_to"]',function(){var a=$j(this).closest("#bookacti-group-of-events-dialog").length?
"group":"event";bookacti_validate_event_repetition_data(a)});$j("#bookacti-template-data-dialog").on("bookacti_default_template_settings",function(){bookacti_delete_days_off_rows($j("#bookacti-template-data-dialog .bookacti-date-intervals-table-container"));$j("#bookacti-template-data-dialog input.bookacti-days-off-from, #bookacti-template-data-dialog input.bookacti-days-off-to").attr("min","").attr("max","");var a=bookacti.booking_system["bookacti-template-calendar"].template_data;"undefined"!==
typeof a.settings&&"undefined"!==typeof a.settings.days_off&&($j.isEmptyObject(a.settings.days_off)||bookacti_fill_days_off($j("#bookacti-template-data-dialog .bookacti-date-intervals-table-container"),a.settings.days_off))});$j("#bookacti-activity-data-dialog").on("change","#bookacti-display-activity-user-roles",function(){$j("#bookacti-activity-roles, #bookacti-activity-roles + .select2-container, #bookacti-activity-data-dialog .bookacti-roles-notice").toggle($j(this).prop("checked"))});$j("#bookacti-group-category-dialog").on("change",
"#bookacti-display-group-category-user-roles",function(){$j("#bookacti-group-category-roles, #bookacti-group-category-roles + .select2-container, #bookacti-group-category-dialog .bookacti-roles-notice").toggle($j(this).prop("checked"))});$j("#bookacti-activity-data-dialog").on("bookacti_activity_insert_dialog bookacti_activity_update_dialog",function(){$j("#bookacti-display-activity-user-roles").prop("checked",$j("#bookacti-activity-roles option:selected").length).trigger("change")});$j("#bookacti-group-category-dialog").on("bookacti_group_category_update_dialog",
function(){$j("#bookacti-display-group-category-user-roles").prop("checked",$j("#bookacti-group-category-roles option:selected").length).trigger("change")});$j("body").on("bookacti_empty_all_dialogs_forms",function(a,e){$j(e+" #bookacti-display-activity-user-roles, "+e+" #bookacti-display-group-category-user-roles").prop("checked",!1).trigger("change")})});
function bookacti_validate_template_form(){var a=$j("#bookacti-template-title").val(),e=$j("#bookacti-template-duplicated-template-id").val(),f=$j("#bookacti-snapduration").val(),b={isTitle:!1,isSnapFreqFormatted:!1,isDuplicateIdPositive:!0,send:!1};""!==a&&(b.isTitle=!0);$j.isNumeric(e)&&0>parseInt(e)&&(b.isDuplicateIdPositive=!1);/^([0-1][0-9]|2[0-3]):([0-5][0-9])$/.test(f)&&(b.isSnapFreqFormatted=!0);b.isTitle&&b.isDuplicateIdPositive&&b.isSnapFreqFormatted&&(b.send=!0);$j("#bookacti-template-data-dialog .bookacti-form-error, #bookacti-template-data-dialog .bookacti-notices").remove();
$j("#bookacti-template-data-dialog input, #bookacti-template-data-dialog select").removeClass("bookacti-input-error");b.send||($j("#bookacti-template-data-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+bookacti_localized.error_on_a_form_field+"</li></ul></div>"),$j("#bookacti-template-data-dialog .bookacti-notices").show());$j("#bookacti-template-data-dialog").trigger("bookacti_validate_template_form",[b]);b.isTitle||($j("#bookacti-template-title").addClass("bookacti-input-error"),
$j("#bookacti-template-title").parent().append("<div class='bookacti-form-error'>"+bookacti_localized.error_fill_field+"</div>"));b.isDuplicateIdPositive||($j("#bookacti-template-duplicated-template-id").addClass("bookacti-input-error"),$j("#bookacti-template-duplicated-template-id").parent().append("<div class='bookacti-form-error'>"+bookacti_localized.error_invalid_value+"</div>"));b.isSnapFreqFormatted||($j("#bookacti-snapduration").addClass("bookacti-input-error"),$j("#bookacti-snapduration").parent().append("<div class='bookacti-form-error'>"+
bookacti_localized.error_time_format+"</div>"));return b.send}
function bookacti_validate_activity_form(){var a=$j("#bookacti-activity-title").val(),e=$j("#bookacti-activity-color").val(),f=$j("#bookacti-activity-availability").val(),b=$j("#bookacti-activity-duration-days").val(),g=$j("#bookacti-activity-duration-hours").val(),d=$j("#bookacti-activity-duration-minutes").val(),c={isTitle:!1,isColor:!1,isAvail:!1,isAvailPositive:!1,isDays:!1,isHours:!1,isMinutes:!1,isDaysInfTo365:!1,isHoursInfTo23:!1,isMinutesInfTo59:!1,isSupToZero:!1,send:!1};a.length&&(c.isTitle=
!0);e.length&&(c.isColor=!0);f.length&&(c.isAvail=!0);c.isAvail&&0<=parseInt(f)&&(c.isAvailPositive=!0);b.length&&(c.isDays=!0);g.length&&(c.isHours=!0);d.length&&(c.isMinutes=!0);c.isDays&&365>=b&&0<=b&&(c.isDaysInfTo365=!0);c.isHours&&23>=g&&0<=g&&(c.isHoursInfTo23=!0);c.isMinutes&&59>=d&&0<=d&&(c.isMinutesInfTo59=!0);if(0<b||0<g||0<d)c.isSupToZero=!0;c.isTitle&&c.isColor&&c.isAvailPositive&&c.isDaysInfTo365&&c.isHoursInfTo23&&c.isMinutesInfTo59&&c.isSupToZero&&(c.send=!0);$j("#bookacti-activity-data-dialog .bookacti-form-error, #bookacti-activity-data-dialog .bookacti-notices").remove();
$j("#bookacti-activity-data-dialog *").removeClass("bookacti-input-error bookacti-input-warning");c.send||($j("#bookacti-activity-data-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+bookacti_localized.error_on_a_form_field+"</li></ul></div>"),$j("#bookacti-activity-data-dialog .bookacti-notices").show());$j("#bookacti-activity-data-dialog").trigger("bookacti_validate_activity_form",[c]);c.isTitle||($j("#bookacti-activity-title").addClass("bookacti-input-error"),
$j("#bookacti-activity-title").parent().append("<div class='bookacti-form-error'>"+bookacti_localized.error_fill_field+"</div>"));c.isColor||($j("#bookacti-activity-color").addClass("bookacti-input-error"),$j("#bookacti-activity-color").parent().append("<div class='bookacti-form-error'>"+bookacti_localized.error_fill_field+"</div>"));c.isAvail&&c.isAvailPositive||($j("#bookacti-activity-availability").addClass("bookacti-input-error"),$j("#bookacti-activity-availability").parent().append("<div class='bookacti-form-error'>"+
bookacti_localized.error_fill_field+"</div>"));c.isDays&&!c.isDaysInfTo365&&($j("#bookacti-activity-duration-days").addClass("bookacti-input-error"),$j("#bookacti-activity-duration-container").append("<div class='bookacti-form-error'>"+bookacti_localized.error_days_sup_to_365+"</div>"));c.isHours&&!c.isHoursInfTo23&&($j("#bookacti-activity-duration-hours").addClass("bookacti-input-error"),$j("#bookacti-activity-duration-container").append("<div class='bookacti-form-error'>"+bookacti_localized.error_hours_sup_to_23+
"</div>"));c.isMinutes&&!c.isMinutesInfTo59&&($j("#bookacti-activity-duration-minutes").addClass("bookacti-input-error"),$j("#bookacti-activity-duration-container").append("<div class='bookacti-form-error'>"+bookacti_localized.error_minutes_sup_to_59+"</div>"));c.isSupToZero||($j("#bookacti-activity-duration-days, #bookacti-activity-duration-hours, #bookacti-activity-duration-minutes").addClass("bookacti-input-error"),$j("#bookacti-activity-duration-container").append("<div class='bookacti-form-error'>"+
bookacti_localized.error_activity_duration_is_null+"</div>"));c.isDays||($j("#bookacti-activity-duration-days").addClass("bookacti-input-warning"),$j("#bookacti-activity-duration-days").val(0));c.isHours||($j("#bookacti-activity-duration-hours").addClass("bookacti-input-warning"),$j("#bookacti-activity-duration-hours").val(0));c.isMinutes||($j("#bookacti-activity-duration-minutes").addClass("bookacti-input-warning"),$j("#bookacti-activity-duration-minutes").val(0));return c.send}
function bookacti_validate_event_form(){$j("#bookacti-event-data-dialog .bookacti-notices").remove();var a={isGeneralValid:bookacti_validate_event_general_data(),isRepetitionValid:bookacti_validate_event_repetition_data("event"),send:!1};a.isRepetitionValid&&a.isGeneralValid&&(a.send=!0);$j("#bookacti-event-data-dialog").trigger("bookacti_validate_event_form",[a]);return a.send}
function bookacti_validate_event_general_data(){var a=$j("#bookacti-event-data-dialog #bookacti-event-title").val(),e=parseInt($j("#bookacti-event-data-dialog #bookacti-event-availability").val()),f={isTitle:!1,isAvailPositive:!1,send:!1};""!==a&&(f.isTitle=!0);0<=e&&(f.isAvailPositive=!0);f.isTitle&&f.isAvailPositive&&(f.send=!0);$j("#bookacti-event-title-container .bookacti-form-error, #bookacti-event-availability-container .bookacti-form-error, #bookacti-event-data-dialog .bookacti-form-field-error").remove();
$j("#bookacti-event-title, #bookacti-event-availability").removeClass("bookacti-input-error");f.send||($j("#bookacti-event-data-dialog .bookacti-error-list").length||$j("#bookacti-event-data-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"></ul></div>'),$j("#bookacti-event-data-dialog .bookacti-error-list").append('<li class="bookacti-form-field-error">'+bookacti_localized.error_on_a_form_field+"</li>"),$j("#bookacti-event-data-dialog .bookacti-notices").show());$j("#bookacti-event-data-dialog").trigger("bookacti_validate_event_general_data",
[f]);f.isTitle||($j("#bookacti-event-title").addClass("bookacti-input-error"),$j("#bookacti-event-title-container").append("<div class='bookacti-form-error'>"+bookacti_localized.error_fill_field+"</div>"));f.isAvailPositive||($j("#bookacti-event-availability").addClass("bookacti-input-error"),$j("#bookacti-event-availability-container").append("<div class='bookacti-form-error'>"+bookacti_localized.error_fill_field+"</div>"));return f.send}
function bookacti_validate_event_repetition_data(a){if("group"===a||"event"===a)if("group"!==a||"undefined"!==typeof bookacti.booking_system["bookacti-template-calendar"].selected_events[0])if("event"!==a||"undefined"!==typeof bookacti.booking_system["bookacti-template-calendar"].picked_events[0]){var e=moment.utc(("group"===a?bookacti.booking_system["bookacti-template-calendar"].selected_events[0]:bookacti.booking_system["bookacti-template-calendar"].picked_events[0]).start).clone().locale("en");
a="group"===a?"#bookacti-group-of-events-dialog":"#bookacti-event-data-dialog";var f=$j(a+' select[name="repeat_freq"]').val()?$j(a+' select[name="repeat_freq"]').val():"none",b=moment.utc($j(a+' input[name="repeat_from"]').val()).locale("en"),g=moment.utc($j(a+' input[name="repeat_to"]').val()).locale("en"),d={isRepeated:!1,isRepeatFrom:!1,isRepeatTo:!1,isFromBeforeTo:!1,isEventBetweenFromAndTo:!1,send:!1};"none"!==f&&(d.isRepeated=!0);isNaN(b)||""===b||null===b||(d.isRepeatFrom=!0);isNaN(g)||""===
g||null===g||(d.isRepeatTo=!0);d.isRepeatFrom&&d.isRepeatTo&&b<g&&(d.isFromBeforeTo=!0);d.isRepeated&&b.isSameOrBefore(e,"day")&&g.isSameOrAfter(e,"day")&&(d.isEventBetweenFromAndTo=!0);if(!d.isRepeated||d.isRepeated&&d.isRepeatFrom&&d.isRepeatTo&&d.isFromBeforeTo&&d.isEventBetweenFromAndTo)d.send=!0;d.isRepeated||($j(a+' input[name="repeat_from"]').prop("disabled",!0),$j(a+' input[name="repeat_to"]').prop("disabled",!0));$j(a+' div[id$="-repeat-days-container"]').hide();$j(a+' div[id$="-repeat-monthly_type-container"]').hide();
$j(a+' div[id$="-repeat-from-container"]').hide();$j(a+' div[id$="-repeat-to-container"]').hide();$j(a+' div[id$="-repeat-exceptions-container"]').hide();$j(a+" input.bookacti-date-interval-from, "+a+" input.bookacti-date-interval-to").attr("min","").attr("max","");$j("#bookacti-group-of-events-repetition-first-event-notice").hide();e=!1;b=moment.utc(b).add(1,"d");g=moment.utc(g).subtract(1,"d");b.isAfter(g)&&(e=!0);e||(d.isRepeatFrom&&$j(a+" input.bookacti-date-interval-from, "+a+" input.bookacti-date-interval-to").attr("min",
b.format("YYYY-MM-DD")),d.isRepeatTo&&$j(a+" input.bookacti-date-interval-from, "+a+" input.bookacti-date-interval-to").attr("max",g.format("YYYY-MM-DD")));$j(a+" .bookacti-input-error, "+a+" .bookacti-input-warning").removeClass("bookacti-input-error bookacti-input-warning");$j(a+" .bookacti-repeat-error").remove();d.send||$j(a+" .bookacti-error-list").length||$j(a).append('<div class="bookacti-notices"><ul class="bookacti-error-list"></ul></div>');$j(a).trigger("bookacti_validate_event_repetition_data",
[d]);d.isRepeated&&($j(a+' input[name="repeat_from"]').prop("disabled",!1),$j(a+' input[name="repeat_to"]').prop("disabled",!1),$j(a+' div[id$="-repeat-from-container"]').show(),$j(a+' div[id$="-repeat-to-container"]').show(),$j("#bookacti-group-of-events-repetition-first-event-notice").show(),"weekly"===f?$j(a+' div[id$="-repeat-days-container"]').show():"monthly"===f&&$j(a+' div[id$="-repeat-monthly_type-container"]').show(),d.isFromBeforeTo&&d.isEventBetweenFromAndTo?$j(a+' div[id$="-repeat-exceptions-container"]').show():
($j(a+' input[name="repeat_from"], '+a+' input[name="repeat_to"]').addClass("bookacti-input-error"),d.isFromBeforeTo?d.isEventBetweenFromAndTo||$j(a+" .bookacti-error-list").append('<li class="bookacti-repeat-error">'+bookacti_localized.error_event_not_btw_from_and_to+"</li>"):$j(a+" .bookacti-error-list").append('<li class="bookacti-repeat-error">'+bookacti_localized.error_repeat_end_before_begin+"</li>")));$j(a+" .bookacti-notices").toggle(0<$j(a+" .bookacti-notices li").length);return d.send}}
function bookacti_validate_group_of_events_form(){$j("#bookacti-group-of-events-dialog .bookacti-notices").remove();var a={isGeneralValid:bookacti_validate_group_of_events_general_data(),isRepetitionValid:bookacti_validate_event_repetition_data("group"),send:!1};a.isRepetitionValid&&a.isGeneralValid&&(a.send=!0);$j("#bookacti-group-of-events-dialog").trigger("bookacti_validate_group_of_events_form",[a]);return a.send}
function bookacti_validate_group_of_events_general_data(){var a=$j("#bookacti-group-of-events-title-field").val(),e=$j("#bookacti-group-of-events-category-selectbox").val(),f=$j("#bookacti-group-of-events-category-title-field").val(),b={isTitle:!1,isCategory:!1,isCategoryTitle:!1,isSelectedEvents:!1,send:!1};"string"===typeof a&&""!==a&&(b.isTitle=!0);"string"===typeof e&&"new"!==e&&(b.isCategory=!0);"string"===typeof f&&""!==f&&(b.isCategoryTitle=!0);2<=bookacti.booking_system["bookacti-template-calendar"].selected_events.length&&
(b.isSelectedEvents=!0);b.isTitle&&(b.isCategory||b.isCategoryTitle)&&b.isSelectedEvents&&(b.send=!0);$j("#bookacti-group-of-events-dialog .bookacti-form-error, #bookacti-group-of-events-dialog .bookacti-form-field-error").remove();$j("#bookacti-group-of-events-dialog input, #bookacti-group-of-events-dialog select").removeClass("bookacti-input-error");b.send||($j("#bookacti-group-of-events-dialog .bookacti-error-list").length||$j("#bookacti-group-of-events-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"></ul></div>'),
$j("#bookacti-group-of-events-dialog .bookacti-error-list").append('<li class="bookacti-form-field-error">'+bookacti_localized.error_on_a_form_field+"</li>"),$j("#bookacti-group-of-events-dialog .bookacti-notices").show());$j("#bookacti-group-of-events-dialog").trigger("bookacti_validate_group_of_events_general_data",[b]);b.isTitle||($j("#bookacti-group-of-events-title-field").addClass("bookacti-input-error"),$j("#bookacti-group-of-events-title-field").parent().append("<div class='bookacti-form-error'>"+
bookacti_localized.error_fill_field+"</div>"));b.isCategory||b.isCategoryTitle||($j("#bookacti-group-of-events-category-title-field").addClass("bookacti-input-error"),$j("#bookacti-group-of-events-category-title-field").parent().append("<div class='bookacti-form-error'>"+bookacti_localized.error_fill_field+"</div>"));b.isSelectedEvents||($j("#bookacti-group-of-events-summary").addClass("bookacti-input-error"),$j("#bookacti-group-of-events-summary").parent().append("<div class='bookacti-form-error'>"+
bookacti_localized.error_select_at_least_two_events+"</div>"));return b.send}
function bookacti_validate_group_category_form(){var a=$j("#bookacti-group-category-title-field").val(),e={isTitle:!1,send:!1};"string"===typeof a&&""!==a&&(e.isTitle=!0);e.isTitle&&(e.send=!0);$j("#bookacti-group-category-dialog .bookacti-form-error, #bookacti-group-category-dialog .bookacti-notices").remove();$j("#bookacti-group-category-dialog input, #bookacti-template-data-dialog select").removeClass("bookacti-input-error");e.send||($j("#bookacti-group-category-dialog").append('<div class="bookacti-notices"><ul><li>'+
bookacti_localized.error_on_a_form_field+"</li></ul></div>"),$j("#bookacti-group-category-dialog .bookacti-notices").show());$j("#bookacti-group-category-dialog").trigger("bookacti_validate_group_category_form",[e]);e.isTitle||($j("#bookacti-group-category-title-field").addClass("bookacti-input-error"),$j("#bookacti-group-category-title-field").parent().append("<div class='bookacti-form-error'>"+bookacti_localized.error_fill_field+"</div>"));return e.send};
