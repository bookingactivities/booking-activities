function bookacti_dialog_choose_group_of_events(e,L,b){var C=e.attr("id"),I=$j("#"+C+"-choose-group-of-events-dialog"),u=$j("#"+C+"-groups-of-events-list"),d=bookacti.booking_system[C],J=d.multiple_bookings,F=d.bookings_only,n=d.past_events,M=d.past_events_bookable,G=moment.utc(bookacti_localized.current_time);u.data("booking-system-id",C);u.empty();if(d.groups_single_events){var z=bookacti_get_event_availability(e,b),g=!0;"undefined"!==typeof b.is_available&&(b.is_available||(g=!1));"undefined"!==
typeof b.extendedProps&&"undefined"!==typeof b.extendedProps.is_available&&(b.extendedProps.is_available||(g=!1));if(n){n=moment.utc(b.start).clone();var p=moment.utc(b.end).clone();M||!n.isBefore(G)||bookacti_localized.started_events_bookable&&p.isAfter(G)||(g=!1)}var f="undefined"!==typeof b.groupId?parseInt(b.groupId):parseInt(b.id);if(g&&"undefined"!==typeof d.events_data[f]){n=g=!1;p=parseInt(d.events_data[f].activity_id);var c=d.activities_data[p].settings;("undefined"===typeof c.min_bookings_per_user?
0:c.min_bookings_per_user?parseInt(c.min_bookings_per_user):0)<=z&&(n=!0);p=max_users_ok=!0;var D="undefined"===typeof c.max_bookings_per_user?0:c.max_bookings_per_user?parseInt(c.max_bookings_per_user):0;c="undefined"===typeof c.max_users_per_event?0:c.max_users_per_event?parseInt(c.max_users_per_event):0;if(D||c){var E=moment.utc(b.start).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");"undefined"!==typeof d.bookings[f]&&"undefined"!==typeof d.bookings[f][E]&&(f=d.bookings[f][E],E=parseInt(f.current_user_bookings),
c&&0===E&&parseInt(f.distinct_users)>=c&&(max_users_ok=!1),D&&E>=D&&(p=!1))}n&&p&&max_users_ok&&(g=!0)}n=$j("<div></div>",{});p=$j("<div></div>",{id:"bookacti-group-of-events-option-single","class":"bookacti-group-of-events-option","data-group-id":0,"data-group-date":"","data-show-events":0});D=$j("<input />",{id:"bookacti-group-of-events-single",type:"radio",name:"group_of_events",value:"single",disabled:!F&&!g});f="";F?(g=bookacti_get_bookings_number_for_a_single_grouped_event(e,b,L),f=g+" "+(1===
g?bookacti_localized.booking:bookacti_localized.bookings)):(f=!g&&0<z?0:z,c=1===f?bookacti_localized.avail:bookacti_localized.avails,f=!g&&0<z&&bookacti_localized.not_bookable?bookacti_localized.not_bookable:f+" "+c);g={html:bookacti_localized.single_event+' <span class="bookacti-group-availability" >('+f+")</span>","for":"bookacti-group-of-events-single"};e.trigger("bookacti_choose_group_dialog_group_label",[g,0,"",b]);g=$j("<label></label>",g);f=$j("<ul></ul>",{id:"bookacti-group-of-events-list-single",
"class":"bookacti-group-of-events-list bookacti-custom-scrollbar","data-group-id":0,"data-group-date":""});c=bookacti_format_event_duration(b.start,b.end);c={title:"undefined"!==typeof b.title?b.title:"",duration:c,quantity:1};e.trigger("bookacti_group_of_events_list_data",[c,b]);c={html:'<span class="bookacti-booking-event-duration" >'+c.duration+'</span><span class="bookacti-booking-event-title-separator" > - </span><span class="bookacti-booking-event-title" >'+c.title+"</span>"};e.trigger("bookacti_group_of_events_list_element_data",
[c,b]);c=$j("<li></li>",c);p.append(D);p.append(g);n.append(p);f.append(c);n.append(f);u.append(n)}$j.each(L,function(a,v){if("undefined"===typeof d.groups_data[a])return!0;var q=d.groups_data[a],A=parseInt(q.category_id),h=d.group_categories_data[A].settings,N=parseInt(bookacti_localized.started_groups_bookable);"undefined"!==typeof h.started_groups_bookable&&0<=$j.inArray(h.started_groups_bookable,[0,1,"0","1",!0,!1])&&(N=$j.isNumeric(h.started_groups_bookable)?parseInt(h.started_groups_bookable):
h.started_groups_bookable?1:0);$j.each(v,function(k,H){var l,w,r,x;var t=l=w=r=x=0;"undefined"!==typeof d.groups_bookings[a]&&"undefined"!==typeof d.groups_bookings[a][k]&&(t=d.groups_bookings[a][k].is_available,l=d.groups_bookings[a][k].availability,w=d.groups_bookings[a][k].quantity,r=d.groups_bookings[a][k].current_user_bookings,x=d.groups_bookings[a][k].distinct_users);t=t&&0<l;var B=moment.utc(H[0].start).clone(),m=moment.utc(H[H.length-1].end).clone();M||!B.isBefore(G)||N&&m.isAfter(G)||(t=
!1);if(t){B=t=!1;("undefined"===typeof h.min_bookings_per_user?0:h.min_bookings_per_user?parseInt(h.min_bookings_per_user):0)<=l&&0<l&&(B=!0);m="undefined"===typeof h.max_users_per_event?0:h.max_users_per_event?parseInt(h.max_users_per_event):0;var K="undefined"===typeof h.max_bookings_per_user?0:h.max_bookings_per_user?parseInt(h.max_bookings_per_user):0,O=max_users_ok=!0;if(K||m)r=parseInt(r),m&&0===r&&parseInt(x)>=m&&(max_users_ok=!1),K&&r>=K&&(O=!1);B&&O&&max_users_ok&&(t=!0)}x=$j("<div></div>",
{});r=$j("<div></div>",{id:"bookacti-group-of-events-option-"+a+"_"+k,"class":"bookacti-group-of-events-option","data-group-id":a,"data-group-date":k,"data-show-events":0});B=$j("<input />",{id:"bookacti-group-of-events-"+a+"_"+k,type:"radio",name:"group_of_events",disabled:!F&&!t,value:a+"_"+k});m="";F?m=w+" "+(1===w?bookacti_localized.booking:bookacti_localized.bookings):(w=!t&&0<z?0:z,m=1===w?bookacti_localized.avail:bookacti_localized.avails,m=!t&&0<l&&bookacti_localized.not_bookable?bookacti_localized.not_bookable:
w+" "+m);l={html:q.title+' <span class="bookacti-group-availability" >('+m+")</span>","for":"bookacti-group-of-events-"+a+"_"+k};e.trigger("bookacti_choose_group_dialog_group_label",[l,a,k,b]);l=$j("<label></label>",l);var P=$j("<ul></ul>",{id:"bookacti-group-of-events-list-"+a+"_"+k,"class":"bookacti-group-of-events-list bookacti-custom-scrollbar","data-group-id":a,"data-group-date":k});$j.each(H,function(Q,y){Q=y.start.substr(0,10)===y.end.substr(0,10);var R=moment.utc(y.start).locale(bookacti_localized.current_lang_code),
S=moment.utc(y.end).locale(bookacti_localized.current_lang_code),T=R.formatPHP(bookacti_localized.date_format)+bookacti_localized.dates_separator+S.formatPHP(bookacti_localized.date_format);Q&&(T=R.formatPHP(bookacti_localized.date_format)+bookacti_localized.date_time_separator+S.formatPHP(bookacti_localized.time_format));y=$j("<li></li>",{html:'<span class="bookacti-booking-event-duration" >'+T+'</span><span class="bookacti-booking-event-title-separator" > - </span><span class="bookacti-booking-event-title" >'+
y.title+"</span>"});P.append(y)});r.append(B);r.append(l);x.append(r);x.append(P);u.append(x)})});u.find('input[name="group_of_events"]').on("change",function(){var a=$j(this).val(),v="single"!==a?parseInt(a.substr(0,a.indexOf("_"))):0,q="single"!==a?a.substr(a.indexOf("_")+1):"",A=$j("#"+C+"-choose-group-of-events-dialog .bookacti-groups-of-events-list");A.find(".bookacti-group-of-events-option:not(#bookacti-group-of-events-option-"+a+")").data("show-events",0).attr("data-show-events",0);A.find(".bookacti-group-of-events-list:not(#bookacti-group-of-events-list-"+
a+")").hide(200);A.find("#bookacti-group-of-events-option-"+a).data("show-events",1).attr("data-show-events",1);A.find("#bookacti-group-of-events-list-"+a).show(200);a={click:!0};$j(this).is(":disabled")&&(a.click=!1);e.trigger("bookacti_trigger_group_of_events_preview",[a,v,q,b]);a.click&&(J?bookacti_unpick_events(e,b):bookacti_unpick_all_events(e),bookacti_pick_events(e,b,v,q),e.trigger("bookacti_group_of_events_preview",[v,q,b]))});u.find('input[name="group_of_events"]:not([disabled]):first').prop("checked",
!0).trigger("change");e.find(".fc-toolbar button:focus").blur();I.dialog({beforeClose:function(){},close:function(){"undefined"!==typeof u.find('input[type="radio"]:checked').val()||J||bookacti_unpick_all_events(e)}});I.dialog("option","buttons",[{text:bookacti_localized.dialog_button_ok,click:function(){var a=u.find('input[type="radio"]:checked').val();if("undefined"!==typeof a){var v={click:!0};u.find('input[type="radio"]:checked').is(":disabled")&&(v.click=!1);var q="single"!==a?parseInt(a.substr(0,
a.indexOf("_"))):0;a="single"!==a?a.substr(a.indexOf("_")+1):"";e.trigger("bookacti_trigger_group_of_events_click",[v,q,a,b]);v.click&&(J?bookacti_unpick_events(e,b):bookacti_unpick_all_events(e),bookacti_pick_events(e,b,q,a),e.trigger("bookacti_group_of_events_chosen",[q,a,b]))}$j(this).dialog("close")}}]);I.dialog("open")};
