$j(document).ready(function(){$j("body").on("click",".ui-widget-overlay",function(){$j("div:ui-dialog:visible").dialog("close")});$j("body").on("keydown",".bookacti-booking-system-dialog",function(a){if(!$j("textarea").is(":focus")&&a.keyCode==$j.ui.keyCode.ENTER){$j(this).parent().find(".ui-dialog-buttonpane button:first").focus();return false}})});function bookacti_init_booking_system_dialogs(){$j(".bookacti-booking-system-dialog").dialog({modal:true,autoOpen:false,minHeight:300,minWidth:400,resize:"auto",show:true,hide:true,dialogClass:"bookacti-dialog",closeText:"&#10006;",close:function(){}})}function bookacti_dialog_choose_group_of_events(A,i,N){var F=A.attr("id");var I=$j("#"+F+"-choose-group-of-events-dialog");var h=$j("#"+F+"-groups-of-events-list");var D=bookacti.booking_system[F];var d=D.multiple_bookings;var p=D.bookings_only;var G=D.past_events;var x=D.past_events_bookable;var s=moment.utc(bookacti_localized.current_time);h.data("booking-system-id",F);h.empty();if(D.groups_single_events){var u="";if(p){var r=bookacti_get_bookings_number_for_a_single_grouped_event(A,N,i);var f=r===1?bookacti_localized.booking:bookacti_localized.bookings;u=r+" "+f}else{var k=bookacti_get_event_availability(A,N);var m=k===1?bookacti_localized.avail:bookacti_localized.avails;u=k+" "+m}var g=true;if(G){var c=moment.utc(N.start).clone();var K=moment.utc(N.end).clone();if(!x&&c.isBefore(s)&&!(bookacti_localized.started_events_bookable&&K.isAfter(s))){g=false}}if(g&&typeof D.events_data[N.id]!=="undefined"){g=false;var e=false;var y=parseInt(D.events_data[N.id]["activity_id"]);var M=D.activities_data[y]["settings"];var n=typeof M.min_bookings_per_user==="undefined"?0:(M.min_bookings_per_user?parseInt(M.min_bookings_per_user):0);if(n<=k){e=true}var q=max_users_ok=true;var J=typeof M.max_bookings_per_user==="undefined"?0:(M.max_bookings_per_user?parseInt(M.max_bookings_per_user):0);var o=typeof M.max_users_per_event==="undefined"?0:(M.max_users_per_event?parseInt(M.max_users_per_event):0);if(J||o){var C=moment.utc(N.start).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");if(typeof D.bookings[N.id]!=="undefined"){if(typeof D.bookings[N.id][C]!=="undefined"){var l=D.bookings[N.id][C];var L=parseInt(l.current_user_bookings);if(o&&L===0&&parseInt(l.distinct_users)>=o){max_users_ok=false}if(J&&L>=J){q=false}}}}if(e&&q&&max_users_ok){g=true}}var z=$j("<div></div>",{});var w=$j("<div></div>",{id:"bookacti-group-of-events-option-single","class":"bookacti-group-of-events-option","data-group-id":0,"data-group-date":"","data-show-events":0});var v=$j("<input />",{id:"bookacti-group-of-events-single",type:"radio",name:"group_of_events",value:"single",disabled:!p&&!g});var b={html:bookacti_localized.single_event+' <span class="bookacti-group-availability" >('+u+")</span>","for":"bookacti-group-of-events-single"};A.trigger("bookacti_choose_group_dialog_group_label",[b,0,"",N]);var E=$j("<label></label>",b);var B=$j("<ul></ul>",{id:"bookacti-group-of-events-list-single","class":"bookacti-group-of-events-list bookacti-custom-scrollbar","data-group-id":0,"data-group-date":""});var H=bookacti_format_event_duration(N.start,N.end);var j={title:N.title,duration:H,quantity:1};A.trigger("bookacti_group_of_events_list_data",[j,N]);var t={html:'<span class="bookacti-booking-event-duration" >'+j.duration+'</span><span class="bookacti-booking-event-title-separator" > - </span><span class="bookacti-booking-event-title" >'+j.title+"</span>"};A.trigger("bookacti_group_of_events_list_element_data",[t,N]);var a=$j("<li></li>",t);w.append(v);w.append(E);z.append(w);B.append(a);z.append(B);h.append(z)}$j.each(i,function(R,T){if(typeof D.groups_data[R]!=="undefined"){return true}var S=D.groups_data[R];var Q=parseInt(S.category_id);var P=D.group_categories_data[Q]["settings"];var O=typeof P.started_groups_bookable!=="undefined"?parseInt(P.started_groups_bookable):parseInt(bookacti_localized.started_groups_bookable);$j.each(T,function(W,Y){var Z,an,ap,ak;Z=an=ap=ak=0;if(typeof D.groups_bookings[R]!=="undefined"){if(typeof D.groups_bookings[R][W]!=="undefined"){Z=D.groups_bookings[R][W]["availability"];an=D.groups_bookings[R][W]["bookings"];ap=D.groups_bookings[R][W]["current_user_bookings"];ak=D.groups_bookings[R][W]["distinct_users"]}}var ae=parseInt(Z)>0;var am=moment.utc(Y[0].start).clone();var aj=moment.utc(Y[Y.length-1].end).clone();if(!x&&am.isBefore(s)&&!(O&&aj.isAfter(s))){ae=false}if(ae){ae=false;var ar=false;var aq=typeof P.min_bookings_per_user==="undefined"?0:(P.min_bookings_per_user?parseInt(P.min_bookings_per_user):0);if(aq<=Z&&Z>0){ar=true}var aa=typeof P.max_users_per_event==="undefined"?0:(P.max_users_per_event?parseInt(P.max_users_per_event):0);var V=typeof P.max_bookings_per_user==="undefined"?0:(P.max_bookings_per_user?parseInt(P.max_bookings_per_user):0);var ai=max_users_ok=true;if(V||aa){var al=parseInt(ap);if(aa&&al===0&&parseInt(ak)>=aa){max_users_ok=false}if(V&&al>=V){ai=false}}if(ar&&ai&&max_users_ok){ae=true}}var af=$j("<div></div>",{});var ab=$j("<div></div>",{id:"bookacti-group-of-events-option-"+R+"_"+W,"class":"bookacti-group-of-events-option","data-group-id":R,"data-group-date":W,"data-show-events":0});var ad=$j("<input />",{id:"bookacti-group-of-events-"+R+"_"+W,type:"radio",name:"group_of_events",disabled:!p&&!ae,value:R+"_"+W});var ao="";if(p){var ah=an===1?bookacti_localized.booking:bookacti_localized.bookings;ao=an+" "+ah}else{var ag=Z===1?bookacti_localized.avail:bookacti_localized.avails;ao=Z+" "+ag}var U={html:S.title+' <span class="bookacti-group-availability" >('+ao+")</span>","for":"bookacti-group-of-events-"+R+"_"+W};A.trigger("bookacti_choose_group_dialog_group_label",[U,R,W,N]);var ac=$j("<label></label>",U);var X=$j("<ul></ul>",{id:"bookacti-group-of-events-list-"+R+"_"+W,"class":"bookacti-group-of-events-list bookacti-custom-scrollbar","data-group-id":R,"data-group-date":W});$j.each(Y,function(av,ax){var au=ax.start.substr(0,10)===ax.end.substr(0,10);var ay=moment.utc(ax.start).locale(bookacti_localized.current_lang_code);var at=moment.utc(ax.end).locale(bookacti_localized.current_lang_code);var az=ay.formatPHP(bookacti_localized.date_format)+bookacti_localized.dates_separator+at.formatPHP(bookacti_localized.date_format);if(au){az=ay.formatPHP(bookacti_localized.date_format)+bookacti_localized.date_time_separator+at.formatPHP(bookacti_localized.time_format)}var aw=$j("<li></li>",{html:'<span class="bookacti-booking-event-duration" >'+az+'</span><span class="bookacti-booking-event-title-separator" > - </span><span class="bookacti-booking-event-title" >'+ax.title+"</span>"});X.append(aw)});ab.append(ad);ab.append(ac);af.append(ab);af.append(X);h.append(af)})});h.find('input[name="group_of_events"]').on("change",function(){var U=$j(this).val();var R=U!=="single"?parseInt(U.substr(0,U.indexOf("_"))):0;var V=U!=="single"?U.substr(U.indexOf("_")+1):"";var S=$j("#"+F+"-choose-group-of-events-dialog .bookacti-groups-of-events-list");S.find(".bookacti-group-of-events-option:not(#bookacti-group-of-events-option-"+U+")").data("show-events",0).attr("data-show-events",0);S.find(".bookacti-group-of-events-list:not(#bookacti-group-of-events-list-"+U+")").hide(200);S.find("#bookacti-group-of-events-option-"+U).data("show-events",1).attr("data-show-events",1);S.find("#bookacti-group-of-events-list-"+U).show(200);var Q={click:true};if($j(this).is(":disabled")){Q.click=false}A.trigger("bookacti_trigger_group_of_events_preview",[Q,R,V,N]);if(Q.click){if(d){var T=bookacti_is_event_picked(A,N);if(T){var O=T.group_id?T.group_id:0;var P=T.group_date?T.group_date:"";bookacti_unpick_events(A,N,O,P)}}if(d){bookacti_unpick_events(A,N,R,V)}else{bookacti_unpick_all_events(A)}bookacti_pick_events(A,N,R,V);A.trigger("bookacti_group_of_events_preview",[R,V,N])}});h.find('input[name="group_of_events"]:not([disabled]):first').prop("checked",true).trigger("change");I.dialog({close:function(){var O=h.find('input[type="radio"]:checked').val();if(typeof O==="undefined"&&!d){bookacti_unpick_all_events(A)}}});I.dialog("option","buttons",[{text:bookacti_localized.dialog_button_ok,click:function(){var T=h.find('input[type="radio"]:checked').val();if(typeof T!=="undefined"){var Q={click:true};if(h.find('input[type="radio"]:checked').is(":disabled")){Q.click=false}var R=T!=="single"?parseInt(T.substr(0,T.indexOf("_"))):0;var U=T!=="single"?T.substr(T.indexOf("_")+1):"";A.trigger("bookacti_trigger_group_of_events_click",[Q,R,U,N]);if(Q.click){if(d){var S=bookacti_is_event_picked(A,N);if(S){var O=S.group_id?S.group_id:0;var P=S.group_date?S.group_date:"";bookacti_unpick_events(A,N,O,P)}}if(d){bookacti_unpick_events(A,N,R,U)}else{bookacti_unpick_all_events(A)}bookacti_pick_events(A,N,R,U);A.trigger("bookacti_group_of_events_chosen",[R,U,N])}}$j(this).dialog("close")}}]);I.dialog("open")};