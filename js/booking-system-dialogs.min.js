function bookacti_dialog_choose_group_of_events(d,N,b){var y=d.attr("id"),I=$j("#"+y+"-choose-group-of-events-dialog"),v=$j("#"+y+"-groups-of-events-list"),h=bookacti.booking_system[y],J=h.multiple_bookings,B=h.bookings_only,w=h.past_events,z=h.past_events_bookable,q=moment.utc(bookacti_localized.current_time);v.data("booking-system-id",y);v.empty();if(h.groups_single_events){var k=bookacti_get_event_availability(d,b),l=0<k;"undefined"!==typeof b.is_available&&(b.is_available||(l=!1));"undefined"!==
typeof b.extendedProps&&"undefined"!==typeof b.extendedProps.is_available&&(b.extendedProps.is_available||(l=!1));if(w){w=moment.utc(b.start).clone();var c=moment.utc(b.end).clone();z||!w.isBefore(q)||bookacti_localized.started_events_bookable&&c.isAfter(q)||(l=!1)}var g="undefined"!==typeof b.groupId?parseInt(b.groupId):parseInt(b.id);if(l&&"undefined"!==typeof h.events_data[g]){z=l=!1;q=parseInt(h.events_data[g].activity_id);c=h.activities_data[q].settings;("undefined"===typeof c.min_bookings_per_user?
0:c.min_bookings_per_user?parseInt(c.min_bookings_per_user):0)<=k&&(z=!0);q=max_users_ok=!0;w="undefined"===typeof c.max_bookings_per_user?0:c.max_bookings_per_user?parseInt(c.max_bookings_per_user):0;c="undefined"===typeof c.max_users_per_event?0:c.max_users_per_event?parseInt(c.max_users_per_event):0;if(w||c){var f=moment.utc(b.start).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");if("undefined"!==typeof h.bookings[g]&&"undefined"!==typeof h.bookings[g][f]){f=h.bookings[g][f];var p=parseInt(f.current_user_bookings);
c&&0===p&&parseInt(f.distinct_users)>=c&&(max_users_ok=!1);w&&p>=w&&(q=!1)}}z&&q&&max_users_ok&&(l=!0)}z=$j("<div></div>",{});q=$j("<div></div>",{id:"bookacti-group-of-events-option-single","class":"bookacti-group-of-events-option","data-group-id":0,"data-group-date":"","data-show-events":0});w=$j("<input />",{id:"bookacti-group-of-events-single",type:"radio",name:"group_of_events",value:"single",disabled:!B&&!l});c=bookacti_get_bookings_number_for_a_single_grouped_event(d,b,N);f=!l&&0<k&&"{current}"!==
bookacti_localized.not_bookable?0:k;p="";(g=bookacti.booking_system[y].events_data?.[g]?.availability)||(g=0);var G=g?parseInt(k/g*100):0;g=parseInt(bookacti.booking_system[y].hide_availability);var r=parseInt(bookacti_localized.hide_availability_fixed);G=100>g&&G>g;var O=0<r&&k>r;!B&&(0>=r&&G||100<=g&&O||G&&O)&&(f="",p="bookacti-hide-availability");r=(0<c?" bookacti-booked":" bookacti-not-booked")+(0>=k?" bookacti-full":"")+(!l&&0<k?" bookacti-not-bookable":"");g=$j("<div></div>",{"class":"bookacti-group-availability-container "+
p});p=$j("<div></div>",{"class":"bookacti-available-places "+r});B?(r=1===c?bookacti_localized.booking:bookacti_localized.bookings,f=$j("<span></span>",{"class":"bookacti-active-bookings-number",html:c}),r=$j("<span></span>",{"class":"bookacti-available-places-avail-particle",html:r}),p.append(f),p.append(r),g.append(p),d.trigger("bookacti_choose_group_dialog_group_number_of_bookings_div",[g,0,"",b,c,k,l])):(c=1===k?bookacti_localized.avail:bookacti_localized.avails,!l&&0<k&&bookacti_localized.not_bookable&&
"{current}"!==bookacti_localized.not_bookable&&(f="",c=bookacti_localized.not_bookable),f=$j("<span></span>",{"class":"bookacti-available-places-number",html:f}),r=$j("<span></span>",{"class":"bookacti-available-places-avail-particle",html:c}),p.append(f),p.append(r),g.append(p),d.trigger("bookacti_choose_group_dialog_group_availability_div",[g,0,"",b,k,l]));k={html:bookacti_localized.single_event+g[0].outerHTML,"for":"bookacti-group-of-events-single"};d.trigger("bookacti_choose_group_dialog_group_label",
[k,0,"",b,l]);k=$j("<label></label>",k);c=$j("<ul></ul>",{id:"bookacti-group-of-events-list-single","class":"bookacti-group-of-events-list bookacti-custom-scrollbar","data-group-id":0,"data-group-date":""});f=bookacti_format_event_duration(b.start,b.end);f={title:"undefined"!==typeof b.title?b.title:"",duration:f,quantity:1};d.trigger("bookacti_group_of_events_list_data",[f,b,l]);f={html:'<span class="bookacti-booking-event-duration" >'+f.duration+'</span><span class="bookacti-booking-event-title-separator" > - </span><span class="bookacti-booking-event-title" >'+
f.title+"</span>"};d.trigger("bookacti_group_of_events_list_element_data",[f,b,l]);l=$j("<li></li>",f);q.append(w);q.append(k);z.append(q);c.append(l);z.append(c);v.append(z)}$j.each(N,function(a,x){if("undefined"===typeof h.groups_data[a])return!0;$j.each(x,function(e,E){var t,m;var n=t=m=0;"undefined"!==typeof h.groups_bookings[a]&&"undefined"!==typeof h.groups_bookings[a][e]&&(n=h.groups_bookings[a][e]?.availability,t=h.groups_bookings[a][e]?.quantity,m=h.groups_bookings[a][e]?.total_availability);
var u=bookacti_is_group_of_events_available(d,a,e),K=$j("<div></div>",{}),L=$j("<div></div>",{id:"bookacti-group-of-events-option-"+a+"_"+e,"class":"bookacti-group-of-events-option"+(B||u?"":" bookacti-group-of-events-unavailable"),"data-group-id":a,"data-group-date":e,"data-show-events":0}),V=$j("<input />",{id:"bookacti-group-of-events-"+a+"_"+e,type:"radio",name:"group_of_events",disabled:!B&&!u,value:a+"_"+e}),C=!u&&0<n&&"{current}"!==bookacti_localized.not_bookable?0:n,F=t,A="",H=m?parseInt(n/
m*100):0;m=parseInt(bookacti.booking_system[y].hide_availability);var M=parseInt(bookacti_localized.hide_availability_fixed);H=100>m&&H>m;var P=0<M&&n>M;!B&&(0>=M&&H||100<=m&&P||H&&P)&&(C="",A="bookacti-hide-availability");m=(0<t?" bookacti-booked":" bookacti-not-booked")+(0>=n?" bookacti-full":"")+(!u&&0<n?" bookacti-not-bookable":"");A=$j("<div></div>",{"class":"bookacti-group-availability-container "+A});m=$j("<div></div>",{"class":"bookacti-available-places "+m});B?(t=1===t?bookacti_localized.booking:
bookacti_localized.bookings,C=$j("<span></span>",{"class":"bookacti-active-bookings-number",html:F}),t=$j("<span></span>",{"class":"bookacti-available-places-avail-particle",html:t}),m.append(C),m.append(t),A.append(m),d.trigger("bookacti_choose_group_dialog_group_number_of_bookings_div",[A,a,e,b,F,n,u])):(F=1===n?bookacti_localized.avail:bookacti_localized.avails,!u&&0<n&&bookacti_localized.not_bookable&&"{current}"!==bookacti_localized.not_bookable&&(C="",F=bookacti_localized.not_bookable),C=$j("<span></span>",
{"class":"bookacti-available-places-number",html:C}),t=$j("<span></span>",{"class":"bookacti-available-places-avail-particle",html:F}),m.append(C),m.append(t),A.append(m),d.trigger("bookacti_choose_group_dialog_group_availability_div",[A,a,e,b,n,u]));n={html:h.groups_data[a].title+A[0].outerHTML,"for":"bookacti-group-of-events-"+a+"_"+e};d.trigger("bookacti_choose_group_dialog_group_label",[n,a,e,b,u]);u=$j("<label></label>",n);var Q=$j("<ul></ul>",{id:"bookacti-group-of-events-list-"+a+"_"+e,"class":"bookacti-group-of-events-list bookacti-custom-scrollbar",
"data-group-id":a,"data-group-date":e});$j.each(E,function(R,D){R=D.start.substr(0,10)===D.end.substr(0,10);var S=moment.utc(D.start).locale(bookacti_localized.current_lang_code),T=moment.utc(D.end).locale(bookacti_localized.current_lang_code),U=S.formatPHP(bookacti_localized.date_format)+bookacti_localized.dates_separator+T.formatPHP(bookacti_localized.date_format);R&&(U=S.formatPHP(bookacti_localized.date_format)+bookacti_localized.date_time_separator+T.formatPHP(bookacti_localized.time_format));
D=$j("<li></li>",{html:'<span class="bookacti-booking-event-duration" >'+U+'</span><span class="bookacti-booking-event-title-separator" > - </span><span class="bookacti-booking-event-title" >'+D.title+"</span>"});Q.append(D)});L.append(V);L.append(u);K.append(L);K.append(Q);v.append(K)})});v.find('input[name="group_of_events"]').on("change",function(){var a=$j(this).val(),x="single"!==a?parseInt(a.substr(0,a.indexOf("_"))):0,e="single"!==a?a.substr(a.indexOf("_")+1):"",E=$j("#"+y+"-choose-group-of-events-dialog .bookacti-groups-of-events-list");
E.find(".bookacti-group-of-events-option:not(#bookacti-group-of-events-option-"+a+")").data("show-events",0).attr("data-show-events",0);E.find(".bookacti-group-of-events-list:not(#bookacti-group-of-events-list-"+a+")").hide(200);E.find("#bookacti-group-of-events-option-"+a).data("show-events",1).attr("data-show-events",1);E.find("#bookacti-group-of-events-list-"+a).show(200);a={click:!0};$j(this).is(":disabled")&&(a.click=!1);d.trigger("bookacti_trigger_group_of_events_preview",[a,x,e,b]);a.click&&
(J?bookacti_unpick_events(d,b):bookacti_unpick_all_events(d),bookacti_pick_events(d,b,x,e),d.trigger("bookacti_group_of_events_preview",[x,e,b]))});v.find('input[name="group_of_events"]:not([disabled]):first').prop("checked",!0).trigger("change");d.find(".fc-toolbar button:focus").blur();I.dialog({beforeClose:function(){},close:function(){"undefined"!==typeof v.find('input[type="radio"]:checked').val()||J||bookacti_unpick_all_events(d)}});I.dialog("option","buttons",[{text:bookacti_localized.dialog_button_ok,
click:function(){var a=v.find('input[type="radio"]:checked').val();if("undefined"!==typeof a){var x={click:!0};v.find('input[type="radio"]:checked').is(":disabled")&&(x.click=!1);var e="single"!==a?parseInt(a.substr(0,a.indexOf("_"))):0;a="single"!==a?a.substr(a.indexOf("_")+1):"";d.trigger("bookacti_trigger_group_of_events_click",[x,e,a,b]);x.click&&(J?bookacti_unpick_events(d,b):bookacti_unpick_all_events(d),bookacti_pick_events(d,b,e,a),d.trigger("bookacti_group_of_events_chosen",[e,a,b]))}$j(this).dialog("close")}}]);
I.dialog("open")};
