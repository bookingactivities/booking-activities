function bookacti_dialog_choose_group_of_events(d,S,b){var C=d.attr("id"),Q=$j("#"+C+"-choose-group-of-events-dialog"),z=$j("#"+C+"-groups-of-events-list"),e=bookacti.booking_system[C],R=e.multiple_bookings,G=e.bookings_only,v=e.past_events,T=e.past_events_bookable,M=moment.utc(bookacti_localized.current_time);z.data("booking-system-id",C);z.empty();if(e.groups_single_events){var m=bookacti_get_event_availability(d,b),h=!0;"undefined"!==typeof b.is_available&&(b.is_available||(h=!1));"undefined"!==
typeof b.extendedProps&&"undefined"!==typeof b.extendedProps.is_available&&(b.extendedProps.is_available||(h=!1));if(v){v=moment.utc(b.start).clone();var w=moment.utc(b.end).clone();T||!v.isBefore(M)||bookacti_localized.started_events_bookable&&w.isAfter(M)||(h=!1)}var f="undefined"!==typeof b.groupId?parseInt(b.groupId):parseInt(b.id);if(h&&"undefined"!==typeof e.events_data[f]){v=h=!1;w=parseInt(e.events_data[f].activity_id);var c=e.activities_data[w].settings;("undefined"===typeof c.min_bookings_per_user?
0:c.min_bookings_per_user?parseInt(c.min_bookings_per_user):0)<=m&&(v=!0);w=max_users_ok=!0;var J="undefined"===typeof c.max_bookings_per_user?0:c.max_bookings_per_user?parseInt(c.max_bookings_per_user):0;c="undefined"===typeof c.max_users_per_event?0:c.max_users_per_event?parseInt(c.max_users_per_event):0;if(J||c){var n=moment.utc(b.start).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");if("undefined"!==typeof e.bookings[f]&&"undefined"!==typeof e.bookings[f][n]){n=e.bookings[f][n];var r=parseInt(n.current_user_bookings);
c&&0===r&&parseInt(n.distinct_users)>=c&&(max_users_ok=!1);J&&r>=J&&(w=!1)}}v&&w&&max_users_ok&&(h=!0)}v=$j("<div></div>",{});w=$j("<div></div>",{id:"bookacti-group-of-events-option-single","class":"bookacti-group-of-events-option","data-group-id":0,"data-group-date":"","data-show-events":0});J=$j("<input />",{id:"bookacti-group-of-events-single",type:"radio",name:"group_of_events",value:"single",disabled:!G&&!h});c=bookacti_get_bookings_number_for_a_single_grouped_event(d,b,S);n=!h&&0<m&&"{current}"!==
bookacti_localized.not_bookable?0:m;r="";(f=bookacti.booking_system[C].events_data?.[f]?.availability)||(f=0);var N=f?parseInt(m/f*100):0;f=parseInt(bookacti.booking_system[C].hide_availability);var K=parseInt(bookacti_localized.hide_availability_fixed);N=100>f&&N>f;var U=0<K&&m>K;!G&&(0>=K&&N||100<=f&&U||N&&U)&&(n="",r="bookacti-hide-availability");K=(0<c?" bookacti-booked":" bookacti-not-booked")+(0>=m?" bookacti-full":"")+(!h&&0<m?" bookacti-not-bookable":"");f=$j("<div></div>",{"class":"bookacti-group-availability-container "+
r});r=$j("<div></div>",{"class":"bookacti-available-places "+K});G?(n=1===c?bookacti_localized.booking:bookacti_localized.bookings,h=$j("<span></span>",{"class":"bookacti-active-bookings-number",html:c}),n=$j("<span></span>",{"class":"bookacti-available-places-avail-particle",html:n}),r.append(h),r.append(n),f.append(r),d.trigger("bookacti_choose_group_dialog_group_number_of_bookings_div",[f,0,"",b,c,m])):(c=1===m?bookacti_localized.avail:bookacti_localized.avails,!h&&0<m&&bookacti_localized.not_bookable&&
"{current}"!==bookacti_localized.not_bookable&&(n="",c=bookacti_localized.not_bookable),h=$j("<span></span>",{"class":"bookacti-available-places-number",html:n}),n=$j("<span></span>",{"class":"bookacti-available-places-avail-particle",html:c}),r.append(h),r.append(n),f.append(r),d.trigger("bookacti_choose_group_dialog_group_availability_div",[f,0,"",b,m]));m={html:bookacti_localized.single_event+f[0].outerHTML,"for":"bookacti-group-of-events-single"};d.trigger("bookacti_choose_group_dialog_group_label",
[m,0,"",b]);m=$j("<label></label>",m);h=$j("<ul></ul>",{id:"bookacti-group-of-events-list-single","class":"bookacti-group-of-events-list bookacti-custom-scrollbar","data-group-id":0,"data-group-date":""});c=bookacti_format_event_duration(b.start,b.end);c={title:"undefined"!==typeof b.title?b.title:"",duration:c,quantity:1};d.trigger("bookacti_group_of_events_list_data",[c,b]);c={html:'<span class="bookacti-booking-event-duration" >'+c.duration+'</span><span class="bookacti-booking-event-title-separator" > - </span><span class="bookacti-booking-event-title" >'+
c.title+"</span>"};d.trigger("bookacti_group_of_events_list_element_data",[c,b]);c=$j("<li></li>",c);w.append(J);w.append(m);v.append(w);h.append(c);v.append(h);z.append(v)}$j.each(S,function(a,A){if("undefined"===typeof e.groups_data[a])return!0;var x=e.groups_data[a],H=parseInt(x.category_id),p=e.group_categories_data[H].settings,V=parseInt(bookacti_localized.started_groups_bookable);"undefined"!==typeof p.started_groups_bookable&&0<=$j.inArray(p.started_groups_bookable,[0,1,"0","1",!0,!1])&&(V=
$j.isNumeric(p.started_groups_bookable)?parseInt(p.started_groups_bookable):p.started_groups_bookable?1:0);$j.each(A,function(k,O){var g,B,y,D,q;var l=g=B=y=D=q=0;"undefined"!==typeof e.groups_bookings[a]&&"undefined"!==typeof e.groups_bookings[a][k]&&(l=e.groups_bookings[a][k]?.is_available,g=e.groups_bookings[a][k]?.availability,B=e.groups_bookings[a][k]?.quantity,y=e.groups_bookings[a][k]?.current_user_bookings,D=e.groups_bookings[a][k]?.distinct_users,q=e.groups_bookings[a][k]?.total_availability);
l=l&&0<g;var I=moment.utc(O[0].start).clone(),u=moment.utc(O[O.length-1].end).clone();T||!I.isBefore(M)||V&&u.isAfter(M)||(l=!1);if(l){I=l=!1;("undefined"===typeof p.min_bookings_per_user?0:p.min_bookings_per_user?parseInt(p.min_bookings_per_user):0)<=g&&0<g&&(I=!0);u="undefined"===typeof p.max_users_per_event?0:p.max_users_per_event?parseInt(p.max_users_per_event):0;var E="undefined"===typeof p.max_bookings_per_user?0:p.max_bookings_per_user?parseInt(p.max_bookings_per_user):0,t=max_users_ok=!0;
if(E||u)y=parseInt(y),u&&0===y&&parseInt(D)>=u&&(max_users_ok=!1),E&&y>=E&&(t=!1);I&&t&&max_users_ok&&(l=!0)}D=$j("<div></div>",{});y=$j("<div></div>",{id:"bookacti-group-of-events-option-"+a+"_"+k,"class":"bookacti-group-of-events-option","data-group-id":a,"data-group-date":k,"data-show-events":0});I=$j("<input />",{id:"bookacti-group-of-events-"+a+"_"+k,type:"radio",name:"group_of_events",disabled:!G&&!l,value:a+"_"+k});E=!l&&0<g&&"{current}"!==bookacti_localized.not_bookable?0:g;u=B;t="";var P=
q?parseInt(g/q*100):0;q=parseInt(bookacti.booking_system[C].hide_availability);var L=parseInt(bookacti_localized.hide_availability_fixed);P=100>q&&P>q;var W=0<L&&g>L;!G&&(0>=L&&P||100<=q&&W||P&&W)&&(E="",t="bookacti-hide-availability");L=(0<B?" bookacti-booked":" bookacti-not-booked")+(0>=g?" bookacti-full":"")+(!l&&0<g?" bookacti-not-bookable":"");q=$j("<div></div>",{"class":"bookacti-group-availability-container "+t});t=$j("<div></div>",{"class":"bookacti-available-places "+L});G?(l=1===B?bookacti_localized.booking:
bookacti_localized.bookings,B=$j("<span></span>",{"class":"bookacti-active-bookings-number",html:u}),l=$j("<span></span>",{"class":"bookacti-available-places-avail-particle",html:l}),t.append(B),t.append(l),q.append(t),d.trigger("bookacti_choose_group_dialog_group_number_of_bookings_div",[q,a,k,b,u,g])):(u=1===g?bookacti_localized.avail:bookacti_localized.avails,!l&&0<g&&bookacti_localized.not_bookable&&"{current}"!==bookacti_localized.not_bookable&&(E="",u=bookacti_localized.not_bookable),B=$j("<span></span>",
{"class":"bookacti-available-places-number",html:E}),l=$j("<span></span>",{"class":"bookacti-available-places-avail-particle",html:u}),t.append(B),t.append(l),q.append(t),d.trigger("bookacti_choose_group_dialog_group_availability_div",[q,a,k,b,g]));g={html:x.title+q[0].outerHTML,"for":"bookacti-group-of-events-"+a+"_"+k};d.trigger("bookacti_choose_group_dialog_group_label",[g,a,k,b]);g=$j("<label></label>",g);var X=$j("<ul></ul>",{id:"bookacti-group-of-events-list-"+a+"_"+k,"class":"bookacti-group-of-events-list bookacti-custom-scrollbar",
"data-group-id":a,"data-group-date":k});$j.each(O,function(Y,F){Y=F.start.substr(0,10)===F.end.substr(0,10);var Z=moment.utc(F.start).locale(bookacti_localized.current_lang_code),aa=moment.utc(F.end).locale(bookacti_localized.current_lang_code),ba=Z.formatPHP(bookacti_localized.date_format)+bookacti_localized.dates_separator+aa.formatPHP(bookacti_localized.date_format);Y&&(ba=Z.formatPHP(bookacti_localized.date_format)+bookacti_localized.date_time_separator+aa.formatPHP(bookacti_localized.time_format));
F=$j("<li></li>",{html:'<span class="bookacti-booking-event-duration" >'+ba+'</span><span class="bookacti-booking-event-title-separator" > - </span><span class="bookacti-booking-event-title" >'+F.title+"</span>"});X.append(F)});y.append(I);y.append(g);D.append(y);D.append(X);z.append(D)})});z.find('input[name="group_of_events"]').on("change",function(){var a=$j(this).val(),A="single"!==a?parseInt(a.substr(0,a.indexOf("_"))):0,x="single"!==a?a.substr(a.indexOf("_")+1):"",H=$j("#"+C+"-choose-group-of-events-dialog .bookacti-groups-of-events-list");
H.find(".bookacti-group-of-events-option:not(#bookacti-group-of-events-option-"+a+")").data("show-events",0).attr("data-show-events",0);H.find(".bookacti-group-of-events-list:not(#bookacti-group-of-events-list-"+a+")").hide(200);H.find("#bookacti-group-of-events-option-"+a).data("show-events",1).attr("data-show-events",1);H.find("#bookacti-group-of-events-list-"+a).show(200);a={click:!0};$j(this).is(":disabled")&&(a.click=!1);d.trigger("bookacti_trigger_group_of_events_preview",[a,A,x,b]);a.click&&
(R?bookacti_unpick_events(d,b):bookacti_unpick_all_events(d),bookacti_pick_events(d,b,A,x),d.trigger("bookacti_group_of_events_preview",[A,x,b]))});z.find('input[name="group_of_events"]:not([disabled]):first').prop("checked",!0).trigger("change");d.find(".fc-toolbar button:focus").blur();Q.dialog({beforeClose:function(){},close:function(){"undefined"!==typeof z.find('input[type="radio"]:checked').val()||R||bookacti_unpick_all_events(d)}});Q.dialog("option","buttons",[{text:bookacti_localized.dialog_button_ok,
click:function(){var a=z.find('input[type="radio"]:checked').val();if("undefined"!==typeof a){var A={click:!0};z.find('input[type="radio"]:checked').is(":disabled")&&(A.click=!1);var x="single"!==a?parseInt(a.substr(0,a.indexOf("_"))):0;a="single"!==a?a.substr(a.indexOf("_")+1):"";d.trigger("bookacti_trigger_group_of_events_click",[A,x,a,b]);A.click&&(R?bookacti_unpick_events(d,b):bookacti_unpick_all_events(d),bookacti_pick_events(d,b,x,a),d.trigger("bookacti_group_of_events_chosen",[x,a,b]))}$j(this).dialog("close")}}]);
Q.dialog("open")};
