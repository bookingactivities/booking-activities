$j(document).ready(function(){$j("body").on("click",".ui-widget-overlay",function(){$j("div:ui-dialog:visible").dialog("close")});$j("body").on("keydown",".bookacti-booking-system-dialog",function(a){if(!$j("textarea").is(":focus")&&a.keyCode==$j.ui.keyCode.ENTER){$j(this).parent().find(".ui-dialog-buttonpane button:first").focus();return false}})});function bookacti_init_booking_system_dialogs(){$j(".bookacti-booking-system-dialog").dialog({modal:true,autoOpen:false,minHeight:300,minWidth:400,resize:"auto",show:true,hide:true,dialogClass:"bookacti-dialog",closeText:"&#10006;",close:function(){}})}function bookacti_dialog_choose_group_of_events(A,F,O){var G=A.attr("id");var J=$j("#"+G+"-choose-group-of-events-dialog");var h=$j("#"+G+"-groups-of-events-list");var D=bookacti.booking_system[G];var d=D.multiple_bookings;var p=D.bookings_only;var H=D.past_events;var x=D.past_events_bookable;var s=moment.utc(bookacti_localized.current_time);h.data("booking-system-id",G);h.empty();if(D.groups_single_events){var m="single";var u="";if(p){var r=bookacti_get_bookings_number_for_a_single_grouped_event(A,O,F);var f=r===1?bookacti_localized.booking:bookacti_localized.bookings;u=r+" "+f}else{var j=bookacti_get_event_availability(A,O);var l=j===1?bookacti_localized.avail:bookacti_localized.avails;u=j+" "+l}var g=true;if(H){var c=moment.utc(O.start).clone();var L=moment.utc(O.end).clone();if(!x&&c.isBefore(s)&&!(bookacti_localized.started_events_bookable&&L.isAfter(s))){g=false}}if(g&&typeof D.events_data[O.id]!=="undefined"){g=false;var e=false;var y=parseInt(D.events_data[O.id]["activity_id"]);var N=D.activities_data[y]["settings"];var n=typeof N.min_bookings_per_user==="undefined"?0:(N.min_bookings_per_user?parseInt(N.min_bookings_per_user):0);if(n<=j){e=true}var q=max_users_ok=true;var K=typeof N.max_bookings_per_user==="undefined"?0:(N.max_bookings_per_user?parseInt(N.max_bookings_per_user):0);var o=typeof N.max_users_per_event==="undefined"?0:(N.max_users_per_event?parseInt(N.max_users_per_event):0);if(K||o){var C=moment.utc(O.start).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");if(typeof D.bookings[O.id]!=="undefined"){if(typeof D.bookings[O.id][C]!=="undefined"){var k=D.bookings[O.id][C];var M=parseInt(k.current_user_bookings);if(o&&M===0&&parseInt(k.distinct_users)>=o){max_users_ok=false}if(K&&M>=K){q=false}}}}if(e&&q&&max_users_ok){g=true}}var z=$j("<div></div>",{});var w=$j("<div></div>",{"class":"bookacti-group-of-events-option","data-group-id":m,"data-show-events":0});var v=$j("<input />",{id:"bookacti-group-of-events-"+m,type:"radio",name:"group_of_events",value:m,disabled:!p&&!g});var b={html:bookacti_localized.single_event+' <span class="bookacti-group-availability" >('+u+")</span>","for":"bookacti-group-of-events-"+m};A.trigger("bookacti_choose_group_dialog_group_label",[b,"single",O]);var E=$j("<label></label>",b);var B=$j("<ul></ul>",{"class":"bookacti-group-of-events-list bookacti-custom-scrollbar","data-group-id":m});var I=bookacti_format_event_duration(O.start,O.end);var i={title:O.title,duration:I,quantity:1};A.trigger("bookacti_group_of_events_list_data",[i,O]);var t={html:'<span class="bookacti-booking-event-duration" >'+i.duration+'</span><span class="bookacti-booking-event-title-separator" > - </span><span class="bookacti-booking-event-title" >'+i.title+"</span>"};A.trigger("bookacti_group_of_events_list_element_data",[t,O]);var a=$j("<li></li>",t);w.append(v);w.append(E);z.append(w);B.append(a);z.append(B);h.append(z)}$j.each(F,function(aj,ah){ah=parseInt(ah);if(typeof D.groups_events[ah]!=="undefined"&&typeof D.groups_data[ah]!=="undefined"){var X=D.groups_data[ah];var Z=X.availability;var Q=parseInt(X.category_id);var al=D.group_categories_data[Q]["settings"];var af=bookacti_localized.started_groups_bookable;if(typeof al.started_groups_bookable!=="undefined"){if($j.inArray(al.started_groups_bookable,[0,1,"0","1",true,false])>=0){af=parseInt(al.started_groups_bookable)}}var aa=true;var ak=moment.utc(X.start).clone();var ag=moment.utc(X.end).clone();if(!x&&ak.isBefore(s)&&!(af&&ag.isAfter(s))){aa=false}if(aa){aa=false;var ao=false;var an=typeof al.min_bookings_per_user==="undefined"?0:(al.min_bookings_per_user?parseInt(al.min_bookings_per_user):0);if(an<=Z&&Z>0){ao=true}var U=typeof al.max_users_per_event==="undefined"?0:(al.max_users_per_event?parseInt(al.max_users_per_event):0);var S=typeof al.max_bookings_per_user==="undefined"?0:(al.max_bookings_per_user?parseInt(al.max_bookings_per_user):0);var ae=max_users_ok=true;if(S||U){var ai=parseInt(X.current_user_bookings);if(U&&ai===0&&parseInt(X.distinct_users)>=U){max_users_ok=false}if(S&&ai>=S){ae=false}}if(ao&&ae&&max_users_ok){aa=true}}var ab=$j("<div></div>",{});var V=$j("<div></div>",{"class":"bookacti-group-of-events-option","data-group-id":ah,"data-show-events":0});var Y=$j("<input />",{id:"bookacti-group-of-events-"+ah,type:"radio",name:"group_of_events",disabled:!p&&!aa,value:ah});var am="";if(p){var R=0;$j.each(D.groups_events[ah],function(ar,aq){var ap=moment.utc(O.start).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");var at=moment.utc(O.end).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");if(O.id==aq.id&&ap===aq.start&&at===aq.end){R=aq.group_bookings}});var ad=R===1?bookacti_localized.booking:bookacti_localized.bookings;am=R+" "+ad}else{var ac=Z===1?bookacti_localized.avail:bookacti_localized.avails;am=Z+" "+ac}var P={html:D.groups_data[ah]["title"]+' <span class="bookacti-group-availability" >('+am+")</span>","for":"bookacti-group-of-events-"+ah};A.trigger("bookacti_choose_group_dialog_group_label",[P,ah,O]);var W=$j("<label></label>",P);var T=$j("<ul></ul>",{"class":"bookacti-group-of-events-list bookacti-custom-scrollbar","data-group-id":ah});$j.each(D.groups_events[ah],function(au,at){var ar=at.start.substr(0,10)===at.end.substr(0,10);var aq=moment.utc(at.start).locale(bookacti_localized.current_lang_code);var ap=moment.utc(at.end).locale(bookacti_localized.current_lang_code);var av=aq.formatPHP(bookacti_localized.date_format)+bookacti_localized.dates_separator+ap.formatPHP(bookacti_localized.date_format);if(ar){av=aq.formatPHP(bookacti_localized.date_format)+bookacti_localized.date_time_separator+ap.formatPHP(bookacti_localized.time_format)}var aw=$j("<li></li>",{html:'<span class="bookacti-booking-event-duration" >'+av+'</span><span class="bookacti-booking-event-title-separator" > - </span><span class="bookacti-booking-event-title" >'+at.title+"</span>"});T.append(aw)});V.append(Y);V.append(W);ab.append(V);ab.append(T);h.append(ab)}});h.find('input[name="group_of_events"]').on("change",function(){var R=$j(this).val();var S=$j("#"+G+"-choose-group-of-events-dialog .bookacti-groups-of-events-list");S.find('.bookacti-group-of-events-option[data-group-id!="'+R+'"]').data("show-events",0).attr("data-show-events",0);S.find('.bookacti-group-of-events-list[data-group-id!="'+R+'"]').hide(200);S.find('.bookacti-group-of-events-option[data-group-id="'+R+'"]').data("show-events",1).attr("data-show-events",1);S.find('.bookacti-group-of-events-list[data-group-id="'+R+'"]').show(200);var Q={click:true};if($j(this).is(":disabled")){Q.click=false}A.trigger("bookacti_trigger_group_of_events_preview",[Q,R,O]);if(Q.click){if(d){var T=bookacti_is_event_picked(A,O);if(T){var P=T.group_id?T.group_id:"single";bookacti_unpick_events_of_group(A,P,O)}}if(d){bookacti_unpick_events_of_group(A,R)}else{bookacti_unpick_all_events(A)}bookacti_pick_events_of_group(A,R,O);A.trigger("bookacti_group_of_events_preview",[R,O])}});h.find('input[name="group_of_events"]:not([disabled]):first').prop("checked",true).trigger("change");J.dialog("open");J.dialog({close:function(){var P=h.find('input[type="radio"]:checked').val();if(typeof P==="undefined"&&!d){bookacti_unpick_all_events(A)}}});J.dialog("option","buttons",[{text:bookacti_localized.dialog_button_ok,click:function(){var R=h.find('input[type="radio"]:checked').val();if(typeof R!=="undefined"){var Q={click:true};if(h.find('input[type="radio"]:checked').is(":disabled")){Q.click=false}A.trigger("bookacti_trigger_group_of_events_click",[Q,R,O]);if(Q.click){if(d){var S=bookacti_is_event_picked(A,O);if(S){var P=S.group_id?S.group_id:"single";bookacti_unpick_events_of_group(A,P,O)}}if(d){bookacti_unpick_events_of_group(A,R)}else{bookacti_unpick_all_events(A)}bookacti_pick_events_of_group(A,R,O);A.trigger("bookacti_group_of_events_chosen",[R,O])}}$j(this).dialog("close")}}])};