$j(document).ready(function(){$j("body").on("click",".ui-widget-overlay",function(){$j("div:ui-dialog:visible").dialog("close")});$j("body").on("keydown",".bookacti-booking-system-dialog",function(a){if(!$j("textarea").is(":focus")&&a.keyCode==$j.ui.keyCode.ENTER){$j(this).parent().find(".ui-dialog-buttonpane button:first").focus();return false}})});function bookacti_init_booking_system_dialogs(){$j(".bookacti-booking-system-dialog").dialog({modal:true,autoOpen:false,minHeight:300,minWidth:400,resize:"auto",show:true,hide:true,dialogClass:"bookacti-dialog",closeText:"&#10006;",close:function(){}})}function bookacti_dialog_choose_group_of_events(z,E,N){var F=z.attr("id");var I=$j("#"+F+"-choose-group-of-events-dialog");var g=$j("#"+F+"-groups-of-events-list");var C=bookacti.booking_system[F];var o=C.bookings_only;var G=C.past_events;var w=C.past_events_bookable;var r=moment.utc(bookacti_localized.current_time);g.data("booking-system-id",F);g.empty();if(C.groups_single_events){var l="single";var t="";if(o){var q=bookacti_get_bookings_number_for_a_single_grouped_event(z,N,E);var e=q===1?bookacti_localized.booking:bookacti_localized.bookings;t=q+" "+e}else{var i=bookacti_get_event_availability(z,N);var k=i===1?bookacti_localized.avail:bookacti_localized.avails;t=i+" "+k}var f=true;if(G){var c=moment.utc(N.start).clone();var K=moment.utc(N.end).clone();if(!w&&c.isBefore(r)&&!(bookacti_localized.started_events_bookable&&K.isAfter(r))){f=false}}if(f&&typeof C.events_data[N.id]!=="undefined"){f=false;var d=false;var x=parseInt(C.events_data[N.id]["activity_id"]);var M=C.activities_data[x]["settings"];var m=typeof M.min_bookings_per_user==="undefined"?0:(M.min_bookings_per_user?parseInt(M.min_bookings_per_user):0);if(m<=i){d=true}var p=max_users_ok=true;var J=typeof M.max_bookings_per_user==="undefined"?0:(M.max_bookings_per_user?parseInt(M.max_bookings_per_user):0);var n=typeof M.max_users_per_event==="undefined"?0:(M.max_users_per_event?parseInt(M.max_users_per_event):0);if(J||n){var B=moment.utc(N.start).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");if(typeof C.bookings[N.id]!=="undefined"){if(typeof C.bookings[N.id][B]!=="undefined"){var j=C.bookings[N.id][B];var L=parseInt(j.current_user_bookings);if(n&&L===0&&parseInt(j.distinct_users)>=n){max_users_ok=false}if(J&&L>=J){p=false}}}}if(d&&p&&max_users_ok){f=true}}var y=$j("<div></div>",{});var v=$j("<div></div>",{"class":"bookacti-group-of-events-option","data-group-id":l,"data-show-events":0});var u=$j("<input />",{id:"bookacti-group-of-events-"+l,type:"radio",name:"group_of_events",value:l,disabled:!o&&!f});var b={html:bookacti_localized.single_event+' <span class="bookacti-group-availability" >('+t+")</span>","for":"bookacti-group-of-events-"+l};z.trigger("bookacti_choose_group_dialog_group_label",[b,"single",N]);var D=$j("<label></label>",b);var A=$j("<ul></ul>",{"class":"bookacti-group-of-events-list bookacti-custom-scrollbar","data-group-id":l});var H=bookacti_format_event_duration(N.start,N.end);var h={title:N.title,duration:H,quantity:1};z.trigger("bookacti_group_of_events_list_data",[h,N]);var s={html:'<span class="bookacti-booking-event-duration" >'+h.duration+'</span><span class="bookacti-booking-event-title-separator" > - </span><span class="bookacti-booking-event-title" >'+h.title+"</span>"};z.trigger("bookacti_group_of_events_list_element_data",[s,N]);var a=$j("<li></li>",s);v.append(u);v.append(D);y.append(v);A.append(a);y.append(A);g.append(y)}$j.each(E,function(ai,ag){ag=parseInt(ag);if(typeof C.groups_events[ag]!=="undefined"&&typeof C.groups_data[ag]!=="undefined"){var W=C.groups_data[ag];var Y=W.availability;var P=parseInt(W.category_id);var ak=C.group_categories_data[P]["settings"];var ae=bookacti_localized.started_groups_bookable;if(typeof ak.started_groups_bookable!=="undefined"){if($j.inArray(ak.started_groups_bookable,[0,1,"0","1",true,false])>=0){ae=parseInt(ak.started_groups_bookable)}}var Z=true;var aj=moment.utc(W.start).clone();var af=moment.utc(W.end).clone();if(!w&&aj.isBefore(r)&&!(ae&&af.isAfter(r))){Z=false}if(Z){Z=false;var an=false;var am=typeof ak.min_bookings_per_user==="undefined"?0:(ak.min_bookings_per_user?parseInt(ak.min_bookings_per_user):0);if(am<=Y&&Y>0){an=true}var T=typeof ak.max_users_per_event==="undefined"?0:(ak.max_users_per_event?parseInt(ak.max_users_per_event):0);var R=typeof ak.max_bookings_per_user==="undefined"?0:(ak.max_bookings_per_user?parseInt(ak.max_bookings_per_user):0);var ad=max_users_ok=true;if(R||T){var ah=parseInt(W.current_user_bookings);if(T&&ah===0&&parseInt(W.distinct_users)>=T){max_users_ok=false}if(R&&ah>=R){ad=false}}if(an&&ad&&max_users_ok){Z=true}}var aa=$j("<div></div>",{});var U=$j("<div></div>",{"class":"bookacti-group-of-events-option","data-group-id":ag,"data-show-events":0});var X=$j("<input />",{id:"bookacti-group-of-events-"+ag,type:"radio",name:"group_of_events",disabled:!o&&!Z,value:ag});var al="";if(o){var Q=0;$j.each(C.groups_events[ag],function(aq,ap){var ao=moment.utc(N.start).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");var ar=moment.utc(N.end).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");if(N.id==ap.id&&ao===ap.start&&ar===ap.end){Q=ap.group_bookings}});var ac=Q===1?bookacti_localized.booking:bookacti_localized.bookings;al=Q+" "+ac}else{var ab=Y===1?bookacti_localized.avail:bookacti_localized.avails;al=Y+" "+ab}var O={html:C.groups_data[ag]["title"]+' <span class="bookacti-group-availability" >('+al+")</span>","for":"bookacti-group-of-events-"+ag};z.trigger("bookacti_choose_group_dialog_group_label",[O,ag,N]);var V=$j("<label></label>",O);var S=$j("<ul></ul>",{"class":"bookacti-group-of-events-list bookacti-custom-scrollbar","data-group-id":ag});$j.each(C.groups_events[ag],function(at,ar){var aq=ar.start.substr(0,10)===ar.end.substr(0,10);var ap=moment.utc(ar.start).locale(bookacti_localized.current_lang_code);var ao=moment.utc(ar.end).locale(bookacti_localized.current_lang_code);var au=ap.formatPHP(bookacti_localized.date_format)+bookacti_localized.dates_separator+ao.formatPHP(bookacti_localized.date_format);if(aq){au=ap.formatPHP(bookacti_localized.date_format)+bookacti_localized.date_time_separator+ao.formatPHP(bookacti_localized.time_format)}var av=$j("<li></li>",{html:'<span class="bookacti-booking-event-duration" >'+au+'</span><span class="bookacti-booking-event-title-separator" > - </span><span class="bookacti-booking-event-title" >'+ar.title+"</span>"});S.append(av)});U.append(X);U.append(V);aa.append(U);aa.append(S);g.append(aa)}});g.find('input[name="group_of_events"]').on("change",function(){var R=$j(this).val();var S=$j("#"+F+"-choose-group-of-events-dialog .bookacti-groups-of-events-list");S.find('.bookacti-group-of-events-option[data-group-id!="'+R+'"]').data("show-events",0).attr("data-show-events",0);S.find('.bookacti-group-of-events-list[data-group-id!="'+R+'"]').hide(200);S.find('.bookacti-group-of-events-option[data-group-id="'+R+'"]').data("show-events",1).attr("data-show-events",1);S.find('.bookacti-group-of-events-list[data-group-id="'+R+'"]').show(200);var P={click:true};if($j(this).is(":disabled")){P.click=false}z.trigger("bookacti_trigger_group_of_events_preview",[P,R,N]);if(P.click){var Q=bookacti.booking_system[F]["multiple_bookings"];if(Q){var T=bookacti_is_event_picked(z,N);if(T){var O=T.group_id?T.group_id:"single";bookacti_unpick_events_of_group(z,O,N)}}if(Q){bookacti_unpick_events_of_group(z,R)}else{bookacti_unpick_all_events(z)}bookacti_pick_events_of_group(z,R,N);z.trigger("bookacti_group_of_events_preview",[R,N])}});g.find('input[name="group_of_events"]:not([disabled]):first').prop("checked",true).trigger("change");I.dialog("open");I.dialog({close:function(){var O=g.find('input[type="radio"]:checked').val();if(typeof O==="undefined"){bookacti_unpick_all_events(z)}}});I.dialog("option","buttons",[{text:bookacti_localized.dialog_button_ok,click:function(){var R=g.find('input[type="radio"]:checked').val();if(typeof R!=="undefined"){var P={click:true};if(g.find('input[type="radio"]:checked').is(":disabled")){P.click=false}z.trigger("bookacti_trigger_group_of_events_click",[P,R,N]);if(P.click){var Q=bookacti.booking_system[F]["multiple_bookings"];if(Q){var S=bookacti_is_event_picked(z,N);if(S){var O=S.group_id?S.group_id:"single";bookacti_unpick_events_of_group(z,O,N)}}if(Q){bookacti_unpick_events_of_group(z,R)}else{bookacti_unpick_all_events(z)}bookacti_pick_events_of_group(z,R,N);z.trigger("bookacti_group_of_events_chosen",[R,N])}}$j(this).dialog("close")}}])};