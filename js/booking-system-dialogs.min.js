$j(document).ready(function(){$j("body").on("click",".ui-widget-overlay",function(){$j("div:ui-dialog:visible").dialog("close")});$j("body").on("keydown",".bookacti-booking-system-dialog",function(a){if(!$j("textarea").is(":focus")&&a.keyCode==$j.ui.keyCode.ENTER){$j(this).parent().find(".ui-dialog-buttonpane button:first").focus();return false}})});function bookacti_init_booking_system_dialogs(){$j(".bookacti-booking-system-dialog").dialog({modal:true,autoOpen:false,minHeight:300,minWidth:400,resize:"auto",show:true,hide:true,dialogClass:"bookacti-dialog",closeText:"&#10006;",close:function(){}})}function bookacti_dialog_choose_group_of_events(z,D,M){var E=z.attr("id");var H=$j("#"+E+"-choose-group-of-events-dialog");var g=$j("#"+E+"-groups-of-events-list");var o=bookacti.booking_system[E]["bookings_only"];var F=bookacti.booking_system[E]["past_events"];var w=bookacti.booking_system[E]["past_events_bookable"];var r=moment.utc(bookacti_localized.current_time);g.data("booking-system-id",E);g.empty();if(bookacti.booking_system[E]["groups_single_events"]){var l="single";var t="";if(o){var q=bookacti_get_bookings_number_for_a_single_grouped_event(z,M,D);var e=q===1?bookacti_localized.booking:bookacti_localized.bookings;t=q+" "+e}else{var i=bookacti_get_event_availability(z,M);var k=i===1?bookacti_localized.avail:bookacti_localized.avails;t=i+" "+k}var f=true;if(F){var c=moment.utc(M.start).clone();var J=moment.utc(M.end).clone();if(!w&&c.isBefore(r)&&!(bookacti_localized.started_events_bookable&&J.isAfter(r))){f=false}}if(f&&typeof bookacti.booking_system[E]["events_data"][M.id]!=="undefined"){f=false;var d=false;var x=parseInt(bookacti.booking_system[E]["events_data"][M.id]["activity_id"]);var L=bookacti.booking_system[E]["activities_data"][x]["settings"];var m=typeof L.min_bookings_per_user==="undefined"?0:(L.min_bookings_per_user?parseInt(L.min_bookings_per_user):0);if(m<=i){d=true}var p=max_users_ok=true;var I=typeof L.max_bookings_per_user==="undefined"?0:(L.max_bookings_per_user?parseInt(L.max_bookings_per_user):0);var n=typeof L.max_users_per_event==="undefined"?0:(L.max_users_per_event?parseInt(L.max_users_per_event):0);if(I||n){var A=moment.utc(M.start).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");if(typeof bookacti.booking_system[E]["bookings"][M.id]!=="undefined"){if(typeof bookacti.booking_system[E]["bookings"][M.id][A]!=="undefined"){var j=bookacti.booking_system[E]["bookings"][M.id][A];var K=parseInt(j.current_user_bookings);if(n&&K===0&&parseInt(j.distinct_users)>=n){max_users_ok=false}if(I&&K>=I){p=false}}}}if(d&&p&&max_users_ok){f=true}}var y=$j("<div></div>",{});var v=$j("<div></div>",{"class":"bookacti-group-of-events-option","data-group-id":l,"data-show-events":0});var u=$j("<input />",{id:"bookacti-group-of-events-"+l,type:"radio",name:"group_of_events",value:l,disabled:!o&&!f});var b={html:bookacti_localized.single_event+' <span class="bookacti-group-availability" >('+t+")</span>","for":"bookacti-group-of-events-"+l};z.trigger("bookacti_choose_group_dialog_group_label",[b,"single",M]);var C=$j("<label></label>",b);var B=$j("<ul></ul>",{"class":"bookacti-group-of-events-list bookacti-custom-scrollbar","data-group-id":l});var G=bookacti_format_event_duration(M.start,M.end);var h={title:M.title,duration:G,quantity:1};z.trigger("bookacti_group_of_events_list_data",[h,M]);var s={html:'<span class="bookacti-booking-event-duration" >'+h.duration+'</span><span class="bookacti-booking-event-title-separator" > - </span><span class="bookacti-booking-event-title" >'+h.title+"</span>"};z.trigger("bookacti_group_of_events_list_element_data",[s,M]);var a=$j("<li></li>",s);v.append(u);v.append(C);y.append(v);B.append(a);y.append(B);g.append(y)}$j.each(D,function(ah,af){af=parseInt(af);if(typeof bookacti.booking_system[E]["groups_events"][af]!=="undefined"&&typeof bookacti.booking_system[E]["groups_data"][af]!=="undefined"){var V=bookacti.booking_system[E]["groups_data"][af];var X=V.availability;var O=parseInt(V.category_id);var aj=bookacti.booking_system[E]["group_categories_data"][O]["settings"];var ad=bookacti_localized.started_groups_bookable;if(typeof aj.started_groups_bookable!=="undefined"){if($j.inArray(aj.started_groups_bookable,[0,1,"0","1",true,false])>=0){ad=parseInt(aj.started_groups_bookable)}}var Y=true;var ai=moment.utc(V.start).clone();var ae=moment.utc(V.end).clone();if(!w&&ai.isBefore(r)&&!(ad&&ae.isAfter(r))){Y=false}if(Y){Y=false;var am=false;var al=typeof aj.min_bookings_per_user==="undefined"?0:(aj.min_bookings_per_user?parseInt(aj.min_bookings_per_user):0);if(al<=X&&X>0){am=true}var S=typeof aj.max_users_per_event==="undefined"?0:(aj.max_users_per_event?parseInt(aj.max_users_per_event):0);var Q=typeof aj.max_bookings_per_user==="undefined"?0:(aj.max_bookings_per_user?parseInt(aj.max_bookings_per_user):0);var ac=max_users_ok=true;if(Q||S){var ag=parseInt(V.current_user_bookings);if(S&&ag===0&&parseInt(V.distinct_users)>=S){max_users_ok=false}if(Q&&ag>=Q){ac=false}}if(am&&ac&&max_users_ok){Y=true}}var Z=$j("<div></div>",{});var T=$j("<div></div>",{"class":"bookacti-group-of-events-option","data-group-id":af,"data-show-events":0});var W=$j("<input />",{id:"bookacti-group-of-events-"+af,type:"radio",name:"group_of_events",disabled:!o&&!Y,value:af});var ak="";if(o){var P=0;$j.each(bookacti.booking_system[E]["groups_events"][af],function(ap,ao){var an=moment.utc(M.start).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");var aq=moment.utc(M.end).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");if(M.id==ao.id&&an===ao.start&&aq===ao.end){P=ao.group_bookings}});var ab=P===1?bookacti_localized.booking:bookacti_localized.bookings;ak=P+" "+ab}else{var aa=X===1?bookacti_localized.avail:bookacti_localized.avails;ak=X+" "+aa}var N={html:bookacti.booking_system[E]["groups_data"][af]["title"]+' <span class="bookacti-group-availability" >('+ak+")</span>","for":"bookacti-group-of-events-"+af};z.trigger("bookacti_choose_group_dialog_group_label",[N,af,M]);var U=$j("<label></label>",N);var R=$j("<ul></ul>",{"class":"bookacti-group-of-events-list bookacti-custom-scrollbar","data-group-id":af});$j.each(bookacti.booking_system[E]["groups_events"][af],function(ar,aq){var ap=aq.start.substr(0,10)===aq.end.substr(0,10);var ao=moment.utc(aq.start).locale(bookacti_localized.current_lang_code);var an=moment.utc(aq.end).locale(bookacti_localized.current_lang_code);var at=ao.formatPHP(bookacti_localized.date_format)+bookacti_localized.dates_separator+an.formatPHP(bookacti_localized.date_format);if(ap){at=ao.formatPHP(bookacti_localized.date_format)+bookacti_localized.date_time_separator+an.formatPHP(bookacti_localized.time_format)}var au=$j("<li></li>",{html:'<span class="bookacti-booking-event-duration" >'+at+'</span><span class="bookacti-booking-event-title-separator" > - </span><span class="bookacti-booking-event-title" >'+aq.title+"</span>"});R.append(au)});T.append(W);T.append(U);Z.append(T);Z.append(R);g.append(Z)}});g.find('input[name="group_of_events"]').on("change",function(){var O=$j(this).val();var P=$j("#"+E+"-choose-group-of-events-dialog .bookacti-groups-of-events-list");P.find('.bookacti-group-of-events-option[data-group-id!="'+O+'"]').data("show-events",0).attr("data-show-events",0);P.find('.bookacti-group-of-events-list[data-group-id!="'+O+'"]').hide(200);P.find('.bookacti-group-of-events-option[data-group-id="'+O+'"]').data("show-events",1).attr("data-show-events",1);P.find('.bookacti-group-of-events-list[data-group-id="'+O+'"]').show(200);var N={click:true};if($j(this).is(":disabled")){N.click=false}z.trigger("bookacti_trigger_group_of_events_preview",[N,O,M]);if(N.click){bookacti_unpick_all_events(z);bookacti_pick_events_of_group(z,O,M);z.trigger("bookacti_group_of_events_preview",[O,M])}});g.find('input[name="group_of_events"]:not([disabled]):first').prop("checked",true).trigger("change");H.dialog("open");H.dialog({close:function(){var N=g.find('input[type="radio"]:checked').val();if(typeof N==="undefined"){bookacti_unpick_all_events(z)}}});H.dialog("option","buttons",[{text:bookacti_localized.dialog_button_ok,click:function(){var O=g.find('input[type="radio"]:checked').val();if(typeof O!=="undefined"){var N={click:true};if(g.find('input[type="radio"]:checked').is(":disabled")){N.click=false}z.trigger("bookacti_trigger_group_of_events_click",[N,O,M]);if(N.click){bookacti_unpick_all_events(z);bookacti_pick_events_of_group(z,O,M);z.trigger("bookacti_group_of_events_chosen",[O,M])}}$j(this).dialog("close")}}])};