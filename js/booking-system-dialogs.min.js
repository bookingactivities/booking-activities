function bookacti_dialog_choose_group_of_events(e,L,b){var C=e.attr("id"),I=$j("#"+C+"-choose-group-of-events-dialog"),v=$j("#"+C+"-groups-of-events-list"),d=bookacti.booking_system[C],J=d.multiple_bookings,F=d.bookings_only,p=d.past_events,M=d.past_events_bookable,G=moment.utc(bookacti_localized.current_time);v.data("booking-system-id",C);v.empty();if(d.groups_single_events){var l=bookacti_get_event_availability(e,b),m=!0;"undefined"!==typeof b.is_available&&(b.is_available||(m=!1));"undefined"!==
typeof b.extendedProps&&"undefined"!==typeof b.extendedProps.is_available&&(b.extendedProps.is_available||(m=!1));if(p){p=moment.utc(b.start).clone();var q=moment.utc(b.end).clone();M||!p.isBefore(G)||bookacti_localized.started_events_bookable&&q.isAfter(G)||(m=!1)}var c="undefined"!==typeof b.groupId?parseInt(b.groupId):parseInt(b.id);if(m&&"undefined"!==typeof d.events_data[c]){p=m=!1;q=parseInt(d.events_data[c].activity_id);var f=d.activities_data[q].settings;("undefined"===typeof f.min_bookings_per_user?
0:f.min_bookings_per_user?parseInt(f.min_bookings_per_user):0)<=l&&(p=!0);q=max_users_ok=!0;var D="undefined"===typeof f.max_bookings_per_user?0:f.max_bookings_per_user?parseInt(f.max_bookings_per_user):0;f="undefined"===typeof f.max_users_per_event?0:f.max_users_per_event?parseInt(f.max_users_per_event):0;if(D||f){var E=moment.utc(b.start).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");"undefined"!==typeof d.bookings[c]&&"undefined"!==typeof d.bookings[c][E]&&(c=d.bookings[c][E],E=parseInt(c.current_user_bookings),
f&&0===E&&parseInt(c.distinct_users)>=f&&(max_users_ok=!1),D&&E>=D&&(q=!1))}p&&q&&max_users_ok&&(m=!0)}p=$j("<div></div>",{});q=$j("<div></div>",{id:"bookacti-group-of-events-option-single","class":"bookacti-group-of-events-option","data-group-id":0,"data-group-date":"","data-show-events":0});D=$j("<input />",{id:"bookacti-group-of-events-single",type:"radio",name:"group_of_events",value:"single",disabled:!F&&!m});c="";F?(l=bookacti_get_bookings_number_for_a_single_grouped_event(e,b,L),c=l+" "+(1===
l?bookacti_localized.booking:bookacti_localized.bookings)):(c=!m&&0<l&&"{current}"!==bookacti_localized.not_bookable?0:l,f=1===c?bookacti_localized.avail:bookacti_localized.avails,c=!m&&0<l&&bookacti_localized.not_bookable&&"{current}"!==bookacti_localized.not_bookable?bookacti_localized.not_bookable:c+" "+f);l={html:bookacti_localized.single_event+' <span class="bookacti-group-availability" >('+c+")</span>","for":"bookacti-group-of-events-single"};e.trigger("bookacti_choose_group_dialog_group_label",
[l,0,"",b]);l=$j("<label></label>",l);m=$j("<ul></ul>",{id:"bookacti-group-of-events-list-single","class":"bookacti-group-of-events-list bookacti-custom-scrollbar","data-group-id":0,"data-group-date":""});c=bookacti_format_event_duration(b.start,b.end);c={title:"undefined"!==typeof b.title?b.title:"",duration:c,quantity:1};e.trigger("bookacti_group_of_events_list_data",[c,b]);c={html:'<span class="bookacti-booking-event-duration" >'+c.duration+'</span><span class="bookacti-booking-event-title-separator" > - </span><span class="bookacti-booking-event-title" >'+
c.title+"</span>"};e.trigger("bookacti_group_of_events_list_element_data",[c,b]);c=$j("<li></li>",c);q.append(D);q.append(l);p.append(q);m.append(c);p.append(m);v.append(p)}$j.each(L,function(a,w){if("undefined"===typeof d.groups_data[a])return!0;var r=d.groups_data[a],A=parseInt(r.category_id),g=d.group_categories_data[A].settings,N=parseInt(bookacti_localized.started_groups_bookable);"undefined"!==typeof g.started_groups_bookable&&0<=$j.inArray(g.started_groups_bookable,[0,1,"0","1",!0,!1])&&(N=
$j.isNumeric(g.started_groups_bookable)?parseInt(g.started_groups_bookable):g.started_groups_bookable?1:0);$j.each(w,function(h,H){var k,x,t,y;var u=k=x=t=y=0;"undefined"!==typeof d.groups_bookings[a]&&"undefined"!==typeof d.groups_bookings[a][h]&&(u=d.groups_bookings[a][h].is_available,k=d.groups_bookings[a][h].availability,x=d.groups_bookings[a][h].quantity,t=d.groups_bookings[a][h].current_user_bookings,y=d.groups_bookings[a][h].distinct_users);u=u&&0<k;var B=moment.utc(H[0].start).clone(),n=moment.utc(H[H.length-
1].end).clone();M||!B.isBefore(G)||N&&n.isAfter(G)||(u=!1);if(u){B=u=!1;("undefined"===typeof g.min_bookings_per_user?0:g.min_bookings_per_user?parseInt(g.min_bookings_per_user):0)<=k&&0<k&&(B=!0);n="undefined"===typeof g.max_users_per_event?0:g.max_users_per_event?parseInt(g.max_users_per_event):0;var K="undefined"===typeof g.max_bookings_per_user?0:g.max_bookings_per_user?parseInt(g.max_bookings_per_user):0,O=max_users_ok=!0;if(K||n)t=parseInt(t),n&&0===t&&parseInt(y)>=n&&(max_users_ok=!1),K&&t>=
K&&(O=!1);B&&O&&max_users_ok&&(u=!0)}y=$j("<div></div>",{});t=$j("<div></div>",{id:"bookacti-group-of-events-option-"+a+"_"+h,"class":"bookacti-group-of-events-option","data-group-id":a,"data-group-date":h,"data-show-events":0});B=$j("<input />",{id:"bookacti-group-of-events-"+a+"_"+h,type:"radio",name:"group_of_events",disabled:!F&&!u,value:a+"_"+h});n="";F?n=x+" "+(1===x?bookacti_localized.booking:bookacti_localized.bookings):(x=!u&&0<k&&"{current}"!==bookacti_localized.not_bookable?0:k,n=1===x?
bookacti_localized.avail:bookacti_localized.avails,n=!u&&0<k&&bookacti_localized.not_bookable&&"{current}"!==bookacti_localized.not_bookable?bookacti_localized.not_bookable:x+" "+n);k={html:r.title+' <span class="bookacti-group-availability" >('+n+")</span>","for":"bookacti-group-of-events-"+a+"_"+h};e.trigger("bookacti_choose_group_dialog_group_label",[k,a,h,b]);k=$j("<label></label>",k);var P=$j("<ul></ul>",{id:"bookacti-group-of-events-list-"+a+"_"+h,"class":"bookacti-group-of-events-list bookacti-custom-scrollbar",
"data-group-id":a,"data-group-date":h});$j.each(H,function(Q,z){Q=z.start.substr(0,10)===z.end.substr(0,10);var R=moment.utc(z.start).locale(bookacti_localized.current_lang_code),S=moment.utc(z.end).locale(bookacti_localized.current_lang_code),T=R.formatPHP(bookacti_localized.date_format)+bookacti_localized.dates_separator+S.formatPHP(bookacti_localized.date_format);Q&&(T=R.formatPHP(bookacti_localized.date_format)+bookacti_localized.date_time_separator+S.formatPHP(bookacti_localized.time_format));
z=$j("<li></li>",{html:'<span class="bookacti-booking-event-duration" >'+T+'</span><span class="bookacti-booking-event-title-separator" > - </span><span class="bookacti-booking-event-title" >'+z.title+"</span>"});P.append(z)});t.append(B);t.append(k);y.append(t);y.append(P);v.append(y)})});v.find('input[name="group_of_events"]').on("change",function(){var a=$j(this).val(),w="single"!==a?parseInt(a.substr(0,a.indexOf("_"))):0,r="single"!==a?a.substr(a.indexOf("_")+1):"",A=$j("#"+C+"-choose-group-of-events-dialog .bookacti-groups-of-events-list");
A.find(".bookacti-group-of-events-option:not(#bookacti-group-of-events-option-"+a+")").data("show-events",0).attr("data-show-events",0);A.find(".bookacti-group-of-events-list:not(#bookacti-group-of-events-list-"+a+")").hide(200);A.find("#bookacti-group-of-events-option-"+a).data("show-events",1).attr("data-show-events",1);A.find("#bookacti-group-of-events-list-"+a).show(200);a={click:!0};$j(this).is(":disabled")&&(a.click=!1);e.trigger("bookacti_trigger_group_of_events_preview",[a,w,r,b]);a.click&&
(J?bookacti_unpick_events(e,b):bookacti_unpick_all_events(e),bookacti_pick_events(e,b,w,r),e.trigger("bookacti_group_of_events_preview",[w,r,b]))});v.find('input[name="group_of_events"]:not([disabled]):first').prop("checked",!0).trigger("change");e.find(".fc-toolbar button:focus").blur();I.dialog({beforeClose:function(){},close:function(){"undefined"!==typeof v.find('input[type="radio"]:checked').val()||J||bookacti_unpick_all_events(e)}});I.dialog("option","buttons",[{text:bookacti_localized.dialog_button_ok,
click:function(){var a=v.find('input[type="radio"]:checked').val();if("undefined"!==typeof a){var w={click:!0};v.find('input[type="radio"]:checked').is(":disabled")&&(w.click=!1);var r="single"!==a?parseInt(a.substr(0,a.indexOf("_"))):0;a="single"!==a?a.substr(a.indexOf("_")+1):"";e.trigger("bookacti_trigger_group_of_events_click",[w,r,a,b]);w.click&&(J?bookacti_unpick_events(e,b):bookacti_unpick_all_events(e),bookacti_pick_events(e,b,r,a),e.trigger("bookacti_group_of_events_chosen",[r,a,b]))}$j(this).dialog("close")}}]);
I.dialog("open")};
