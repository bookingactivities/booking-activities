$j(document).ready(function(){$j("body").on("click",".ui-widget-overlay",function(){$j("div:ui-dialog:visible").dialog("close")});$j("body").on("keydown",".bookacti-booking-system-dialog",function(c){if(!$j("textarea").is(":focus")&&c.keyCode==$j.ui.keyCode.ENTER)return $j(this).parent().find(".ui-dialog-buttonpane button:first").focus(),!1})});
function bookacti_init_booking_system_dialogs(){$j(".bookacti-booking-system-dialog").dialog({modal:!0,autoOpen:!1,minHeight:300,minWidth:400,resize:"auto",show:!0,hide:!0,dialogClass:"bookacti-dialog",closeText:"&#10006;",close:function(){}})}
function bookacti_dialog_choose_group_of_events(c,L,b){var B=c.attr("id"),I=$j("#"+B+"-choose-group-of-events-dialog"),t=$j("#"+B+"-groups-of-events-list"),d=bookacti.booking_system[B],J=d.multiple_bookings,E=d.bookings_only,n=d.past_events,M=d.past_events_bookable,F=moment.utc(bookacti_localized.current_time);t.data("booking-system-id",B);t.empty();if(d.groups_single_events){var l="";if(E)l=bookacti_get_bookings_number_for_a_single_grouped_event(c,b,L),l=l+" "+(1===l?bookacti_localized.booking:bookacti_localized.bookings);
else{var p=bookacti_get_event_availability(c,b);l=p+" "+(1===p?bookacti_localized.avail:bookacti_localized.avails)}var v=!0;if(n){n=moment.utc(b.start).clone();var g=moment.utc(b.end).clone();M||!n.isBefore(F)||bookacti_localized.started_events_bookable&&g.isAfter(F)||(v=!1)}g="undefined"!==typeof b.groupId?parseInt(b.groupId):parseInt(b.id);if(v&&"undefined"!==typeof d.events_data[g]){n=v=!1;var e=parseInt(d.events_data[g].activity_id),h=d.activities_data[e].settings;("undefined"===typeof h.min_bookings_per_user?
0:h.min_bookings_per_user?parseInt(h.min_bookings_per_user):0)<=p&&(n=!0);p=max_users_ok=!0;e="undefined"===typeof h.max_bookings_per_user?0:h.max_bookings_per_user?parseInt(h.max_bookings_per_user):0;h="undefined"===typeof h.max_users_per_event?0:h.max_users_per_event?parseInt(h.max_users_per_event):0;if(e||h){var C=moment.utc(b.start).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");"undefined"!==typeof d.bookings[g]&&"undefined"!==typeof d.bookings[g][C]&&(g=d.bookings[g][C],C=parseInt(g.current_user_bookings),
h&&0===C&&parseInt(g.distinct_users)>=h&&(max_users_ok=!1),e&&C>=e&&(p=!1))}n&&p&&max_users_ok&&(v=!0)}n=$j("<div></div>",{});p=$j("<div></div>",{id:"bookacti-group-of-events-option-single","class":"bookacti-group-of-events-option","data-group-id":0,"data-group-date":"","data-show-events":0});v=$j("<input />",{id:"bookacti-group-of-events-single",type:"radio",name:"group_of_events",value:"single",disabled:!E&&!v});l={html:bookacti_localized.single_event+' <span class="bookacti-group-availability" >('+
l+")</span>","for":"bookacti-group-of-events-single"};c.trigger("bookacti_choose_group_dialog_group_label",[l,0,"",b]);l=$j("<label></label>",l);g=$j("<ul></ul>",{id:"bookacti-group-of-events-list-single","class":"bookacti-group-of-events-list bookacti-custom-scrollbar","data-group-id":0,"data-group-date":""});e=bookacti_format_event_duration(b.start,b.end);e={title:"undefined"!==typeof b.title?b.title:"",duration:e,quantity:1};c.trigger("bookacti_group_of_events_list_data",[e,b]);e={html:'<span class="bookacti-booking-event-duration" >'+
e.duration+'</span><span class="bookacti-booking-event-title-separator" > - </span><span class="bookacti-booking-event-title" >'+e.title+"</span>"};c.trigger("bookacti_group_of_events_list_element_data",[e,b]);e=$j("<li></li>",e);p.append(v);p.append(l);n.append(p);g.append(e);n.append(g);t.append(n)}$j.each(L,function(a,u){if("undefined"===typeof d.groups_data[a])return!0;var q=d.groups_data[a],A=parseInt(q.category_id),f=d.group_categories_data[A].settings,N=parseInt(bookacti_localized.started_groups_bookable);
"undefined"!==typeof f.started_groups_bookable&&0<=$j.inArray(f.started_groups_bookable,[0,1,"0","1",!0,!1])&&(N=$j.isNumeric(f.started_groups_bookable)?parseInt(f.started_groups_bookable):f.started_groups_bookable?1:0);$j.each(u,function(k,G){var H,r,w;var m=H=r=w=0;"undefined"!==typeof d.groups_bookings[a]&&"undefined"!==typeof d.groups_bookings[a][k]&&(m=d.groups_bookings[a][k].availability,H=d.groups_bookings[a][k].quantity,r=d.groups_bookings[a][k].current_user_bookings,w=d.groups_bookings[a][k].distinct_users);
var x=0<parseInt(m),y=moment.utc(G[0].start).clone(),D=moment.utc(G[G.length-1].end).clone();M||!y.isBefore(F)||N&&D.isAfter(F)||(x=!1);if(x){y=x=!1;("undefined"===typeof f.min_bookings_per_user?0:f.min_bookings_per_user?parseInt(f.min_bookings_per_user):0)<=m&&0<m&&(y=!0);D="undefined"===typeof f.max_users_per_event?0:f.max_users_per_event?parseInt(f.max_users_per_event):0;var K="undefined"===typeof f.max_bookings_per_user?0:f.max_bookings_per_user?parseInt(f.max_bookings_per_user):0,O=max_users_ok=
!0;if(K||D)r=parseInt(r),D&&0===r&&parseInt(w)>=D&&(max_users_ok=!1),K&&r>=K&&(O=!1);y&&O&&max_users_ok&&(x=!0)}w=$j("<div></div>",{});r=$j("<div></div>",{id:"bookacti-group-of-events-option-"+a+"_"+k,"class":"bookacti-group-of-events-option","data-group-id":a,"data-group-date":k,"data-show-events":0});x=$j("<input />",{id:"bookacti-group-of-events-"+a+"_"+k,type:"radio",name:"group_of_events",disabled:!E&&!x,value:a+"_"+k});y="";y=E?H+" "+(1===H?bookacti_localized.booking:bookacti_localized.bookings):
m+" "+(1===m?bookacti_localized.avail:bookacti_localized.avails);m={html:q.title+' <span class="bookacti-group-availability" >('+y+")</span>","for":"bookacti-group-of-events-"+a+"_"+k};c.trigger("bookacti_choose_group_dialog_group_label",[m,a,k,b]);m=$j("<label></label>",m);var P=$j("<ul></ul>",{id:"bookacti-group-of-events-list-"+a+"_"+k,"class":"bookacti-group-of-events-list bookacti-custom-scrollbar","data-group-id":a,"data-group-date":k});$j.each(G,function(Q,z){Q=z.start.substr(0,10)===z.end.substr(0,
10);var R=moment.utc(z.start).locale(bookacti_localized.current_lang_code),S=moment.utc(z.end).locale(bookacti_localized.current_lang_code),T=R.formatPHP(bookacti_localized.date_format)+bookacti_localized.dates_separator+S.formatPHP(bookacti_localized.date_format);Q&&(T=R.formatPHP(bookacti_localized.date_format)+bookacti_localized.date_time_separator+S.formatPHP(bookacti_localized.time_format));z=$j("<li></li>",{html:'<span class="bookacti-booking-event-duration" >'+T+'</span><span class="bookacti-booking-event-title-separator" > - </span><span class="bookacti-booking-event-title" >'+
z.title+"</span>"});P.append(z)});r.append(x);r.append(m);w.append(r);w.append(P);t.append(w)})});t.find('input[name="group_of_events"]').on("change",function(){var a=$j(this).val(),u="single"!==a?parseInt(a.substr(0,a.indexOf("_"))):0,q="single"!==a?a.substr(a.indexOf("_")+1):"",A=$j("#"+B+"-choose-group-of-events-dialog .bookacti-groups-of-events-list");A.find(".bookacti-group-of-events-option:not(#bookacti-group-of-events-option-"+a+")").data("show-events",0).attr("data-show-events",0);A.find(".bookacti-group-of-events-list:not(#bookacti-group-of-events-list-"+
a+")").hide(200);A.find("#bookacti-group-of-events-option-"+a).data("show-events",1).attr("data-show-events",1);A.find("#bookacti-group-of-events-list-"+a).show(200);a={click:!0};$j(this).is(":disabled")&&(a.click=!1);c.trigger("bookacti_trigger_group_of_events_preview",[a,u,q,b]);a.click&&(J?bookacti_unpick_events(c,b):bookacti_unpick_all_events(c),bookacti_pick_events(c,b,u,q),c.trigger("bookacti_group_of_events_preview",[u,q,b]))});t.find('input[name="group_of_events"]:not([disabled]):first').prop("checked",
!0).trigger("change");I.dialog({close:function(){"undefined"!==typeof t.find('input[type="radio"]:checked').val()||J||bookacti_unpick_all_events(c)}});I.dialog("option","buttons",[{text:bookacti_localized.dialog_button_ok,click:function(){var a=t.find('input[type="radio"]:checked').val();if("undefined"!==typeof a){var u={click:!0};t.find('input[type="radio"]:checked').is(":disabled")&&(u.click=!1);var q="single"!==a?parseInt(a.substr(0,a.indexOf("_"))):0;a="single"!==a?a.substr(a.indexOf("_")+1):
"";c.trigger("bookacti_trigger_group_of_events_click",[u,q,a,b]);u.click&&(J?bookacti_unpick_events(c,b):bookacti_unpick_all_events(c),bookacti_pick_events(c,b,q,a),c.trigger("bookacti_group_of_events_chosen",[q,a,b]))}$j(this).dialog("close")}}]);I.dialog("open")};
