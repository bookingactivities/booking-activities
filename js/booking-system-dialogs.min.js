function bookacti_dialog_choose_group_of_events(e,N,c){var w=e.attr("id"),J=$j("#"+w+"-choose-group-of-events-dialog"),q=$j("#"+w+"-groups-of-events-list"),f=bookacti.booking_system[w],K=f.multiple_bookings,y=f.bookings_only,r=f.past_events,t=f.past_events_bookable,n=moment.utc(bookacti_localized.current_time);q.data("booking-system-id",w);q.empty();if(f.groups_single_events){var g=bookacti_get_event_availability(e,c),p=0<g;"undefined"!==typeof c.is_available&&(c.is_available||(p=!1));"undefined"!==
typeof c.extendedProps&&"undefined"!==typeof c.extendedProps.is_available&&(c.extendedProps.is_available||(p=!1));if(r){r=moment.utc(c.start).clone();var b=moment.utc(c.end).clone();t||!r.isBefore(n)||bookacti_localized.started_events_bookable&&b.isAfter(n)||(p=!1)}var h="undefined"!==typeof c.groupId?parseInt(c.groupId):parseInt(c.id);if(p&&"undefined"!==typeof f.events_data[h]){t=p=!1;n=parseInt(f.events_data[h].activity_id);b=f.activities_data[n].settings;("undefined"===typeof b.min_bookings_per_user?
0:b.min_bookings_per_user?parseInt(b.min_bookings_per_user):0)<=g&&(t=!0);n=max_users_ok=!0;r="undefined"===typeof b.max_bookings_per_user?0:b.max_bookings_per_user?parseInt(b.max_bookings_per_user):0;b="undefined"===typeof b.max_users_per_event?0:b.max_users_per_event?parseInt(b.max_users_per_event):0;if(r||b){var l=moment.utc(c.start).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");if("undefined"!==typeof f.bookings[h]&&"undefined"!==typeof f.bookings[h][l]){l=f.bookings[h][l];var u=parseInt(l.current_user_bookings);
b&&0===u&&parseInt(l.distinct_users)>=b&&(max_users_ok=!1);r&&u>=r&&(n=!1)}}t&&n&&max_users_ok&&(p=!0)}t=$j("<div></div>",{});n=$j("<div></div>",{id:"bookacti-group-of-events-option-single","class":"bookacti-group-of-events-option","data-group-id":0,"data-group-date":"","data-show-events":0});r=$j("<input />",{id:"bookacti-group-of-events-single",type:"radio",name:"group_of_events",value:"single",disabled:!y&&!p});b=bookacti_get_bookings_number_for_a_single_grouped_event(e,c,N);l=!p&&0<g&&"{current}"!==
bookacti_localized.not_bookable?0:g;u="";(h=bookacti.booking_system[w].events_data?.[h]?.availability)||(h=0);var F=h?parseInt(g/h*100):0;h=parseInt(bookacti.booking_system[w].hide_availability);var C=parseInt(bookacti_localized.hide_availability_fixed);F=100>h&&F>h;var O=0<C&&g>C;!y&&(0>=C&&F||100<=h&&O||F&&O)&&(l="",u="bookacti-hide-availability");C=(0<b?" bookacti-booked":" bookacti-not-booked")+(0>=g?" bookacti-full":"")+(!p&&0<g?" bookacti-not-bookable":"");h=$j("<div></div>",{"class":"bookacti-group-availability-container "+
u});u=$j("<div></div>",{"class":"bookacti-available-places "+C});y?(l=1===b?bookacti_localized.booking:bookacti_localized.bookings,g=$j("<span></span>",{"class":"bookacti-active-bookings-number",html:b}),b=$j("<span></span>",{"class":"bookacti-available-places-avail-particle",html:l})):(b=1===g?bookacti_localized.avail:bookacti_localized.avails,!p&&0<g&&bookacti_localized.not_bookable&&"{current}"!==bookacti_localized.not_bookable&&(l="",b=bookacti_localized.not_bookable),g=$j("<span></span>",{"class":"bookacti-available-places-number",
html:l}),b=$j("<span></span>",{"class":"bookacti-available-places-avail-particle",html:b}));u.append(g);u.append(b);h.append(u);g=$j("<span></span>",{html:bookacti_localized.single_event,"class":"bookacti-group-of-events-option-title"});g=$j("<label></label>",{html:g[0].outerHTML+h[0].outerHTML,"for":"bookacti-group-of-events-single"});b=$j("<ul></ul>",{id:"bookacti-group-of-events-list-single","class":"bookacti-group-of-events-list bookacti-custom-scrollbar","data-group-id":0,"data-group-date":""});
l=bookacti_format_event_duration(c.start,c.end);l=$j("<li></li>",{html:'<span class="bookacti-booking-event-duration" >'+l+'</span><span class="bookacti-booking-event-title-separator" > - </span><span class="bookacti-booking-event-title" >'+("undefined"!==typeof c.title?c.title:"")+"</span>"});n.append(r);n.append(g);t.append(n);b.append(l);t.append(b);e.trigger("bookacti_group_of_events_option",[t,0,"",c,p]);q.append(t)}$j.each(N,function(a,v){if("undefined"===typeof f.groups_data[a])return!0;$j.each(v,
function(d,A){var D,m;var k=D=m=0;"undefined"!==typeof f.groups_bookings[a]&&"undefined"!==typeof f.groups_bookings[a][d]&&(k=f.groups_bookings[a][d]?.availability,D=f.groups_bookings[a][d]?.quantity,m=f.groups_bookings[a][d]?.total_availability);var B=bookacti_is_group_of_events_available(e,a,d),G=$j("<div></div>",{}),L=$j("<div></div>",{id:"bookacti-group-of-events-option-"+a+"_"+d,"class":"bookacti-group-of-events-option"+(y||B?"":" bookacti-group-of-events-unavailable"),"data-group-id":a,"data-group-date":d,
"data-show-events":0}),V=$j("<input />",{id:"bookacti-group-of-events-"+a+"_"+d,type:"radio",name:"group_of_events",disabled:!y&&!B,value:a+"_"+d}),x=!B&&0<k&&"{current}"!==bookacti_localized.not_bookable?0:k,H=D,E="",I=m?parseInt(k/m*100):0;m=parseInt(bookacti.booking_system[w].hide_availability);var M=parseInt(bookacti_localized.hide_availability_fixed);I=100>m&&I>m;var P=0<M&&k>M;!y&&(0>=M&&I||100<=m&&P||I&&P)&&(x="",E="bookacti-hide-availability");m=(0<D?" bookacti-booked":" bookacti-not-booked")+
(0>=k?" bookacti-full":"")+(!B&&0<k?" bookacti-not-bookable":"");E=$j("<div></div>",{"class":"bookacti-group-availability-container "+E});m=$j("<div></div>",{"class":"bookacti-available-places "+m});y?(x=1===D?bookacti_localized.booking:bookacti_localized.bookings,k=$j("<span></span>",{"class":"bookacti-active-bookings-number",html:H}),x=$j("<span></span>",{"class":"bookacti-available-places-avail-particle",html:x})):(H=1===k?bookacti_localized.avail:bookacti_localized.avails,!B&&0<k&&bookacti_localized.not_bookable&&
"{current}"!==bookacti_localized.not_bookable&&(x="",H=bookacti_localized.not_bookable),k=$j("<span></span>",{"class":"bookacti-available-places-number",html:x}),x=$j("<span></span>",{"class":"bookacti-available-places-avail-particle",html:H}));m.append(k);m.append(x);E.append(m);k=$j("<span></span>",{html:f.groups_data[a].title,"class":"bookacti-group-of-events-option-title"});k=$j("<label></label>",{html:k[0].outerHTML+E[0].outerHTML,"for":"bookacti-group-of-events-"+a+"_"+d});var Q=$j("<ul></ul>",
{id:"bookacti-group-of-events-list-"+a+"_"+d,"class":"bookacti-group-of-events-list bookacti-custom-scrollbar","data-group-id":a,"data-group-date":d});$j.each(A,function(R,z){R=z.start.substr(0,10)===z.end.substr(0,10);var S=moment.utc(z.start).locale(bookacti_localized.current_lang_code),T=moment.utc(z.end).locale(bookacti_localized.current_lang_code),U=S.formatPHP(bookacti_localized.date_format)+bookacti_localized.dates_separator+T.formatPHP(bookacti_localized.date_format);R&&(U=S.formatPHP(bookacti_localized.date_format)+
bookacti_localized.date_time_separator+T.formatPHP(bookacti_localized.time_format));z=$j("<li></li>",{html:'<span class="bookacti-booking-event-duration" >'+U+'</span><span class="bookacti-booking-event-title-separator" > - </span><span class="bookacti-booking-event-title" >'+z.title+"</span>"});Q.append(z)});L.append(V);L.append(k);G.append(L);G.append(Q);e.trigger("bookacti_group_of_events_option",[G,a,d,c,B]);q.append(G)})});q.find('input[name="group_of_events"]').on("change",function(){var a=
$j(this).val(),v="single"!==a?parseInt(a.substr(0,a.indexOf("_"))):0,d="single"!==a?a.substr(a.indexOf("_")+1):"",A=$j("#"+w+"-choose-group-of-events-dialog .bookacti-groups-of-events-list");A.find(".bookacti-group-of-events-option:not(#bookacti-group-of-events-option-"+a+")").data("show-events",0).attr("data-show-events",0);A.find(".bookacti-group-of-events-list:not(#bookacti-group-of-events-list-"+a+")").hide(200);A.find("#bookacti-group-of-events-option-"+a).data("show-events",1).attr("data-show-events",
1);A.find("#bookacti-group-of-events-list-"+a).show(200);a={click:!0};$j(this).is(":disabled")&&(a.click=!1);e.trigger("bookacti_trigger_group_of_events_preview",[a,v,d,c]);a.click&&(K?bookacti_unpick_events(e,c):bookacti_unpick_all_events(e),bookacti_pick_events(e,c,v,d),e.trigger("bookacti_group_of_events_preview",[v,d,c]))});q.find('input[name="group_of_events"]:not([disabled]):first').prop("checked",!0).trigger("change");e.find(".fc-toolbar button:focus").blur();J.dialog({beforeClose:function(){},
close:function(){"undefined"!==typeof q.find('input[type="radio"]:checked').val()||K||bookacti_unpick_all_events(e)}});J.dialog("option","buttons",[{text:bookacti_localized.dialog_button_ok,click:function(){var a=q.find('input[type="radio"]:checked').val();if("undefined"!==typeof a){var v={click:!0};q.find('input[type="radio"]:checked').is(":disabled")&&(v.click=!1);var d="single"!==a?parseInt(a.substr(0,a.indexOf("_"))):0;a="single"!==a?a.substr(a.indexOf("_")+1):"";e.trigger("bookacti_trigger_group_of_events_click",
[v,d,a,c]);v.click&&(K?bookacti_unpick_events(e,c):bookacti_unpick_all_events(e),bookacti_pick_events(e,c,d,a),e.trigger("bookacti_group_of_events_chosen",[d,a,c]))}$j(this).dialog("close")}}]);J.dialog("open")};
