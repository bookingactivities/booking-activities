$j(document).ready(function(){$j("body").on("click",".ui-widget-overlay",function(){$j("div:ui-dialog:visible").dialog("close")});$j("body").on("keydown",".bookacti-booking-system-dialog",function(a){if(!$j("textarea").is(":focus")&&a.keyCode==$j.ui.keyCode.ENTER){$j(this).parent().find(".ui-dialog-buttonpane button:first").focus();return false}});$j("body").on("bookacti_group_of_events_preview",".bookacti-booking-system",function(g,d,c){var b=$j(this);var a=$j(this).attr("id");var f=$j("#"+a+"-choose-group-of-events-dialog .bookacti-groups-of-events-list");f.find('.bookacti-group-of-events-option[data-group-id!="'+d+'"]').data("show-events",0).attr("data-show-events",0);f.find('.bookacti-group-of-events-list[data-group-id!="'+d+'"]').hide(200);f.find('.bookacti-group-of-events-option[data-group-id="'+d+'"]').data("show-events",1).attr("data-show-events",1);f.find('.bookacti-group-of-events-list[data-group-id="'+d+'"]').show(200);bookacti_unpick_all_events(b);bookacti_pick_events_of_group(b,d,c)})});function bookacti_init_booking_system_dialogs(){$j(".bookacti-booking-system-dialog").dialog({modal:true,autoOpen:false,minHeight:300,minWidth:400,resize:"auto",show:true,hide:true,dialogClass:"bookacti-dialog",closeText:"&#10006;",close:function(){}})}function bookacti_dialog_choose_group_of_events(y,B,J){var C=y.attr("id");var F=$j("#"+C+"-choose-group-of-events-dialog");var g=$j("#"+C+"-groups-of-events-list");var n=bookacti.booking_system[C]["bookings_only"];var D=bookacti.booking_system[C]["past_events"];var v=bookacti.booking_system[C]["past_events_bookable"];var q=moment.utc(bookacti_localized.current_time);g.data("booking-system-id",C);g.empty();if(bookacti.booking_system[C]["groups_single_events"]){var k="single";var r="";if(n){var p=bookacti_get_bookings_number_for_a_single_grouped_event(y,J,B);var e=p===1?bookacti_localized.booking:bookacti_localized.bookings;r=p+" "+e}else{var h=bookacti_get_event_availability(y,J);var j=h===1?bookacti_localized.avail:bookacti_localized.avails;r=h+" "+j}var f=true;if(D){var c=moment.utc(J.start).clone();var H=moment.utc(J.end).clone();if(!v&&c.isBefore(q)&&!(bookacti_localized.started_events_bookable&&H.isAfter(q))){f=false}}if(f&&typeof bookacti.booking_system[C]["events_data"][J.id]!=="undefined"){f=false;var d=false;var w=parseInt(bookacti.booking_system[C]["events_data"][J.id]["activity_id"]);var I=bookacti.booking_system[C]["activities_data"][w]["settings"];var l=typeof I.min_bookings_per_user==="undefined"?0:(I.min_bookings_per_user?parseInt(I.min_bookings_per_user):0);if(l<=h){d=true}var o=max_users_ok=true;if(typeof bookacti.booking_system[C]["bookings"][J.id]!=="undefined"){var c=J.start instanceof moment?J.start.format("YYYY-MM-DD HH:mm:ss"):J.start;var H=J.end instanceof moment?J.end.format("YYYY-MM-DD HH:mm:ss"):J.end;var G=typeof I.max_bookings_per_user==="undefined"?0:(I.max_bookings_per_user?parseInt(I.max_bookings_per_user):0);var m=typeof I.max_users_per_event==="undefined"?0:(I.max_users_per_event?parseInt(I.max_users_per_event):0);if(G||m){$j.each(bookacti.booking_system[C]["bookings"][J.id],function(M,K){if(c===K.event_start&&H===K.event_end){var L=parseInt(K.current_user_bookings);if(m&&L===0&&K.distinct_users>=m){max_users_ok=false}if(G&&L>=G){o=false}return false}})}}if(d&&o&&max_users_ok){f=true}}var x=$j("<div />",{});var u=$j("<div />",{"class":"bookacti-group-of-events-option","data-group-id":k,"data-show-events":0});var t=$j("<input />",{id:"bookacti-group-of-events-"+k,type:"radio",name:"group_of_events",value:k,disabled:!n&&!f});var b={html:bookacti_localized.single_event+' <span class="bookacti-group-availability" >('+r+")</span>","for":"bookacti-group-of-events-"+k};y.trigger("bookacti_choose_group_dialog_group_label",[b,"single",J]);var A=$j("<label />",b);var z=$j("<ul />",{"class":"bookacti-group-of-events-list bookacti-custom-scrollbar","data-group-id":k});var E=bookacti_format_event_duration(J.start,J.end);var i={title:J.title,duration:E,quantity:1};y.trigger("bookacti_group_of_events_list_data",[i,J]);var s={html:'<span class="bookacti-booking-event-duration" >'+i.duration+'</span><span class="bookacti-booking-event-title-separator" > - </span><span class="bookacti-booking-event-title" >'+i.title+"</span>"};y.trigger("bookacti_group_of_events_list_element_data",[s,J]);var a=$j("<li />",s);u.append(t);u.append(A);x.append(u);z.append(a);x.append(z);g.append(x)}$j.each(B,function(ae,ac){ac=parseInt(ac);if(typeof bookacti.booking_system[C]["groups_events"][ac]!=="undefined"&&typeof bookacti.booking_system[C]["groups_data"][ac]!=="undefined"){var S=bookacti.booking_system[C]["groups_data"][ac];var U=S.availability;var L=parseInt(S.category_id);var ag=bookacti.booking_system[C]["group_categories_data"][L]["settings"];var aa=bookacti_localized.started_groups_bookable;if(typeof ag.started_groups_bookable!=="undefined"){if($j.inArray(ag.started_groups_bookable,[0,1,"0","1",true,false])>=0){aa=parseInt(ag.started_groups_bookable)}}var V=true;var af=moment.utc(S.start).clone();var ab=moment.utc(S.end).clone();if(!v&&af.isBefore(q)&&!(aa&&ab.isAfter(q))){V=false}if(V){V=false;var aj=false;var ai=typeof ag.min_bookings_per_user==="undefined"?0:(ag.min_bookings_per_user?parseInt(ag.min_bookings_per_user):0);if(ai<=U&&U>0){aj=true}var P=typeof ag.max_users_per_event==="undefined"?0:(ag.max_users_per_event?parseInt(ag.max_users_per_event):0);var N=typeof ag.max_bookings_per_user==="undefined"?0:(ag.max_bookings_per_user?parseInt(ag.max_bookings_per_user):0);var Z=max_users_ok=true;if(N||P){var ad=parseInt(S.current_user_bookings);if(P&&ad===0&&S.distinct_users>=P){max_users_ok=false}if(N&&ad>=N){Z=false}}if(aj&&Z&&max_users_ok){V=true}}var W=$j("<div />",{});var Q=$j("<div />",{"class":"bookacti-group-of-events-option","data-group-id":ac,"data-show-events":0});var T=$j("<input />",{id:"bookacti-group-of-events-"+ac,type:"radio",name:"group_of_events",disabled:!n&&!V,value:ac});var ah="";if(n){var M=0;$j.each(bookacti.booking_system[C]["groups_events"][ac],function(al,ak){if(J.id==ak.id&&J.start.format("YYYY-MM-DD HH:mm:ss")===ak.start&&J.end.format("YYYY-MM-DD HH:mm:ss")===ak.end){M=ak.group_bookings}});var Y=M===1?bookacti_localized.booking:bookacti_localized.bookings;ah=M+" "+Y}else{var X=U===1?bookacti_localized.avail:bookacti_localized.avails;ah=U+" "+X}var K={html:bookacti.booking_system[C]["groups_data"][ac]["title"]+' <span class="bookacti-group-availability" >('+ah+")</span>","for":"bookacti-group-of-events-"+ac};y.trigger("bookacti_choose_group_dialog_group_label",[K,ac,J]);var R=$j("<label />",K);var O=$j("<ul />",{"class":"bookacti-group-of-events-list bookacti-custom-scrollbar","data-group-id":ac});$j.each(bookacti.booking_system[C]["groups_events"][ac],function(an,aq){var al=aq.start.substr(0,10)===aq.end.substr(0,10);var ap=moment.utc(aq.start).locale(bookacti_localized.current_lang_code);var am=moment.utc(aq.end).locale(bookacti_localized.current_lang_code);var ak=ap.formatPHP(bookacti_localized.date_format)+bookacti_localized.dates_separator+am.formatPHP(bookacti_localized.date_format);if(al){ak=ap.formatPHP(bookacti_localized.date_format)+bookacti_localized.date_time_separator+am.formatPHP(bookacti_localized.time_format)}var ao=$j("<li />",{html:'<span class="bookacti-booking-event-duration" >'+ak+'</span><span class="bookacti-booking-event-title-separator" > - </span><span class="bookacti-booking-event-title" >'+aq.title+"</span>"});O.append(ao)});Q.append(T);Q.append(R);W.append(Q);W.append(O);g.append(W)}});g.find('input[name="group_of_events"]').on("change",function(){var K=$j(this).val();y.trigger("bookacti_group_of_events_preview",[K,J])});g.find('input[name="group_of_events"]:not([disabled]):first').prop("checked",true).trigger("change");F.dialog("open");F.dialog({close:function(){var K=g.find('input[type="radio"]:checked').val();if(typeof K==="undefined"){bookacti_unpick_all_events(y)}}});F.dialog("option","buttons",[{text:bookacti_localized.dialog_button_ok,click:function(){var K=g.find('input[type="radio"]:checked').val();if(typeof K!=="undefined"){bookacti_unpick_all_events(y);bookacti_pick_events_of_group(y,K,J);y.trigger("bookacti_group_of_events_chosen",[K,J])}$j(this).dialog("close")}}])};