$j(document).ready(function(){$j("body").on("click",".ui-widget-overlay",function(){$j("div:ui-dialog:visible").dialog("close")});$j("body").on("keydown",".bookacti-booking-system-dialog",function(a){if(!$j("textarea").is(":focus")&&a.keyCode==$j.ui.keyCode.ENTER){$j(this).parent().find(".ui-dialog-buttonpane button:first").focus();return false}});$j("body").on("bookacti_group_of_events_preview",".bookacti-booking-system",function(g,d,c){var b=$j(this);var a=$j(this).attr("id");var f=$j("#"+a+"-choose-group-of-events-dialog .bookacti-groups-of-events-list");f.find('.bookacti-group-of-events-option[data-group-id!="'+d+'"]').data("show-events",0).attr("data-show-events",0);f.find('.bookacti-group-of-events-list[data-group-id!="'+d+'"]').hide(200);f.find('.bookacti-group-of-events-option[data-group-id="'+d+'"]').data("show-events",1).attr("data-show-events",1);f.find('.bookacti-group-of-events-list[data-group-id="'+d+'"]').show(200);bookacti_unpick_all_events(b);bookacti_pick_events_of_group(b,d,c)})});function bookacti_init_booking_system_dialogs(){$j(".bookacti-booking-system-dialog").dialog({modal:true,autoOpen:false,minHeight:300,minWidth:400,resize:"auto",show:true,hide:true,dialogClass:"bookacti-dialog",closeText:"&#10006;",close:function(){}})}function bookacti_dialog_choose_group_of_events(y,C,M){var E=y.attr("id");var H=$j("#"+E+"-choose-group-of-events-dialog");var g=$j("#"+E+"-groups-of-events-list");var n=bookacti.booking_system[E]["bookings_only"];var F=bookacti.booking_system[E]["past_events"];var v=bookacti.booking_system[E]["past_events_bookable"];var q=moment.utc(bookacti_localized.current_time);g.data("booking-system-id",E);g.empty();if(bookacti.booking_system[E]["groups_single_events"]){var k="single";var s="";if(n){var p=bookacti_get_bookings_number_for_a_single_grouped_event(y,M,C);var e=p===1?bookacti_localized.booking:bookacti_localized.bookings;s=p+" "+e}else{var i=bookacti_get_event_availability(y,M);var j=i===1?bookacti_localized.avail:bookacti_localized.avails;s=i+" "+j}var f=true;if(F){var c=moment.utc(M.start).clone();var J=moment.utc(M.end).clone();if(!v&&c.isBefore(q)&&!(bookacti_localized.started_events_bookable&&J.isAfter(q))){f=false}}if(f&&typeof bookacti.booking_system[E]["events_data"][M.id]!=="undefined"){f=false;var d=false;var w=parseInt(bookacti.booking_system[E]["events_data"][M.id]["activity_id"]);var L=bookacti.booking_system[E]["activities_data"][w]["settings"];var l=typeof L.min_bookings_per_user==="undefined"?0:(L.min_bookings_per_user?parseInt(L.min_bookings_per_user):0);if(l<=i){d=true}var o=max_users_ok=true;var I=typeof L.max_bookings_per_user==="undefined"?0:(L.max_bookings_per_user?parseInt(L.max_bookings_per_user):0);var m=typeof L.max_users_per_event==="undefined"?0:(L.max_users_per_event?parseInt(L.max_users_per_event):0);if(I||m){var z=moment.utc(M.start).format("YYYY-MM-DD HH:mm:ss");if(typeof bookacti.booking_system[E]["bookings"][M.id]!=="undefined"){if(typeof bookacti.booking_system[E]["bookings"][M.id][z]!=="undefined"){var D=bookacti.booking_system[E]["bookings"][M.id][z];var K=parseInt(D.current_user_bookings);if(m&&K===0&&parseInt(D.distinct_users)>=m){max_users_ok=false}if(I&&K>=I){o=false}}}}if(d&&o&&max_users_ok){f=true}}var x=$j("<div></div>",{});var u=$j("<div></div>",{"class":"bookacti-group-of-events-option","data-group-id":k,"data-show-events":0});var t=$j("<input />",{id:"bookacti-group-of-events-"+k,type:"radio",name:"group_of_events",value:k,disabled:!n&&!f});var b={html:bookacti_localized.single_event+' <span class="bookacti-group-availability" >('+s+")</span>","for":"bookacti-group-of-events-"+k};y.trigger("bookacti_choose_group_dialog_group_label",[b,"single",M]);var B=$j("<label></label>",b);var A=$j("<ul></ul>",{"class":"bookacti-group-of-events-list bookacti-custom-scrollbar","data-group-id":k});var G=bookacti_format_event_duration(M.start,M.end);var h={title:M.title,duration:G,quantity:1};y.trigger("bookacti_group_of_events_list_data",[h,M]);var r={html:'<span class="bookacti-booking-event-duration" >'+h.duration+'</span><span class="bookacti-booking-event-title-separator" > - </span><span class="bookacti-booking-event-title" >'+h.title+"</span>"};y.trigger("bookacti_group_of_events_list_element_data",[r,M]);var a=$j("<li></li>",r);u.append(t);u.append(B);x.append(u);A.append(a);x.append(A);g.append(x)}$j.each(C,function(ah,af){af=parseInt(af);if(typeof bookacti.booking_system[E]["groups_events"][af]!=="undefined"&&typeof bookacti.booking_system[E]["groups_data"][af]!=="undefined"){var V=bookacti.booking_system[E]["groups_data"][af];var X=V.availability;var O=parseInt(V.category_id);var aj=bookacti.booking_system[E]["group_categories_data"][O]["settings"];var ad=bookacti_localized.started_groups_bookable;if(typeof aj.started_groups_bookable!=="undefined"){if($j.inArray(aj.started_groups_bookable,[0,1,"0","1",true,false])>=0){ad=parseInt(aj.started_groups_bookable)}}var Y=true;var ai=moment.utc(V.start).clone();var ae=moment.utc(V.end).clone();if(!v&&ai.isBefore(q)&&!(ad&&ae.isAfter(q))){Y=false}if(Y){Y=false;var am=false;var al=typeof aj.min_bookings_per_user==="undefined"?0:(aj.min_bookings_per_user?parseInt(aj.min_bookings_per_user):0);if(al<=X&&X>0){am=true}var S=typeof aj.max_users_per_event==="undefined"?0:(aj.max_users_per_event?parseInt(aj.max_users_per_event):0);var Q=typeof aj.max_bookings_per_user==="undefined"?0:(aj.max_bookings_per_user?parseInt(aj.max_bookings_per_user):0);var ac=max_users_ok=true;if(Q||S){var ag=parseInt(V.current_user_bookings);if(S&&ag===0&&parseInt(V.distinct_users)>=S){max_users_ok=false}if(Q&&ag>=Q){ac=false}}if(am&&ac&&max_users_ok){Y=true}}var Z=$j("<div></div>",{});var T=$j("<div></div>",{"class":"bookacti-group-of-events-option","data-group-id":af,"data-show-events":0});var W=$j("<input />",{id:"bookacti-group-of-events-"+af,type:"radio",name:"group_of_events",disabled:!n&&!Y,value:af});var ak="";if(n){var P=0;$j.each(bookacti.booking_system[E]["groups_events"][af],function(ao,an){if(M.id==an.id&&M.start.format("YYYY-MM-DD HH:mm:ss")===an.start&&M.end.format("YYYY-MM-DD HH:mm:ss")===an.end){P=an.group_bookings}});var ab=P===1?bookacti_localized.booking:bookacti_localized.bookings;ak=P+" "+ab}else{var aa=X===1?bookacti_localized.avail:bookacti_localized.avails;ak=X+" "+aa}var N={html:bookacti.booking_system[E]["groups_data"][af]["title"]+' <span class="bookacti-group-availability" >('+ak+")</span>","for":"bookacti-group-of-events-"+af};y.trigger("bookacti_choose_group_dialog_group_label",[N,af,M]);var U=$j("<label></label>",N);var R=$j("<ul></ul>",{"class":"bookacti-group-of-events-list bookacti-custom-scrollbar","data-group-id":af});$j.each(bookacti.booking_system[E]["groups_events"][af],function(ar,aq){var ap=aq.start.substr(0,10)===aq.end.substr(0,10);var ao=moment.utc(aq.start).locale(bookacti_localized.current_lang_code);var an=moment.utc(aq.end).locale(bookacti_localized.current_lang_code);var at=ao.formatPHP(bookacti_localized.date_format)+bookacti_localized.dates_separator+an.formatPHP(bookacti_localized.date_format);if(ap){at=ao.formatPHP(bookacti_localized.date_format)+bookacti_localized.date_time_separator+an.formatPHP(bookacti_localized.time_format)}var au=$j("<li></li>",{html:'<span class="bookacti-booking-event-duration" >'+at+'</span><span class="bookacti-booking-event-title-separator" > - </span><span class="bookacti-booking-event-title" >'+aq.title+"</span>"});R.append(au)});T.append(W);T.append(U);Z.append(T);Z.append(R);g.append(Z)}});g.find('input[name="group_of_events"]').on("change",function(){var N=$j(this).val();y.trigger("bookacti_group_of_events_preview",[N,M])});g.find('input[name="group_of_events"]:not([disabled]):first').prop("checked",true).trigger("change");H.dialog("open");H.dialog({close:function(){var N=g.find('input[type="radio"]:checked').val();if(typeof N==="undefined"){bookacti_unpick_all_events(y)}}});H.dialog("option","buttons",[{text:bookacti_localized.dialog_button_ok,click:function(){var N=g.find('input[type="radio"]:checked').val();if(typeof N!=="undefined"){bookacti_unpick_all_events(y);bookacti_pick_events_of_group(y,N,M);y.trigger("bookacti_group_of_events_chosen",[N,M])}$j(this).dialog("close")}}])};