$j(document).ready(function(){$j("body").on("click",".ui-widget-overlay",function(){$j("div:ui-dialog:visible").dialog("close")});$j("body").on("keydown",".bookacti-booking-system-dialog",function(a){if(!$j("textarea").is(":focus")&&a.keyCode==$j.ui.keyCode.ENTER){$j(this).parent().find(".ui-dialog-buttonpane button:first").focus();return false}});$j("body").on("bookacti_group_of_events_preview",".bookacti-booking-system",function(f,c,b){var a=$j(this);var d=a.closest("bookacti-booking-system-container").find(".bookacti-groups-of-events-list");d.find('.bookacti-group-of-events-option[data-group-id!="'+c+'"]').data("show-events",0).attr("data-show-events",0);d.find('.bookacti-group-of-events-list[data-group-id!="'+c+'"]').hide(200);d.find('.bookacti-group-of-events-option[data-group-id="'+c+'"]').data("show-events",1).attr("data-show-events",1);d.find('.bookacti-group-of-events-list[data-group-id="'+c+'"]').show(200);bookacti_unpick_all_events(a);bookacti_pick_events_of_group(a,c,b)})});function bookacti_init_booking_system_dialogs(){$j(".bookacti-booking-system-dialog").dialog({modal:true,autoOpen:false,minHeight:300,minWidth:400,resize:"auto",show:true,hide:true,dialogClass:"bookacti-dialog",closeText:"&#10006;",close:function(){}})}function bookacti_dialog_choose_group_of_events(k,e,C){var s=k.attr("id");var g=s==="bookacti-booking-system-bookings-page"?"booking_page":"frontend";var D=$j("#"+s+"-choose-group-of-events-dialog");var p=$j("#"+s+"-groups-of-events-list");var F=bookacti.booking_system[s]["past_events"];var o=bookacti.booking_system[s]["past_events_bookable"];var q=moment.utc(bookacti_localized.current_time);p.data("booking-system-id",s);p.empty();if(bookacti.booking_system[s]["groups_single_events"]){var B="single";var G="";if(g==="booking_page"){var b=bookacti_get_bookings_number_for_a_single_grouped_event(k,C,e);var z=b>1?bookacti_localized.bookings:bookacti_localized.booking;G=b+" "+z}else{var u=bookacti_get_event_availability(k,C);var x=u>1?bookacti_localized.avails:bookacti_localized.avail;G=u+" "+x}var v=true;if(F){var c=moment.utc(C.start).clone();var m=moment.utc(C.end).clone();if(!o&&c.isBefore(q)&&!(bookacti_localized.started_events_bookable&&m.isAfter(q))){v=false}}if(v&&typeof bookacti.booking_system[s]["events_data"][C.id]!=="undefined"){v=false;var I=false;var r=parseInt(bookacti.booking_system[s]["events_data"][C.id]["activity_id"]);var A=bookacti.booking_system[s]["activities_data"][r]["settings"];var H=typeof A.min_bookings_per_user==="undefined"?0:(A.min_bookings_per_user?parseInt(A.min_bookings_per_user):0);if(H<=u){I=true}var y=max_users_ok=true;if(typeof bookacti.booking_system[s]["bookings"][C.id]!=="undefined"){var c=C.start instanceof moment?C.start.format("YYYY-MM-DD HH:mm:ss"):C.start;var m=C.end instanceof moment?C.end.format("YYYY-MM-DD HH:mm:ss"):C.end;var d=typeof A.max_bookings_per_user==="undefined"?0:(A.max_bookings_per_user?parseInt(A.max_bookings_per_user):0);var j=typeof A.max_users_per_event==="undefined"?0:(A.max_users_per_event?parseInt(A.max_users_per_event):0);if(d||j){$j.each(bookacti.booking_system[s]["bookings"][C.id],function(L,J){if(c===J.event_start&&m===J.event_end){var K=parseInt(J.current_user_bookings);if(j&&K===0&&J.distinct_users>=j){max_users_ok=false}if(d&&K>=d){y=false}return false}})}}if(I&&y&&max_users_ok){v=true}}var w=$j("<div />",{});var l=$j("<div />",{"class":"bookacti-group-of-events-option","data-group-id":B,"data-show-events":0});var t=$j("<input />",{id:"bookacti-group-of-events-"+B,type:"radio",name:"group_of_events",value:B,disabled:g!=="booking_page"&&!v,});var n=$j("<label />",{html:bookacti_localized.single_event+' <span class="bookacti-group-availability" >('+G+")</span>","for":"bookacti-group-of-events-"+B});var f=$j("<ul />",{"class":"bookacti-group-of-events-list bookacti-custom-scrollbar","data-group-id":B});var E=bookacti_format_event_duration(C.start,C.end);var i={title:C.title,duration:E,quantity:1};k.trigger("bookacti_group_of_events_list_data",[i,C]);var a={html:'<span class="bookacti-booking-event-duration" >'+i.duration+'</span><span class="bookacti-booking-event-title-separator" > - </span><span class="bookacti-booking-event-title" >'+i.title+"</span>"};k.trigger("bookacti_group_of_events_list_element_data",[a,C]);var h=$j("<li />",a);l.append(t);l.append(n);w.append(l);f.append(h);w.append(f);p.append(w)}$j.each(e,function(ac,aa){aa=parseInt(aa);if(typeof bookacti.booking_system[s]["groups_events"][aa]!=="undefined"&&typeof bookacti.booking_system[s]["groups_data"][aa]!=="undefined"){var R=bookacti.booking_system[s]["groups_data"][aa];var T=R.availability;var U=true;if(F){var ad=moment.utc(R.start).clone();var Z=moment.utc(R.end).clone();if(!o&&ad.isBefore(q)&&!(bookacti_localized.started_groups_bookable&&Z.isAfter(q))){U=false}}if(U){U=false;var ah=false;var K=parseInt(R.category_id);var ae=bookacti.booking_system[s]["group_categories_data"][K]["settings"];var ag=typeof ae.min_bookings_per_user==="undefined"?0:(ae.min_bookings_per_user?parseInt(ae.min_bookings_per_user):0);if(ag<=T&&T>0){ah=true}var O=typeof ae.max_users_per_event==="undefined"?0:(ae.max_users_per_event?parseInt(ae.max_users_per_event):0);var M=typeof ae.max_bookings_per_user==="undefined"?0:(ae.max_bookings_per_user?parseInt(ae.max_bookings_per_user):0);var Y=max_users_ok=true;if(M||O){var ab=parseInt(R.current_user_bookings);if(O&&ab===0&&R.distinct_users>=O){max_users_ok=false}if(M&&ab>=M){Y=false}}if(ah&&Y&&max_users_ok){U=true}}var V=$j("<div />",{});var P=$j("<div />",{"class":"bookacti-group-of-events-option","data-group-id":aa,"data-show-events":0});var S=$j("<input />",{id:"bookacti-group-of-events-"+aa,type:"radio",name:"group_of_events",disabled:g!=="booking_page"&&!U,value:aa});var af="";if(g==="booking_page"){var L=0;$j.each(bookacti.booking_system[s]["groups_events"][aa],function(aj,ai){if(C.id==ai.id&&C.start.format("YYYY-MM-DD HH:mm:ss")===ai.start&&C.end.format("YYYY-MM-DD HH:mm:ss")===ai.end){L=ai.group_bookings}});var X=L>1?bookacti_localized.bookings:bookacti_localized.booking;af=L+" "+X}else{var W=T>1?bookacti_localized.avails:bookacti_localized.avail;af=T+" "+W}var J={html:bookacti.booking_system[s]["groups_data"][aa]["title"]+' <span class="bookacti-group-availability" >('+af+")</span>","for":"bookacti-group-of-events-"+aa};k.trigger("bookacti_choose_group_dialog_group_label",[J,aa,C]);var Q=$j("<label />",J);var N=$j("<ul />",{"class":"bookacti-group-of-events-list bookacti-custom-scrollbar","data-group-id":aa});$j.each(bookacti.booking_system[s]["groups_events"][aa],function(al,ao){var aj=ao.start.substr(0,10)===ao.end.substr(0,10);var an=moment(ao.start).locale(bookacti_localized.current_lang_code);var ak=moment(ao.end).locale(bookacti_localized.current_lang_code);var ai=an.formatPHP(bookacti_localized.date_format)+bookacti_localized.dates_separator+ak.formatPHP(bookacti_localized.date_format);if(aj){ai=an.formatPHP(bookacti_localized.date_format)+bookacti_localized.date_time_separator+ak.formatPHP(bookacti_localized.time_format)}var am=$j("<li />",{html:'<span class="bookacti-booking-event-duration" >'+ai+'</span><span class="bookacti-booking-event-title-separator" > - </span><span class="bookacti-booking-event-title" >'+ao.title+"</span>"});N.append(am)});P.append(S);P.append(Q);V.append(P);V.append(N);p.append(V)}});p.find('input[name="group_of_events"]').on("change",function(){var J=$j(this).val();k.trigger("bookacti_group_of_events_preview",[J,C])});p.find('input[name="group_of_events"]:not([disabled]):first').prop("checked",true).trigger("change");D.dialog("open");D.dialog({close:function(){var J=p.find('input[type="radio"]:checked').val();if(typeof J==="undefined"){bookacti_unpick_all_events(k)}}});D.dialog("option","buttons",[{text:bookacti_localized.dialog_button_ok,click:function(){var J=p.find('input[type="radio"]:checked').val();if(typeof J!=="undefined"){bookacti_unpick_all_events(k);bookacti_pick_events_of_group(k,J,C);k.trigger("bookacti_group_of_events_chosen",[J,C])}$j(this).dialog("close")}}])};