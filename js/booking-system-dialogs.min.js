$j(document).ready(function(){$j("body").on("click",".ui-widget-overlay",function(){$j("div:ui-dialog:visible").dialog("close")});$j("body").on("keydown",".bookacti-booking-system-dialog",function(a){if(!$j("textarea").is(":focus")&&a.keyCode==$j.ui.keyCode.ENTER){$j(this).parent().find(".ui-dialog-buttonpane button:first").focus();return false}})});function bookacti_init_booking_system_dialogs(){$j(".bookacti-booking-system-dialog").dialog({modal:true,autoOpen:false,minHeight:300,minWidth:400,resize:"auto",show:true,hide:true,dialogClass:"bookacti-dialog",closeText:"&#10006;",close:function(){}})}function bookacti_dialog_choose_group_of_events(B,i,O){var G=B.attr("id");var J=$j("#"+G+"-choose-group-of-events-dialog");var h=$j("#"+G+"-groups-of-events-list");var E=bookacti.booking_system[G];var d=E.multiple_bookings;var p=E.bookings_only;var H=E.past_events;var y=E.past_events_bookable;var t=moment.utc(bookacti_localized.current_time);h.data("booking-system-id",G);h.empty();if(E.groups_single_events){var v="";if(p){var r=bookacti_get_bookings_number_for_a_single_grouped_event(B,O,i);var f=r===1?bookacti_localized.booking:bookacti_localized.bookings;v=r+" "+f}else{var k=bookacti_get_event_availability(B,O);var m=k===1?bookacti_localized.avail:bookacti_localized.avails;v=k+" "+m}var g=true;if(H){var c=moment.utc(O.start).clone();var L=moment.utc(O.end).clone();if(!y&&c.isBefore(t)&&!(bookacti_localized.started_events_bookable&&L.isAfter(t))){g=false}}var s=typeof O.groupId!=="undefined"?parseInt(O.groupId):parseInt(O.id);if(g&&typeof E.events_data[s]!=="undefined"){g=false;var e=false;var z=parseInt(E.events_data[s]["activity_id"]);var N=E.activities_data[z]["settings"];var n=typeof N.min_bookings_per_user==="undefined"?0:(N.min_bookings_per_user?parseInt(N.min_bookings_per_user):0);if(n<=k){e=true}var q=max_users_ok=true;var K=typeof N.max_bookings_per_user==="undefined"?0:(N.max_bookings_per_user?parseInt(N.max_bookings_per_user):0);var o=typeof N.max_users_per_event==="undefined"?0:(N.max_users_per_event?parseInt(N.max_users_per_event):0);if(K||o){var D=moment.utc(O.start).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");if(typeof E.bookings[s]!=="undefined"){if(typeof E.bookings[s][D]!=="undefined"){var l=E.bookings[s][D];var M=parseInt(l.current_user_bookings);if(o&&M===0&&parseInt(l.distinct_users)>=o){max_users_ok=false}if(K&&M>=K){q=false}}}}if(e&&q&&max_users_ok){g=true}}var A=$j("<div></div>",{});var x=$j("<div></div>",{id:"bookacti-group-of-events-option-single","class":"bookacti-group-of-events-option","data-group-id":0,"data-group-date":"","data-show-events":0});var w=$j("<input />",{id:"bookacti-group-of-events-single",type:"radio",name:"group_of_events",value:"single",disabled:!p&&!g});var b={html:bookacti_localized.single_event+' <span class="bookacti-group-availability" >('+v+")</span>","for":"bookacti-group-of-events-single"};B.trigger("bookacti_choose_group_dialog_group_label",[b,0,"",O]);var F=$j("<label></label>",b);var C=$j("<ul></ul>",{id:"bookacti-group-of-events-list-single","class":"bookacti-group-of-events-list bookacti-custom-scrollbar","data-group-id":0,"data-group-date":""});var I=bookacti_format_event_duration(O.start,O.end);var j={title:typeof O.title!=="undefined"?O.title:"",duration:I,quantity:1};B.trigger("bookacti_group_of_events_list_data",[j,O]);var u={html:'<span class="bookacti-booking-event-duration" >'+j.duration+'</span><span class="bookacti-booking-event-title-separator" > - </span><span class="bookacti-booking-event-title" >'+j.title+"</span>"};B.trigger("bookacti_group_of_events_list_element_data",[u,O]);var a=$j("<li></li>",u);x.append(w);x.append(F);A.append(x);C.append(a);A.append(C);h.append(A)}$j.each(i,function(S,U){if(typeof E.groups_data[S]==="undefined"){return true}var T=E.groups_data[S];var R=parseInt(T.category_id);var Q=E.group_categories_data[R]["settings"];var P=parseInt(bookacti_localized.started_groups_bookable);if(typeof Q.started_groups_bookable!=="undefined"){if($j.inArray(Q.started_groups_bookable,[0,1,"0","1",true,false])>=0){P=$j.isNumeric(Q.started_groups_bookable)?parseInt(Q.started_groups_bookable):(Q.started_groups_bookable?1:0)}}$j.each(U,function(X,Z){var aa,ao,aq,al;aa=ao=aq=al=0;if(typeof E.groups_bookings[S]!=="undefined"){if(typeof E.groups_bookings[S][X]!=="undefined"){aa=E.groups_bookings[S][X]["availability"];ao=E.groups_bookings[S][X]["quantity"];aq=E.groups_bookings[S][X]["current_user_bookings"];al=E.groups_bookings[S][X]["distinct_users"]}}var af=parseInt(aa)>0;var an=moment.utc(Z[0].start).clone();var ak=moment.utc(Z[Z.length-1].end).clone();if(!y&&an.isBefore(t)&&!(P&&ak.isAfter(t))){af=false}if(af){af=false;var at=false;var ar=typeof Q.min_bookings_per_user==="undefined"?0:(Q.min_bookings_per_user?parseInt(Q.min_bookings_per_user):0);if(ar<=aa&&aa>0){at=true}var ab=typeof Q.max_users_per_event==="undefined"?0:(Q.max_users_per_event?parseInt(Q.max_users_per_event):0);var W=typeof Q.max_bookings_per_user==="undefined"?0:(Q.max_bookings_per_user?parseInt(Q.max_bookings_per_user):0);var aj=max_users_ok=true;if(W||ab){var am=parseInt(aq);if(ab&&am===0&&parseInt(al)>=ab){max_users_ok=false}if(W&&am>=W){aj=false}}if(at&&aj&&max_users_ok){af=true}}var ag=$j("<div></div>",{});var ac=$j("<div></div>",{id:"bookacti-group-of-events-option-"+S+"_"+X,"class":"bookacti-group-of-events-option","data-group-id":S,"data-group-date":X,"data-show-events":0});var ae=$j("<input />",{id:"bookacti-group-of-events-"+S+"_"+X,type:"radio",name:"group_of_events",disabled:!p&&!af,value:S+"_"+X});var ap="";if(p){var ai=ao===1?bookacti_localized.booking:bookacti_localized.bookings;ap=ao+" "+ai}else{var ah=aa===1?bookacti_localized.avail:bookacti_localized.avails;ap=aa+" "+ah}var V={html:T.title+' <span class="bookacti-group-availability" >('+ap+")</span>","for":"bookacti-group-of-events-"+S+"_"+X};B.trigger("bookacti_choose_group_dialog_group_label",[V,S,X,O]);var ad=$j("<label></label>",V);var Y=$j("<ul></ul>",{id:"bookacti-group-of-events-list-"+S+"_"+X,"class":"bookacti-group-of-events-list bookacti-custom-scrollbar","data-group-id":S,"data-group-date":X});$j.each(Z,function(aw,ay){var av=ay.start.substr(0,10)===ay.end.substr(0,10);var az=moment.utc(ay.start).locale(bookacti_localized.current_lang_code);var au=moment.utc(ay.end).locale(bookacti_localized.current_lang_code);var aA=az.formatPHP(bookacti_localized.date_format)+bookacti_localized.dates_separator+au.formatPHP(bookacti_localized.date_format);if(av){aA=az.formatPHP(bookacti_localized.date_format)+bookacti_localized.date_time_separator+au.formatPHP(bookacti_localized.time_format)}var ax=$j("<li></li>",{html:'<span class="bookacti-booking-event-duration" >'+aA+'</span><span class="bookacti-booking-event-title-separator" > - </span><span class="bookacti-booking-event-title" >'+ay.title+"</span>"});Y.append(ax)});ac.append(ae);ac.append(ad);ag.append(ac);ag.append(Y);h.append(ag)})});h.find('input[name="group_of_events"]').on("change",function(){var S=$j(this).val();var Q=S!=="single"?parseInt(S.substr(0,S.indexOf("_"))):0;var T=S!=="single"?S.substr(S.indexOf("_")+1):"";var R=$j("#"+G+"-choose-group-of-events-dialog .bookacti-groups-of-events-list");R.find(".bookacti-group-of-events-option:not(#bookacti-group-of-events-option-"+S+")").data("show-events",0).attr("data-show-events",0);R.find(".bookacti-group-of-events-list:not(#bookacti-group-of-events-list-"+S+")").hide(200);R.find("#bookacti-group-of-events-option-"+S).data("show-events",1).attr("data-show-events",1);R.find("#bookacti-group-of-events-list-"+S).show(200);var P={click:true};if($j(this).is(":disabled")){P.click=false}B.trigger("bookacti_trigger_group_of_events_preview",[P,Q,T,O]);if(P.click){if(d){bookacti_unpick_events(B,O)}else{bookacti_unpick_all_events(B)}bookacti_pick_events(B,O,Q,T);B.trigger("bookacti_group_of_events_preview",[Q,T,O])}});h.find('input[name="group_of_events"]:not([disabled]):first').prop("checked",true).trigger("change");J.dialog({close:function(){var P=h.find('input[type="radio"]:checked').val();if(typeof P==="undefined"&&!d){bookacti_unpick_all_events(B)}}});J.dialog("option","buttons",[{text:bookacti_localized.dialog_button_ok,click:function(){var R=h.find('input[type="radio"]:checked').val();if(typeof R!=="undefined"){var P={click:true};if(h.find('input[type="radio"]:checked').is(":disabled")){P.click=false}var Q=R!=="single"?parseInt(R.substr(0,R.indexOf("_"))):0;var S=R!=="single"?R.substr(R.indexOf("_")+1):"";B.trigger("bookacti_trigger_group_of_events_click",[P,Q,S,O]);if(P.click){if(d){bookacti_unpick_events(B,O)}else{bookacti_unpick_all_events(B)}bookacti_pick_events(B,O,Q,S);B.trigger("bookacti_group_of_events_chosen",[Q,S,O])}}$j(this).dialog("close")}}]);J.dialog("open")};