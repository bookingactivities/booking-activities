$j(document).ready(function(){if(!$j("#bookacti-template-container").length){return}bookacti.selected_template=parseInt($j("#bookacti-template-picker").val())||0;bookacti.hidden_activities=[];bookacti.selected_category="new";bookacti.is_dragging=false;bookacti.is_resizing=false;bookacti.is_hovering=false;bookacti.load_events=false;bookacti.booking_system["bookacti-template-calendar"]={};bookacti.booking_system["bookacti-template-calendar"]["calendars"]=bookacti.selected_template?[bookacti.selected_template]:[];bookacti.booking_system["bookacti-template-calendar"]["bookings"]=[];bookacti.booking_system["bookacti-template-calendar"]["groups_events"]=[];bookacti.booking_system["bookacti-template-calendar"]["groups_data"]=[];bookacti.booking_system["bookacti-template-calendar"]["activities_data"]={};bookacti.booking_system["bookacti-template-calendar"]["events_data"]=[];bookacti.booking_system["bookacti-template-calendar"]["events_interval"]=[];bookacti.booking_system["bookacti-template-calendar"]["group_categories_data"]=[];bookacti.booking_system["bookacti-template-calendar"]["start"]="1970-02-01 00:00:00";bookacti.booking_system["bookacti-template-calendar"]["end"]="2037-12-31 23:59:59";bookacti.booking_system["bookacti-template-calendar"]["display_data"]=[];bookacti.booking_system["bookacti-template-calendar"]["template_data"]=[];bookacti.booking_system["bookacti-template-calendar"]["selected_events"]=[];bookacti.booking_system["bookacti-template-calendar"]["picked_events"]=[];bookacti.booking_system["bookacti-template-calendar"]["loading_number"]=0;bookacti.booking_system["bookacti-template-calendar"]["method"]="calendar";bookacti.booking_system["bookacti-template-calendar"]["past_events"]=true;bookacti.booking_system["bookacti-template-calendar"]["past_events_bookable"]=true;bookacti_init_groups_of_events();bookacti_init_show_hide_activities_switch();bookacti_init_event_duplication_feedbacks();bookacti_init_template_dialogs();bookacti_bind_template_dialogs();$j("body").on("change","#bookacti-template-picker",function(){bookacti_switch_template($j(this).val())});if($j("#bookacti-template-calendar").length){bookacti_load_template_calendar($j("#bookacti-template-calendar"))}if(bookacti.selected_template){bookacti_switch_template(bookacti.selected_template)}$j("body").on("dragstart","#bookacti-template-activities-container .fc-event",function(b,a){a.helper.css("maxWidth",$j(this).width())});$j("body").on("bookacti_clear_events","#bookacti-template-calendar",function(b,a){bookacti_clear_events_on_calendar_editor()});window.onerror=function(e,b,a,d,c){$j("#bookacti-fatal-error").show()};$j("body").on("click","#bookacti-exit-loading",function(){bookacti_exit_template_loading_state(true);bookacti.load_events=true})});function bookacti_load_template_calendar(f){f=f||$j("#bookacti-template-calendar");var c=bookacti_get_availability_period(f);var d=typeof bookacti.booking_system["bookacti-template-calendar"]["display_data"]!=="undefined"?bookacti.booking_system["bookacti-template-calendar"]["display_data"]:{};var a=typeof d.minTime!=="undefined"?d.minTime:"00:00";var b=typeof d.maxTime!=="undefined"?d.maxTime:"24:00";var g=typeof d.snapDuration!=="undefined"?d.snapDuration:"00:05";var e={locale:bookacti_localized.fullcalendar_locale,defaultView:"agendaWeek",minTime:a,maxTime:b,slotLabelFormat:"LT",slotDuration:"00:30",snapDuration:g,scrollTime:"00:00",aspectRatio:"auto",validRange:{start:c.start?moment.utc(c.start.substr(0,10)):moment.utc("1970-02-01 00:00:00"),end:c.end?moment.utc(c.end.substr(0,10)).add(1,"days"):moment.utc("2037-12-31 23:59:59")},nowIndicator:false,weekNumbers:false,weekNumbersWithinDays:true,navLinks:true,slotEventOverlap:false,eventLimit:false,eventLimitClick:"popover",allDaySlot:false,allDayDefault:false,fixedWeekCount:false,showNonCurrentDates:true,editable:true,droppable:true,dropAccept:".fc-event",eventDurationEditable:true,dragRevertDuration:0,customButtons:{goTo:{text:bookacti_localized.go_to_button,click:function(){if(!$j(".bookacti-go-to-datepicker").length){$j(".fc-goTo-button").after('<input type="date" class="bookacti-go-to-datepicker"/>');$j(".bookacti-go-to-datepicker").hide()}$j(".bookacti-go-to-datepicker").toggle(200)}}},header:{left:"prevYear,prev,next,nextYear today goTo",center:"title",right:"month,agendaWeek,agendaDay"},events:function(k,h,i,j){j([])},viewRender:function(h,l){if(bookacti.load_events===true){var j={start:moment.utc(moment.utc(h.intervalStart).clone().locale("en").format("YYYY-MM-DD")+" 00:00:00").locale("en"),end:moment.utc(moment.utc(h.intervalEnd).clone().locale("en").subtract(1,"days").format("YYYY-MM-DD")+" 23:59:59").locale("en")};var m=bookacti_get_interval_of_events($j("#bookacti-template-calendar"),j);if(!$j.isEmptyObject(m)){bookacti_get_calendar_editor_data_by_interval(m)}}if(h.name.indexOf("agenda")>-1){var k=typeof d.slotEventOverlap!=="undefined"?d.slotEventOverlap:f.fullCalendar("option","slotEventOverlap");if(k){l.addClass("bookacti-events-overlap")}}var i=bookacti.booking_system["bookacti-template-calendar"]["template_data"];if(typeof i!=="undefined"){if(typeof i.settings!=="undefined"){if(typeof i.settings.days_off!=="undefined"){$j.each(i.settings.days_off,function(o,s){var r=moment.utc(s.from+" 00:00:00");var n=moment.utc(s.to+" 23:59:59");if(n.isBefore(h.start)||r.isAfter(h.end)){return true}do{var p=r.format("YYYY-MM-DD");var q=f.find('th[data-date="'+p+'"], td[data-date="'+p+'"]');q.addClass("fc-disabled-day");q.find("a").contents().unwrap();r.add(1,"days")}while(r.isSameOrBefore(n))})}}}f.trigger("bookacti_view_render",[h,l])},eventRender:function(C,m,A){if(!C.start||!C.end||C.start===C.end){return false}if(bookacti.is_dragging||bookacti.is_resizing){return true}var t=bookacti.booking_system["bookacti-template-calendar"]["events_data"][C.id];var y=0;var p=moment.utc(C.start).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");var v=moment.utc(C.end).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");m.data("event-id",C.id);m.attr("data-event-id",C.id);m.data("event-start",p);m.attr("data-event-start",p);m.data("event-end",v);m.attr("data-event-end",v);C.render=1;if(typeof t!=="undefined"){y=t.activity_id;m.data("activity-id",y);m.attr("data-activity-id",y)}var F=m.find(".fc-title");F.html(F.text());var o="LT";if(A.name.indexOf("agenda")>-1){o=f.fullCalendar("option","noMeridiemTimeFormat")}if(bookacti_localized.calendar_localization==="wp_settings"){o=bookacti_convert_php_datetime_format_to_moment_js(bookacti_localized.wp_time_format)}m.find(".fc-time").html('<span class="bookacti-event-time-start">'+C.start.format(o)+'</span><span class="bookacti-event-time-separator"> - </span><span class="bookacti-event-time-end">'+C.end.format(o)+"</span>");var z=typeof t!=="undefined"?parseInt(t.availability):0;C.bookings=bookacti_get_event_number_of_bookings($j("#bookacti-template-calendar"),C);if(C.bookings!=null){var u="",h="",l="";if(z===0){u="bookacti-no-availability"}else{if(C.bookings>0){h="bookacti-booked"}else{h="bookacti-not-booked"}if(C.bookings>=z){l="bookacti-full"}}var i='<div class="bookacti-availability-container" ><span class="bookacti-available-places '+u+" "+h+" "+l+'" ><span class="bookacti-bookings" >'+C.bookings+'</span><span class="bookacti-total-availability" >/'+z+"</span></span></div>";m.append(i)}var w=m.find(".bookacti-event-actions").length?m.find(".bookacti-event-actions"):$j("<div></div>",{"class":"bookacti-event-actions"});var D=[];if(!w.find(".bookacti-event-action-edit").length){var n=$j("<div></div>",{"class":"bookacti-event-action bookacti-event-action-edit","data-hide-on-mouseout":"1"});var s=$j("<span></span>",{type:"checkbox","class":"dashicons dashicons-admin-generic bookacti-event-action-edit-button","aria-hidden":"true"});D.push(n.prepend(s))}if(!w.find(".bookacti-event-action-select").length){var x=moment.utc(C.start).clone().locale("en").format("YYYY-MM-DD");var B=false;$j.each(bookacti.booking_system["bookacti-template-calendar"]["selected_events"],function(H,G){if(G.id==C.id&&G.start.substr(0,10)===x){B=true;return false}});var E=$j("<div></div>",{"class":"bookacti-event-action bookacti-event-action-select","data-hide-on-mouseout":"0"});var r=$j("<input />",{type:"checkbox","class":"bookacti-event-action-select-checkbox",value:"0",checked:B});D.push(E.append(r))}$j.each(D,function(H,G){w.append(G)});f.trigger("bookacti_event_actions",[w,C,m,A]);m.append(w);if(A.hasOwnProperty("dayGrid")){var q=$j("<div></div>",{"class":"fc-bg"});m.append(q)}var k=bookacti.booking_system["bookacti-template-calendar"]["template_data"];if(typeof k!=="undefined"&&C.render){if(typeof k.settings!=="undefined"){if(typeof k.settings.days_off!=="undefined"){var j=moment.utc(C.start);$j.each(k.settings.days_off,function(H,J){var I=moment.utc(J.from+" 00:00:00");var G=moment.utc(J.to+" 23:59:59");if(j.isBetween(I,G,"second","[]")){C.render=0}})}}}if(typeof t!=="undefined"&&C.render){if(t.repeat_freq&&t.repeat_freq!=="none"&&typeof t.repeat_exceptions!=="undefined"){var j=moment.utc(C.start);$j.each(t.repeat_exceptions,function(H,I){var G=moment.utc(I.from+" 00:00:00");var J=moment.utc(I.to+" 23:59:59");if(j.isBetween(G,J,"second","[]")){C.render=0}})}}if(bookacti.hidden_activities&&y&&C.render){if($j.inArray(parseInt(y),bookacti.hidden_activities)>=0){C.render=0}}f.trigger("bookacti_event_render",[C,m,A]);if(!C.render){return false}},eventAfterRender:function(j,i,h){bookacti_add_class_according_to_event_size(i);f.trigger("bookacti_calendar_editor_event_after_render",[j,i,h])},eventAfterAllRender:function(h){f.find(".fc-event").toggleClass("bookacti-event-unavailable",bookacti.booking_system["bookacti-template-calendar"]["loading_number"]>0);$j('.bookacti-event-action[data-hide-on-mouseout="1"]').hide();$j.each(bookacti.booking_system["bookacti-template-calendar"]["picked_events"],function(k,l){var j=moment.utc(l.start).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");f.find('.fc-event[data-event-id="'+l.id+'"][data-event-start="'+j+'"]').addClass("bookacti-picked-event")});bookacti_refresh_selected_events_display();f.trigger("bookacti_calendar_editor_event_after_all_render",[h])},eventAllow:function(j,i){var k={allow:true};var h=bookacti.booking_system["bookacti-template-calendar"]["template_data"];if(typeof h!=="undefined"){if(typeof h.settings!=="undefined"){if(typeof h.settings.days_off!=="undefined"){$j.each(h.settings.days_off,function(m,o){var n=moment.utc(o.from+" 00:00:00");var l=moment.utc(o.to+" 23:59:59");if(j.start.isBetween(n,l,"second","[]")){k.allow=false;return false}})}}}f.trigger("bookacti_calendar_editor_allow_drop",[k.allow,j,i]);return k.allow},eventReceive:function(h){var p=parseInt(h.activity_id);var n=bookacti.booking_system["bookacti-template-calendar"]["activities_data"][p];var m=f.fullCalendar("getView");if(!n){return false}if(m.name.substr(0,6)!=="agenda"){var i=f.fullCalendar("option","minTime");h.start.set({hours:i.substr(0,2),minutes:i.substr(3,2),seconds:0})}var k=n.duration?n.duration:"000.01:00:00";h.end=h.start.clone();h.end.add(moment.duration(k));var l=moment.utc(h.start).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");var o=moment.utc(h.end).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");var j={action:"bookactiInsertEvent",activity_id:p,template_id:bookacti.selected_template,title:n.multilingual_title,start:l,end:o,availability:n.availability,nonce:$j("#nonce_edit_template").val()};f.trigger("bookacti_insert_event_before",[h,j]);bookacti_start_template_loading();$j.ajax({url:ajaxurl,data:j,type:"POST",dataType:"json",success:function(q){if(q.status==="success"){h.id=q.event_id;h.bookings=0;bookacti.booking_system["bookacti-template-calendar"]["events_data"][h.id]=q.event_data;f.fullCalendar("updateEvent",h);f.trigger("bookacti_event_inserted",[h,q,j])}else{if(typeof h._id!=="undefined"){if(h._id.indexOf("_")>=0){f.fullCalendar("removeEvents",h._id)}}else{if(typeof h.id!=="undefined"){f.fullCalendar("removeEvents",h.id)}}f.fullCalendar("refetchEvents");var r=typeof q.message!=="undefined"?q.message:bookacti_localized.error;alert(r);console.log(r);console.log(q)}},error:function(q){alert("AJAX "+bookacti_localized.error);console.log(q)},complete:function(){bookacti_stop_template_loading()}})},eventResize:function(i,j,h){bookacti_update_event_dates(i,j,h)},eventDrop:function(j,l,i,k){var h=0;if(k.altKey){h=1}if(h){i();bookacti_duplicate_event(j,l,i)}else{bookacti_update_event_dates(j,l,i)}},eventDragStart:function(k,i,m,h){var j=$j(this);bookacti.is_dragging=true;var l=$j('.fc-event[data-event-id="'+k.id+'"]');l.addClass("bookacti-event-dragged");f.trigger("bookacti_calendar_editor_drag_start",[k,j])},eventDragStop:function(k,i,m,h){var j=$j(this);bookacti.is_dragging=false;var l=$j('.fc-event[data-event-id="'+k.id+'"]');l.removeClass("bookacti-event-dragged");f.trigger("bookacti_calendar_editor_drag_stop",[k,j])},eventResizeStart:function(k,i,l,h){var j=$j(this);bookacti.is_resizing=true;f.trigger("bookacti_calendar_editor_resize_start",[k,j])},eventResizeStop:function(k,i,l,h){var j=$j(this);bookacti.is_resizing=false;f.trigger("bookacti_calendar_editor_resize_stop",[k,j])},eventClick:function(l,j,i){var k=$j(this);var h=moment.utc(l.start).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");var m=$j('.fc-event[data-event-id="'+l.id+'"][data-event-start="'+h+'"]');if(bookacti.is_touch_device){if(!k.find(".bookacti-event-action").is(":visible")){$j(".bookacti-event-over").removeClass("bookacti-event-over");bookacti_show_event_actions(k)}else{bookacti_hide_event_actions(k,l)}}bookacti.booking_system["bookacti-template-calendar"]["picked_events"]=[];$j(".fc-event").removeClass("bookacti-picked-event");m.addClass("bookacti-picked-event");bookacti_pick_event($j("#bookacti-template-calendar"),l);if($j(j.target).closest(".bookacti-event-actions").length){if($j(j.target).is(".bookacti-event-action-edit")||$j(j.target).closest(".bookacti-event-action-edit").length){if(l.editable!==false){bookacti_dialog_update_event(l)}}else{if($j(j.target).is(".bookacti-event-action-select")||$j(j.target).closest(".bookacti-event-action-select").length){if(k.find(".bookacti-event-action-select-checkbox").is(":checked")){bookacti_select_event(l)}else{bookacti_unselect_event(l);k.find(".bookacti-event-action-select").show()}}}}f.trigger("bookacti_calendar_editor_event_click",[l,j,i])},eventMouseover:function(k,i,h){var j=$j(this);bookacti_show_event_actions(j);bookacti.is_hovering=true;f.trigger("bookacti_calendar_editor_event_mouse_over",[k,j])},eventMouseout:function(k,i,h){var j=$j(this);bookacti_hide_event_actions(j,k);bookacti.is_hovering=false;f.trigger("bookacti_calendar_editor_event_mouse_out",[k,j])},loading:function(h){if(!h&&bookacti.is_touch_device){$j(".fc-event").each(function(){var i=$j.Event("mouseover",{target:this.firstChild,_dummyCalledOnStartup:true});$j(this).trigger(i)})}}};if(bookacti_localized.calendar_localization==="wp_settings"){e.firstDay=bookacti_localized.wp_start_of_week;e.slotLabelFormat=bookacti_convert_php_datetime_format_to_moment_js(bookacti_localized.wp_time_format);e.timeFormat=bookacti_convert_php_datetime_format_to_moment_js(bookacti_localized.wp_time_format)}f.trigger("bookacti_calendar_editor_init_data",[e]);f.fullCalendar(e);f.trigger("bookacti_after_calendar_editor_set_up")};