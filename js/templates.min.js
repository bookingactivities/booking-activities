$j(document).ready(function(){if(!$j("#bookacti-template-container").length){return}bookacti.selected_template=parseInt($j("#bookacti-template-picker").val())||0;bookacti.hidden_activities=[];bookacti.selected_category="new";bookacti.load_events=false;bookacti.booking_system["bookacti-template-calendar"]={};bookacti.booking_system["bookacti-template-calendar"]["calendars"]=bookacti.selected_template?[bookacti.selected_template]:[];bookacti.booking_system["bookacti-template-calendar"]["bookings"]=[];bookacti.booking_system["bookacti-template-calendar"]["groups_events"]=[];bookacti.booking_system["bookacti-template-calendar"]["groups_data"]=[];bookacti.booking_system["bookacti-template-calendar"]["activities_data"]={};bookacti.booking_system["bookacti-template-calendar"]["events_data"]=[];bookacti.booking_system["bookacti-template-calendar"]["events_interval"]=[];bookacti.booking_system["bookacti-template-calendar"]["group_categories_data"]=[];bookacti.booking_system["bookacti-template-calendar"]["start"]="1970-02-01 00:00:00";bookacti.booking_system["bookacti-template-calendar"]["end"]="2037-12-31 23:59:59";bookacti.booking_system["bookacti-template-calendar"]["display_data"]=[];bookacti.booking_system["bookacti-template-calendar"]["template_data"]=[];bookacti.booking_system["bookacti-template-calendar"]["selected_events"]=[];bookacti.booking_system["bookacti-template-calendar"]["picked_events"]=[];bookacti.booking_system["bookacti-template-calendar"]["loading_number"]=0;bookacti.booking_system["bookacti-template-calendar"]["method"]="calendar";bookacti.booking_system["bookacti-template-calendar"]["past_events"]=true;bookacti.booking_system["bookacti-template-calendar"]["past_events_bookable"]=true;bookacti_make_activities_draggable();bookacti_make_activities_sortable();bookacti_init_groups_of_events();bookacti_init_show_hide_activities_switch();bookacti_init_event_duplication_feedbacks();bookacti_init_template_dialogs();bookacti_bind_template_dialogs();$j("body").on("change","#bookacti-template-picker",function(){bookacti_switch_template($j(this).val())});if(bookacti.selected_template){bookacti_switch_template(bookacti.selected_template)}$j("body").on("bookacti_init_booking_sytem","#bookacti-template-calendar",function(c,b,a){b.load=false});$j("body").on("dragstart","#bookacti-template-activities-container .fc-event",function(b,a){a.helper.css("maxWidth",$j(this).width())});$j("body").on("bookacti_clear_events","#bookacti-template-calendar",function(b,a){bookacti_clear_events_on_calendar_editor()});window.onerror=function(e,b,a,d,c){$j("#bookacti-fatal-error").show()};$j("body").on("click","#bookacti-exit-loading",function(){bookacti_stop_template_loading(true);bookacti.load_events=true})});function bookacti_load_template_calendar(){var a=$j("#bookacti-template-calendar");var e=bookacti_get_availability_period(a);var d=typeof bookacti.booking_system["bookacti-template-calendar"]["display_data"]!=="undefined"?bookacti.booking_system["bookacti-template-calendar"]["display_data"]:{};var h=typeof bookacti_localized.event_tiny_height!=="undefined"?parseInt(bookacti_localized.event_tiny_height):32;var g=typeof d.slotMinTime!=="undefined"?d.slotMinTime:"00:00";var b=typeof d.slotMaxTime!=="undefined"?d.slotMaxTime:"24:00";var c=typeof d.snapDuration!=="undefined"?d.snapDuration:"00:05";var f={locale:bookacti_localized.fullcalendar_locale,timeZone:bookacti_localized.fullcalendar_timezone,initialView:"timeGridWeek",eventShortHeight:0,eventMinHeight:h,slotMinTime:g,slotMaxTime:b,slotDuration:"00:30",snapDuration:c,scrollTime:"00:00",height:"auto",contentHeight:"auto",nowIndicator:false,weekNumbers:false,navLinks:true,slotEventOverlap:false,dayMaxEvents:false,moreLinkClick:"popover",eventDisplay:"block",allDaySlot:false,defaultAllDay:false,fixedWeekCount:false,showNonCurrentDates:true,eventResizableFromStart:false,rerenderDelay:100,editable:true,droppable:true,dropAccept:".fc-event, .bookacti-activity-draggable",eventDurationEditable:true,dragRevertDuration:0,validRange:{start:e.start?moment.utc(e.start.substr(0,10)).format("YYYY-MM-DD"):"1970-02-01",end:e.end?moment.utc(e.end.substr(0,10)).add(1,"days").format("YYYY-MM-DD"):"2038-01-01"},customButtons:{goTo:{text:bookacti_localized.go_to_button,click:function(){if(!$j(".bookacti-go-to-datepicker").length){$j(".fc-goTo-button").after('<input type="date" class="bookacti-go-to-datepicker" min="1970-01-01"/>');$j(".bookacti-go-to-datepicker").hide()}$j(".bookacti-go-to-datepicker").toggle(200)}}},headerToolbar:{start:"prevYear,prev,next,nextYear today goTo",center:"title",end:"dayGridMonth,timeGridWeek,timeGridDay"},events:function(k,j,l){j([])},viewClassNames:function(k){var j={class_names:[]};a.trigger("bookacti_calendar_editor_view_class_names",[j,k]);return j.class_names},dayHeaderClassNames:function(m){var j={class_names:[]};var k=bookacti.booking_system["bookacti-template-calendar"]["template_data"];if(typeof k!=="undefined"){if(typeof k.settings!=="undefined"){if(typeof k.settings.days_off!=="undefined"){var l=moment.utc(m.date);$j.each(k.settings.days_off,function(o,q){var p=moment.utc(q.from+" 00:00:00");var n=moment.utc(q.to+" 23:59:59");if(l.isBetween(p,n,"second","[]")){j.class_names.push("fc-day-disabled");return false}})}}}a.trigger("bookacti_calendar_editor_day_header_class_names",[j,m]);return j.class_names},dayCellClassNames:function(m){var j={class_names:[]};var k=bookacti.booking_system["bookacti-template-calendar"]["template_data"];if(typeof k!=="undefined"){if(typeof k.settings!=="undefined"){if(typeof k.settings.days_off!=="undefined"){var l=moment.utc(m.date);$j.each(k.settings.days_off,function(o,q){var p=moment.utc(q.from+" 00:00:00");var n=moment.utc(q.to+" 23:59:59");if(l.isBetween(p,n,"second","[]")){j.class_names.push("fc-day-disabled");return false}})}}}a.trigger("bookacti_calendar_editor_day_cell_class_names",[j,m]);return j.class_names},datesSet:function(k){if(bookacti.load_events===true){var j={start:moment.utc(moment.utc(k.view.currentStart).clone().locale("en").format("YYYY-MM-DD")+" 00:00:00"),end:moment.utc(moment.utc(k.view.currentEnd).clone().locale("en").subtract(1,"days").format("YYYY-MM-DD")+" 23:59:59")};var l=bookacti_get_interval_of_events(a,j);if(!$j.isEmptyObject(l)){bookacti_get_calendar_editor_data_by_interval(l)}}a.trigger("bookacti_calendar_editor_view_render",[k])},eventDidMount:function(o){if(o.isMirror){return}var m=o.event.groupId;var k=m?bookacti.booking_system["bookacti-template-calendar"]["events_data"][m]:[];var l=typeof k.activity_id!=="undefined"?parseInt(k.activity_id):(typeof o.event.extendedProps.activity_id!=="undefined"?parseInt(o.event.extendedProps.activity_id):0);var j=moment.utc(o.event.start).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");var n=moment.utc(o.event.end).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");$j(o.el).data("event-id",m?m:"").attr("data-event-id",m?m:"");$j(o.el).data("event-start",j).attr("data-event-start",j);$j(o.el).data("event-end",n).attr("data-event-end",n);$j(o.el).data("activity-id",l?l:"").attr("data-activity-id",l?l:"");a.trigger("bookacti_calendar_editor_event_did_mount",[o])},eventClassNames:function(o){var k={class_names:[]};if(o.isMirror||o.event.display==="none"){return k}var j=bookacti.booking_system["bookacti-template-calendar"]["events_data"][o.event.groupId];var m=typeof j!=="undefined"?parseInt(j.activity_id):0;if(bookacti.hidden_activities&&m){if($j.inArray(m,bookacti.hidden_activities)>=0){k.class_names.push("bookacti-event-hidden")}}var n=moment.utc(o.event.start).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");$j.each(bookacti.booking_system["bookacti-template-calendar"]["picked_events"],function(q,r){var p=moment.utc(r.start).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");if(r.id==o.event.groupId&&n===p){k.class_names.push("bookacti-picked-event")}});$j.each(bookacti.booking_system["bookacti-template-calendar"]["selected_events"],function(q,p){var r=moment.utc(p.start).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");if(p.id==o.event.groupId&&n===r){k.class_names.push("bookacti-selected-event")}});if(o.view.type.indexOf("dayGrid")>-1||o.view.type.indexOf("timeGrid")>-1){var l=bookacti_fc_get_event_size_classes(a,o.event,o.view);if(l.length){k.class_names=$j.merge(k.class_names,l)}}a.trigger("bookacti_calendar_editor_event_class_names",[k,o]);return k.class_names},eventContent:function(F){var t={domNodes:[]};if(F.event.display==="none"){return t}if(F.view.type.indexOf("dayGrid")>-1){var E=moment.utc(F.event.start).locale("en").format("YYYY-MM-DD")!==moment.utc(F.event.end).locale("en").format("YYYY-MM-DD");var k=bookacti.fc_calendar["bookacti-template-calendar"].getOption("eventDisplay");if(F.event.display==="list-item"||(F.event.display==="auto"&&(k==="list-item"||(k==="auto"&&!F.event.allDay&&!E)))){var H=$j("<div></div>",{"class":"fc-daygrid-event-dot"});t.domNodes.push(H[0])}}var n="LT";if(F.view.type.indexOf("timeGrid")>-1){var A=moment.localeData().longDateFormat("LT");n=A.replace(/[aA]/g,"")}if(bookacti_localized.calendar_localization==="wp_settings"){n=bookacti_convert_php_datetime_format_to_moment_js(bookacti_localized.wp_time_format)}var y=$j("<div></div>",{"class":"fc-event-time",html:'<span class="bookacti-event-time-start">'+moment.utc(F.event.start).format(n)+'</span><span class="bookacti-event-time-separator"> - </span><span class="bookacti-event-time-end">'+moment.utc(F.event.end).format(n)+"</span>"});t.domNodes.push(y[0]);var w=$j("<div></div>",{"class":"fc-event-title-container",html:'<div class="fc-event-title">'+F.event.title+"</div>"});t.domNodes.push(w[0]);if(F.isMirror||F.event.display==="none"){return t}var r=bookacti.booking_system["bookacti-template-calendar"]["events_data"][F.event.groupId];var x=typeof r!=="undefined"?parseInt(r.availability):0;var s=bookacti_get_event_number_of_bookings(a,F.event);if(s!=null){var l="";if(x===0){l+="bookacti-no-availability"}else{l+=s>0?" bookacti-booked":" bookacti-not-booked";if(s>=x){l+=" bookacti-full"}}var j=$j("<div></div>",{"class":"bookacti-availability-container"});var q=$j("<div></div>",{"class":"bookacti-available-places "+l});var C=$j("<span></span>",{"class":"bookacti-bookings",html:s});var B=$j("<span></span>",{"class":"bookacti-total-availability",html:x});q.append(C);q.append(B);j.append(q);t.domNodes.push(j[0])}var u=$j("<div></div>",{"class":"bookacti-event-actions"});var D={actions:[]};var m=$j("<div></div>",{"class":"bookacti-event-action bookacti-event-action-edit"});var p=$j("<span></span>",{type:"checkbox","class":"dashicons dashicons-admin-generic bookacti-event-action-edit-button"});m.prepend(p);D.actions.push(m);var v=moment.utc(F.event.start).clone().locale("en").format("YYYY-MM-DD");var z=false;$j.each(bookacti.booking_system["bookacti-template-calendar"]["selected_events"],function(J,I){if(I.id==F.event.groupId&&I.start.substr(0,10)===v){z=true;return false}});var G=$j("<div></div>",{"class":"bookacti-event-action bookacti-event-action-select"});var o=$j("<input/>",{type:"checkbox","class":"bookacti-event-action-select-checkbox",value:"0",checked:z});G.append(o);D.actions.push(G);a.trigger("bookacti_calendar_editor_event_actions",[D,F]);if(D.actions.length){$j.each(D.actions,function(J,I){u.append(I)});t.domNodes.push(u[0])}a.trigger("bookacti_calendar_editor_event_content",[t,F]);return t},eventAllow:function(m,l){var k={allow:true};var j=bookacti.booking_system["bookacti-template-calendar"]["template_data"];if(typeof j!=="undefined"){if(typeof j.settings!=="undefined"){if(typeof j.settings.days_off!=="undefined"){$j.each(j.settings.days_off,function(o,q){var p=moment.utc(q.from+" 00:00:00");var n=moment.utc(q.to+" 23:59:59");if(moment.utc(m.start).isBetween(p,n,"second","[]")){k.allow=false;return false}})}}}a.trigger("bookacti_calendar_editor_allow_drop",[k.allow,m,l]);return k.allow},eventReceive:function(k){if(typeof k.event.extendedProps.activity_id==="undefined"){k.revert();return}var s=parseInt(k.event.extendedProps.activity_id);var q=bookacti.booking_system["bookacti-template-calendar"]["activities_data"][s];if(!q){k.revert();return}var j=moment.utc(k.event.start);if(k.view.type.substr(0,8)!=="timeGrid"){var l=bookacti.fc_calendar["bookacti-template-calendar"].getOption("slotMinTime");j.set({hours:l.substr(0,2),minutes:l.substr(3,2),seconds:0})}var o=q.duration?q.duration:"000.01:00:00";var n=j.clone();n.add(moment.duration(o));k.event.setDates(j.toDate(),n.toDate());var p=moment.utc(k.event.start).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");var r=moment.utc(k.event.end).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");var m={action:"bookactiInsertEvent",activity_id:s,template_id:bookacti.selected_template,title:q.multilingual_title,start:p,end:r,availability:q.availability,nonce:$j("#nonce_edit_template").val()};a.trigger("bookacti_calendar_editor_event_before_insert",[k,m]);bookacti_start_template_loading();$j.ajax({url:ajaxurl,data:m,type:"POST",dataType:"json",success:function(t){if(t.status==="success"){k.event.setProp("groupId",t.event_id);$j('.fc-event[data-event-id=""][data-activity-id="'+s+'"][data-event-start="'+p+'"]').data("event-id",t.event_id).attr("data-event-id",t.event_id);bookacti.booking_system["bookacti-template-calendar"]["events_data"][t.event_id]=t.event_data;a.trigger("bookacti_calendar_editor_event_inserted",[k,t,m])}else{k.revert();var u=typeof t.message!=="undefined"?t.message:bookacti_localized.error;alert(u);console.log(u);console.log(t)}},error:function(t){k.revert();alert("AJAX "+bookacti_localized.error);console.log(t)},complete:function(){bookacti_stop_template_loading()}})},eventResize:function(j){bookacti_update_event_dates(j.event,j.oldEvent,j.revert)},eventDrop:function(j){if(j.jsEvent.altKey){j.revert();bookacti_duplicate_event(j.event,j.oldEvent)}else{bookacti_update_event_dates(j.event,j.oldEvent,j.revert)}},eventDragStart:function(k){var j=$j('.fc-event[data-event-id="'+k.event.groupId+'"]');j.addClass("bookacti-event-dragged");a.trigger("bookacti_calendar_editor_drag_start",[k])},eventDragStop:function(k){var j=$j('.fc-event.bookacti-event-dragged[data-event-id="'+k.event.groupId+'"]');j.removeClass("bookacti-event-dragged");a.trigger("bookacti_calendar_editor_drag_stop",[k])},eventResizeStart:function(j){a.trigger("bookacti_calendar_editor_resize_start",[j])},eventResizeStop:function(j){a.trigger("bookacti_calendar_editor_resize_stop",[j])},eventClick:function(j){bookacti.booking_system["bookacti-template-calendar"]["picked_events"]=[];bookacti_unpick_all_events_on_calendar(a);bookacti_pick_event(a,j.event);if($j(j.jsEvent.target).closest(".bookacti-event-actions").length){if($j(j.jsEvent.target).is(".bookacti-event-action-edit")||$j(j.jsEvent.target).closest(".bookacti-event-action-edit").length){if(j.event.editable!==false){bookacti_dialog_update_event(j.event)}}else{if($j(j.jsEvent.target).is(".bookacti-event-action-select")||$j(j.jsEvent.target).closest(".bookacti-event-action-select").length){if($j(j.el).find(".bookacti-event-action-select-checkbox").is(":checked")){bookacti_select_event(j.event)}else{bookacti_unselect_event(j.event);$j(j.el).find(".bookacti-event-action-select").show()}}}}a.trigger("bookacti_calendar_editor_event_click",[j])},eventMouseEnter:function(j){a.trigger("bookacti_calendar_editor_event_mouse_enter",[j])},eventMouseLeave:function(j){a.trigger("bookacti_calendar_editor_event_mouse_leave",[j])},loading:function(j){if(!j&&bookacti.is_touch_device){$j(".fc-event").each(function(){var k=$j.Event("mouseover",{target:this.firstChild,_dummyCalledOnStartup:true});$j(this).trigger(k)})}}};if(bookacti_localized.calendar_localization==="wp_settings"){var i=bookacti_convert_php_datetime_format_to_fc_date_formatting_object(bookacti_localized.wp_time_format);f.firstDay=bookacti_localized.wp_start_of_week;f.slotLabelFormat=i;f.eventTimeFormat=i}a.trigger("bookacti_calendar_editor_init_data",[f]);if(typeof bookacti.fc_calendar["bookacti-template-calendar"]!=="undefined"){bookacti.fc_calendar["bookacti-template-calendar"].destroy()}bookacti.fc_calendar["bookacti-template-calendar"]=new FullCalendar.Calendar(a.find(".bookacti-calendar:first")[0],f);bookacti.fc_calendar["bookacti-template-calendar"].render();a.trigger("bookacti_calendar_editor_after_set_up")};