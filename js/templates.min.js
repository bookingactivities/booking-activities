$j(document).ready(function(){$j("#bookacti-template-container").length&&(bookacti.selected_template=parseInt($j("#bookacti-template-picker").val())||0,bookacti.hidden_activities=[],bookacti.selected_category="new",bookacti.load_events=!1,bookacti.booking_system["bookacti-template-calendar"]={},bookacti.booking_system["bookacti-template-calendar"].calendars=bookacti.selected_template?[bookacti.selected_template]:[],bookacti.booking_system["bookacti-template-calendar"].bookings=[],bookacti.booking_system["bookacti-template-calendar"].groups_events=
[],bookacti.booking_system["bookacti-template-calendar"].groups_data=[],bookacti.booking_system["bookacti-template-calendar"].activities_data={},bookacti.booking_system["bookacti-template-calendar"].events_data=[],bookacti.booking_system["bookacti-template-calendar"].events_interval=[],bookacti.booking_system["bookacti-template-calendar"].group_categories_data=[],bookacti.booking_system["bookacti-template-calendar"].start="1970-02-01 00:00:00",bookacti.booking_system["bookacti-template-calendar"].end=
"2037-12-31 23:59:59",bookacti.booking_system["bookacti-template-calendar"].display_data=[],bookacti.booking_system["bookacti-template-calendar"].template_data=[],bookacti.booking_system["bookacti-template-calendar"].selected_events=[],bookacti.booking_system["bookacti-template-calendar"].picked_events=[],bookacti.booking_system["bookacti-template-calendar"].loading_number=0,bookacti.booking_system["bookacti-template-calendar"].method="calendar",bookacti.booking_system["bookacti-template-calendar"].past_events=
!0,bookacti.booking_system["bookacti-template-calendar"].past_events_bookable=!0,bookacti_make_activities_draggable(),bookacti_make_activities_sortable(),bookacti_init_groups_of_events(),bookacti_init_show_hide_activities_switch(),bookacti_init_event_duplication_feedbacks(),bookacti_init_template_dialogs(),bookacti_bind_template_dialogs(),$j("body").on("change","#bookacti-template-picker",function(){bookacti_switch_template($j(this).val())}),bookacti.selected_template&&bookacti_switch_template(bookacti.selected_template),
$j("body").on("bookacti_init_booking_sytem","#bookacti-template-calendar",function(f,h,l){h.load=!1}),$j("body").on("dragstart","#bookacti-template-activities-container .fc-event",function(f,h){h.helper.css("maxWidth",$j(this).width())}),$j("body").on("bookacti_clear_events","#bookacti-template-calendar",function(f,h){bookacti_clear_events_on_calendar_editor()}),window.onerror=function(f,h,l,m,t){$j("#bookacti-fatal-error").show()},$j("body").on("click","#bookacti-exit-loading",function(){bookacti_stop_template_loading(!0);
bookacti.load_events=!0}))});
function bookacti_load_template_calendar(){var f=$j("#bookacti-template-calendar"),h=bookacti_get_availability_period(f),l="undefined"!==typeof bookacti.booking_system["bookacti-template-calendar"].display_data?bookacti.booking_system["bookacti-template-calendar"].display_data:{},m="undefined"!==typeof bookacti_localized.event_tiny_height?parseInt(bookacti_localized.event_tiny_height):32,t="undefined"!==typeof l.slotMinTime?l.slotMinTime:"00:00",u="undefined"!==typeof l.slotMaxTime?l.slotMaxTime:
"24:00";l="undefined"!==typeof l.snapDuration?l.snapDuration:"00:05";var v=moment.utc("1970-02-01 "+t).add(1,"minutes").format("HH:mm");h={locale:bookacti_localized.fullcalendar_locale,timeZone:bookacti_localized.fullcalendar_timezone,now:new Date(bookacti_localized.current_time.substr(0,10)),initialView:"timeGridWeek",eventShortHeight:0,eventMinHeight:m,nextDayThreshold:v,slotMinTime:t,slotMaxTime:u,slotDuration:"00:30",snapDuration:l,scrollTime:"00:00",height:"auto",contentHeight:"auto",nowIndicator:!1,
weekNumbers:!1,navLinks:!0,slotEventOverlap:!1,dayMaxEvents:!1,moreLinkClick:"popover",eventDisplay:"block",allDaySlot:!1,defaultAllDay:!1,fixedWeekCount:!1,showNonCurrentDates:!0,eventResizableFromStart:!1,rerenderDelay:100,editable:!0,droppable:!0,dropAccept:".fc-event, .bookacti-activity-draggable",eventDurationEditable:!0,dragRevertDuration:0,validRange:{start:h.start?moment.utc(h.start.substr(0,10)).format("YYYY-MM-DD"):"1970-02-01",end:h.end?moment.utc(h.end.substr(0,10)).add(1,"days").format("YYYY-MM-DD"):
"2038-01-01"},customButtons:{goTo:{text:bookacti_localized.go_to_button,click:function(){$j(".bookacti-go-to-datepicker").length||($j(".fc-goTo-button").after('<input type="date" class="bookacti-go-to-datepicker" min="1970-01-01"/>'),$j(".bookacti-go-to-datepicker").hide());$j(".bookacti-go-to-datepicker").toggle(200)}}},headerToolbar:{start:"prevYear,prev,next,nextYear today goTo",center:"title",end:"dayGridMonth,timeGridWeek,timeGridDay"},events:function(a,c,b){c([])},viewClassNames:function(a){var c=
{class_names:[]};f.find(".fc-today-button").length&&!f.find(".fc-day-today").length&&(moment().isBetween(a.view.currentStart,a.view.currentEnd,"day","[)")||f.find(".fc-today-button").attr("disabled",!1));f.trigger("bookacti_calendar_editor_view_class_names",[c,a]);return c.class_names},dayHeaderClassNames:function(a){var c={class_names:[]},b=bookacti.booking_system["bookacti-template-calendar"].template_data;if("undefined"!==typeof b&&"undefined"!==typeof b.settings&&"undefined"!==typeof b.settings.days_off){var d=
moment.utc(a.date);$j.each(b.settings.days_off,function(g,e){g=moment.utc(e.from+" 00:00:00");e=moment.utc(e.to+" 23:59:59");if(d.isBetween(g,e,"second","[]"))return c.class_names.push("fc-day-disabled"),!1})}f.trigger("bookacti_calendar_editor_day_header_class_names",[c,a]);return c.class_names},dayCellClassNames:function(a){var c={class_names:[]},b=bookacti.booking_system["bookacti-template-calendar"].template_data;if("undefined"!==typeof b&&"undefined"!==typeof b.settings&&"undefined"!==typeof b.settings.days_off){var d=
moment.utc(a.date);$j.each(b.settings.days_off,function(g,e){g=moment.utc(e.from+" 00:00:00");e=moment.utc(e.to+" 23:59:59");if(d.isBetween(g,e,"second","[]"))return c.class_names.push("fc-day-disabled"),!1})}f.trigger("bookacti_calendar_editor_day_cell_class_names",[c,a]);return c.class_names},datesSet:function(a){if(!0===bookacti.load_events){var c={start:moment.utc(moment.utc(a.view.currentStart).clone().locale("en").format("YYYY-MM-DD")+" 00:00:00"),end:moment.utc(moment.utc(a.view.currentEnd).clone().locale("en").subtract(1,
"days").format("YYYY-MM-DD")+" 23:59:59")};c=bookacti_get_interval_of_events(f,c);$j.isEmptyObject(c)||bookacti_get_calendar_editor_data_by_interval(c)}f.trigger("bookacti_calendar_editor_view_render",[a])},eventDidMount:function(a){if(!a.isMirror){var c=a.event.groupId,b=bookacti.booking_system["bookacti-template-calendar"].events_data[c],d=0;"undefined"!==typeof b?d=parseInt(b.activity_id):"undefined"!==typeof a.event.extendedProps.activity_id&&(d=parseInt(a.event.extendedProps.activity_id));b=
moment.utc(a.event.start).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");var g=moment.utc(a.event.end).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");$j(a.el).data("event-id",c?c:"").attr("data-event-id",c?c:"");$j(a.el).data("event-start",b).attr("data-event-start",b);$j(a.el).data("event-end",g).attr("data-event-end",g);$j(a.el).data("activity-id",d?d:"").attr("data-activity-id",d?d:"");f.trigger("bookacti_calendar_editor_event_did_mount",[a])}},eventClassNames:function(a){var c={class_names:[]};
if(a.isMirror||"none"===a.event.display)return c;var b=bookacti.booking_system["bookacti-template-calendar"].events_data[a.event.groupId];b="undefined"!==typeof b?parseInt(b.activity_id):0;bookacti.hidden_activities&&b&&0<=$j.inArray(b,bookacti.hidden_activities)&&c.class_names.push("bookacti-event-hidden");var d=moment.utc(a.event.start).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");$j.each(bookacti.booking_system["bookacti-template-calendar"].picked_events,function(g,e){g=moment.utc(e.start).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");
e.id==a.event.groupId&&d===g&&c.class_names.push("bookacti-picked-event")});$j.each(bookacti.booking_system["bookacti-template-calendar"].selected_events,function(g,e){g=moment.utc(e.start).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");e.id==a.event.groupId&&d===g&&c.class_names.push("bookacti-selected-event")});if(-1<a.view.type.indexOf("dayGrid")||-1<a.view.type.indexOf("timeGrid"))b=bookacti_fc_get_event_size_classes(f,a.event,a.view),b.length&&(c.class_names=$j.merge(c.class_names,b));f.trigger("bookacti_calendar_editor_event_class_names",
[c,a]);return c.class_names},eventContent:function(a){var c={domNodes:[]};if("none"===a.event.display)return c;if(-1<a.view.type.indexOf("dayGrid")){var b=moment.utc(a.event.start).locale("en").format("YYYY-MM-DD")!==moment.utc(a.event.end).locale("en").format("YYYY-MM-DD"),d=bookacti.fc_calendar["bookacti-template-calendar"].getOption("eventDisplay");if("list-item"===a.event.display||"auto"===a.event.display&&("list-item"===d||"auto"===d&&!a.event.allDay&&!b))b=$j("<div></div>",{"class":"fc-daygrid-event-dot"}),
c.domNodes.push(b[0])}b="LT";-1<a.view.type.indexOf("timeGrid")&&(b=moment.localeData().longDateFormat("LT").replace(/[aA]/g,""));"wp_settings"===bookacti_localized.calendar_localization&&(b=bookacti_convert_php_datetime_format_to_moment_js(bookacti_localized.wp_time_format));b=$j("<div></div>",{"class":"fc-event-time",html:'<span class="bookacti-event-time-start">'+moment.utc(a.event.start).format(b)+'</span><span class="bookacti-event-time-separator"> - </span><span class="bookacti-event-time-end">'+
moment.utc(a.event.end).format(b)+"</span>"});c.domNodes.push(b[0]);b=$j("<div></div>",{"class":"fc-event-title-container",html:'<div class="fc-event-title">'+a.event.title+"</div>"});c.domNodes.push(b[0]);if(a.isMirror||"none"===a.event.display)return c;b=bookacti.booking_system["bookacti-template-calendar"].events_data[a.event.groupId];d="undefined"!==typeof b?parseInt(b.availability):0;var g=bookacti_get_event_number_of_bookings(f,a.event);if(null!=g){var e="";0===d?e+="bookacti-no-availability":
(e+=0<g?" bookacti-booked":" bookacti-not-booked",g>=d&&(e+=" bookacti-full"));b=$j("<div></div>",{"class":"bookacti-availability-container"});e=$j("<div></div>",{"class":"bookacti-available-places "+e});g=$j("<span></span>",{"class":"bookacti-bookings",html:g});d=$j("<span></span>",{"class":"bookacti-total-availability",html:d});e.append(g);e.append(d);b.append(e);c.domNodes.push(b[0])}var n=$j("<div></div>",{"class":"bookacti-event-actions"});b={actions:[]};d=$j("<div></div>",{"class":"bookacti-event-action bookacti-event-action-edit"});
e=$j("<span></span>",{type:"checkbox","class":"dashicons dashicons-admin-generic bookacti-event-action-edit-button"});d.prepend(e);b.actions.push(d);var p=moment.utc(a.event.start).clone().locale("en").format("YYYY-MM-DD"),k=!1;$j.each(bookacti.booking_system["bookacti-template-calendar"].selected_events,function(q,r){if(r.id==a.event.groupId&&r.start.substr(0,10)===p)return k=!0,!1});d=$j("<div></div>",{"class":"bookacti-event-action bookacti-event-action-select"});e=$j("<input/>",{type:"checkbox",
"class":"bookacti-event-action-select-checkbox",value:"0",checked:k});d.append(e);b.actions.push(d);f.trigger("bookacti_calendar_editor_event_actions",[b,a]);b.actions.length&&($j.each(b.actions,function(q,r){n.append(r)}),c.domNodes.push(n[0]));f.trigger("bookacti_calendar_editor_event_content",[c,a]);return c},eventAllow:function(a,c){var b=!0,d=bookacti.booking_system["bookacti-template-calendar"].template_data;"undefined"!==typeof d&&"undefined"!==typeof d.settings&&"undefined"!==typeof d.settings.days_off&&
$j.each(d.settings.days_off,function(g,e){g=moment.utc(e.from+" 00:00:00");e=moment.utc(e.to+" 23:59:59");if(moment.utc(a.start).isBetween(g,e,"second","[]"))return b=!1});f.trigger("bookacti_calendar_editor_allow_drop",[b,a,c]);return b},eventReceive:function(a){if("undefined"===typeof a.event.extendedProps.activity_id)a.revert();else{var c=parseInt(a.event.extendedProps.activity_id),b=bookacti.booking_system["bookacti-template-calendar"].activities_data[c];if(b){var d=moment.utc(a.event.start);
if("timeGrid"!==a.view.type.substr(0,8)){var g=bookacti.fc_calendar["bookacti-template-calendar"].getOption("slotMinTime");d.set({hours:g.substr(0,2),minutes:g.substr(3,2),seconds:0})}g=b.duration?b.duration:"000.01:00:00";var e=d.clone();e.add(moment.duration(g));a.event.setDates(d.toDate(),e.toDate());var n=moment.utc(a.event.start).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");d=moment.utc(a.event.end).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");var p={action:"bookactiInsertEvent",
activity_id:c,template_id:bookacti.selected_template,title:b.multilingual_title,start:n,end:d,availability:b.availability,nonce:$j("#bookacti-edit-template-nonce").val()};f.trigger("bookacti_calendar_editor_event_before_insert",[a,p]);bookacti_start_template_loading();$j.ajax({url:ajaxurl,data:p,type:"POST",dataType:"json",success:function(k){if("success"===k.status)a.event.setProp("groupId",k.event_id),$j('.fc-event[data-event-id=""][data-activity-id="'+c+'"][data-event-start="'+n+'"]').data("event-id",
k.event_id).attr("data-event-id",k.event_id),bookacti.booking_system["bookacti-template-calendar"].events_data[k.event_id]=k.event_data,f.trigger("bookacti_calendar_editor_event_inserted",[a,k,p]);else{a.revert();var q="undefined"!==typeof k.message?k.message:bookacti_localized.error;alert(q);console.log(q);console.log(k)}},error:function(k){a.revert();alert("AJAX "+bookacti_localized.error);console.log(k)},complete:function(){bookacti_stop_template_loading()}})}else a.revert()}},eventResize:function(a){bookacti_update_event_dates(a.event,
a.oldEvent,a.revert)},eventDrop:function(a){a.jsEvent.altKey?(a.revert(),bookacti_duplicate_event(a.event,a.oldEvent)):bookacti_update_event_dates(a.event,a.oldEvent,a.revert)},eventDragStart:function(a){$j('.fc-event[data-event-id="'+a.event.groupId+'"]').addClass("bookacti-event-dragged");f.trigger("bookacti_calendar_editor_drag_start",[a])},eventDragStop:function(a){$j('.fc-event.bookacti-event-dragged[data-event-id="'+a.event.groupId+'"]').removeClass("bookacti-event-dragged");f.trigger("bookacti_calendar_editor_drag_stop",
[a])},eventResizeStart:function(a){f.trigger("bookacti_calendar_editor_resize_start",[a])},eventResizeStop:function(a){f.trigger("bookacti_calendar_editor_resize_stop",[a])},eventClick:function(a){bookacti.booking_system["bookacti-template-calendar"].picked_events=[];bookacti_unpick_all_events_on_calendar(f);bookacti_pick_event(f,a.event);if($j(a.jsEvent.target).closest(".bookacti-event-actions").length)if($j(a.jsEvent.target).is(".bookacti-event-action-edit")||$j(a.jsEvent.target).closest(".bookacti-event-action-edit").length)!1!==
a.event.editable&&bookacti_dialog_update_event(a.event);else if($j(a.jsEvent.target).is(".bookacti-event-action-select")||$j(a.jsEvent.target).closest(".bookacti-event-action-select").length)$j(a.el).find(".bookacti-event-action-select-checkbox").is(":checked")?bookacti_select_event(a.event):(bookacti_unselect_event(a.event),$j(a.el).find(".bookacti-event-action-select").show());f.trigger("bookacti_calendar_editor_event_click",[a])},eventMouseEnter:function(a){f.trigger("bookacti_calendar_editor_event_mouse_enter",
[a])},eventMouseLeave:function(a){f.trigger("bookacti_calendar_editor_event_mouse_leave",[a])},loading:function(a){!a&&bookacti.is_touch_device&&$j(".fc-event").each(function(){var c=$j.Event("mouseover",{target:this.firstChild,_dummyCalledOnStartup:!0});$j(this).trigger(c)})}};"wp_settings"===bookacti_localized.calendar_localization&&(m=bookacti_convert_php_datetime_format_to_fc_date_formatting_object(bookacti_localized.wp_time_format),h.firstDay=bookacti_localized.wp_start_of_week,h.slotLabelFormat=
m,h.eventTimeFormat=m);f.trigger("bookacti_calendar_editor_init_data",[h]);"undefined"!==typeof bookacti.fc_calendar["bookacti-template-calendar"]&&bookacti.fc_calendar["bookacti-template-calendar"].destroy();bookacti.fc_calendar["bookacti-template-calendar"]=new FullCalendar.Calendar(f.find(".bookacti-calendar:first")[0],h);bookacti.fc_calendar["bookacti-template-calendar"].render();f.trigger("bookacti_calendar_editor_after_set_up")};
