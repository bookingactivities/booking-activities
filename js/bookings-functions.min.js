$j(document).ready(function(){$j("#bookacti-booking-list, .bookacti-user-booking-list-table").on("click","tbody tr",function(){$j(".bookacti-booking-list-selected-row").removeClass("bookacti-booking-list-selected-row");$j(this).addClass("bookacti-booking-list-selected-row")});$j("#bookacti-booking-list, .bookacti-user-booking-list-table").on("bookacti_booking_action_data","tr.bookacti-single-booking, tr.bookacti-booking-group",function(a,b){a=!1;"undefined"!==typeof b.form_data&&b.form_data instanceof
FormData&&(a=!0);a?b.form_data.append("locale",bookacti_localized.current_locale):b.locale=bookacti_localized.current_locale});$j("#bookacti-booking-list").on("click","tbody .toggle-row",function(){$j(this).closest("tr").toggleClass("is-expanded")});$j("#bookacti-booking-list tbody").off("click",".toggle-row")});
function bookacti_filter_booking_list(a){a=a?a:1;var b=$j("#bookacti-booking-system-bookings-page"),e=bookacti_serialize_object($j("#bookacti-booking-list-filters-form"));e.paged=a;e.action="bookactiGetBookingList";e.templates||(e.templates=[],$j("#bookacti-booking-filter-templates option").each(function(){e.templates.push($j(this).val())}));$j("#bookacti-booking-list-filters-form").trigger("bookacti_filter_booking_list_data",[e]);var c=$j("#bookacti-booking-list thead .manage-column:not(.hidden)").length?
$j("#bookacti-booking-list thead .manage-column:not(.hidden)").length:1;bookacti.current_filter_request=$j.ajax({url:bookacti_localized.ajaxurl,type:"POST",data:e,dataType:"json",beforeSend:function(){null!=bookacti.current_filter_request&&bookacti.current_filter_request.abort();bookacti_start_loading_booking_system(b);$j("#bookacti-booking-list #the-list").html('<tr class="no-items" ><td class="colspanchange" colspan="'+c+'" >'+bookacti_get_loading_html()+"</td></tr>")},success:function(d){"success"===
d.status?($j("#bookacti-booking-list").html(d.booking_list),bookacti_refresh_list_table_hidden_columns(),window.history.pushState({path:d.new_url},"",d.new_url),$j("#bookacti-booking-list").trigger("bookacti_booking_list_filtered",[d,e])):"failed"===d.status&&(d='<tr class="no-items" ><td class="colspanchange" colspan="'+c+'" >'+("undefined"!==typeof d.message?d.message:bookacti_localized.error)+"</td></tr>",$j("#bookacti-booking-list #the-list").append(d))},error:function(d){"abort"!=d.statusText&&
(console.log("AJAX "+bookacti_localized.error),console.log(d))},complete:function(){bookacti_stop_loading_booking_system(b);bookacti_remove_loading_html($j("#bookacti-booking-list #the-list"))}})}
function bookacti_update_template_related_filters(){var a=bookacti.booking_system["bookacti-booking-system-bookings-page"].templates_per_activities,b=$j("#bookacti-booking-filter-templates").val();if($j.isEmptyObject(b))return $j("#bookacti-booking-filter-activities option").show(),!1;if("undefined"===typeof a)return!1;$j("#bookacti-booking-filter-activities option").each(function(e,c){var d=parseInt($j(c).attr("value")),f=!0;$j.each(b,function(g,k){return"undefined"===typeof a[d]||-1===$j.inArray(k,
a[d].template_ids)?!0:f=!1});f?($j(c).is(":selected")&&$j(c).prop("selected",!1),$j(c).attr("disabled",!0).hide()):$j(c).attr("disabled",!1).show()});$j("#bookacti-booking-filter-activities").hasClass("select2-hidden-accessible")&&($j("#bookacti-booking-filter-activities").select2("destroy"),bookacti_select2_init())}
function bookacti_refresh_calendar_according_to_date_filter(){if(!$j("#bookacti-booking-system-filter-container").is(":visible"))return!1;var a=$j("#bookacti-booking-system-bookings-page").attr("id"),b=$j("#bookacti-booking-filter-dates-from").val(),e=$j("#bookacti-booking-filter-dates-to").val();b=b?moment.utc(b+" 00:00:00").locale("en"):"";e=e?moment.utc(e+" 23:59:59").locale("en"):"";bookacti.booking_system[a].start=b?b.format("YYYY-MM-DD HH:mm:ss"):"";bookacti.booking_system[a].end=e?e.format("YYYY-MM-DD HH:mm:ss"):
"";var c={};b&&(c.start=b.format("YYYY-MM-DD"));e&&(c.end=e.add(1,"days").format("YYYY-MM-DD"));bookacti.fc_calendar[a].setOption("validRange",c)}
function bookacti_unpick_all_events_filter(){var a=$j("#bookacti-booking-system-bookings-page");bookacti_clear_booking_system_displayed_info(a);$j("#bookacti-unpick-events-filter").hide(200);$j("#bookacti-picked-events-actions-container").hide(200);$j("#bookacti-booking-system-filter-container").is(":visible")&&$j("#bookacti-pick-event-filter-instruction").show(200)}
function bookacti_reload_booking_system_according_to_filters(a){var b=a.attr("id"),e=$j("#bookacti-booking-filter-templates").val(),c=$j("#bookacti-booking-filter-status").val(),d=$j("#bookacti-booking-filter-customer").val(),f=$j("#bookacti-booking-filter-dates-from").val(),g=$j("#bookacti-booking-filter-dates-end").val();if(!e||$j.isEmptyObject(e))e=[],$j("#bookacti-booking-filter-templates option").each(function(){e.push($j(this).val())});bookacti.booking_system[b].calendars=e;bookacti.booking_system[b].activities=
[];bookacti.booking_system[b].group_categories=[];bookacti.booking_system[b].status=c?c:[];bookacti.booking_system[b].user_id=d?[d]:[];bookacti.booking_system[b].start=f?f+" 00:00:00":"";bookacti.booking_system[b].end=g?g+" 23:59:59":"";bookacti_unpick_all_events_filter();bookacti_reload_booking_system(a)}
function bookacti_init_booking_actions(){$j(".bookacti-user-booking-list-table, .woocommerce-table, #bookacti-booking-list").on("click",".bookacti-booking-action, .bookacti-booking-group-action",function(a){a.preventDefault();user_auth_key=$j(this).data("user-auth-key").length?$j(this).data("user-auth-key"):"";a={booking_ids:[],booking_group_ids:[],all:0};if($j(this).hasClass("bookacti-booking-action")){var b=$j(this).data("booking-id");a.booking_ids.push(b);$j(this).hasClass("bookacti-cancel-booking")?
bookacti_dialog_cancel_booking(b,"single"):$j(this).hasClass("bookacti-reschedule-booking")?bookacti_dialog_reschedule_booking(b):$j(this).hasClass("bookacti-refund-booking")?bookacti_dialog_refund_booking(b,"single"):$j(this).hasClass("bookacti-change-booking-status")?bookacti_dialog_change_bookings_status(a):$j(this).hasClass("bookacti-change-booking-quantity")?bookacti_dialog_change_bookings_quantity(a):$j(this).hasClass("bookacti-send-booking-notification")?bookacti_dialog_send_booking_notification(b,
"single"):$j(this).hasClass("bookacti-delete-booking")&&bookacti_dialog_delete_booking(b,"single")}else b=$j(this).data("booking-group-id"),a.booking_group_ids.push(b),$j(this).hasClass("bookacti-cancel-booking-group")?bookacti_dialog_cancel_booking(b,"group"):$j(this).hasClass("bookacti-refund-booking-group")?bookacti_dialog_refund_booking(b,"group"):$j(this).hasClass("bookacti-change-booking-group-state")?bookacti_dialog_change_bookings_status(a):$j(this).hasClass("bookacti-change-booking-group-quantity")?
bookacti_dialog_change_bookings_quantity(a):$j(this).hasClass("bookacti-show-booking-group-bookings")?bookacti_display_grouped_bookings(b):$j(this).hasClass("bookacti-send-booking-group-notification")?bookacti_dialog_send_booking_notification(b,"group"):$j(this).hasClass("bookacti-delete-booking-group")&&bookacti_dialog_delete_booking(b,"group");$j(this).attr("href")&&""!==$j(this).attr("href")&&!$j(this).hasClass("prevent-default")&&($j(this).hasClass("_blank")?window.open($j(this).attr("href")):
location.href=$j(this).attr("href"))})}
function bookacti_init_booking_bulk_actions(){$j("#bookacti-bookings-container").on("click",'.bulkactions input[type="submit"]',function(a){a.preventDefault();if(a=$j(this).siblings('select[name^="action"]').val()){var b={booking_ids:[],booking_group_ids:[],all:parseInt($j("#bookacti-all-selected").val())?1:0};$j('#bookacti-bookings-container tbody .check-column input[name="booking_ids[]"]:checked').each(function(){b.booking_ids.push(parseInt($j(this).val()))});$j('#bookacti-bookings-container tbody .check-column input[name="booking_group_ids[]"]:checked').each(function(){b.booking_group_ids.push(parseInt($j(this).val()))});
"reschedule"===a?bookacti_dialog_reschedule_booking(booking_id):"refund"===a?bookacti_dialog_refund_booking(booking_id,"single"):"edit_status"===a?bookacti_dialog_change_bookings_status(b):"edit_quantity"===a?bookacti_dialog_change_bookings_quantity(b):"send_notification"===a?bookacti_dialog_send_booking_notification(booking_id,"single"):"delete"===a&&bookacti_dialog_delete_booking(booking_id,"single")}})}
function bookacti_get_booking_list_filters(){var a=$j("#bookacti-booking-list-filters-form").length?bookacti_serialize_object($j("#bookacti-booking-list-filters-form")):{};$j.isEmptyObject(a)||a.templates||(a.templates=[],$j("#bookacti-booking-filter-templates option").each(function(){a.templates.push($j(this).val())}));$j("#bookacti-booking-list-filters-form").trigger("bookacti_filter_booking_list_data",[a]);return a}
function bookacti_change_export_type_according_to_active_tab(){var a=$j("#bookacti-export-bookings-dialog .bookacti-tabs li.ui-tabs-active");a=a.length?a.hasClass("bookacti-tab-ical")?"ical":"csv":"csv";var b=$j("#bookacti-export-bookings-url-container").data("export-type");$j("#bookacti-export-type-field").val(a);b===a?($j("#bookacti-export-bookings-url-container").show(),$j("#bookacti-export-bookings-dialog .bookacti-notices").show()):($j("#bookacti-export-bookings-url-container").hide(),$j("#bookacti-export-bookings-dialog .bookacti-notices").hide())}
function bookacti_display_grouped_bookings(a){if(a="undefined"!==typeof a&&$j.isNumeric(a)?a:!1){var b=$j('.bookacti-show-booking-group-bookings[data-booking-group-id="'+a+'"]:focus').first().closest("tr");b.find(".bookacti-show-booking-group-bookings").toggleClass("active");if(b.next().hasClass("bookacti-gouped-booking"))b.next().is(":visible")?(b.nextUntil("tr:not(.bookacti-gouped-booking)").addClass("hidden"),b.nextUntil("tr:not(.bookacti-gouped-booking)").length%2&&b.after('<tr class="bookacti-gouped-booking hidden dummy"></tr>')):
(b.next(".bookacti-gouped-booking.hidden.dummy").remove(),b.nextUntil("tr:not(.bookacti-gouped-booking)").removeClass("hidden"));else{var e=[];b.find("td").each(function(){var d=$j(this).data("column-id");d&&e.push(d)});var c={action:"bookactiGetGroupedBookingsRows",booking_group_id:a,is_admin:bookacti_localized.is_admin?1:0,context:bookacti_localized.is_admin?"admin_booking_list":"user_booking_list",columns:e,nonce:bookacti_localized.nonce_get_booking_rows};b.trigger("bookacti_booking_action_data",
[c,a,"group","display_grouped_bookings"]);bookacti_booking_row_enter_loading_state(b);$j.ajax({url:bookacti_localized.ajaxurl,type:"POST",data:c,dataType:"json",success:function(d){if("success"===d.status)$j("#bookacti-booking-list-container #the-list tr.no-items").remove(),b.after(d.rows),bookacti_refresh_list_table_hidden_columns(),$j("#bookacti-booking-list").trigger("bookacti_grouped_bookings_displayed");else if("failed"===d.status){var f=$j("#bookacti-booking-list thead .manage-column:not(.hidden)").length?
$j("#bookacti-booking-list thead .manage-column:not(.hidden)").length:1;b.after('<tr class="no-items" ><td class="colspanchange" colspan="'+f+'" >'+("undefined"!==typeof d.message?d.message:bookacti_localized.error)+"</td></tr>")}},error:function(d){console.log("AJAX "+bookacti_localized.error);console.log(d)},complete:function(){bookacti_booking_row_exit_loading_state(b)}})}}}
function bookacti_booking_row_enter_loading_state(a){a.find(".bookacti-booking-status").hide();bookacti_add_loading_html(a.find(".bookacti-booking-status"),"after");a.find(".bookacti-booking-action").attr("disabled",!0)}function bookacti_booking_row_exit_loading_state(a){bookacti_remove_loading_html(a);a.find(".bookacti-booking-status").show();a.find(".bookacti-booking-action").attr("disabled",!1)}
function bookacti_refresh_list_table_hidden_columns(){$j(".hide-column-tog").each(function(){var a=$j(this).val();$j(this).prop("checked")?$j(".column-"+a).removeClass("hidden"):$j(".column-"+a).addClass("hidden")})}
function bookacti_refresh_booking_group_frame(){$j(".bookacti-gouped-booking").removeClass("bookacti-gouped-booking-first bookacti-gouped-booking-last");var a=0;$j(".bookacti-gouped-booking").each(function(){if(a===$j(this).data("booking-group-id"))return!0;a=$j(this).data("booking-group-id");$j('.bookacti-gouped-booking[data-booking-group-id="'+a+'"]:not(.hidden):first').addClass("bookacti-gouped-booking-first");$j('.bookacti-gouped-booking[data-booking-group-id="'+a+'"]:not(.hidden):last').addClass("bookacti-gouped-booking-last")})}
function bookacti_validate_picked_events(a,b){a=a||$j(".bookacti-booking-system:first");b=b||0;var e=a.attr("id");e=bookacti.booking_system[e].picked_events;var c={events_selected:!0,consistent_inputs:!0,is_qty_sup_to_0:!0,is_qty_inf_to_avail:!0,send:!0},d=a.closest("form"),f={selected_events:{}};d.length?f=bookacti_serialize_object(d):(d=a.siblings(".bookacti-booking-system-inputs"),d.length&&(d.wrap('<form class="bookacti-temporary-form"></form>'),f=bookacti_serialize_object(d.closest("form.bookacti-temporary-form")),
d.unwrap("form.bookacti-temporary-form")));"undefined"===typeof f.selected_events?c.events_selected=!1:$j.isEmptyObject(f.selected_events)&&(c.events_selected=!1);e.length||(c.events_selected=!1);if(c.events_selected){var g=0;$j.each(e,function(n,l){if(!c.consistent_inputs)return!1;if(0<parseInt(l.group_id)){if(f.selected_events[g].group_id!=l.group_id||f.selected_events[g].group_date!==l.group_date)c.consistent_inputs=!1}else if(f.selected_events[g].id!=l.id||f.selected_events[g].start!==l.start||
f.selected_events[g].end!==l.end)c.consistent_inputs=!1;++g});d=0;for(var k in f.selected_events)f.selected_events.hasOwnProperty(k)&&++d;k=0;for(var h in e)e.hasOwnProperty(h)&&++k;d!==k&&(c.consistent_inputs=!1)}if(0>=parseInt(b))c.is_qty_sup_to_0=!1;else{var m=bookacti_get_min_and_max_quantity(a);parseInt(b)>parseInt(m.avail)&&(c.is_qty_inf_to_avail=!1)}c.events_selected&&c.consistent_inputs&&c.is_qty_sup_to_0&&c.is_qty_inf_to_avail||(c.send=!1);a.siblings(".bookacti-notices").empty();a.trigger("bookacti_validate_picked_events",
[c]);c.send||(h="",c.events_selected||(h+="<li>"+bookacti_localized.error_select_event+"</li>"),c.is_qty_inf_to_avail||(h+="<li>"+bookacti_localized.error_less_avail_than_quantity.replace("%1$s",b).replace("%2$s",m.avail)+"</li>"),c.is_qty_sup_to_0||(h+="<li>"+bookacti_localized.error_quantity_inf_to_0+"</li>"),c.consistent_inputs||(h+="<li>"+bookacti_localized.error_corrupted_event+"</li>"),""!==h&&a.siblings(".bookacti-notices").append("<ul class='bookacti-error-list'>"+h+"</ul>").show());return c.send}
;
