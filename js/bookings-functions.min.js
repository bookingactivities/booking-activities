function bookacti_init_booking_filters_actions(){bookacti_update_template_related_filters();$j("#bookacti-booking-filter-templates, #bookacti-booking-filter-status, #bookacti-booking-filter-customer").on("change bookacti_customers_selectbox_changed",function(){bookacti_update_template_related_filters();if($j("#bookacti-booking-system-filter-container").is(":visible")){var b=$j("#bookacti-booking-system-bookings-page");bookacti_reload_booking_system_according_to_filters(b)}});$j("#bookacti-pick-event-filter").on("click",function(){var c=$j("#bookacti-booking-system-bookings-page");if(!$j("#bookacti-booking-system-filter-container").is(":visible")){var b=c.attr("id");var f=$j("#bookacti-booking-filter-templates").val()?$j("#bookacti-booking-filter-templates").val():[];var e=$j("#bookacti-booking-filter-status").val()?$j("#bookacti-booking-filter-status").val():[];var d=$j("#bookacti-booking-filter-customer").val()?$j("#bookacti-booking-filter-customer").val():0;if(!bookacti_compare_arrays(bookacti.booking_system[b]["calendars"],f)||!bookacti_compare_arrays(bookacti.booking_system[b]["status"],e)||bookacti.booking_system[b]["user_id"]!==d){bookacti_reload_booking_system_according_to_filters(c)}$j("#bookacti-pick-event-filter").text(bookacti_localized.hide_calendar)}else{$j("#bookacti-pick-event-filter").text(bookacti_localized.pick_an_event)}$j("#bookacti-booking-system-filter-container").toggle(200)});$j("#bookacti-unpick-events-filter").on("click",function(){var b=$j("#bookacti-booking-system-bookings-page");bookacti_unpick_all_events(b);bookacti_clear_booking_system_displayed_info(b);$j("#bookacti-unpick-events-filter").hide(200)});var a=$j("#bookacti-booking-system-bookings-page");a.on("bookacti_event_click",function(d,c,b){$j("#bookacti-unpick-events-filter").show(200)});$j("#bookacti-booking-filter-activities").on("change",function(){var b=$j("#bookacti-booking-system-bookings-page");var c=b.find(".bookacti-calendar");c.fullCalendar("rerenderEvents")});$j("#bookacti-booking-filter-dates-from, #bookacti-booking-filter-dates-to").on("change",function(){var b=$j("#bookacti-booking-system-bookings-page");var c=b.find(".bookacti-calendar");bookacti_refresh_calendar_according_to_date_filter(c)})}function bookacti_filter_booking_list(){var b=$j("#bookacti-booking-list-filters-form").serialize();var a=window.location.protocol+"//"+window.location.host+window.location.pathname+"?page=bookacti_bookings&"+b;window.history.pushState({path:a},"",a)}function bookacti_update_template_related_filters(){var a=bookacti.booking_system["bookacti-booking-system-bookings-page"]["templates_per_activities"];var b=$j("#bookacti-booking-filter-templates").val();if(!b){$j("#bookacti-booking-filter-activities option").show();return false}$j("#bookacti-booking-filter-activities option").each(function(c,f){var e=parseInt($j(f).attr("value"));var d=true;$j.each(b,function(h,g){if($j.inArray(g,a[e]["template_ids"])>=0){d=false;return false}});if(d){if($j(f).is(":selected")){$j(f).prop("selected",false)}$j(f).hide()}else{$j(f).show()}})}function bookacti_refresh_calendar_according_to_date_filter(b){if(!$j("#bookacti-booking-system-filter-container").is(":visible")){return false}b=$j("#bookacti-booking-system-bookings-page").find(".bookacti-calendar");var d=moment($j("#bookacti-booking-filter-dates-from").val());var c=moment($j("#bookacti-booking-filter-dates-to").val());var a={start:d.isValid()?d.format("YYYY-MM-DD"):bookacti.booking_system["bookacti-booking-system-bookings-page"]["template_data"]["start"],end:c.isValid()?c.format("YYYY-MM-DD"):bookacti.booking_system["bookacti-booking-system-bookings-page"]["template_data"]["end"],settings:{}};bookacti_update_calendar_settings(b,a)}function bookacti_reload_booking_system_according_to_filters(b){var a=b.attr("id");var e=$j("#bookacti-booking-filter-templates").val();var d=$j("#bookacti-booking-filter-status").val();var c=$j("#bookacti-booking-filter-customer").val();bookacti.booking_system[a]["calendars"]=e?e:[];bookacti.booking_system[a]["status"]=d?d:[];bookacti.booking_system[a]["user_id"]=c?c:0;bookacti_reload_booking_system(b)}function bookacti_init_booking_actions(){$j(".bookacti-booking-actions, .bookacti-booking-group-actions, #bookacti-bookings-list").on("click",".bookacti-booking-action, .bookacti-booking-group-action",function(c){c.preventDefault();if($j(this).hasClass("bookacti-booking-action")){var b=$j(this).data("booking-id");if($j(this).hasClass("bookacti-cancel-booking")){bookacti_dialog_cancel_booking(b,"single")}else{if($j(this).hasClass("bookacti-reschedule-booking")){bookacti_dialog_reschedule_booking(b)}else{if($j(this).hasClass("bookacti-refund-booking")){bookacti_dialog_refund_booking(b,"single")}else{if($j(this).hasClass("bookacti-change-booking-state")){bookacti_dialog_change_booking_state(b,"single")}}}}}else{var a=$j(this).data("booking-group-id");if($j(this).hasClass("bookacti-cancel-booking-group")){bookacti_dialog_cancel_booking(a,"group")}else{if($j(this).hasClass("bookacti-refund-booking-group")){bookacti_dialog_refund_booking(a,"group")}else{if($j(this).hasClass("bookacti-change-booking-group-state")){bookacti_dialog_change_booking_state(a,"group")}else{if($j(this).hasClass("bookacti-show-booking-group-bookings")){bookacti_display_grouped_bookings($j("#bookacti-booking-system-bookings-page"),a)}}}}}if($j(this).attr("href")&&$j(this).attr("href")!==""&&!$j(this).hasClass("prevent-default")){if($j(this).hasClass("_blank")){window.open($j(this).attr("href"))}else{location.href=$j(this).attr("href")}}})}function bookacti_display_grouped_bookings(b,a){a=typeof a!=="undefined"&&$j.isNumeric(a)?a:false;if(!a){return false}var d=$j('.bookacti-show-booking-group-bookings[data-booking-group-id="'+a+'"]').closest("tr");d.find(".bookacti-show-booking-group-bookings").toggleClass("active");if(d.next().hasClass("bookacti-gouped-booking")){if(d.next().is(":visible")){d.nextUntil("tr:not(.bookacti-gouped-booking)").addClass("hidden");if(d.nextUntil("tr:not(.bookacti-gouped-booking)").length%2){d.after('<tr class="bookacti-gouped-booking hidden dummy"></tr>')}}else{d.next(".bookacti-gouped-booking.hidden.dummy").remove();d.nextUntil("tr:not(.bookacti-gouped-booking)").removeClass("hidden")}return false}var c={action:"bookactiGetBookingRows",booking_group_id:a,nonce:bookacti_localized.nonce_get_booking_rows};bookacti_booking_row_enter_loading_state(d);$j.ajax({url:bookacti_localized.ajaxurl,type:"POST",data:c,dataType:"json",success:function(f){if(f.status==="success"){$j("#bookacti-bookings-list-container #the-list tr.no-items").remove();d.after(f.rows);$j("#bookacti-bookings-list").trigger("bookacti_grouped_bookings_displayed")}else{if(f.status==="failed"){var e=bookacti_localized.error_retrieve_bookings;if(f.error==="not_allowed"){e+="\n"+bookacti_localized.error_not_allowed}var g='<tr class="no-items" ><td class="colspanchange" colspan="'+$j("#bookacti-bookings-list table tr th").length+'" >'+e+"</td></tr>";d.after(g)}}},error:function(f){console.log("AJAX "+bookacti_localized.error_retrieve_bookings);console.log(f)},complete:function(){bookacti_booking_row_exit_loading_state(d)}})}function bookacti_booking_row_enter_loading_state(b){var a='<div class="bookacti-loading-alt"><img class="bookacti-loader" src="'+bookacti_localized.plugin_path+'/img/ajax-loader.gif" title="'+bookacti_localized.loading+'" /></div>';b.find(".bookacti-booking-state").hide();b.find(".bookacti-booking-state").after(a);b.find(".bookacti-booking-action").attr("disabled",true)}function bookacti_booking_row_exit_loading_state(a){a.find(".bookacti-loading-alt").remove();a.find(".bookacti-booking-state").show();a.find(".bookacti-booking-action").attr("disabled",false)}function bookacti_validate_picked_events(a,d){a=a||$j(".bookacti-booking-system:first");d=d||0;var j=a.attr("id");var i=a.parent().find('input[name="bookacti_group_id"]').val();var k=a.parent().find('input[name="bookacti_event_id"]').val();var b=a.parent().find('input[name="bookacti_event_start"]').val();var g=a.parent().find('input[name="bookacti_event_end"]').val();var c=0;var e={is_group:false,is_event:false,is_event_in_selected:false,are_picked_events_same_as_group:false,is_corrupted:false,is_qty_sup_to_avail:false,is_qty_sup_to_0:false,send:false};if(k!==""&&b!==""&&g!==""){e.is_event=true}if(i!==""&&(($j.isNumeric(i)&&typeof bookacti.booking_system[j]["groups_events"][i]!=="undefined")||(i==="single"&&e.is_event))){e.is_group=true}if(parseInt(d)>0){e.is_qty_sup_to_0=true}if(e.is_group&&typeof bookacti.booking_system[j]["picked_events"]!=="undefined"){if(i==="single"&&bookacti.booking_system[j]["picked_events"].length===1){if(bookacti.booking_system[j]["picked_events"][0]["id"]===k&&bookacti.booking_system[j]["picked_events"][0]["start"]===b&&bookacti.booking_system[j]["picked_events"][0]["end"]===g){e.is_event_in_selected=true;c=bookacti_get_event_availability(a,bookacti.booking_system[j]["picked_events"][0])}}else{if(bookacti.booking_system[j]["picked_events"].length===bookacti.booking_system[j]["groups_events"][i].length){var f=true;$j.each(bookacti.booking_system[j]["picked_events"],function(m,n){var l=false;$j.each(bookacti.booking_system[j]["groups_events"][i],function(p,o){if(n.id==o.id&&n.start===o.start&&n.end===o.end){l=true;return false}});if(!l){f=false;return false}});e.are_picked_events_same_as_group=f;c=bookacti_get_group_availability(a,bookacti.booking_system[j]["groups_events"][i])}}}if((parseInt(d)>parseInt(c))&&c!==0){e.is_qty_sup_to_avail=true}if((i==="single"&&e.is_event&&!e.is_event_in_selected)||($j.isNumeric(i)&&(!e.is_group||!e.are_picked_events_same_as_group))){e.is_corrupted=true}if(e.is_event&&e.is_group&&e.is_qty_sup_to_0&&!e.is_qty_sup_to_avail&&!e.is_corrupted){e.send=true}a.siblings(".bookacti-notices").empty();a.trigger("bookacti_validate_picked_events",[e]);if(!e.send){var h="";if((!e.is_event||!e.is_event_in_selected)&&!e.is_corrupted){h+="<li>"+bookacti_localized.error_select_schedule+"</li>"}if(e.is_qty_sup_to_avail){h+="<li>"+bookacti_localized.error_less_avail_than_quantity.replace("%1$s",d).replace("%2$s",c)+"</li>"}if(!e.is_qty_sup_to_0){h+="<li>"+bookacti_localized.error_quantity_inf_to_0+"</li>"}if(e.is_corrupted){h+="<li>"+bookacti_localized.error_corrupted_schedule+"</li>"}if(h!==""){a.siblings(".bookacti-notices").append("<ul class='bookacti-error-list'>"+h+"</ul>").show()}}return e.send};