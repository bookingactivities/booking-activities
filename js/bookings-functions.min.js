$j(document).ready(function(){$j("#bookacti-booking-list, .bookacti-user-booking-list-table").on("click","tbody tr",function(){$j(".bookacti-booking-list-selected-row").removeClass("bookacti-booking-list-selected-row");$j(this).addClass("bookacti-booking-list-selected-row")});$j("#bookacti-booking-list, .bookacti-user-booking-list-table").on("bookacti_booking_action_data","tr.bookacti-single-booking, tr.bookacti-booking-group",function(c,b){var a=false;if(typeof b.form_data!=="undefined"){if(b.form_data instanceof FormData){a=true}}if(a){b.form_data.append("locale",bookacti_localized.current_locale)}else{b.locale=bookacti_localized.current_locale}});$j("#bookacti-booking-list").on("click","tbody .toggle-row",function(){$j(this).closest("tr").toggleClass("is-expanded")});$j("#bookacti-booking-list tbody").off("click",".toggle-row")});function bookacti_filter_booking_list(c){c=c?c:1;var a=$j("#bookacti-booking-system-bookings-page");var d=$j("#bookacti-booking-list-filters-form").serializeObject();d.paged=c;d.action="bookactiGetBookingList";if(!d.templates){d.templates=[];$j("#bookacti-booking-filter-templates option").each(function(){d.templates.push($j(this).val())})}a.trigger("bookacti_filter_booking_list_data",[d]);bookacti_start_loading_booking_system(a);var b=$j("#bookacti-booking-list thead .manage-column:not(.hidden)").length?$j("#bookacti-booking-list thead .manage-column:not(.hidden)").length:1;var e='<div class="bookacti-loading-alt"><img class="bookacti-loader" src="'+bookacti_localized.plugin_path+'/img/ajax-loader.gif" title="'+bookacti_localized.loading+'" /><span class="bookacti-loading-alt-text" >'+bookacti_localized.loading+"</span></div>";$j("#bookacti-booking-list #the-list").html('<tr class="no-items" ><td class="colspanchange" colspan="'+b+'" >'+e+"</td></tr>");$j.ajax({url:bookacti_localized.ajaxurl,type:"POST",data:d,dataType:"json",success:function(f){if(f.status==="success"){$j("#bookacti-booking-list").html(f.booking_list);bookacti_refresh_list_table_hidden_columns();window.history.pushState({path:f.new_url},"",f.new_url);$j("#bookacti-booking-list").trigger("bookacti_booking_list_filtered",[f,d])}else{if(f.status==="failed"){var h=typeof f.message!=="undefined"?f.message:bookacti_localized.error;var g='<tr class="no-items" ><td class="colspanchange" colspan="'+b+'" >'+h+"</td></tr>";$j("#bookacti-booking-list #the-list").append(g)}}},error:function(f){console.log("AJAX "+bookacti_localized.error);console.log(f)},complete:function(){bookacti_stop_loading_booking_system(a)}})}function bookacti_update_template_related_filters(){var a=bookacti.booking_system["bookacti-booking-system-bookings-page"]["templates_per_activities"];var b=$j("#bookacti-booking-filter-templates").val();if($j.isEmptyObject(b)){$j("#bookacti-booking-filter-activities option").show();return false}if(typeof a==="undefined"){return false}$j("#bookacti-booking-filter-activities option").each(function(c,f){var e=parseInt($j(f).attr("value"));var d=true;$j.each(b,function(h,g){if(typeof a[e]==="undefined"){return true}if($j.inArray(g,a[e]["template_ids"])===-1){return true}d=false;return false});if(d){if($j(f).is(":selected")){$j(f).prop("selected",false)}$j(f).hide()}else{$j(f).show()}})}function bookacti_refresh_calendar_according_to_date_filter(){if(!$j("#bookacti-booking-system-filter-container").is(":visible")){return false}var e=$j("#bookacti-booking-system-bookings-page");var d=e.attr("id");var g=e.find(".bookacti-calendar");var f=$j("#bookacti-booking-filter-dates-from").val();var b=$j("#bookacti-booking-filter-dates-to").val();var c={start:moment.utc(f?f+" 00:00:00":"1970-02-01 00:00:00").locale("en"),end:moment.utc(b?b+" 23:59:59":"2037-12-31 23:59:59").locale("en")};bookacti.booking_system[d]["start"]=c.start.format("YYYY-MM-DD HH:mm:ss");bookacti.booking_system[d]["end"]=c.end.format("YYYY-MM-DD HH:mm:ss");var a={start:c.start.format("YYYY-MM-DD"),end:c.end.add(1,"days").format("YYYY-MM-DD")};g.fullCalendar("option","validRange",a)}function bookacti_unpick_all_events_filter(){var a=$j("#bookacti-booking-system-bookings-page");bookacti_clear_booking_system_displayed_info(a);$j("#bookacti-unpick-events-filter").hide(200);$j("#bookacti-picked-events-actions-container").hide(200);if($j("#bookacti-booking-system-filter-container").is(":visible")){$j("#bookacti-pick-event-filter-instruction").show(200)}}function bookacti_reload_booking_system_according_to_filters(b){var a=b.attr("id");var g=$j("#bookacti-booking-filter-templates").val();var d=$j("#bookacti-booking-filter-status").val();var c=$j("#bookacti-booking-filter-customer").val();var f=$j("#bookacti-booking-filter-dates-from").val();var e=$j("#bookacti-booking-filter-dates-end").val();if(!g){g=[];$j("#bookacti-booking-filter-templates option").each(function(){g.push($j(this).val())})}bookacti.booking_system[a]["calendars"]=g;bookacti.booking_system[a]["activities"]=[];bookacti.booking_system[a]["group_categories"]=[];bookacti.booking_system[a]["status"]=d?d:[];bookacti.booking_system[a]["user_id"]=c?c:0;bookacti.booking_system[a]["start"]=f?f+" 00:00:00":"";bookacti.booking_system[a]["end"]=e?e+" 23:59:59":"";bookacti_unpick_all_events_filter();bookacti_reload_booking_system(b)}function bookacti_init_booking_actions(){$j(".bookacti-user-booking-list-table, .woocommerce-table, #bookacti-booking-list").on("click",".bookacti-booking-action, .bookacti-booking-group-action",function(c){c.preventDefault();if($j(this).hasClass("bookacti-booking-action")){var b=$j(this).data("booking-id");if($j(this).hasClass("bookacti-cancel-booking")){bookacti_dialog_cancel_booking(b,"single")}else{if($j(this).hasClass("bookacti-reschedule-booking")){bookacti_dialog_reschedule_booking(b)}else{if($j(this).hasClass("bookacti-refund-booking")){bookacti_dialog_refund_booking(b,"single")}else{if($j(this).hasClass("bookacti-change-booking-state")){bookacti_dialog_change_booking_state(b,"single")}else{if($j(this).hasClass("bookacti-change-booking-quantity")){bookacti_dialog_change_booking_quantity(b,"single")}else{if($j(this).hasClass("bookacti-delete-booking")){bookacti_dialog_delete_booking(b,"single")}}}}}}}else{var a=$j(this).data("booking-group-id");if($j(this).hasClass("bookacti-cancel-booking-group")){bookacti_dialog_cancel_booking(a,"group")}else{if($j(this).hasClass("bookacti-refund-booking-group")){bookacti_dialog_refund_booking(a,"group")}else{if($j(this).hasClass("bookacti-change-booking-group-state")){bookacti_dialog_change_booking_state(a,"group")}else{if($j(this).hasClass("bookacti-change-booking-group-quantity")){bookacti_dialog_change_booking_quantity(a,"group")}else{if($j(this).hasClass("bookacti-show-booking-group-bookings")){bookacti_display_grouped_bookings(a)}else{if($j(this).hasClass("bookacti-delete-booking-group")){bookacti_dialog_delete_booking(a,"group")}}}}}}}if($j(this).attr("href")&&$j(this).attr("href")!==""&&!$j(this).hasClass("prevent-default")){if($j(this).hasClass("_blank")){window.open($j(this).attr("href"))}else{location.href=$j(this).attr("href")}}});if($j("body.booking-activities_page_bookacti_bookings").length){bookacti_init_add_and_remove_items()}}function bookacti_init_booking_bulk_actions(){$j("body").on("submit",".bookacti-bookings-bulk-action",function(a){if($j(this).find('[name="action"]').val()==-1||$j(this).find('[name="action2"]').val()==-1){a.preventDefault()}})}function bookacti_change_export_type_according_to_active_tab(){var b=$j("#bookacti-export-bookings-dialog .bookacti-tabs li.ui-tabs-active");var a=b.length?(b.hasClass("bookacti-tab-ical")?"ical":"csv"):"csv";var c=$j("#bookacti-export-bookings-url-container").data("export-type");$j("#bookacti-export-type-field").val(a);if(c===a){$j("#bookacti-export-bookings-url-container").show();$j("#bookacti-export-bookings-dialog .bookacti-notices").show()}else{$j("#bookacti-export-bookings-url-container").hide();$j("#bookacti-export-bookings-dialog .bookacti-notices").hide()}}function bookacti_display_grouped_bookings(a){a=typeof a!=="undefined"&&$j.isNumeric(a)?a:false;if(!a){return false}var d=$j('.bookacti-show-booking-group-bookings[data-booking-group-id="'+a+'"]:focus').first().closest("tr");d.find(".bookacti-show-booking-group-bookings").toggleClass("active");if(d.next().hasClass("bookacti-gouped-booking")){if(d.next().is(":visible")){d.nextUntil("tr:not(.bookacti-gouped-booking)").addClass("hidden");if(d.nextUntil("tr:not(.bookacti-gouped-booking)").length%2){d.after('<tr class="bookacti-gouped-booking hidden dummy"></tr>')}}else{d.next(".bookacti-gouped-booking.hidden.dummy").remove();d.nextUntil("tr:not(.bookacti-gouped-booking)").removeClass("hidden")}return false}var b=[];d.find("td").each(function(){var e=$j(this).data("column-id");if(e){b.push(e)}});var c={action:"bookactiGetGroupedBookingsRows",booking_group_id:a,is_admin:bookacti_localized.is_admin?1:0,context:bookacti_localized.is_admin?"admin_booking_list":"user_booking_list",columns:b,nonce:bookacti_localized.nonce_get_booking_rows};d.trigger("bookacti_booking_action_data",[c,a,"group","display_grouped_bookings"]);bookacti_booking_row_enter_loading_state(d);$j.ajax({url:bookacti_localized.ajaxurl,type:"POST",data:c,dataType:"json",success:function(e){if(e.status==="success"){$j("#bookacti-booking-list-container #the-list tr.no-items").remove();d.after(e.rows);bookacti_refresh_list_table_hidden_columns();$j("#bookacti-booking-list").trigger("bookacti_grouped_bookings_displayed")}else{if(e.status==="failed"){var g=$j("#bookacti-booking-list thead .manage-column:not(.hidden)").length?$j("#bookacti-booking-list thead .manage-column:not(.hidden)").length:1;var h=typeof e.message!=="undefined"?e.message:bookacti_localized.error;var f='<tr class="no-items" ><td class="colspanchange" colspan="'+g+'" >'+h+"</td></tr>";d.after(f)}}},error:function(f){console.log("AJAX "+bookacti_localized.error);console.log(f)},complete:function(){bookacti_booking_row_exit_loading_state(d)}})}function bookacti_booking_row_enter_loading_state(b){var a='<div class="bookacti-loading-alt"><img class="bookacti-loader" src="'+bookacti_localized.plugin_path+'/img/ajax-loader.gif" title="'+bookacti_localized.loading+'" /></div>';b.find(".bookacti-booking-state").hide();b.find(".bookacti-booking-state").after(a);b.find(".bookacti-booking-action").attr("disabled",true)}function bookacti_booking_row_exit_loading_state(a){a.find(".bookacti-loading-alt").remove();a.find(".bookacti-booking-state").show();a.find(".bookacti-booking-action").attr("disabled",false)}function bookacti_refresh_list_table_hidden_columns(){$j(".hide-column-tog").each(function(){var a=$j(this).val();if($j(this).prop("checked")){$j(".column-"+a).removeClass("hidden")}else{$j(".column-"+a).addClass("hidden")}})}function bookacti_refresh_booking_group_frame(){$j(".bookacti-gouped-booking").removeClass("bookacti-gouped-booking-first bookacti-gouped-booking-last");var a=0;$j(".bookacti-gouped-booking").each(function(){if(a===$j(this).data("booking-group-id")){return true}a=$j(this).data("booking-group-id");$j('.bookacti-gouped-booking[data-booking-group-id="'+a+'"]:not(.hidden):first').addClass("bookacti-gouped-booking-first");$j('.bookacti-gouped-booking[data-booking-group-id="'+a+'"]:not(.hidden):last').addClass("bookacti-gouped-booking-last")})}function bookacti_validate_picked_events(a,f){a=a||$j(".bookacti-booking-system:first");f=f||0;var p=a.attr("id");var o=bookacti.booking_system[p]["picked_events"];var h={events_selected:true,consistent_inputs:true,is_qty_sup_to_0:true,is_qty_inf_to_avail:true,send:true};var c=a.closest("form");var r={selected_events:{}};if(c.length){r=c.serializeObject()}else{var m=a.siblings(".bookacti-booking-system-inputs");if(m.length){m.wrap('<form class="bookacti-temporary-form"></form>');r=m.closest("form.bookacti-temporary-form").serializeObject();m.unwrap("form.bookacti-temporary-form")}}if(typeof r.selected_events==="undefined"){h.events_selected=false}else{if($j.isEmptyObject(r.selected_events)){h.events_selected=false}}if(!o.length){h.events_selected=false}if(h.events_selected){var g=0;$j.each(o,function(i,k){if(!h.consistent_inputs){return false}if(parseInt(k.group_id)>0){if(r.selected_events[g]["group_id"]!=k.group_id||r.selected_events[g]["group_date"]!==k.group_date){h.consistent_inputs=false}}else{if(r.selected_events[g]["id"]!=k.id||r.selected_events[g]["start"]!==k.start||r.selected_events[g]["end"]!==k.end){h.consistent_inputs=false}}++g});var b=0;var e;for(e in r.selected_events){if(r.selected_events.hasOwnProperty(e)){++b}}var j=0;var d;for(d in o){if(o.hasOwnProperty(d)){++j}}if(b!==j){h.consistent_inputs=false}}if(parseInt(f)<=0){h.is_qty_sup_to_0=false}else{var q=bookacti_get_min_and_max_quantity(a);if((parseInt(f)>parseInt(q.avail))){h.is_qty_inf_to_avail=false}}if(!h.events_selected||!h.consistent_inputs||!h.is_qty_sup_to_0||!h.is_qty_inf_to_avail){h.send=false}a.siblings(".bookacti-notices").empty();a.trigger("bookacti_validate_picked_events",[h]);if(!h.send){var n="";if(!h.events_selected){n+="<li>"+bookacti_localized.error_select_event+"</li>"}if(!h.is_qty_inf_to_avail){n+="<li>"+bookacti_localized.error_less_avail_than_quantity.replace("%1$s",f).replace("%2$s",q.avail)+"</li>"}if(!h.is_qty_sup_to_0){n+="<li>"+bookacti_localized.error_quantity_inf_to_0+"</li>"}if(!h.consistent_inputs){n+="<li>"+bookacti_localized.error_corrupted_event+"</li>"}if(n!==""){a.siblings(".bookacti-notices").append("<ul class='bookacti-error-list'>"+n+"</ul>").show()}}return h.send};