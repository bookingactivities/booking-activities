function bookacti_switch_template(a){if(a){$j("#bookacti-template-picker").val(a);bookacti.load_events=!1;var b=$j.extend({},bookacti.booking_system["bookacti-template-calendar"]);b=bookacti_get_booking_system_attributes_without_data($j("#bookacti-template-calendar"));delete b.display_data;delete b.picked_events;bookacti_start_template_loading();$j.ajax({url:ajaxurl,data:{action:"bookactiSwitchTemplate",template_id:a,attributes:JSON.stringify(b),nonce:$j("#bookacti-edit-template-nonce").val()},type:"POST",
dataType:"json",success:function(c){if("success"===c.status){var d=bookacti.selected_template?!1:!0,e=bookacti.booking_system["bookacti-template-calendar"].loading_number;bookacti.selected_template=parseInt(a);bookacti.hidden_activities=[];bookacti.booking_system["bookacti-template-calendar"]=c.booking_system_data;bookacti.booking_system["bookacti-template-calendar"].selected_events=[];bookacti.booking_system["bookacti-template-calendar"].picked_events=[];bookacti.booking_system["bookacti-template-calendar"].loading_number=
e;bookacti.booking_system["bookacti-template-calendar"].method="calendar";bookacti.booking_system["bookacti-template-calendar"].past_events=!0;bookacti.booking_system["bookacti-template-calendar"].past_events_bookable=!0;d&&(bookacti_bind_template_dialogs(),bookacti_init_groups_of_events());bookacti_load_template_calendar();$j("#bookacti-template-activity-list .bookacti-activity").remove();$j("#bookacti-template-activity-list").append(c.activities_list);bookacti_refresh_activity_list();$j("#bookacti-group-categories").empty();
$j("#bookacti-group-categories").append(c.groups_list);$j("#bookacti-template-add-group-of-events-tuto-select-events").toggle(""===c.groups_list);$j("#bookacti-template-groups-of-events-container .dashicons").toggleClass("bookacti-disabled",0<bookacti.booking_system["bookacti-template-calendar"].loading_number);bookacti.booking_system["bookacti-template-calendar"].selected_events=[];$j("#bookacti-insert-group-of-events").css("visibility","hidden");$j("#bookacti-template-add-first-group-of-events-container").hide();
$j('#bookacti-group-of-events-category-selectbox option[value!="new"]').remove();var g=[];$j("#bookacti-group-categories .bookacti-group-category").each(function(){$j("#bookacti-group-of-events-category-selectbox").append('<option value="'+$j(this).data("group-category-id")+'">'+$j(this).find(".bookacti-group-category-title").attr("title")+"</option>");1==$j(this).data("visible")&&g.push($j(this).data("group-category-id"))});bookacti_make_group_categories_sortable();bookacti_make_groups_of_events_sortable();
bookacti_update_create_form_link_template_id(bookacti.selected_template);bookacti_start_template_loading();bookacti.fc_calendar["bookacti-template-calendar"].gotoDate(moment.utc().locale("en").format("YYYY-MM-DD"));bookacti_clear_events_on_calendar_editor();c=bookacti.fc_calendar["bookacti-template-calendar"].view;c={start:moment.utc(moment.utc(c.currentStart).clone().locale("en").format("YYYY-MM-DD")+" 00:00:00"),end:moment.utc(moment.utc(c.currentEnd).clone().locale("en").subtract(1,"days").format("YYYY-MM-DD")+
" 23:59:59")};c=bookacti_get_interval_of_events($j("#bookacti-template-calendar"),c);$j.isEmptyObject(c)||bookacti_get_calendar_editor_data_by_interval(c);bookacti.load_events=!0;$j("#bookacti-template-calendar").trigger("bookacti_calendar_editor_template_switched");bookacti_stop_template_loading()}else"failed"===c.status&&(d="undefined"!==typeof c.message?c.message:bookacti_localized.error,alert(d),console.log(d),console.log(c))},error:function(c){console.log("AJAX "+bookacti_localized.error);console.log(c)},
complete:function(){bookacti_stop_template_loading()}})}else $j("#bookacti-template-picker").val(""),bookacti.selected_template=0,$j("#bookacti-first-template-container").show(),$j("#bookacti-template-sidebar, #bookacti-calendar-integration-tuto-container").addClass("bookacti-no-template"),$j("#bookacti-template-calendar").remove(),$j("#bookacti-template-activity-list .bookacti-activity").remove(),bookacti_display_activity_tuto_if_no_activity_available(),bookacti.booking_system["bookacti-template-calendar"].selected_events=
[],$j("#bookacti-insert-group-of-events").css("visibility","hidden"),$j("#bookacti-template-add-first-group-of-events-container").hide(),$j("#bookacti-template-add-group-of-events-tuto-select-events").show(),bookacti_bind_template_dialogs()}
function bookacti_refresh_activity_list(){$j("#bookacti-template-activity-list").css("height",200<$j("#bookacti-template-activity-list").outerHeight()?200:"auto");bookacti_display_activity_tuto_if_no_activity_available();bookacti_refresh_show_hide_activities_icons()}
function bookacti_init_show_hide_activities_switch(){$j("body").on("click","#bookacti-template-activity-list .bookacti-activity-visibility",function(){var a=parseInt($j(this).closest(".bookacti-activity").data("activity-id")),b=$j.inArray(a,bookacti.hidden_activities);1===$j(this).data("activity-visible")?($j(this).removeClass("dashicons-visibility"),$j(this).addClass("dashicons-hidden"),$j(this).data("activity-visible",0),$j(this).attr("data-activity-visible",0),-1===b&&bookacti.hidden_activities.push(a)):
($j(this).addClass("dashicons-visibility"),$j(this).removeClass("dashicons-hidden"),$j(this).data("activity-visible",1),$j(this).attr("data-activity-visible",1),-1!==b&&bookacti.hidden_activities.splice(b,1));"undefined"!==typeof bookacti.fc_calendar["bookacti-template-calendar"]&&bookacti.fc_calendar["bookacti-template-calendar"].render()})}
function bookacti_refresh_show_hide_activities_icons(){var a=$j("#bookacti-template-activity-list .bookacti-activity-visibility");a.addClass("dashicons-visibility");a.removeClass("dashicons-hidden");a.data("activity-visible",1);a.attr("data-activity-visible",1);$j.each(bookacti.hidden_activities,function(b,c){$j('#bookacti-template-activity-list .bookacti-activity[data-activity-id="'+c+'"] .bookacti-activity-visibility').length&&(b=$j('#bookacti-template-activity-list .bookacti-activity[data-activity-id="'+
c+'"] .bookacti-activity-visibility'),b.removeClass("dashicons-visibility"),b.addClass("dashicons-hidden"),b.data("activity-visible",0),b.attr("data-activity-visible",0))})}function bookacti_make_activities_draggable(){new FullCalendar.Draggable(document.getElementById("bookacti-template-activity-list"),{itemSelector:".bookacti-activity-draggable:not(.bookacti-activity-disabled)"})}
function bookacti_make_activities_sortable(){$j("#bookacti-template-activity-list").sortable({items:".bookacti-activity",handle:".bookacti-activity-visibility",placeholder:"bookacti-calendar-editor-sortable-placeholder",delay:300,update:function(a,b){bookacti_save_template_items_order("activities")}});$j("#bookacti-template-activity-list").disableSelection()}
function bookacti_save_template_items_order(a,b){a="undefined"!==typeof a?a:"";b="undefined"!==typeof b?parseInt(b):0;var c="";switch(a){case "activities":var d="#bookacti-template-activity-list .bookacti-activity";c="activity-id";break;case "group_categories":d="#bookacti-group-categories .bookacti-group-category";c="group-category-id";break;case "groups_of_events":d='.bookacti-group-category[data-group-category-id="'+b+'"] .bookacti-groups-of-events-editor-list .bookacti-group-of-events',c="group-id"}var e=
[];d&&c&&$j(d).length&&$j(d).each(function(){"undefined"!==typeof $j(this).data(c)&&e.push($j(this).data(c))});if(e.length){var g={action:"bookactiSaveTemplateItemsOrder",template_id:bookacti.selected_template,item_type:a,item_id:b,items_order:e,nonce:$j("#bookacti-edit-template-nonce").val()};$j("#bookacti-template-container").trigger("bookacti_update_template_items_order_data",[g,a,b]);bookacti_start_template_loading();$j.ajax({url:ajaxurl,data:g,type:"POST",dataType:"json",success:function(f){"success"===
f.status?$j("#bookacti-template-container").trigger("bookacti_template_items_order_updated",[f,g,a,b]):"failed"===f.status&&(console.log("undefined"!==typeof f.message?f.message:bookacti_localized.error),console.log(f))},error:function(f){console.log("AJAX "+bookacti_localized.error);console.log(f)},complete:function(){bookacti_stop_template_loading()}})}}
function bookacti_init_groups_of_events(){$j("body").on("click","#bookacti-template-calendar .fc-more",function(){bookacti_refresh_selected_events_display()});$j("body").on("bookacti_select_event bookacti_unselect_event bookacti_unselect_all_events","#bookacti-template-calendar",function(){bookacti_maybe_display_add_group_of_events_button()});$j("body").on("bookacti_select_event bookacti_unselect_event","#bookacti-template-calendar",function(){0>=bookacti.booking_system["bookacti-template-calendar"].selected_events.length&&
(bookacti_unselect_all_events(),bookacti_refresh_selected_events_display())});$j("body").on("click","#bookacti-group-categories .bookacti-group-category-title",function(){var a=$j(this).parent().data("group-category-id");bookacti_expand_collapse_groups_of_events(a)});$j("body").on("click","#bookacti-group-categories .bookacti-group-of-events-title",function(){if($j(this).closest(".bookacti-group-of-events").hasClass("bookacti-selected-group"))bookacti_unselect_all_events(),bookacti_refresh_selected_events_display();
else{var a=$j(this).closest(".bookacti-group-of-events").data("group-id");bookacti_select_events_of_group(a)}})}function bookacti_make_group_categories_sortable(){$j("#bookacti-group-categories").sortable({items:".bookacti-group-category",handle:".bookacti-group-category-title",placeholder:"bookacti-calendar-editor-sortable-placeholder",delay:300,update:function(a,b){bookacti_save_template_items_order("group_categories")}});$j("#bookacti-group-categories").disableSelection()}
function bookacti_make_groups_of_events_sortable(){$j(".bookacti-groups-of-events-editor-list").sortable({items:".bookacti-group-of-events",handle:".bookacti-group-of-events-title",placeholder:"bookacti-calendar-editor-sortable-placeholder",delay:300,update:function(a,b){a=$j(b.item).closest(".bookacti-group-category").data("group-category-id");bookacti_save_template_items_order("groups_of_events",a)}});$j(".bookacti-groups-of-events-editor-list").disableSelection()}
function bookacti_add_group_category(a,b){$j("#bookacti-group-categories").append("<div class='bookacti-group-category'  data-group-category-id='"+a+"' data-show-groups='0' data-visible='1' ><div class='bookacti-group-category-title' title='"+b+"' ><span>"+b+"</span></div><div class='bookacti-update-group-category dashicons dashicons-admin-generic' ></div><div class='bookacti-groups-of-events-editor-list bookacti-custom-scrollbar'></div></div>");$j("#bookacti-group-of-events-category-selectbox").append("<option value='"+
a+"' >"+b+"</option>");bookacti.selected_category=a}
function bookacti_add_group_of_events(a,b,c){$j('.bookacti-group-category[data-group-category-id="'+c+'"]').length||bookacti_add_group_category(c,"Untitled");$j('.bookacti-group-category[data-group-category-id="'+c+'"] .bookacti-groups-of-events-editor-list').append("<div class='bookacti-group-of-events' data-group-id='"+a+"' ><div class='bookacti-group-of-events-title' title='"+b+"'>"+b+"</div><div class='bookacti-update-group-of-events dashicons dashicons-admin-generic' ></div></div>");bookacti_expand_collapse_groups_of_events(c,
"expand",!0)}
function bookacti_select_events_of_group(a,b){a=a?parseInt(a):0;b=b?b:"";if(!a)return!1;bookacti_unselect_all_events();bookacti.booking_system["bookacti-template-calendar"].selected_events=[];bookacti.fc_calendar["bookacti-template-calendar"].render();var c=[];b&&"undefined"!==typeof bookacti.booking_system["bookacti-template-calendar"].groups_events[a]&&"undefined"!==typeof bookacti.booking_system["bookacti-template-calendar"].groups_events[a][b]&&(c=bookacti.booking_system["bookacti-template-calendar"].groups_events[a][b].slice());c.length||
"undefined"!==typeof bookacti.booking_system["bookacti-template-calendar"].groups_data[a]&&"undefined"!==typeof bookacti.booking_system["bookacti-template-calendar"].groups_data[a].events&&(c=bookacti.booking_system["bookacti-template-calendar"].groups_data[a].events.slice());c.length&&bookacti.fc_calendar["bookacti-template-calendar"].gotoDate(c[0].start);var d=!0;$j.each(c,function(e,g){!1===bookacti_select_event(g)&&(d=!1)});d&&$j('.bookacti-group-of-events[data-group-id="'+a+'"]').addClass("bookacti-selected-group");
return d}
function bookacti_select_event(a){if("object"!==typeof a||"object"===typeof a&&("undefined"===typeof a.id||"undefined"===typeof a.start))return!1;var b="undefined"!==typeof a.groupId?parseInt(a.groupId):parseInt(a.id),c="undefined"!==typeof bookacti.booking_system["bookacti-template-calendar"].events_data[b]?bookacti.booking_system["bookacti-template-calendar"].events_data[b]:[],d=a.activity_id?a.activity_id:c.activity_id?c.activity_id:0,e="";a.title||(c.title?e=c.title:$j('.bookacti-activity[data-activity-id="'+d+
'"] .bookacti-activity-draggable').length&&(e=$j('.bookacti-activity[data-activity-id="'+d+'"] .bookacti-activity-draggable').text()));a={id:b,activity_id:d,title:a.title?a.title:e,start:moment.utc(a.start).clone().locale("en"),end:moment.utc(a.end).clone().locale("en")};b=$j('.fc-event[data-event-id="'+a.id+'"][data-event-start="'+a.start.format("YYYY-MM-DD HH:mm:ss")+'"]');b.length&&(b.addClass("bookacti-selected-event"),b.find(".bookacti-event-action-select-checkbox").prop("checked",!0));bookacti.booking_system["bookacti-template-calendar"].selected_events.push({id:a.id,
activity_id:a.activity_id,title:a.title,start:a.start.format("YYYY-MM-DD HH:mm:ss"),end:a.end.format("YYYY-MM-DD HH:mm:ss")});bookacti.booking_system["bookacti-template-calendar"].selected_events.sort(function(g,f){g=moment.utc(g.start);f=moment.utc(f.start);return g.isBefore(f)?-1:g.isAfter(f)?1:0});$j("#bookacti-template-calendar").trigger("bookacti_select_event",[a]);return!0}
function bookacti_unselect_event(a,b){b=b?!0:!1;if("object"!==typeof a&&!$j.isNumeric(a)||"object"===typeof a&&("undefined"===typeof a.id||"undefined"===typeof a.start)||$j.isNumeric(a)&&!b)return!1;var c={id:$j.isNumeric(a)?a:"undefined"!==typeof a.groupId?a.groupId:a.id,start:"undefined"!==typeof a.start?moment.utc(a.start).clone().locale("en"):"",end:"undefined"!==typeof a.end?moment.utc(a.end).clone().locale("en"):""};a=c.start?moment.utc(c.start).clone().locale("en").format("YYYY-MM-DD HH:mm:ss"):
"";var d=c.start?moment.utc(c.start).clone().locale("en").format("YYYY-MM-DD"):"";a=b?$j('.fc-event[data-event-id="'+c.id+'"]'):$j('.fc-event[data-event-id="'+c.id+'"][data-event-start="'+a+'"]');a.length&&(a.removeClass("bookacti-selected-event"),a.find(".bookacti-event-action-select-checkbox").prop("checked",!1));a=$j.grep(bookacti.booking_system["bookacti-template-calendar"].selected_events,function(e){return e.id!=c.id||!b&&e.start.substr(0,10)!==d?!0:!1});bookacti.booking_system["bookacti-template-calendar"].selected_events=
a;$j("#bookacti-template-calendar").trigger("bookacti_unselect_event",[c,b]);return!0}
function bookacti_unselect_all_events(){$j(".fc-event").removeClass("bookacti-selected-event");$j(".fc-event").find(".bookacti-event-action-select-checkbox").prop("checked",!1);bookacti.booking_system["bookacti-template-calendar"].selected_events=[];$j(".bookacti-group-of-events.bookacti-selected-group").removeClass("bookacti-selected-group");$j("#bookacti-template-calendar").trigger("bookacti_unselect_all_events")}
function bookacti_refresh_selected_events_display(){$j(".fc-event").removeClass("bookacti-selected-event");$j(".fc-event .bookacti-event-action-select-checkbox").prop("checked",!1);$j.each(bookacti.booking_system["bookacti-template-calendar"].selected_events,function(a,b){a=$j('.fc-event[data-event-id="'+b.id+'"][data-event-start="'+b.start+'"]');a.addClass("bookacti-selected-event");a.find(".bookacti-event-action-select-checkbox").prop("checked",!0)});$j("#bookacti-template-calendar").trigger("bookacti_refresh_selected_events")}
function bookacti_update_create_form_link_template_id(a){$j('#bookacti-calendar-integration-tuto-container input[name="calendar_field[calendars]"]').val(a);bookacti_update_create_form_link_url()}function bookacti_update_create_form_link_url(){var a=$j("#bookacti-create-form-link").data("base-url"),b=$j("#bookacti-calendar-integration-tuto-container input").serialize();$j("#bookacti-create-form-link").attr("href",a+"?"+b)}
function bookacti_get_calendar_editor_data_by_interval(a){a=a?a:bookacti.booking_system["bookacti-template-calendar"].events_interval;if($j.isEmptyObject(a)){var b=bookacti.fc_calendar["bookacti-template-calendar"].view;b={start:moment.utc(moment.utc(b.currentStart).clone().locale("en").format("YYYY-MM-DD")+" 00:00:00"),end:moment.utc(moment.utc(b.currentEnd).clone().locale("en").subtract(1,"days").format("YYYY-MM-DD")+" 23:59:59")};a=bookacti_get_interval_of_events($j("#bookacti-template-calendar"),
b)}bookacti.booking_system["bookacti-template-calendar"].events_interval=bookacti_get_extended_events_interval($j("#bookacti-template-calendar"),a);b=$j.isEmptyObject(bookacti.booking_system["bookacti-template-calendar"].groups_events)?[]:Object.keys(bookacti.booking_system["bookacti-template-calendar"].groups_events);bookacti_start_template_loading();$j.ajax({url:ajaxurl,type:"POST",data:{action:"bookactiGetCalendarEditorDataByInterval",template_id:bookacti.selected_template,interval:JSON.stringify(a),
group_ids:JSON.stringify(b),nonce:$j("#bookacti-edit-template-nonce").val()},dataType:"json",success:function(c){if("success"===c.status)$j.isEmptyObject(bookacti.booking_system["bookacti-template-calendar"].events)?bookacti.booking_system["bookacti-template-calendar"].events=c.events:$j.extend(bookacti.booking_system["bookacti-template-calendar"].events,c.events),$j.isEmptyObject(bookacti.booking_system["bookacti-template-calendar"].events_data)?bookacti.booking_system["bookacti-template-calendar"].events_data=
c.events_data:$j.extend(bookacti.booking_system["bookacti-template-calendar"].events_data,c.events_data),$j.isEmptyObject(bookacti.booking_system["bookacti-template-calendar"].groups_events)?bookacti.booking_system["bookacti-template-calendar"].groups_events=c.groups_events:$j.extend(!0,bookacti.booking_system["bookacti-template-calendar"].groups_events,c.groups_events),$j.isEmptyObject(bookacti.booking_system["bookacti-template-calendar"].bookings)?bookacti.booking_system["bookacti-template-calendar"].bookings=
c.bookings:$j.extend(!0,bookacti.booking_system["bookacti-template-calendar"].bookings,c.bookings),bookacti_fc_add_events($j("#bookacti-template-calendar"),c.events),$j("#bookacti-template-calendar").trigger("bookacti_calendar_editor_interval_data_loaded",[c,a]);else{var d="undefined"!==typeof c.message?c.message:bookacti_localized.error;alert(d);console.log(d);console.log(c)}},error:function(c){alert("AJAX "+bookacti_localized.error);console.log(c)},complete:function(){bookacti_stop_template_loading()}})}
function bookacti_refetch_events_on_calendar_editor(){bookacti_clear_events_on_calendar_editor();var a=bookacti.fc_calendar["bookacti-template-calendar"].view;a={start:moment.utc(moment.utc(a.currentStart).clone().locale("en").format("YYYY-MM-DD")+" 00:00:00"),end:moment.utc(moment.utc(a.currentEnd).clone().locale("en").subtract(1,"days").format("YYYY-MM-DD")+" 23:59:59")};a=bookacti_get_interval_of_events($j("#bookacti-template-calendar"),a);bookacti_get_calendar_editor_data_by_interval(a)}
function bookacti_clear_events_on_calendar_editor(){bookacti.booking_system["bookacti-template-calendar"].events=[];bookacti.booking_system["bookacti-template-calendar"].events_data=[];bookacti.booking_system["bookacti-template-calendar"].events_interval=[];"undefined"!==typeof bookacti.fc_calendar["bookacti-template-calendar"]&&bookacti.fc_calendar["bookacti-template-calendar"].removeAllEvents()}
function bookacti_update_event_dates(a,b,c,d){c="undefined"!==typeof c?c:!1;d="undefined"!==typeof d?d:"";var e="",g={forced_update:0};"normal"===d&&(e="bookacti-update-event-dates-dialog");"booked"===d&&(e="bookacti-update-booked-event-dates-dialog",g=bookacti_serialize_object($j("#bookacti-update-booked-event-dates-form")),g.forced_update=1);e&&$j("#"+e+" .bookacti-notices").remove();var f="undefined"!==typeof a.groupId?parseInt(a.groupId):parseInt(a.id),n=moment.utc(a.start).clone().locale("en").format("YYYY-MM-DD HH:mm:ss"),
h=a.end?moment.utc(a.end).clone().locale("en").format("YYYY-MM-DD HH:mm:ss"):n,q=moment.utc(b.start).clone().locale("en").format("YYYY-MM-DD HH:mm:ss"),y=b.end?moment.utc(b.end).clone().locale("en").format("YYYY-MM-DD HH:mm:ss"):q,v=$j.extend({action:"bookactiUpdateEventDates",event_id:f,event_start:n,event_end:h,old_event_start:q,old_event_end:y,interval:bookacti.booking_system["bookacti-template-calendar"].events_interval,nonce:$j("#bookacti-edit-template-nonce").val()},g);$j("#bookacti-template-calendar").trigger("bookacti_update_event_dates_before",
[a,v,b,c]);bookacti_start_template_loading();e&&bookacti_add_loading_html($j("#"+e));$j.ajax({url:ajaxurl,data:v,type:"POST",dataType:"json",success:function(k){if("success"===k.status){var t=moment.duration(moment.utc(n).diff(moment.utc(q))),w=moment.duration(moment.utc(h).diff(moment.utc(y)));$j.isEmptyObject(k.event_data)||(bookacti.booking_system["bookacti-template-calendar"].events_data[f]=k.event_data);$j.each(bookacti.booking_system["bookacti-template-calendar"].selected_events,function(m,
l){if(l.id==f){m=moment.utc(l.start).clone().locale("en").add(t).format("YYYY-MM-DD HH:mm:ss");var x=moment.utc(l.end).clone().locale("en").add(w).format("YYYY-MM-DD HH:mm:ss");l.start=m;l.end=x}});$j.each(bookacti.booking_system["bookacti-template-calendar"].groups_events,function(m,l){$j.each(l,function(x,p){$j.each(p,function(A,r){r.id==f&&(r.start=moment.utc(r.start).clone().locale("en").add(t).format("YYYY-MM-DD HH:mm:ss"),r.end=moment.utc(r.end).clone().locale("en").add(w).format("YYYY-MM-DD HH:mm:ss"))})})});
$j.each(bookacti.booking_system["bookacti-template-calendar"].groups_data,function(m,l){$j.each(l.events,function(x,p){p.id==f&&(p.start=moment.utc(p.start).clone().locale("en").add(t).format("YYYY-MM-DD HH:mm:ss"),p.end=moment.utc(p.end).clone().locale("en").add(w).format("YYYY-MM-DD HH:mm:ss"))})});var u={};"undefined"!==typeof bookacti.booking_system["bookacti-template-calendar"].bookings[f]&&($j.each(bookacti.booking_system["bookacti-template-calendar"].bookings[f],function(m,l){m=moment.utc(m).clone().locale("en").add(t).format("YYYY-MM-DD HH:mm:ss");
u[m]=$j.extend({},l)}),$j.isEmptyObject(u)&&delete bookacti.booking_system["bookacti-template-calendar"].bookings[f]);$j.isEmptyObject(u)||(bookacti.booking_system["bookacti-template-calendar"].bookings[f]=u);k.events.length&&(bookacti_fc_remove_events_by_groupId($j("#bookacti-template-calendar"),f),bookacti_fc_add_events($j("#bookacti-template-calendar"),k.events));e&&($j("#"+e).off("dialogbeforeclose"),$j("#"+e).dialog("close"));$j("#bookacti-template-calendar").trigger("bookacti_event_dates_updated",
[a,b,k,v])}else if("failed"===k.status)if("has_bookings"!==k.error||g.forced_update){!1!==c&&c();var z="undefined"!==typeof k.message?k.message:bookacti_localized.error;e?($j("#"+e).append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+z+"</li></ul></div>"),$j("#"+e+" .bookacti-notices").show()):alert(z);console.log(k)}else e&&$j("#"+e).dialog("close"),bookacti_dialog_update_booked_event_dates(a,b,c),$j("#bookacti-update-booked-event-dates-intro").append('<span class="bookacti-bookings-nb">'+
k.bookings_nb+"</span>"),$j("#bookacti-update-booked-event-dates-send_notifications-container").append('<span class="bookacti-notifications-nb">'+k.notifications_nb+"</span>")},error:function(k){!1!==c&&c();alert("AJAX "+bookacti_localized.error);console.log(k)},complete:function(){e&&bookacti_remove_loading_html($j("#"+e));bookacti_stop_template_loading()}})}
function bookacti_duplicate_event(a,b){var c="undefined"!==typeof a.groupId?parseInt(a.groupId):parseInt(a.id),d=moment.utc(a.start).clone().locale("en").format("YYYY-MM-DD HH:mm:ss"),e=a.end?moment.utc(a.end).clone().locale("en").format("YYYY-MM-DD HH:mm:ss"):d,g=moment.utc(b.start).clone().locale("en").format("YYYY-MM-DD HH:mm:ss"),f=b.end?moment.utc(b.end).clone().locale("en").format("YYYY-MM-DD HH:mm:ss"):g,n={action:"bookactiDuplicateEvent",event_id:c,event_start:d,event_end:e,old_event_start:g,
old_event_end:f,interval:bookacti.booking_system["bookacti-template-calendar"].events_interval,nonce:$j("#bookacti-edit-template-nonce").val()};$j("#bookacti-template-calendar").trigger("bookacti_duplicate_event_before",[a,b,n]);bookacti_start_template_loading();$j.ajax({url:ajaxurl,data:n,type:"POST",dataType:"json",success:function(h){if("success"===h.status)$j.isEmptyObject(h.event_data)||(bookacti.booking_system["bookacti-template-calendar"].events_data[h.event_id]=h.event_data),h.events.length&&
bookacti_fc_add_events($j("#bookacti-template-calendar"),h.events),$j("#bookacti-template-calendar").trigger("bookacti_event_duplicated",[a,b,h,n]);else if("failed"===h.status){var q="undefined"!==typeof h.message?h.message:bookacti_localized.error;alert(q);console.log(q);console.log(h)}},error:function(h){alert("AJAX "+bookacti_localized.error);console.log(h)},complete:function(){bookacti_stop_template_loading()}})}
function bookacti_bind_template_dialogs(){bookacti.selected_template?($j("#bookacti-update-template").off().on("click","span",function(){bookacti_dialog_update_template(bookacti.selected_template)}),$j("#bookacti-template-activities-container").off().on("click","#bookacti-insert-activity, #bookacti-template-add-first-activity-button",function(){1<$j("#bookacti-template-picker option").length?bookacti_dialog_choose_activity_creation_type():bookacti_dialog_create_activity()})):($j("#bookacti-update-template").off().on("click",
"span",function(){alert(bookacti_localized.error_no_template_selected)}),$j("#bookacti-template-activities-container").off().on("click","#bookacti-insert-activity, #bookacti-template-add-first-activity-button",function(){alert(bookacti_localized.error_no_template_selected)}))}
function bookacti_start_template_loading(){$j("#bookacti-template-sidebar .dashicons").addClass("bookacti-disabled");$j("#bookacti-template-activities-container .bookacti-activity-draggable").addClass("bookacti-activity-disabled");$j(".bookacti-template-dialog").find("input, select, button").attr("disabled",!0);$j("#bookacti-template-picker").attr("disabled",!0);bookacti_start_loading_booking_system($j("#bookacti-template-calendar"))}
function bookacti_stop_template_loading(a){a=a||!1;bookacti_stop_loading_booking_system($j("#bookacti-template-calendar"),a);0===bookacti.booking_system["bookacti-template-calendar"].loading_number&&($j("#bookacti-template-sidebar .dashicons").removeClass("bookacti-disabled"),$j("#bookacti-template-activities-container .bookacti-activity-draggable").removeClass("bookacti-activity-disabled"),$j(".bookacti-template-dialog").find("input, select, button").attr("disabled",!1),$j("#bookacti-template-picker").attr("disabled",
!1))}function bookacti_display_activity_tuto_if_no_activity_available(){$j("#bookacti-template-first-activity-container").length&&$j("#bookacti-template-first-activity-container").toggle(0>=$j(".bookacti-activity").length)}
function bookacti_maybe_display_add_group_of_events_button(){$j("#bookacti-template-add-first-group-of-events-container").length&&(2<=bookacti.booking_system["bookacti-template-calendar"].selected_events.length?($j("#bookacti-insert-group-of-events").css("visibility","visible"),$j(".bookacti-group-category").length||($j("#bookacti-template-add-group-of-events-tuto-select-events").hide(),$j("#bookacti-template-add-first-group-of-events-container").show())):($j("#bookacti-template-add-first-group-of-events-container").hide(),
$j("#bookacti-insert-group-of-events").css("visibility","hidden"),$j(".bookacti-group-category").length||$j("#bookacti-template-add-group-of-events-tuto-select-events").show()),$j(".bookacti-group-of-events .bookacti-update-group-of-events").removeClass("dashicons-insert").addClass("dashicons-admin-generic"),$j(".bookacti-group-of-events.bookacti-selected-group").length&&$j(".bookacti-group-of-events.bookacti-selected-group .bookacti-update-group-of-events").removeClass("dashicons-admin-generic").addClass("dashicons-insert"))}
function bookacti_expand_collapse_groups_of_events(a,b,c){c=c?!0:!1;b=0<=$j.inArray(b,["expand","collapse"])?b:!1;var d=$j('.bookacti-group-category[data-group-category-id="'+a+'"]').data("show-groups");!d&&"collapse"!==b||"expand"===b?d&&"expand"!==b||"collapse"===b||(c&&bookacti_expand_collapse_all_groups_of_events("collapse",a),$j('.bookacti-group-category[data-group-category-id="'+a+'"]').attr("data-show-groups",1),$j('.bookacti-group-category[data-group-category-id="'+a+'"]').data("show-groups",
1),$j('.bookacti-group-category[data-group-category-id="'+a+'"] .bookacti-groups-of-events-editor-list').slideDown(200)):($j('.bookacti-group-category[data-group-category-id="'+a+'"]').attr("data-show-groups",0),$j('.bookacti-group-category[data-group-category-id="'+a+'"]').data("show-groups",0),$j('.bookacti-group-category[data-group-category-id="'+a+'"] .bookacti-groups-of-events-editor-list').slideUp(200))}
function bookacti_expand_collapse_all_groups_of_events(a,b){b=$j.isArray(b)?b:$j.isNumeric(b)?[b]:[];var c=".bookacti-group-category";$j.each(b,function(d,e){c+=':not([data-group-category-id="'+e+'"])'});"collapse"===a?($j(c).attr("data-show-groups",0),$j(c).data("show-groups",0),$j(c+" .bookacti-groups-of-events-editor-list").slideUp(200)):"expand"===a&&($j(c).attr("data-show-groups",1),$j(c).data("show-groups",1),$j(c+" .bookacti-groups-of-events-editor-list").slideDown(200))}
function bookacti_load_activities_bound_to_template(a){parseInt(a)!==parseInt(bookacti.selected_template)&&($j("#bookacti-activity-import-dialog .bookacti-form-error").remove(),bookacti_start_template_loading(),bookacti_add_loading_html($j("#bookacti-activity-import-dialog")),$j.ajax({url:ajaxurl,data:{action:"bookactiGetActivitiesByTemplate",selected_template_id:a,current_template_id:bookacti.selected_template,nonce:$j("#bookacti-edit-template-nonce").val()},type:"POST",dataType:"json",success:function(b){$j("select#bookacti-activities-to-import option").remove();
if("success"===b.status)b.activities&&$j.each(b.activities,function(d,e){$j('#bookacti-template-activity-list .bookacti-activity[data-activity-id="'+d+'"]').length||$j("select#bookacti-activities-to-import").append('<option value="'+d+'" >'+e.title+"</option>")});else{var c="undefined"!==typeof b.message?b.message:bookacti_localized.error;$j("#bookacti-activity-import-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+c+"</li></ul></div>");$j("#bookacti-activity-import-dialog .bookacti-notices").show();
console.log(b)}},error:function(b){alert("AJAX "+bookacti_localized.error);console.log(b)},complete:function(){bookacti_stop_template_loading();bookacti_remove_loading_html($j("#bookacti-activity-import-dialog"))}}))}
function bookacti_init_event_duplication_feedbacks(){$j(document).on("keydown",function(a){a.altKey&&($j("#bookacti-template-container .bookacti-event-dragged, #bookacti-template-container .fc-event:hover, #bookacti-template-container .fc-helper").addClass("bookacti-duplicate-event"),a.stopPropagation(),a.preventDefault())});$j(document).on("keyup",function(a){18==a.keyCode&&($j("#bookacti-template-container .bookacti-duplicate-event").removeClass("bookacti-duplicate-event"),a.stopPropagation(),a.preventDefault())})}
function bookacti_fc_remove_events_by_groupId(a,b){var c=a.attr("id");bookacti.fc_calendar[c].batchRendering(function(){$j.each(bookacti.fc_calendar[c].getEvents(),function(d,e){e.groupId==b&&e.remove()})})};
