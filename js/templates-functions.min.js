function bookacti_switch_template(a){if(!a){$j("#bookacti-template-picker").val("");bookacti.selected_template=0;$j("#bookacti-first-template-container").show();$j("#bookacti-template-sidebar, #bookacti-calendar-integration-tuto-container").addClass("bookacti-no-template");$j("#bookacti-template-calendar").remove();$j("#bookacti-template-activity-list .bookacti-activity").remove();bookacti_display_activity_tuto_if_no_activity_available();bookacti.booking_system["bookacti-template-calendar"]["selected_events"]=[];$j("#bookacti-insert-group-of-events").css("visibility","hidden");$j("#bookacti-template-add-first-group-of-events-container").hide();$j("#bookacti-template-add-group-of-events-tuto-select-events").show();bookacti_bind_template_dialogs();return}$j("#bookacti-template-picker").val(a);bookacti.load_events=false;var b=$j.extend({},bookacti.booking_system["bookacti-template-calendar"]);var b=bookacti_get_booking_system_attributes_without_data($j("#bookacti-template-calendar"));delete b.display_data;delete b.picked_events;bookacti_start_template_loading();$j.ajax({url:ajaxurl,data:{action:"bookactiSwitchTemplate",template_id:a,attributes:JSON.stringify(b),nonce:$j("#nonce_edit_template").val()},type:"POST",dataType:"json",success:function(f){if(f.status==="success"){var h=bookacti.selected_template?false:true;var g=bookacti.booking_system["bookacti-template-calendar"]["loading_number"];bookacti.selected_template=parseInt(a);bookacti.hidden_activities=[];bookacti.booking_system["bookacti-template-calendar"]=f.booking_system_data;bookacti.booking_system["bookacti-template-calendar"]["selected_events"]=[];bookacti.booking_system["bookacti-template-calendar"]["picked_events"]=[];bookacti.booking_system["bookacti-template-calendar"]["loading_number"]=g;bookacti.booking_system["bookacti-template-calendar"]["method"]="calendar";bookacti.booking_system["bookacti-template-calendar"]["past_events"]=true;bookacti.booking_system["bookacti-template-calendar"]["past_events_bookable"]=true;if(h){bookacti_bind_template_dialogs();bookacti_init_groups_of_events()}bookacti_load_template_calendar();$j("#bookacti-template-activity-list .bookacti-activity").remove();$j("#bookacti-template-activity-list").append(f.activities_list);bookacti_refresh_activity_list();$j("#bookacti-group-categories").empty();$j("#bookacti-group-categories").append(f.groups_list);$j("#bookacti-template-add-group-of-events-tuto-select-events").toggle(f.groups_list==="");$j("#bookacti-template-groups-of-events-container .dashicons").toggleClass("bookacti-disabled",bookacti.booking_system["bookacti-template-calendar"]["loading_number"]>0);bookacti.booking_system["bookacti-template-calendar"]["selected_events"]=[];$j("#bookacti-insert-group-of-events").css("visibility","hidden");$j("#bookacti-template-add-first-group-of-events-container").hide();$j('#bookacti-group-of-events-category-selectbox option[value!="new"]').remove();var e=[];$j("#bookacti-group-categories .bookacti-group-category").each(function(){$j("#bookacti-group-of-events-category-selectbox").append('<option value="'+$j(this).data("group-category-id")+'">'+$j(this).find(".bookacti-group-category-title").attr("title")+"</option>");if($j(this).data("visible")==1){e.push($j(this).data("group-category-id"))}});bookacti_make_group_categories_sortable();bookacti_make_groups_of_events_sortable();bookacti_update_create_form_link_template_id(bookacti.selected_template);bookacti_start_template_loading();bookacti.fc_calendar["bookacti-template-calendar"].gotoDate(moment.utc().locale("en").format("YYYY-MM-DD"));bookacti_clear_events_on_calendar_editor();var c=bookacti.fc_calendar["bookacti-template-calendar"].view;var d={start:moment.utc(moment.utc(c.currentStart).clone().locale("en").format("YYYY-MM-DD")+" 00:00:00"),end:moment.utc(moment.utc(c.currentEnd).clone().locale("en").subtract(1,"days").format("YYYY-MM-DD")+" 23:59:59")};var j=bookacti_get_interval_of_events($j("#bookacti-template-calendar"),d);if(!$j.isEmptyObject(j)){bookacti_get_calendar_editor_data_by_interval(j)}bookacti.load_events=true;$j("#bookacti-template-calendar").trigger("bookacti_calendar_editor_template_switched");bookacti_stop_template_loading()}else{if(f.status==="failed"){var i=typeof f.message!=="undefined"?f.message:bookacti_localized.error;alert(i);console.log(i);console.log(f)}}},error:function(c){console.log("AJAX "+bookacti_localized.error);console.log(c)},complete:function(){bookacti_stop_template_loading()}})}function bookacti_refresh_activity_list(){$j("#bookacti-template-activity-list").css("height",$j("#bookacti-template-activity-list").outerHeight()>200?200:"auto");bookacti_display_activity_tuto_if_no_activity_available();bookacti_refresh_show_hide_activities_icons()}function bookacti_init_show_hide_activities_switch(){$j("body").on("click","#bookacti-template-activity-list .bookacti-activity-visibility",function(){var b=parseInt($j(this).closest(".bookacti-activity").data("activity-id"));var a=$j.inArray(b,bookacti.hidden_activities);if($j(this).data("activity-visible")===1){$j(this).removeClass("dashicons-visibility");$j(this).addClass("dashicons-hidden");$j(this).data("activity-visible",0);$j(this).attr("data-activity-visible",0);if(a===-1){bookacti.hidden_activities.push(b)}}else{$j(this).addClass("dashicons-visibility");$j(this).removeClass("dashicons-hidden");$j(this).data("activity-visible",1);$j(this).attr("data-activity-visible",1);if(a!==-1){bookacti.hidden_activities.splice(a,1)}}if(typeof bookacti.fc_calendar["bookacti-template-calendar"]!=="undefined"){bookacti.fc_calendar["bookacti-template-calendar"].render()}})}function bookacti_refresh_show_hide_activities_icons(){var a=$j("#bookacti-template-activity-list .bookacti-activity-visibility");a.addClass("dashicons-visibility");a.removeClass("dashicons-hidden");a.data("activity-visible",1);a.attr("data-activity-visible",1);$j.each(bookacti.hidden_activities,function(b,d){if($j('#bookacti-template-activity-list .bookacti-activity[data-activity-id="'+d+'"] .bookacti-activity-visibility').length){var c=$j('#bookacti-template-activity-list .bookacti-activity[data-activity-id="'+d+'"] .bookacti-activity-visibility');c.removeClass("dashicons-visibility");c.addClass("dashicons-hidden");c.data("activity-visible",0);c.attr("data-activity-visible",0)}})}function bookacti_make_activities_draggable(){new FullCalendar.Draggable(document.getElementById("bookacti-template-activity-list"),{itemSelector:".bookacti-activity-draggable:not(.bookacti-activity-disabled)"})}function bookacti_make_activities_sortable(){$j("#bookacti-template-activity-list").sortable({items:".bookacti-activity",handle:".bookacti-activity-visibility",placeholder:"bookacti-calendar-editor-sortable-placeholder",update:function(b,a){bookacti_save_template_items_order("activities")}});$j("#bookacti-template-activity-list").disableSelection()}function bookacti_save_template_items_order(a,b){a=typeof a!=="undefined"?a:"";b=typeof b!=="undefined"?parseInt(b):0;var d,f="";switch(a){case"activities":d="#bookacti-template-activity-list .bookacti-activity";f="activity-id";break;case"group_categories":d="#bookacti-group-categories .bookacti-group-category";f="group-category-id";break;case"groups_of_events":d='.bookacti-group-category[data-group-category-id="'+b+'"] .bookacti-groups-of-events-editor-list .bookacti-group-of-events';f="group-id";break}var c=[];if(d&&f){if($j(d).length){$j(d).each(function(){if(typeof $j(this).data(f)!=="undefined"){c.push($j(this).data(f))}})}}if(!c.length){return}var e={action:"bookactiSaveTemplateItemsOrder",template_id:bookacti.selected_template,item_type:a,item_id:b,items_order:c,nonce:$j("#nonce_edit_template").val()};$j("#bookacti-template-container").trigger("bookacti_update_template_items_order_data",[e,a,b]);bookacti_start_template_loading();$j.ajax({url:ajaxurl,data:e,type:"POST",dataType:"json",success:function(g){if(g.status==="success"){$j("#bookacti-template-container").trigger("bookacti_template_items_order_updated",[g,e,a,b])}else{if(g.status==="failed"){var h=typeof g.message!=="undefined"?g.message:bookacti_localized.error;console.log(h);console.log(g)}}},error:function(h){var g="AJAX "+bookacti_localized.error;console.log(g);console.log(h)},complete:function(){bookacti_stop_template_loading()}})}function bookacti_init_groups_of_events(){$j("body").on("click","#bookacti-template-calendar .fc-more",function(){bookacti_refresh_selected_events_display()});$j("body").on("bookacti_select_event bookacti_unselect_event bookacti_unselect_all_events","#bookacti-template-calendar",function(){bookacti_maybe_display_add_group_of_events_button()});$j("body").on("bookacti_select_event bookacti_unselect_event","#bookacti-template-calendar",function(){if(bookacti.booking_system["bookacti-template-calendar"]["selected_events"].length<=0){bookacti_unselect_all_events();bookacti_refresh_selected_events_display()}});$j("body").on("click","#bookacti-group-categories .bookacti-group-category-title",function(){var a=$j(this).parent().data("group-category-id");bookacti_expand_collapse_groups_of_events(a)});$j("body").on("click","#bookacti-group-categories .bookacti-group-of-events-title",function(){var b=$j(this).closest(".bookacti-group-of-events").hasClass("bookacti-selected-group");if(!b){var a=$j(this).closest(".bookacti-group-of-events").data("group-id");bookacti_select_events_of_group(a)}else{bookacti_unselect_all_events();bookacti_refresh_selected_events_display()}})}function bookacti_make_group_categories_sortable(){$j("#bookacti-group-categories").sortable({items:".bookacti-group-category",handle:".bookacti-group-category-title",placeholder:"bookacti-calendar-editor-sortable-placeholder",update:function(b,a){bookacti_save_template_items_order("group_categories")}});$j("#bookacti-group-categories").disableSelection()}function bookacti_make_groups_of_events_sortable(){$j(".bookacti-groups-of-events-editor-list").sortable({items:".bookacti-group-of-events",handle:".bookacti-group-of-events-title",placeholder:"bookacti-calendar-editor-sortable-placeholder",update:function(c,b){var a=$j(b.item).closest(".bookacti-group-category").data("group-category-id");bookacti_save_template_items_order("groups_of_events",a)}});$j(".bookacti-groups-of-events-editor-list").disableSelection()}function bookacti_add_group_category(b,a){$j("#bookacti-group-categories").append("<div class='bookacti-group-category'  data-group-category-id='"+b+"' data-show-groups='0' data-visible='1' ><div class='bookacti-group-category-title' title='"+a+"' ><span>"+a+"</span></div><div class='bookacti-update-group-category dashicons dashicons-admin-generic' ></div><div class='bookacti-groups-of-events-editor-list bookacti-custom-scrollbar'></div></div>");$j("#bookacti-group-of-events-category-selectbox").append("<option value='"+b+"' >"+a+"</option>");bookacti.selected_category=b}function bookacti_add_group_of_events(c,b,a){if(!$j('.bookacti-group-category[data-group-category-id="'+a+'"]').length){bookacti_add_group_category(a,"Untitled")}$j('.bookacti-group-category[data-group-category-id="'+a+'"] .bookacti-groups-of-events-editor-list').append("<div class='bookacti-group-of-events' data-group-id='"+c+"' ><div class='bookacti-group-of-events-title' title='"+b+"'>"+b+"</div><div class='bookacti-update-group-of-events dashicons dashicons-admin-generic' ></div></div>");bookacti_expand_collapse_groups_of_events(a,"expand",true)}function bookacti_select_events_of_group(a,d){a=a?parseInt(a):0;d=d?d:"";if(!a){return false}bookacti_unselect_all_events();bookacti.booking_system["bookacti-template-calendar"]["selected_events"]=[];bookacti.fc_calendar["bookacti-template-calendar"].render();var c=[];if(d){if(typeof bookacti.booking_system["bookacti-template-calendar"]["groups_events"][a]!=="undefined"){if(typeof bookacti.booking_system["bookacti-template-calendar"]["groups_events"][a][d]!=="undefined"){c=bookacti.booking_system["bookacti-template-calendar"]["groups_events"][a][d].slice()}}}if(!c.length){if(typeof bookacti.booking_system["bookacti-template-calendar"]["groups_data"][a]!=="undefined"){if(typeof bookacti.booking_system["bookacti-template-calendar"]["groups_data"][a]["events"]!=="undefined"){c=bookacti.booking_system["bookacti-template-calendar"]["groups_data"][a]["events"].slice()}}}if(c.length){bookacti.fc_calendar["bookacti-template-calendar"].gotoDate(c[0]["start"])}var b=true;$j.each(c,function(e,f){var g=bookacti_select_event(f);if(g===false){b=false}});if(b){$j('.bookacti-group-of-events[data-group-id="'+a+'"]').addClass("bookacti-selected-group")}return b}function bookacti_select_event(b){if((typeof b!=="object")||(typeof b==="object"&&(typeof b.id==="undefined"||typeof b.start==="undefined"))){return false}var g=typeof b.groupId!=="undefined"?parseInt(b.groupId):parseInt(b.id);var a=typeof bookacti.booking_system["bookacti-template-calendar"]["events_data"][g]!=="undefined"?bookacti.booking_system["bookacti-template-calendar"]["events_data"][g]:[];var e=b.activity_id?b.activity_id:(a.activity_id?a.activity_id:0);var d="";if(!b.title){if(a.title){d=a.title}else{if($j('.bookacti-activity[data-activity-id="'+e+'"] .bookacti-activity-draggable').length){d=$j('.bookacti-activity[data-activity-id="'+e+'"] .bookacti-activity-draggable').text()}}}var c={id:g,activity_id:e,title:b.title?b.title:d,start:moment.utc(b.start).clone().locale("en"),end:moment.utc(b.end).clone().locale("en")};var f=$j('.fc-event[data-event-id="'+c.id+'"][data-event-start="'+c.start.format("YYYY-MM-DD HH:mm:ss")+'"]');if(f.length){f.addClass("bookacti-selected-event");f.find(".bookacti-event-action-select-checkbox").prop("checked",true)}bookacti.booking_system["bookacti-template-calendar"]["selected_events"].push({id:c.id,activity_id:c.activity_id,title:c.title,start:c.start.format("YYYY-MM-DD HH:mm:ss"),end:c.end.format("YYYY-MM-DD HH:mm:ss")});bookacti.booking_system["bookacti-template-calendar"]["selected_events"].sort(function(j,i){var h=moment.utc(j.start);var k=moment.utc(i.start);return((h.isBefore(k))?-1:((h.isAfter(k))?1:0))});$j("#bookacti-template-calendar").trigger("bookacti_select_event",[c]);return true}function bookacti_unselect_event(b,c){c=c?true:false;if((typeof b!=="object"&&!$j.isNumeric(b))||(typeof b==="object"&&(typeof b.id==="undefined"||typeof b.start==="undefined"))||($j.isNumeric(b)&&!c)){return false}var g={id:$j.isNumeric(b)?b:(typeof b.groupId!=="undefined"?b.groupId:b.id),start:typeof b.start!=="undefined"?moment.utc(b.start).clone().locale("en"):"",end:typeof b.end!=="undefined"?moment.utc(b.end).clone().locale("en"):""};var e=g.start?moment.utc(g.start).clone().locale("en").format("YYYY-MM-DD HH:mm:ss"):"";var a=g.start?moment.utc(g.start).clone().locale("en").format("YYYY-MM-DD"):"";var f=c?$j('.fc-event[data-event-id="'+g.id+'"]'):$j('.fc-event[data-event-id="'+g.id+'"][data-event-start="'+e+'"]');if(f.length){f.removeClass("bookacti-selected-event");f.find(".bookacti-event-action-select-checkbox").prop("checked",false)}var d=$j.grep(bookacti.booking_system["bookacti-template-calendar"]["selected_events"],function(h){if(h.id==g.id&&(c||h.start.substr(0,10)===a)){return false}return true});bookacti.booking_system["bookacti-template-calendar"]["selected_events"]=d;$j("#bookacti-template-calendar").trigger("bookacti_unselect_event",[g,c]);return true}function bookacti_unselect_all_events(){$j(".fc-event").removeClass("bookacti-selected-event");$j(".fc-event").find(".bookacti-event-action-select-checkbox").prop("checked",false);bookacti.booking_system["bookacti-template-calendar"]["selected_events"]=[];$j(".bookacti-group-of-events.bookacti-selected-group").removeClass("bookacti-selected-group");$j("#bookacti-template-calendar").trigger("bookacti_unselect_all_events")}function bookacti_refresh_selected_events_display(){$j(".fc-event").removeClass("bookacti-selected-event");$j(".fc-event .bookacti-event-action-select-checkbox").prop("checked",false);$j.each(bookacti.booking_system["bookacti-template-calendar"]["selected_events"],function(c,b){var a=$j('.fc-event[data-event-id="'+b.id+'"][data-event-start="'+b.start+'"]');a.addClass("bookacti-selected-event");a.find(".bookacti-event-action-select-checkbox").prop("checked",true)});$j("#bookacti-template-calendar").trigger("bookacti_refresh_selected_events")}function bookacti_update_create_form_link_template_id(a){$j('#bookacti-calendar-integration-tuto-container input[name="calendar_field[calendars]"]').val(a);bookacti_update_create_form_link_url()}function bookacti_update_create_form_link_url(){var b=$j("#bookacti-create-form-link").data("base-url");var a=$j("#bookacti-calendar-integration-tuto-container input").serialize();$j("#bookacti-create-form-link").attr("href",b+"?"+a)}function bookacti_get_calendar_editor_data_by_interval(b){b=b?b:bookacti.booking_system["bookacti-template-calendar"]["events_interval"];if($j.isEmptyObject(b)){var a=bookacti.fc_calendar["bookacti-template-calendar"].view;var d={start:moment.utc(moment.utc(a.currentStart).clone().locale("en").format("YYYY-MM-DD")+" 00:00:00"),end:moment.utc(moment.utc(a.currentEnd).clone().locale("en").subtract(1,"days").format("YYYY-MM-DD")+" 23:59:59")};b=bookacti_get_interval_of_events($j("#bookacti-template-calendar"),d)}bookacti.booking_system["bookacti-template-calendar"]["events_interval"]=bookacti_get_extended_events_interval($j("#bookacti-template-calendar"),b);var c=!$j.isEmptyObject(bookacti.booking_system["bookacti-template-calendar"]["groups_events"])?Object.keys(bookacti.booking_system["bookacti-template-calendar"]["groups_events"]):[];bookacti_start_template_loading();$j.ajax({url:ajaxurl,type:"POST",data:{action:"bookactiGetCalendarEditorDataByInterval",template_id:bookacti.selected_template,interval:JSON.stringify(b),group_ids:JSON.stringify(c),nonce:$j("#nonce_get_calendar_editor_data").val()},dataType:"json",success:function(e){if(e.status==="success"){if($j.isEmptyObject(bookacti.booking_system["bookacti-template-calendar"]["events"])){bookacti.booking_system["bookacti-template-calendar"]["events"]=e.events}else{$j.extend(bookacti.booking_system["bookacti-template-calendar"]["events"],e.events)}if($j.isEmptyObject(bookacti.booking_system["bookacti-template-calendar"]["events_data"])){bookacti.booking_system["bookacti-template-calendar"]["events_data"]=e.events_data}else{$j.extend(bookacti.booking_system["bookacti-template-calendar"]["events_data"],e.events_data)}if($j.isEmptyObject(bookacti.booking_system["bookacti-template-calendar"]["groups_events"])){bookacti.booking_system["bookacti-template-calendar"]["groups_events"]=e.groups_events}else{$j.extend(true,bookacti.booking_system["bookacti-template-calendar"]["groups_events"],e.groups_events)}if($j.isEmptyObject(bookacti.booking_system["bookacti-template-calendar"]["bookings"])){bookacti.booking_system["bookacti-template-calendar"]["bookings"]=e.bookings}else{$j.extend(true,bookacti.booking_system["bookacti-template-calendar"]["bookings"],e.bookings)}bookacti_fc_add_events($j("#bookacti-template-calendar"),e.events);$j("#bookacti-template-calendar").trigger("bookacti_calendar_editor_interval_data_loaded",[e,b])}else{var f=typeof e.message!=="undefined"?e.message:bookacti_localized.error;alert(f);console.log(f);console.log(e)}},error:function(f){alert("AJAX "+bookacti_localized.error);console.log(f)},complete:function(){bookacti_stop_template_loading()}})}function bookacti_refetch_events_on_calendar_editor(){bookacti_clear_events_on_calendar_editor();var a=bookacti.fc_calendar["bookacti-template-calendar"].view;var c={start:moment.utc(moment.utc(a.currentStart).clone().locale("en").format("YYYY-MM-DD")+" 00:00:00"),end:moment.utc(moment.utc(a.currentEnd).clone().locale("en").subtract(1,"days").format("YYYY-MM-DD")+" 23:59:59")};var b=bookacti_get_interval_of_events($j("#bookacti-template-calendar"),c);bookacti_get_calendar_editor_data_by_interval(b)}function bookacti_clear_events_on_calendar_editor(){bookacti.booking_system["bookacti-template-calendar"]["events"]=[];bookacti.booking_system["bookacti-template-calendar"]["events_data"]=[];bookacti.booking_system["bookacti-template-calendar"]["events_interval"]=[];if(typeof bookacti.fc_calendar["bookacti-template-calendar"]!=="undefined"){bookacti.fc_calendar["bookacti-template-calendar"].removeAllEvents()}}function bookacti_update_event_dates(c,m,j,l){j=typeof j!=="undefined"?j:false;l=typeof l!=="undefined"?l:"";var g="";var i={};i.forced_update=0;if(l==="normal"){g="bookacti-update-event-dates-dialog"}if(l==="booked"){g="bookacti-update-booked-event-dates-dialog";i=$j("#bookacti-update-booked-event-dates-form").serializeObject();i.forced_update=1}if(g){$j("#"+g+" .bookacti-notices").remove()}var k=typeof c.groupId!=="undefined"?parseInt(c.groupId):parseInt(c.id);var b=moment.utc(c.start).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");var f=!c.end?b:moment.utc(c.end).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");var a=moment.utc(m.start).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");var e=!m.end?a:moment.utc(m.end).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");var d=bookacti.booking_system["bookacti-template-calendar"]["events_interval"];var h=$j.extend({action:"bookactiUpdateEventDates",event_id:k,event_start:b,event_end:f,old_event_start:a,old_event_end:e,interval:d,nonce:$j("#nonce_edit_template").val()},i);$j("#bookacti-template-calendar").trigger("bookacti_update_event_dates_before",[c,h,m,j]);bookacti_start_template_loading();if(g){bookacti_add_loading_html($j("#"+g))}$j.ajax({url:ajaxurl,data:h,type:"POST",dataType:"json",success:function(n){if(n.status==="success"){var o=moment.duration(moment.utc(b).diff(moment.utc(a)));var r=moment.duration(moment.utc(f).diff(moment.utc(e)));if(!$j.isEmptyObject(n.event_data)){bookacti.booking_system["bookacti-template-calendar"]["events_data"][k]=n.event_data}$j.each(bookacti.booking_system["bookacti-template-calendar"]["selected_events"],function(u,t){if(t.id==k){var v=moment.utc(t.start).clone().locale("en").add(o).format("YYYY-MM-DD HH:mm:ss");var s=moment.utc(t.end).clone().locale("en").add(r).format("YYYY-MM-DD HH:mm:ss");t.start=v;t.end=s}});$j.each(bookacti.booking_system["bookacti-template-calendar"]["groups_events"],function(s,t){$j.each(t,function(v,u){$j.each(u,function(w,x){if(x.id==k){x.start=moment.utc(x.start).clone().locale("en").add(o).format("YYYY-MM-DD HH:mm:ss");x.end=moment.utc(x.end).clone().locale("en").add(r).format("YYYY-MM-DD HH:mm:ss")}})})});$j.each(bookacti.booking_system["bookacti-template-calendar"]["groups_data"],function(t,s){$j.each(s.events,function(u,v){if(v.id==k){v.start=moment.utc(v.start).clone().locale("en").add(o).format("YYYY-MM-DD HH:mm:ss");v.end=moment.utc(v.end).clone().locale("en").add(r).format("YYYY-MM-DD HH:mm:ss")}})});var q={};if(typeof bookacti.booking_system["bookacti-template-calendar"]["bookings"][k]!=="undefined"){$j.each(bookacti.booking_system["bookacti-template-calendar"]["bookings"][k],function(t,s){var u=moment.utc(t).clone().locale("en").add(o).format("YYYY-MM-DD HH:mm:ss");q[u]=$j.extend({},s)});if($j.isEmptyObject(q)){delete bookacti.booking_system["bookacti-template-calendar"]["bookings"][k]}}if(!$j.isEmptyObject(q)){bookacti.booking_system["bookacti-template-calendar"]["bookings"][k]=q}if(n.events.length){bookacti_fc_remove_events_by_groupId($j("#bookacti-template-calendar"),k);bookacti_fc_add_events($j("#bookacti-template-calendar"),n.events)}if(g){$j("#"+g).off("dialogbeforeclose");$j("#"+g).dialog("close")}$j("#bookacti-template-calendar").trigger("bookacti_event_dates_updated",[c,m,n,h])}else{if(n.status==="failed"){if(n.error==="has_bookings"&&!i.forced_update){if(g){$j("#"+g).dialog("close")}bookacti_dialog_update_booked_event_dates(c,m,j);$j("#bookacti-update-booked-event-dates-intro").append('<span class="bookacti-bookings-nb">'+n.bookings_nb+"</span>");$j("#bookacti-update-booked-event-dates-send_notifications-container").append('<span class="bookacti-notifications-nb">'+n.notifications_nb+"</span>")}else{if(j!==false){j()}var p=typeof n.message!=="undefined"?n.message:bookacti_localized.error;if(g){$j("#"+g).append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+p+"</li></ul></div>");$j("#"+g+" .bookacti-notices").show()}else{alert(p)}console.log(n)}}}},error:function(n){if(j!==false){j()}alert("AJAX "+bookacti_localized.error);console.log(n)},complete:function(){if(g){bookacti_remove_loading_html($j("#"+g))}bookacti_stop_template_loading()}})}function bookacti_duplicate_event(c,i){var h=typeof c.groupId!=="undefined"?parseInt(c.groupId):parseInt(c.id);var b=moment.utc(c.start).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");var f=!c.end?b:moment.utc(c.end).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");var a=moment.utc(i.start).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");var e=!i.end?a:moment.utc(i.end).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");var d=bookacti.booking_system["bookacti-template-calendar"]["events_interval"];var g={action:"bookactiDuplicateEvent",event_id:h,event_start:b,event_end:f,old_event_start:a,old_event_end:e,interval:d,nonce:$j("#nonce_edit_template").val()};$j("#bookacti-template-calendar").trigger("bookacti_duplicate_event_before",[c,i,g]);bookacti_start_template_loading();$j.ajax({url:ajaxurl,data:g,type:"POST",dataType:"json",success:function(j){if(j.status==="success"){if(!$j.isEmptyObject(j.event_data)){bookacti.booking_system["bookacti-template-calendar"]["events_data"][j.event_id]=j.event_data}if(j.events.length){bookacti_fc_add_events($j("#bookacti-template-calendar"),j.events)}$j("#bookacti-template-calendar").trigger("bookacti_event_duplicated",[c,i,j,g])}else{if(j.status==="failed"){var k=typeof j.message!=="undefined"?j.message:bookacti_localized.error;alert(k);console.log(k);console.log(j)}}},error:function(j){alert("AJAX "+bookacti_localized.error);console.log(j)},complete:function(){bookacti_stop_template_loading()}})}function bookacti_bind_template_dialogs(){if(bookacti.selected_template){$j("#bookacti-update-template").off().on("click","span",function(){bookacti_dialog_update_template(bookacti.selected_template)});$j("#bookacti-template-activities-container").off().on("click","#bookacti-insert-activity, #bookacti-template-add-first-activity-button",function(){if($j("#bookacti-template-picker option").length>1){bookacti_dialog_choose_activity_creation_type()}else{bookacti_dialog_create_activity()}})}else{$j("#bookacti-update-template").off().on("click","span",function(){alert(bookacti_localized.error_no_template_selected)});$j("#bookacti-template-activities-container").off().on("click","#bookacti-insert-activity, #bookacti-template-add-first-activity-button",function(){alert(bookacti_localized.error_no_template_selected)})}}function bookacti_start_template_loading(){$j("#bookacti-template-sidebar .dashicons").addClass("bookacti-disabled");$j("#bookacti-template-activities-container .bookacti-activity-draggable").addClass("bookacti-activity-disabled");$j(".bookacti-template-dialog").find("input, select, button").attr("disabled",true);$j("#bookacti-template-picker").attr("disabled",true);bookacti_start_loading_booking_system($j("#bookacti-template-calendar"))}function bookacti_stop_template_loading(a){a=a||false;bookacti_stop_loading_booking_system($j("#bookacti-template-calendar"),a);if(bookacti.booking_system["bookacti-template-calendar"]["loading_number"]===0){$j("#bookacti-template-sidebar .dashicons").removeClass("bookacti-disabled");$j("#bookacti-template-activities-container .bookacti-activity-draggable").removeClass("bookacti-activity-disabled");$j(".bookacti-template-dialog").find("input, select, button").attr("disabled",false);$j("#bookacti-template-picker").attr("disabled",false)}}function bookacti_display_activity_tuto_if_no_activity_available(){if($j("#bookacti-template-first-activity-container").length){$j("#bookacti-template-first-activity-container").toggle($j(".bookacti-activity").length<=0)}}function bookacti_maybe_display_add_group_of_events_button(){if(!$j("#bookacti-template-add-first-group-of-events-container").length){return}if(bookacti.booking_system["bookacti-template-calendar"]["selected_events"].length>=2){$j("#bookacti-insert-group-of-events").css("visibility","visible");if(!$j(".bookacti-group-category").length){$j("#bookacti-template-add-group-of-events-tuto-select-events").hide();$j("#bookacti-template-add-first-group-of-events-container").show()}}else{$j("#bookacti-template-add-first-group-of-events-container").hide();$j("#bookacti-insert-group-of-events").css("visibility","hidden");if(!$j(".bookacti-group-category").length){$j("#bookacti-template-add-group-of-events-tuto-select-events").show()}}$j(".bookacti-group-of-events .bookacti-update-group-of-events").removeClass("dashicons-insert").addClass("dashicons-admin-generic");if($j(".bookacti-group-of-events.bookacti-selected-group").length){$j(".bookacti-group-of-events.bookacti-selected-group .bookacti-update-group-of-events").removeClass("dashicons-admin-generic").addClass("dashicons-insert")}}function bookacti_expand_collapse_groups_of_events(c,d,a){a=a?true:false;d=$j.inArray(d,["expand","collapse"])>=0?d:false;var b=$j('.bookacti-group-category[data-group-category-id="'+c+'"]').data("show-groups");if((b||d==="collapse")&&d!=="expand"){$j('.bookacti-group-category[data-group-category-id="'+c+'"]').attr("data-show-groups",0);$j('.bookacti-group-category[data-group-category-id="'+c+'"]').data("show-groups",0);$j('.bookacti-group-category[data-group-category-id="'+c+'"] .bookacti-groups-of-events-editor-list').slideUp(200,function(){bookacti_set_editor_group_of_events_max_height(c)})}else{if((!b||d==="expand")&&d!=="collapse"){if(a){bookacti_expand_collapse_all_groups_of_events("collapse",c)}$j('.bookacti-group-category[data-group-category-id="'+c+'"]').attr("data-show-groups",1);$j('.bookacti-group-category[data-group-category-id="'+c+'"]').data("show-groups",1);$j('.bookacti-group-category[data-group-category-id="'+c+'"] .bookacti-groups-of-events-editor-list').slideDown(200,function(){bookacti_set_editor_group_of_events_max_height(c)})}}}function bookacti_set_editor_group_of_events_max_height(a){if($j('.bookacti-group-category[data-group-category-id="'+a+'"] .bookacti-groups-of-events-editor-list').outerHeight()>=150){$j('.bookacti-group-category[data-group-category-id="'+a+'"] .bookacti-groups-of-events-editor-list').css("height",150)}else{$j('.bookacti-group-category[data-group-category-id="'+a+'"] .bookacti-groups-of-events-editor-list').css("height","auto")}if($j("#bookacti-group-categories").outerHeight()>200){$j("#bookacti-group-categories").css("height",200)}else{$j("#bookacti-group-categories").css("height","auto")}}function bookacti_expand_collapse_all_groups_of_events(c,a){a=$j.isArray(a)?a:($j.isNumeric(a)?[a]:[]);var b=".bookacti-group-category";$j.each(a,function(d,e){b+=':not([data-group-category-id="'+e+'"])'});if(c==="collapse"){$j(b).attr("data-show-groups",0);$j(b).data("show-groups",0);$j(b+" .bookacti-groups-of-events-editor-list").slideUp(200)}else{if(c==="expand"){$j(b).attr("data-show-groups",1);$j(b).data("show-groups",1);$j(b+" .bookacti-groups-of-events-editor-list").slideDown(200)}}}function bookacti_load_activities_bound_to_template(a){if(parseInt(a)===parseInt(bookacti.selected_template)){return}$j("#bookacti-activity-import-dialog .bookacti-form-error").remove();bookacti_start_template_loading();bookacti_add_loading_html($j("#bookacti-activity-import-dialog"));$j.ajax({url:ajaxurl,data:{action:"bookactiGetActivitiesByTemplate",selected_template_id:a,current_template_id:bookacti.selected_template,nonce:$j("#nonce_edit_template").val()},type:"POST",dataType:"json",success:function(b){$j("select#bookacti-activities-to-import option").remove();if(b.status==="success"){if(b.activities){$j.each(b.activities,function(d,e){if(!$j('#bookacti-template-activity-list .bookacti-activity[data-activity-id="'+d+'"]').length){$j("select#bookacti-activities-to-import").append('<option value="'+d+'" >'+e.title+"</option>")}})}}else{var c=typeof b.message!=="undefined"?b.message:bookacti_localized.error;$j("#bookacti-activity-import-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+c+"</li></ul></div>");$j("#bookacti-activity-import-dialog .bookacti-notices").show();console.log(b)}},error:function(b){alert("AJAX "+bookacti_localized.error);console.log(b)},complete:function(){bookacti_stop_template_loading();bookacti_remove_loading_html($j("#bookacti-activity-import-dialog"))}})}function bookacti_init_event_duplication_feedbacks(){$j(document).on("keydown",function(a){if(a.altKey){$j("#bookacti-template-container .bookacti-event-dragged, #bookacti-template-container .fc-event:hover, #bookacti-template-container .fc-helper").addClass("bookacti-duplicate-event");a.stopPropagation();a.preventDefault()}});$j(document).on("keyup",function(a){if(a.keyCode==18){$j("#bookacti-template-container .bookacti-duplicate-event").removeClass("bookacti-duplicate-event");a.stopPropagation();a.preventDefault()}})}function bookacti_fc_remove_events_by_groupId(b,c){var a=b.attr("id");bookacti.fc_calendar[a].batchRendering(function(){$j.each(bookacti.fc_calendar[a].getEvents(),function(e,d){if(d.groupId==c){d.remove()}})})};