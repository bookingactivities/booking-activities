$j(document).ready(function(){bookacti_init_booking_actions();bookacti_init_booking_bulk_actions();$j(".bookacti-export-bookings-button").on("click",function(){bookacti_dialog_export_bookings()});$j("#bookacti-export-bookings-dialog").dialog({beforeClose:function(){}});$j("#bookacti-bookings-calendar-settings-dialog").dialog({beforeClose:function(){}});$j('.bookacti_export_button input[type="button"]').on("click",function(){var a=$j(this).closest(".bookacti_export_url").find(".bookacti_export_url_field input").val();
a&&window.open(a,"_blank")});$j("#bookacti-export-bookings-dialog").on("tabsactivate",".bookacti-tabs",function(a,b){bookacti_change_export_type_according_to_active_tab()})});
function bookacti_dialog_update_bookings_calendar_settings(){$j("#bookacti-bookings-calendar-settings-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_ok,click:function(){$j("#bookacti-bookings-calendar-settings-dialog .bookacti-notices").remove();var a=bookacti_serialize_object($j("#bookacti-bookings-calendar-settings-form"));$j("body").trigger("bookacti_bookings_calendar_settings_data",[a]);bookacti_add_loading_html($j("#bookacti-bookings-calendar-settings-dialog"));$j.ajax({url:bookacti_localized.ajaxurl,
type:"POST",data:a,dataType:"json",success:function(b){if("success"===b.status){bookacti.booking_system["bookacti-booking-system-bookings-page"].display_data=b.display_data;bookacti.booking_system["bookacti-booking-system-bookings-page"].tooltip_booking_list=b.calendar_settings.tooltip_booking_list;bookacti.booking_system["bookacti-booking-system-bookings-page"].tooltip_booking_list_columns=b.calendar_settings.tooltip_booking_list_columns;$j("body").trigger("bookacti_bookings_calendar_settings_updated",
[a,b]);var e=$j("#bookacti-booking-system-bookings-page");bookacti_reload_booking_system(e,!0);$j("#bookacti-submit-filter-button").attr("data-ajax",b.calendar_settings.ajax).data("ajax",b.calendar_settings.ajax);$j("#bookacti-bookings-calendar-settings-dialog").dialog("close")}else if("failed"===b.status){e="undefined"!==typeof b.message?b.message:"";if(!e){e+="Error while trying to update calendar settings";var c="undefined"!==typeof b.error?b.error:"";c&&(e+=" ("+c+")")}$j("#bookacti-bookings-calendar-settings-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+
e+"</li></ul></div>");console.log(e);console.log(b)}},error:function(b){$j("#bookacti-bookings-calendar-settings-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>AJAX error while trying to update calendar settings</li></ul></div>');console.log("AJAX error while trying to update calendar settings");console.log(b)},complete:function(){$j("#bookacti-bookings-calendar-settings-dialog .bookacti-notices").show();bookacti_remove_loading_html($j("#bookacti-bookings-calendar-settings-dialog"))}})}},
{text:bookacti_localized.dialog_button_cancel,click:function(){$j(this).dialog("close")}}]);$j("#bookacti-bookings-calendar-settings-dialog").dialog("open")}
function bookacti_dialog_cancel_booking(a,b){b="group"===b?"group":"single";var e="group"===b?"bookactiCancelBookingGroup":"bookactiCancelBooking";if("single"===b){var c=$j('.bookacti-cancel-booking[data-booking-id="'+a+'"]').closest("tr");var g=$j('.bookacti-cancel-booking[data-booking-id="'+a+'"]').closest("tr, .bookacti-booking-row")}else c=$j('.bookacti-cancel-booking-group[data-booking-group-id="'+a+'"]').closest("tr"),g=$j('.bookacti-cancel-booking-group[data-booking-group-id="'+a+'"]').closest("tr, .bookacti-booking-row");
bookacti_localized.is_admin&&"undefined"!==typeof bookacti_empty_all_dialog_forms||$j("#bookacti-cancel-booking-dialog").dialog({beforeClose:function(){$j("#bookacti-cancel-booking-dialog .bookacti-notices").remove()}});c.first().trigger("bookacti_booking_action_dialog_opened",[a,b,"cancel"]);$j("#bookacti-cancel-booking-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_cancel_booking,"class":"bookacti-dialog-delete-button",click:function(){$j("#bookacti-cancel-booking-dialog .bookacti-notices").remove();
var h=[];c.first().find("td").each(function(){var d=$j(this).data("column-id");d&&h.push(d)});var f={action:e,booking_id:a,context:bookacti_localized.is_admin?"admin_booking_list":"user_booking_list",columns:h,user_auth_key:"undefined"!==typeof user_auth_key?user_auth_key:"",nonce:bookacti_localized.nonce_cancel_booking};c.first().trigger("bookacti_booking_action_data",[f,a,b,"cancel"]);bookacti_add_loading_html($j("#bookacti-cancel-booking-dialog"));bookacti_booking_row_enter_loading_state(g);$j.ajax({url:bookacti_localized.ajaxurl,
type:"POST",data:f,dataType:"json",success:function(d){if("success"===d.status)d.row&&(c.last().after(d.row),c.remove(),bookacti_refresh_list_table_hidden_columns()),$j("#bookacti-cancel-booking-dialog").dialog("close"),d.allow_refund&&bookacti_dialog_refund_bookings({booking_ids:"group"===b?[]:[a],booking_group_ids:"group"===b?[a]:[],all:0}),$j("body").trigger("bookacti_booking_cancelled_by_user",[a,b]);else if("failed"===d.status){var m="undefined"!==typeof d.message?d.message:bookacti_localized.error;
$j("#bookacti-cancel-booking-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+m+"</li></ul></div>");console.log(m);console.log(d)}},error:function(d){$j("#bookacti-cancel-booking-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>AJAX '+bookacti_localized.error+"</li></ul></div>");console.log("AJAX "+bookacti_localized.error);console.log(d)},complete:function(){$j("#bookacti-cancel-booking-dialog .bookacti-notices").show();bookacti_remove_loading_html($j("#bookacti-cancel-booking-dialog"));
bookacti_booking_row_exit_loading_state(g)}})}},{text:bookacti_localized.dialog_button_cancel,click:function(){$j(this).dialog("close")}}]);$j("#bookacti-cancel-booking-dialog").dialog("open")}
function bookacti_dialog_refund_bookings(a){var b=a.all?$j(".bookacti-single-booking, .bookacti-booking-group").closest("tr, .bookacti-booking-row"):$j();a.all||($j.each(a.booking_ids,function(c,g){b=b.add($j('.bookacti-single-booking[data-booking-id="'+g+'"]').closest("tr, .bookacti-booking-row"))}),$j.each(a.booking_group_ids,function(c,g){b=b.add($j('.bookacti-booking-group[data-booking-group-id="'+g+'"]').closest("tr, .bookacti-booking-row"))}));$j("#bookacti-refund-booking-dialog #bookacti-refund-options").empty();
$j("#bookacti-refund-booking-dialog #bookacti-refund-options-container").hide();$j("#bookacti-refund-booking-dialog #bookacti-no-refund-option").hide();$j("#bookacti-refund-booking-dialog #bookacti-refund-amount").empty();$j("#bookacti-refund-booking-dialog #bookacti-refund-amount-container").hide();$j("#bookacti-refund-booking-dialog").dialog("option","buttons",[]);$j("#bookacti-refund-booking-dialog .bookacti-notices").remove();$j("body").trigger("bookacti_booking_action_dialog_opened",[a,"refund"]);
a.filters=a.all?bookacti_get_booking_list_filters():{};var e={form_data:new FormData($j("#bookacti-refund-booking-form").get(0))};e.form_data.append("action","bookactiGetBookingsRefundActionsHTML");e.form_data.append("booking_selection",JSON.stringify(a));e.form_data.append("is_admin",bookacti_localized.is_admin?1:0);$j("body").trigger("bookacti_booking_action_data",[e,a,"get_refund_actions"]);bookacti_booking_row_enter_loading_state(b);bookacti_add_loading_html($j("#bookacti-refund-booking-dialog"));
$j.ajax({url:bookacti_localized.ajaxurl,type:"POST",data:e.form_data,dataType:"json",cache:!1,contentType:!1,processData:!1,success:function(c){if("success"===c.status)c.actions_html?($j("#bookacti-refund-booking-dialog #bookacti-refund-options").html(c.actions_html),$j("#bookacti-refund-booking-dialog #bookacti-refund-options-container").show(),c.amount&&($j("#bookacti-refund-booking-dialog #bookacti-refund-amount").html(c.amount),$j("#bookacti-refund-booking-dialog #bookacti-refund-amount-container").show()),
$j('#bookacti-refund-booking-form #bookacti-refund-options input[type="radio"]:first').prop("checked",!0),$j("#bookacti-refund-booking-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_refund,"class":"bookacti-dialog-delete-button",click:function(){if($j('#bookacti-refund-booking-form input[name="refund_action"]').val()){$j("#bookacti-refund-booking-dialog .bookacti-notices").remove();var h=[];b.first().find("td").each(function(){var d=$j(this).data("column-id");d&&h.push(d)});
a.filters=a.all?bookacti_get_booking_list_filters():{};var f={form_data:new FormData($j("#bookacti-refund-booking-form").get(0))};f.form_data.append("action","bookactiRefundBookings");f.form_data.append("booking_selection",JSON.stringify(a));f.form_data.append("columns",JSON.stringify(h));f.form_data.append("is_admin",bookacti_localized.is_admin?1:0);f.form_data.append("user_auth_key","undefined"!==typeof user_auth_key?user_auth_key:"");$j("body").trigger("bookacti_booking_action_data",[f,a,"refund"]);
bookacti_booking_row_enter_loading_state(b);bookacti_add_loading_html($j("#bookacti-refund-booking-dialog"));$j.ajax({url:bookacti_localized.ajaxurl,type:"POST",data:f.form_data,dataType:"json",cache:!1,contentType:!1,processData:!1,success:function(d){if("success"===d.status){$j("#bookacti-refund-booking-dialog").dialog("close");if(d.rows){var m=$j(d.rows);b.each(function(){var l=$j(this).find(".bookacti-single-booking").addBack(".bookacti-single-booking").data("booking-id"),k=$j(this).find(".bookacti-booking-group").addBack(".bookacti-booking-group").data("booking-group-id");
l=(l=l?'.bookacti-single-booking[data-booking-id="'+l+'"]':k?'.bookacti-booking-group[data-booking-group-id="'+k+'"]':"")?m.find(l).addBack(l).closest("tr"):$j();l.length&&$j(this).replaceWith(l);k&&$j('.bookacti-gouped-booking[data-booking-group-id="'+k+'"]').remove()});bookacti_refresh_list_table_hidden_columns()}b.remove();d.message&&bookacti_dialog_refund_confirmation(d.message);$j("body").trigger("bookacti_booking_refunded",[d,a]);d.rows||window.location.reload()}else if("failed"===d.status){var n=
"undefined"!==typeof d.message?d.message:bookacti_localized.error;$j("#bookacti-refund-booking-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+n+"</li></ul></div>");console.log(n);console.log(d)}},error:function(d){console.log("AJAX "+bookacti_localized.error);console.log(d)},complete:function(){$j("#bookacti-refund-booking-dialog .bookacti-notices").show();bookacti_remove_loading_html($j("#bookacti-refund-booking-dialog"));bookacti_booking_row_exit_loading_state(b)}})}}},
{text:bookacti_localized.dialog_button_cancel,click:function(){$j(this).dialog("close")}}])):$j("#bookacti-refund-booking-dialog #bookacti-no-refund-option").show();else if("failed"===c.status){var g="undefined"!==typeof c.message?c.message:bookacti_localized.error;$j("#bookacti-refund-booking-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+g+"</li></ul></div>");console.log(g);console.log(c)}},error:function(c){$j("#bookacti-refund-booking-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>AJAX '+
bookacti_localized.error+"</li></ul></div>");console.log("AJAX "+bookacti_localized.error);console.log(c)},complete:function(){$j("#bookacti-refund-booking-dialog .bookacti-notices").show();bookacti_remove_loading_html($j("#bookacti-refund-booking-dialog"));bookacti_booking_row_exit_loading_state(b)}});$j("#bookacti-refund-booking-dialog").dialog("open")}
function bookacti_dialog_refund_confirmation(a){$j("#bookacti-refund-booking-confirm-dialog").html(a);$j("#bookacti-refund-booking-confirm-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_ok,click:function(){$j(this).dialog("close")}}]);$j("#bookacti-refund-booking-confirm-dialog").dialog("open")}
function bookacti_dialog_change_bookings_status(a){var b=a.all?$j(".bookacti-single-booking, .bookacti-booking-group").closest("tr, .bookacti-booking-row"):$j();a.all||($j.each(a.booking_ids,function(g,h){b=b.add($j('.bookacti-single-booking[data-booking-id="'+h+'"]').closest("tr, .bookacti-booking-row"))}),$j.each(a.booking_group_ids,function(g,h){b=b.add($j('.bookacti-booking-group[data-booking-group-id="'+h+'"]').closest("tr, .bookacti-booking-row"))}));var e=1===b.length?b.find(".bookacti-booking-status").data("booking-status"):
"",c=1===b.length?b.find(".bookacti-payment-status").data("payment-status"):"";$j("select#bookacti-select-booking-status").val(e);$j("select#bookacti-select-payment-status").val(c);$j("#bookacti-send-notifications-on-status-change").prop("checked",!1);$j("body").trigger("bookacti_booking_action_dialog_opened",[a,"change_booking_status"]);$j("#bookacti-change-booking-status-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_ok,click:function(){var g=$j("select#bookacti-select-booking-status").val(),
h=$j("select#bookacti-select-payment-status").val();if((g||h)&&(g!==e||h!==c)){$j("#bookacti-change-booking-status-dialog .bookacti-notices").remove();var f=[];b.first().find("td").each(function(){var m=$j(this).data("column-id");m&&f.push(m)});a.filters=a.all?bookacti_get_booking_list_filters():{};var d={form_data:new FormData($j("#bookacti-change-booking-status-form").get(0))};d.form_data.append("action","bookactiChangeBookingsStatus");d.form_data.append("booking_selection",JSON.stringify(a));d.form_data.append("columns",
JSON.stringify(f));d.form_data.append("is_admin",bookacti_localized.is_admin?1:0);$j("body").trigger("bookacti_booking_action_data",[d,a,"change_booking_status"]);bookacti_booking_row_enter_loading_state(b);bookacti_add_loading_html($j("#bookacti-change-booking-status-dialog"));$j.ajax({url:bookacti_localized.ajaxurl,type:"POST",data:d.form_data,dataType:"json",cache:!1,contentType:!1,processData:!1,success:function(m){if("success"===m.status){$j("#bookacti-change-booking-status-dialog").dialog("close");
if(m.rows){var n=$j(m.rows);b.each(function(){var k=$j(this).find(".bookacti-single-booking").addBack(".bookacti-single-booking").data("booking-id"),p=$j(this).find(".bookacti-booking-group").addBack(".bookacti-booking-group").data("booking-group-id");k=(k=k?'.bookacti-single-booking[data-booking-id="'+k+'"]':p?'.bookacti-booking-group[data-booking-group-id="'+p+'"]':"")?n.find(k).addBack(k).closest("tr"):$j();k.length&&$j(this).replaceWith(k);p&&$j('.bookacti-gouped-booking[data-booking-group-id="'+
p+'"]').remove()});bookacti_refresh_list_table_hidden_columns()}b.remove();g&&$j("body").trigger("bookacti_booking_status_changed",[m,a,g]);h&&$j("body").trigger("bookacti_payment_status_changed",[m,a,h]);m.rows||window.location.reload()}else if("failed"===m.status){var l="undefined"!==typeof m.message?m.message:bookacti_localized.error;$j("#bookacti-change-booking-status-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+l+"</li></ul></div>").show();console.log(l);
console.log(m)}},error:function(m){$j("#bookacti-change-booking-status-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>AJAX '+bookacti_localized.error+"</li></ul></div>").show();console.log("AJAX "+bookacti_localized.error);console.log(m)},complete:function(){$j("#bookacti-change-booking-status-dialog .bookacti-notices").show();bookacti_remove_loading_html($j("#bookacti-change-booking-status-dialog"));bookacti_booking_row_exit_loading_state(b)}})}}},{text:bookacti_localized.dialog_button_cancel,
click:function(){$j(this).dialog("close")}}]);$j("#bookacti-change-booking-status-dialog").dialog("open")}
function bookacti_dialog_change_bookings_quantity(a){var b=a.all?$j(".bookacti-single-booking, .bookacti-booking-group").closest("tr, .bookacti-booking-row"):$j();a.all||($j.each(a.booking_ids,function(c,g){b=b.add($j('.bookacti-single-booking[data-booking-id="'+g+'"]').closest("tr, .bookacti-booking-row"))}),$j.each(a.booking_group_ids,function(c,g){b=b.add($j('.bookacti-booking-group[data-booking-group-id="'+g+'"]').closest("tr, .bookacti-booking-row"))}));var e=1===b.length?parseInt(b.find(".column-quantity").text()):
1;$j("#bookacti-new-quantity").val(e);$j("body").trigger("bookacti_booking_action_dialog_opened",[a,"change_quantity"]);$j("#bookacti-change-booking-quantity-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_ok,click:function(){var c=parseInt($j("#bookacti-new-quantity").val());if(c){$j("#bookacti-change-booking-quantity-dialog .bookacti-notices").remove();var g=[];b.first().find("td").each(function(){var f=$j(this).data("column-id");f&&g.push(f)});a.filters=a.all?bookacti_get_booking_list_filters():
{};var h={form_data:new FormData($j("#bookacti-change-booking-quantity-form").get(0))};h.form_data.append("action","bookactiChangeBookingsQuantity");h.form_data.append("booking_selection",JSON.stringify(a));h.form_data.append("columns",JSON.stringify(g));h.form_data.append("is_admin",bookacti_localized.is_admin?1:0);$j("body").trigger("bookacti_booking_action_data",[h,a,"change_quantity"]);bookacti_booking_row_enter_loading_state(b);bookacti_add_loading_html($j("#bookacti-change-booking-quantity-dialog"));
$j.ajax({url:bookacti_localized.ajaxurl,type:"POST",data:h.form_data,dataType:"json",cache:!1,contentType:!1,processData:!1,success:function(f){if("success"===f.status){$j("#bookacti-change-booking-quantity-dialog").dialog("close");if(f.rows){var d=$j(f.rows);b.each(function(){var n=$j(this).find(".bookacti-single-booking").addBack(".bookacti-single-booking").data("booking-id"),l=$j(this).find(".bookacti-booking-group").addBack(".bookacti-booking-group").data("booking-group-id");n=(n=n?'.bookacti-single-booking[data-booking-id="'+
n+'"]':l?'.bookacti-booking-group[data-booking-group-id="'+l+'"]':"")?d.find(n).addBack(n).closest("tr"):$j();n.length&&$j(this).replaceWith(n);l&&$j('.bookacti-gouped-booking[data-booking-group-id="'+l+'"]').remove()});bookacti_refresh_list_table_hidden_columns()}b.remove();$j("body").trigger("bookacti_booking_quantity_changed",[f,a,c]);f.rows||window.location.reload()}else if("failed"===f.status){var m="undefined"!==typeof f.message?f.message:bookacti_localized.error;$j("#bookacti-change-booking-quantity-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+
m+"</li></ul></div>").show();console.log(m);console.log(f)}},error:function(f){$j("#bookacti-change-booking-quantity-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>AJAX '+bookacti_localized.error+"</li></ul></div>").show();console.log("AJAX "+bookacti_localized.error);console.log(f)},complete:function(){$j("#bookacti-change-booking-quantity-dialog .bookacti-notices").show();bookacti_remove_loading_html($j("#bookacti-change-booking-quantity-dialog"));bookacti_booking_row_exit_loading_state(b)}})}}},
{text:bookacti_localized.dialog_button_cancel,click:function(){$j(this).dialog("close")}}]);$j("#bookacti-change-booking-quantity-dialog").dialog("open")}
function bookacti_dialog_reschedule_bookings(a){var b=a.all?$j(".bookacti-single-booking, .bookacti-booking-group").closest("tr, .bookacti-booking-row"):$j();a.all||($j.each(a.booking_ids,function(f,d){b=b.add($j('.bookacti-single-booking[data-booking-id="'+d+'"]').closest("tr, .bookacti-booking-row"))}),$j.each(a.booking_group_ids,function(f,d){b=b.add($j('.bookacti-booking-group[data-booking-group-id="'+d+'"]').closest("tr, .bookacti-booking-row"))}));var e=$j("#bookacti-booking-system-reschedule.bookacti-booking-system"),
c=e.attr("id"),g=1;e.empty();bookacti_clear_booking_system_displayed_info(e);$j("#bookacti-reschedule-booking-dialog > .bookacti-notices").remove();$j("#bookacti-reschedule-booking-dialog .bookacti-booking-system-container .bookacti-notices").empty().hide();bookacti_localized.is_admin&&$j("#bookacti-send-notifications-on-reschedule").prop("checked",!1);$j("body").trigger("bookacti_booking_action_dialog_opened",[a,"reschedule"]);a.filters=a.all?bookacti_get_booking_list_filters():{};var h={form_data:new FormData($j("#bookacti-reschedule-booking-form").get(0))};
h.form_data.append("action","bookactiGetRescheduleBookingSystemData");h.form_data.append("booking_selection",JSON.stringify(a));h.form_data.append("user_auth_key","undefined"!==typeof user_auth_key?user_auth_key:"");h.form_data.append("is_admin",bookacti_localized.is_admin?1:0);$j("body").trigger("bookacti_booking_action_data",[h,a,"get_reschedule_booking_system_data"]);bookacti_booking_row_enter_loading_state(b);bookacti_add_loading_html($j("#bookacti-reschedule-booking-dialog"),"prepend");$j.ajax({url:bookacti_localized.ajaxurl,
type:"POST",data:h.form_data,dataType:"json",cache:!1,contentType:!1,processData:!1,success:function(f){bookacti_remove_loading_html($j("#bookacti-reschedule-booking-dialog"));if("success"===f.status){g=f.quantity;e.closest("form").find("input.bookacti-quantity").val(g);var d=e.attr("id");bookacti.booking_system[d]=f.booking_system_data;e.trigger("bookacti_before_reschedule_booking_system_loads",[f]);bookacti_reload_booking_system(e)}else"failed"===f.status&&(d="undefined"!==typeof f.message?f.message:
bookacti_localized.error,$j("#bookacti-reschedule-booking-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+d+"</li></ul></div>"),console.log(d),console.log(f))},error:function(f){bookacti_remove_loading_html($j("#bookacti-reschedule-booking-dialog"));$j("#bookacti-reschedule-booking-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>AJAX '+bookacti_localized.error+"</li></ul></div>");console.log("AJAX "+bookacti_localized.error);
console.log(f)},complete:function(){$j("#bookacti-reschedule-booking-dialog > .bookacti-notices").show();bookacti_booking_row_exit_loading_state(b)}});$j("#bookacti-reschedule-booking-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_reschedule,"class":"bookacti-dialog-delete-button",click:function(){if(bookacti_validate_picked_events(e,g)){$j("#bookacti-reschedule-booking-dialog > .bookacti-notices").remove();var f=!1,d=bookacti.booking_system[c].picked_events;$j.each(d,
function(k,p){if(0<parseInt(p.group_id))return f=!0,!1});if(!f){var m=1;bookacti_localized.is_admin&&$j("#bookacti-send-notifications-on-reschedule").length&&(m=$j("#bookacti-send-notifications-on-reschedule").prop("checked")?1:0);var n=[];b.first().find("td").each(function(){var k=$j(this).data("column-id");k&&n.push(k)});var l={form_data:new FormData($j("#bookacti-reschedule-booking-form").get(0))};l.form_data.append("action","bookactiRescheduleBookings");l.form_data.append("booking_selection",
JSON.stringify(a));l.form_data.append("picked_events",JSON.stringify(d));l.form_data.append("columns",JSON.stringify(n));l.form_data.append("is_admin",bookacti_localized.is_admin?1:0);l.form_data.append("send_notifications",m);l.form_data.append("user_auth_key","undefined"!==typeof user_auth_key?user_auth_key:"");l.form_data.append("nonce",bookacti_localized.nonce_reschedule_booking);$j("body").trigger("bookacti_booking_action_data",[l,a,"reschedule"]);bookacti_booking_row_enter_loading_state(b);
bookacti_start_loading_booking_system(e);bookacti_add_loading_html($j("#bookacti-reschedule-booking-dialog"));$j.ajax({url:bookacti_localized.ajaxurl,type:"POST",data:l.form_data,dataType:"json",cache:!1,contentType:!1,processData:!1,success:function(k){if("success"===k.status){$j("#bookacti-reschedule-booking-dialog").dialog("close");if(k.rows){var p=$j(k.rows);b.each(function(){var q=$j(this).find(".bookacti-single-booking").addBack(".bookacti-single-booking").data("booking-id"),r=$j(this).find(".bookacti-booking-group").addBack(".bookacti-booking-group").data("booking-group-id");
q=(q=q?'.bookacti-single-booking[data-booking-id="'+q+'"]':r?'.bookacti-booking-group[data-booking-group-id="'+r+'"]':"")?p.find(q).addBack(q).closest("tr"):$j();q.length&&$j(this).replaceWith(q);r&&$j('.bookacti-gouped-booking[data-booking-group-id="'+r+'"]').remove()});bookacti_refresh_list_table_hidden_columns()}b.remove();$j("body").trigger("bookacti_bookings_rescheduled",[k,a])}else if("failed"===k.status){var t="undefined"!==typeof k.message?k.message:bookacti_localized.error;$j("#bookacti-reschedule-booking-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+
t+"</li></ul></div>");console.log(t);console.log(k)}},error:function(k){$j("#bookacti-reschedule-booking-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>AJAX '+bookacti_localized.error+"</li></ul></div>");console.log("AJAX "+bookacti_localized.error);console.log(k)},complete:function(){$j("#bookacti-reschedule-booking-dialog > .bookacti-notices").show();bookacti_remove_loading_html($j("#bookacti-reschedule-booking-dialog"));bookacti_booking_row_exit_loading_state(b);
bookacti_stop_loading_booking_system(e)}})}}}},{text:bookacti_localized.dialog_button_cancel,click:function(){$j(this).dialog("close")}}]);$j("#bookacti-reschedule-booking-dialog").dialog("open")}
function bookacti_dialog_send_bookings_notification(a){var b=a.all?$j(".bookacti-single-booking, .bookacti-booking-group").closest("tr, .bookacti-booking-row"):$j();a.all||($j.each(a.booking_ids,function(e,c){b=b.add($j('.bookacti-single-booking[data-booking-id="'+c+'"]').closest("tr, .bookacti-booking-row"))}),$j.each(a.booking_group_ids,function(e,c){b=b.add($j('.bookacti-booking-group[data-booking-group-id="'+c+'"]').closest("tr, .bookacti-booking-row"))}));$j("body").trigger("bookacti_booking_action_dialog_opened",
[a,"send_notification"]);$j("#bookacti-send-booking-notification-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_send,click:function(){var e=$j("#bookacti-booking-notification-id").val();if(e){$j("#bookacti-send-booking-notification-dialog .bookacti-notices").remove();var c=[];b.first().find("td").each(function(){var h=$j(this).data("column-id");h&&c.push(h)});a.filters=a.all?bookacti_get_booking_list_filters():{};var g={form_data:new FormData($j("#bookacti-send-booking-notification-form").get(0))};
g.form_data.append("action","bookactiSendBookingsNotification");g.form_data.append("booking_selection",JSON.stringify(a));g.form_data.append("columns",JSON.stringify(c));g.form_data.append("is_admin",bookacti_localized.is_admin?1:0);$j("body").trigger("bookacti_booking_action_data",[g,a,"send_notification"]);bookacti_booking_row_enter_loading_state(b);bookacti_add_loading_html($j("#bookacti-send-booking-notification-dialog"));$j.ajax({url:bookacti_localized.ajaxurl,type:"POST",data:g.form_data,dataType:"json",
cache:!1,contentType:!1,processData:!1,success:function(h){if("success"===h.status)h.message?$j("#bookacti-send-booking-notification-dialog").append('<div class="bookacti-notices"><ul class="bookacti-success-list"><li>'+h.message+"</li></ul></div>").show():$j("#bookacti-send-booking-notification-dialog").dialog("close"),$j("body").trigger("bookacti_booking_notification_sent",[h,a,e]);else if("failed"===h.status){var f="undefined"!==typeof h.message?h.message:bookacti_localized.error;$j("#bookacti-send-booking-notification-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+
f+"</li></ul></div>").show();console.log(f);console.log(h)}},error:function(h){$j("#bookacti-send-booking-notification-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>AJAX '+bookacti_localized.error+"</li></ul></div>").show();console.log("AJAX "+bookacti_localized.error);console.log(h)},complete:function(){$j("#bookacti-send-booking-notification-dialog .bookacti-notices").show();bookacti_remove_loading_html($j("#bookacti-send-booking-notification-dialog"));bookacti_booking_row_exit_loading_state(b)}})}}},
{text:bookacti_localized.dialog_button_cancel,click:function(){$j(this).dialog("close")}}]);$j("#bookacti-send-booking-notification-dialog").dialog("open")}
function bookacti_dialog_delete_bookings(a){var b=a.all?$j(".bookacti-single-booking, .bookacti-booking-group").closest("tr, .bookacti-booking-row"):$j();a.all||($j.each(a.booking_ids,function(e,c){b=b.add($j('.bookacti-single-booking[data-booking-id="'+c+'"]').closest("tr, .bookacti-booking-row"))}),$j.each(a.booking_group_ids,function(e,c){b=b.add($j('.bookacti-booking-group[data-booking-group-id="'+c+'"]').closest("tr, .bookacti-booking-row"))}));$j("#bookacti-delete-booking-group-warning").toggle(a.all||
a.booking_group_ids.length);$j("body").trigger("bookacti_booking_action_dialog_opened",[a,"delete"]);$j("#bookacti-delete-booking-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_delete,"class":"bookacti-dialog-delete-button",click:function(){$j("#bookacti-delete-booking-dialog .bookacti-notices").remove();var e=[];b.first().find("td").each(function(){var g=$j(this).data("column-id");g&&e.push(g)});a.filters=a.all?bookacti_get_booking_list_filters():{};var c={form_data:new FormData($j("#bookacti-delete-booking-form").get(0))};
c.form_data.append("action","bookactiDeleteBookings");c.form_data.append("booking_selection",JSON.stringify(a));c.form_data.append("columns",JSON.stringify(e));c.form_data.append("is_admin",bookacti_localized.is_admin?1:0);$j("body").trigger("bookacti_booking_action_data",[c,a,"delete"]);bookacti_booking_row_enter_loading_state(b);bookacti_add_loading_html($j("#bookacti-delete-booking-dialog"));$j.ajax({url:bookacti_localized.ajaxurl,type:"POST",data:c.form_data,dataType:"json",cache:!1,contentType:!1,
processData:!1,success:function(g){if("success"===g.status)$j("#bookacti-delete-booking-dialog").dialog("close"),b.animate({opacity:0},function(){b.children("td, th").animate({padding:0}).wrapInner("<div></div>").children().slideUp(function(){b.remove()})}),$j.each(a.booking_group_ids,function(f,d){$j('.bookacti-gouped-booking[data-booking-group-id="'+d+'"]').remove()}),$j("body").trigger("bookacti_booking_deleted",[g,a]),a.all&&window.location.reload();else if("failed"===g.status){var h="undefined"!==
typeof g.message?g.message:bookacti_localized.error;$j("#bookacti-delete-booking-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+h+"</li></ul></div>");console.log(h);console.log(g)}},error:function(g){$j("#bookacti-delete-booking-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>AJAX '+bookacti_localized.error+"</li></ul></div>");console.log("AJAX "+bookacti_localized.error);console.log(g)},complete:function(){$j("#bookacti-delete-booking-dialog .bookacti-notices").show();
bookacti_remove_loading_html($j("#bookacti-delete-booking-dialog"));bookacti_booking_row_exit_loading_state(b)}})}},{text:bookacti_localized.dialog_button_cancel,"class":"bookacti-dialog-left-button",click:function(){$j(this).dialog("close")}}]);$j("#bookacti-delete-booking-dialog").dialog("open")}
function bookacti_dialog_export_bookings(){$j("#bookacti-export-bookings-url-container").data("export-type","");bookacti_change_export_type_according_to_active_tab();$j("#bookacti_export_bookings_url_secret").val("");$j("#bookacti-export-bookings-url-container").hide();$j("#bookacti-export-bookings-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_generate_link,click:function(){bookacti_generate_export_bookings_url(!1)}},{text:bookacti_localized.dialog_button_reset,"class":"bookacti-dialog-delete-button bookacti-dialog-left-button",
click:function(){bookacti_generate_export_bookings_url(!0)}}]);$j("#bookacti-export-bookings-dialog").dialog("open")}
function bookacti_generate_export_bookings_url(a){a=a||!1;$j("#bookacti-export-bookings-dialog .bookacti-notices").remove();bookacti_add_loading_html($j("#bookacti-export-bookings-dialog"));var b=bookacti_serialize_object($j("#bookacti-export-bookings-form"));b.action="bookactiExportBookingsUrl";b.reset_key=a?1:0;b.booking_filters=bookacti_serialize_object($j("#bookacti-booking-list-filters-form"));$j("#bookacti-export-bookings-form").trigger("bookacti_export_bookings_url_data",[b,a]);$j.ajax({url:ajaxurl,
type:"POST",data:b,dataType:"json",success:function(e){if("success"===e.status)$j("#bookacti_export_bookings_url_secret").val(e.url),$j("#bookacti-export-bookings-dialog").append('<div class="bookacti-notices"><ul class="bookacti-success-list"><li>'+e.message+"</li></ul></div>").show(),$j("#bookacti-export-bookings-url-container").data("export-type",b.export_type),$j("#bookacti-export-bookings-url-container").show(),$j("#bookacti-form-editor").trigger("bookacti_export_bookings_url",[e]);else if("failed"===
e.status){var c="undefined"!==typeof e.message?e.message:bookacti_localized.error;$j("#bookacti-export-bookings-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+c+"</li></ul></div>").show();console.log(c);console.log(e)}},error:function(e){$j("#bookacti-export-bookings-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>AJAX '+bookacti_localized.error+"</li></ul></div>").show();console.log("AJAX "+bookacti_localized.error);console.log(e)},
complete:function(){$j("#bookacti-export-bookings-dialog .bookacti-notices").show();bookacti_remove_loading_html($j("#bookacti-export-bookings-dialog"))}})};
