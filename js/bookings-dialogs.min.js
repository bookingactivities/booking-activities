$j(document).ready(function(){bookacti_init_bookings_dialogs();bookacti_init_booking_actions();if($j(".bookacti-bookings-bulk-action").length){bookacti_init_booking_bulk_actions()}$j(".bookacti-export-bookings-button").on("click",function(){bookacti_dialog_export_bookings()});$j('.bookacti_export_button input[type="button"]').on("click",function(){var a=$j(this).closest(".bookacti_export_url").find(".bookacti_export_url_field input").val();if(a){window.open(a,"_blank")}});$j("#bookacti-export-bookings-dialog").on("tabsactivate",".bookacti-tabs",function(b,a){bookacti_change_export_type_according_to_active_tab()})});function bookacti_init_bookings_dialogs(){$j(".bookacti-bookings-dialog").dialog({modal:true,autoOpen:false,minHeight:300,minWidth:460,resize:"auto",show:true,hide:true,dialogClass:"bookacti-dialog",closeText:"&#10006;",close:function(){}});$j("body").on("click",".ui-widget-overlay",function(){$j("div:ui-dialog:visible").dialog("close")});$j(".bookacti-bookings-dialog").off("keydown").on("keydown",function(a){if(!$j("textarea").is(":focus")&&a.keyCode==$j.ui.keyCode.ENTER){$j(this).parent().find(".ui-dialog-buttonpane button:first").focus();return false}})}function bookacti_dialog_update_bookings_calendar_settings(){$j("#bookacti-bookings-calendar-settings-dialog .bookacti-notices").remove();$j("#bookacti-bookings-calendar-settings-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_ok,click:function(){$j("#bookacti-bookings-calendar-settings-dialog .bookacti-notices").remove();$j("#bookacti-bookings-calendar-settings-dialog select[multiple].bookacti-items-select-box option").prop("selected",true);var a=$j("#bookacti-bookings-calendar-settings-form").serializeObject();$j("body").trigger("bookacti_bookings_calendar_settings_data",[a]);var b='<div class="bookacti-loading-alt"><img class="bookacti-loader" src="'+bookacti_localized.plugin_path+'/img/ajax-loader.gif" title="'+bookacti_localized.loading+'" /><span class="bookacti-loading-alt-text" >'+bookacti_localized.loading+"</span></div>";$j("#bookacti-bookings-calendar-settings-dialog").append(b);$j.ajax({url:bookacti_localized.ajaxurl,type:"POST",data:a,dataType:"json",success:function(f){if(f.status==="success"){var d="bookacti-booking-system-bookings-page";bookacti.booking_system[d]["display_data"]=f.display_data;bookacti.booking_system[d]["tooltip_booking_list"]=f.calendar_settings.tooltip_booking_list;bookacti.booking_system[d]["tooltip_booking_list_columns"]=f.calendar_settings.booking_list_columns;$j("body").trigger("bookacti_bookings_calendar_settings_updated",[a,f]);var c=$j("#bookacti-booking-system-bookings-page");bookacti_reload_booking_system(c,true);$j("#bookacti-submit-filter-button").attr("data-ajax",f.calendar_settings.ajax).data("ajax",f.calendar_settings.ajax);$j("#bookacti-bookings-calendar-settings-dialog").dialog("close")}else{if(f.status==="failed"){var g=typeof f.message!=="undefined"?f.message:"";if(!g){g+="Error while trying to update calendar settings";var e=typeof f.error!=="undefined"?f.error:"";if(e){g+=" ("+e+")"}}$j("#bookacti-bookings-calendar-settings-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+g+"</li></ul></div>");console.log(g);console.log(f)}}},error:function(c){$j("#bookacti-bookings-calendar-settings-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>AJAX error while trying to update calendar settings</li></ul></div>');console.log("AJAX error while trying to update calendar settings");console.log(c)},complete:function(){$j("#bookacti-bookings-calendar-settings-dialog .bookacti-notices").show();$j("#bookacti-bookings-calendar-settings-dialog .bookacti-loading-alt").remove()}})}},{text:bookacti_localized.dialog_button_cancel,click:function(){$j(this).dialog("close")}}]);$j("#bookacti-bookings-calendar-settings-dialog").dialog("open")}function bookacti_dialog_cancel_booking(a,b){b=b==="group"?"group":"single";var c=b==="group"?"bookactiCancelBookingGroup":"bookactiCancelBooking";$j("#bookacti-cancel-booking-dialog .bookacti-notices").remove();$j("#bookacti-cancel-booking-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_cancel_booking,"class":"bookacti-dialog-delete-button",click:function(){$j("#bookacti-cancel-booking-dialog .bookacti-notices").remove();var h;var g;if(b==="single"){h=$j('.bookacti-cancel-booking[data-booking-id="'+a+'"]').closest("tr");g=$j('.bookacti-cancel-booking[data-booking-id="'+a+'"]').closest("tr, .bookacti-booking-row")}else{h=$j('.bookacti-cancel-booking-group[data-booking-group-id="'+a+'"]').closest("tr");g=$j('.bookacti-cancel-booking-group[data-booking-group-id="'+a+'"]').closest("tr, .bookacti-booking-row")}var d=[];h.find("td").each(function(){var i=$j(this).data("column-id");if(i){d.push(i)}});var e={action:c,booking_id:a,context:bookacti_localized.is_admin?"admin_booking_list":"user_booking_list",columns:d,nonce:$j("#bookacti_nonce_cancel_booking").val()};h.trigger("bookacti_booking_action_data",[e,a,b,"cancel"]);var f='<div class="bookacti-loading-alt"><img class="bookacti-loader" src="'+bookacti_localized.plugin_path+'/img/ajax-loader.gif" title="'+bookacti_localized.loading+'" /><span class="bookacti-loading-alt-text" >'+bookacti_localized.loading+"</span></div>";$j("#bookacti-cancel-booking-dialog").append(f);bookacti_booking_row_enter_loading_state(g);$j.ajax({url:bookacti_localized.ajaxurl,type:"POST",data:e,dataType:"json",success:function(i){if(i.status==="success"){if(i.row){h.after(i.row);h.remove();bookacti_refresh_list_table_hidden_columns()}$j("#bookacti-cancel-booking-dialog").dialog("close");if(i.allow_refund){bookacti_dialog_refund_booking(a,b)}$j("body").trigger("bookacti_booking_cancelled_by_user",[a,b])}else{if(i.status==="failed"){var j=typeof i.message!=="undefined"?i.message:bookacti_localized.error;$j("#bookacti-cancel-booking-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+j+"</li></ul></div>");console.log(j);console.log(i)}}},error:function(i){$j("#bookacti-cancel-booking-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>AJAX '+bookacti_localized.error+"</li></ul></div>");console.log("AJAX "+bookacti_localized.error);console.log(i)},complete:function(){$j("#bookacti-cancel-booking-dialog .bookacti-notices").show();$j("#bookacti-cancel-booking-dialog .bookacti-loading-alt").remove();bookacti_booking_row_exit_loading_state(g)}})}},{text:bookacti_localized.dialog_button_cancel,click:function(){$j(this).dialog("close")}}]);$j("#bookacti-cancel-booking-dialog").dialog("open")}function bookacti_dialog_refund_booking(a,c){c=c==="group"?"group":"single";var e=c==="group"?"bookactiGetBookingGroupRefundActionsHTML":"bookactiGetBookingRefundActionsHTML";var b=c==="group"?"bookactiRefundBookingGroup":"bookactiRefundBooking";$j("#bookacti-refund-booking-dialog .bookacti-notices").remove();$j("#bookacti-refund-booking-dialog #bookacti-refund-options").empty();$j("#bookacti-refund-booking-dialog #bookacti-refund-options-container").hide();$j("#bookacti-refund-booking-dialog #bookacti-no-refund-option").hide();$j("#bookacti-refund-booking-dialog #bookacti-refund-amount").empty();$j("#bookacti-refund-booking-dialog #bookacti-refund-amount-container").hide();var d='<div class="bookacti-loading-alt"><img class="bookacti-loader" src="'+bookacti_localized.plugin_path+'/img/ajax-loader.gif" title="'+bookacti_localized.loading+'" /><span class="bookacti-loading-alt-text" >'+bookacti_localized.loading+"</span></div>";$j("#bookacti-refund-booking-dialog").append(d);$j.ajax({url:bookacti_localized.ajaxurl,type:"POST",data:{action:e,booking_id:a,is_admin:bookacti_localized.is_admin?1:0,nonce:$j("#nonce_refund_booking").val()},dataType:"json",success:function(f){if(f.status==="success"){var h=[];if(f.actions_html){$j("#bookacti-refund-booking-dialog #bookacti-refund-options").html(f.actions_html);$j("#bookacti-refund-booking-dialog #bookacti-refund-options-container").show();if(f.amount){$j("#bookacti-refund-booking-dialog #bookacti-refund-amount").html(f.amount);$j("#bookacti-refund-booking-dialog #bookacti-refund-amount-container").show()}$j('#bookacti-refund-booking-form input[type="radio"]:first').prop("checked",true);h.push({text:bookacti_localized.dialog_button_refund,"class":"bookacti-dialog-delete-button",click:function(){$j("#bookacti-refund-booking-dialog .bookacti-notices").remove();var p;var o;if(c==="single"){p=$j('.bookacti-refund-booking[data-booking-id="'+a+'"]').closest("tr");o=$j('.bookacti-refund-booking[data-booking-id="'+a+'"]').closest("tr, .bookacti-booking-row")}else{p=$j('.bookacti-refund-booking-group[data-booking-group-id="'+a+'"]').closest("tr");o=$j('.bookacti-refund-booking-group[data-booking-group-id="'+a+'"]').closest("tr, .bookacti-booking-row")}var m=p.closest("#bookacti-booking-list").length?1:0;var i=0;if(m){i=p.next().hasClass("bookacti-gouped-booking")?1:0}o.find(".bookacti-booking-state").hide();o.find(".bookacti-booking-state").after(d);$j("#bookacti-refund-booking-dialog").append(d);var n=$j('#bookacti-refund-booking-form input[name="refund-action"]:checked').val();var l=$j('#bookacti-refund-message textarea[name="refund-message"]').val();var j=[];p.find("td").each(function(){var q=$j(this).data("column-id");if(q){j.push(q)}});var k={action:b,booking_id:a,refund_action:n,refund_message:l,reload_grouped_bookings:i,is_admin:bookacti_localized.is_admin?1:0,context:bookacti_localized.is_admin?"admin_booking_list":"user_booking_list",columns:j,nonce:$j("#nonce_refund_booking").val()};p.trigger("bookacti_booking_action_data",[k,a,c,"refund"]);$j.ajax({url:bookacti_localized.ajaxurl,type:"POST",data:k,dataType:"json",success:function(r){if(r.status==="success"){if(i&&typeof r.grouped_booking_rows!=="undefined"){var q=p.next().hasClass("hidden");p.nextUntil("tr:not(.bookacti-gouped-booking)").remove();p.after(r.grouped_booking_rows);if(q){p.nextUntil("tr:not(.bookacti-gouped-booking)").addClass("hidden");if(p.nextUntil("tr:not(.bookacti-gouped-booking)").length%2){p.after('<tr class="bookacti-gouped-booking hidden dummy"></tr>')}}}if(r.row){p.after(r.row);p.remove();bookacti_refresh_list_table_hidden_columns()}$j("body").trigger("bookacti_booking_refunded",[a,c,n,l,r]);$j("#bookacti-refund-booking-dialog").dialog("close");if(r.message){bookacti_dialog_refund_confirmation(r.message)}}else{if(r.status==="failed"){var s=typeof r.message!=="undefined"?r.message:bookacti_localized.error;$j("#bookacti-refund-booking-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+s+"</li></ul></div>");console.log(s);console.log(r)}}},error:function(q){console.log("AJAX "+bookacti_localized.error);console.log(q)},complete:function(){$j("#bookacti-refund-booking-dialog .bookacti-notices").show();$j("#bookacti-refund-booking-dialog .bookacti-loading-alt").remove();o.find(".bookacti-loading-alt").remove();o.find(".bookacti-booking-state").show()}})}})}else{$j("#bookacti-refund-booking-dialog #bookacti-no-refund-option").show()}h.push({text:bookacti_localized.dialog_button_cancel,click:function(){$j(this).dialog("close")}});$j("#bookacti-refund-booking-dialog").dialog("option","buttons",h)}else{if(f.status==="failed"){var g=typeof f.message!=="undefined"?f.message:bookacti_localized.error;$j("#bookacti-refund-booking-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+g+"</li></ul></div>");console.log(g);console.log(f)}}},error:function(f){console.log("AJAX "+bookacti_localized.error);console.log(f)},complete:function(){$j("#bookacti-refund-booking-dialog .bookacti-loading-alt").remove();$j("#bookacti-refund-booking-dialog .bookacti-notices").show()}});$j("#bookacti-refund-booking-dialog").dialog("open")}function bookacti_dialog_refund_confirmation(a){$j("#bookacti-refund-booking-confirm-dialog").html(a);$j("#bookacti-refund-booking-confirm-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_ok,click:function(){$j(this).dialog("close")}}]);$j("#bookacti-refund-booking-confirm-dialog").dialog("open")}function bookacti_dialog_change_booking_state(c,e){e=e==="group"?"group":"single";var f=e==="group"?"bookactiChangeBookingGroupState":"bookactiChangeBookingState";var h;if(e==="single"){h=$j('.bookacti-change-booking-state[data-booking-id="'+c+'"]').closest("tr")}else{h=$j('.bookacti-change-booking-group-state[data-booking-group-id="'+c+'"]').closest("tr")}var g=h.closest("#bookacti-booking-list").length?1:0;var b=g&&h.next().hasClass("bookacti-gouped-booking")?1:0;var d=h.find(".bookacti-booking-state").data("booking-state");var a=h.find(".bookacti-payment-status").data("payment-status");if(d){$j('#bookacti-select-booking-state option[value="'+d+'"]').prop("selected",true)}if(a){$j('#bookacti-select-payment-status option[value="'+a+'"]').prop("selected",true)}$j("#bookacti-send-notifications-on-state-change").prop("checked",false);$j("#bookacti-change-booking-state-dialog .bookacti-notices").remove();$j("#bookacti-change-booking-state-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_ok,click:function(){var k=$j("select#bookacti-select-booking-state").val();var n=$j("select#bookacti-select-payment-status").val();var i=$j("#bookacti-send-notifications-on-state-change").prop("checked")?1:0;var l=$j("#bookacti-change-booking-state-dialog #nonce_change_booking_state").val();if((k||n)&&(k!==d||n!==a)){$j("#bookacti-change-booking-state-dialog .bookacti-notices").remove();var j=[];h.find("td").each(function(){var o=$j(this).data("column-id");if(o){j.push(o)}});var m={action:f,booking_id:c,new_booking_state:d!==k?k:0,new_payment_status:n,send_notifications:i,is_bookings_page:g,is_admin:bookacti_localized.is_admin?1:0,context:bookacti_localized.is_admin?"admin_booking_list":"user_booking_list",columns:j,reload_grouped_bookings:b,nonce:l};h.trigger("bookacti_booking_action_data",[m,c,e,"change_state"]);bookacti_booking_row_enter_loading_state(h);$j.ajax({url:bookacti_localized.ajaxurl,type:"POST",data:m,dataType:"json",success:function(p){if(p.status==="success"){$j("#bookacti-change-booking-state-dialog").dialog("close");if(b&&typeof p.grouped_booking_rows!=="undefined"){var o=h.next().hasClass("hidden");h.nextUntil("tr:not(.bookacti-gouped-booking)").remove();h.after(p.grouped_booking_rows);if(o){h.nextUntil("tr:not(.bookacti-gouped-booking)").addClass("hidden");if(h.nextUntil("tr:not(.bookacti-gouped-booking)").length%2){h.after('<tr class="bookacti-gouped-booking hidden dummy"></tr>')}}}if(p.row){h.after(p.row);h.remove();bookacti_refresh_list_table_hidden_columns()}if(d!==k){$j("body").trigger("bookacti_booking_state_changed",[c,e,k,d,g,p.active_changed])}if(a!==n){$j("body").trigger("bookacti_payment_status_changed",[c,e,n,a,g,p.active_changed])}}else{if(p.status==="failed"){var q=typeof p.message!=="undefined"?p.message:bookacti_localized.error;$j("#bookacti-change-booking-state-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+q+"</li></ul></div>").show();console.log(q);console.log(p)}}},error:function(o){$j("#bookacti-change-booking-state-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>AJAX '+bookacti_localized.error+"</li></ul></div>").show();console.log("AJAX "+bookacti_localized.error);console.log(o)},complete:function(){$j("#bookacti-change-booking-state-dialog .bookacti-notices").show();bookacti_booking_row_exit_loading_state(h)}})}}},{text:bookacti_localized.dialog_button_cancel,click:function(){$j(this).dialog("close")}}]);$j("#bookacti-change-booking-state-dialog").dialog("open")}function bookacti_dialog_change_booking_quantity(b,c){c=c==="group"?"group":"single";var e;if(c==="single"){e=$j('.bookacti-change-booking-quantity[data-booking-id="'+b+'"]').closest("tr")}else{e=$j('.bookacti-change-booking-group-quantity[data-booking-group-id="'+b+'"]').closest("tr")}var d=e.closest("#bookacti-booking-list").length?1:0;var a=d&&e.next().hasClass("bookacti-gouped-booking")?1:0;var f=parseInt(e.find(".column-quantity").text());$j("#bookacti-new-quantity").val(f);$j("#bookacti-change-booking-quantity-dialog .bookacti-notices").remove();e.trigger("bookacti_booking_action_dialog_opened",[b,c,"change_quantity"]);$j("#bookacti-change-booking-quantity-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_ok,click:function(){var h=parseInt($j("#bookacti-new-quantity").val());if(h){$j("#bookacti-change-booking-quantity-dialog .bookacti-notices").remove();var g=[];e.find("td").each(function(){var j=$j(this).data("column-id");if(j){g.push(j)}});var i=$j("#bookacti-change-booking-quantity-form").serializeObject();i.action=c==="group"?"bookactiChangeBookingGroupQuantity":"bookactiChangeBookingQuantity";i.booking_id=b;i.is_bookings_page=d;i.is_admin=bookacti_localized.is_admin?1:0;i.context=bookacti_localized.is_admin?"admin_booking_list":"user_booking_list";i.columns=g;i.reload_grouped_bookings=a;e.trigger("bookacti_booking_action_data",[i,b,c,"change_quantity"]);bookacti_booking_row_enter_loading_state(e);$j.ajax({url:bookacti_localized.ajaxurl,type:"POST",data:i,dataType:"json",success:function(k){if(k.status==="success"){$j("#bookacti-change-booking-quantity-dialog").dialog("close");if(a&&typeof k.grouped_booking_rows!=="undefined"){var j=e.next().hasClass("hidden");e.nextUntil("tr:not(.bookacti-gouped-booking)").remove();e.after(k.grouped_booking_rows);if(j){e.nextUntil("tr:not(.bookacti-gouped-booking)").addClass("hidden");if(e.nextUntil("tr:not(.bookacti-gouped-booking)").length%2){e.after('<tr class="bookacti-gouped-booking hidden dummy"></tr>')}}}if(k.row){e.after(k.row);e.remove();bookacti_refresh_list_table_hidden_columns()}$j("body").trigger("bookacti_booking_quantity_changed",[b,c,h,f,d,k.active_changed])}else{if(k.status==="failed"){var l=typeof k.message!=="undefined"?k.message:bookacti_localized.error;$j("#bookacti-change-booking-quantity-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+l+"</li></ul></div>").show();console.log(l);console.log(k)}}},error:function(j){$j("#bookacti-change-booking-quantity-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>AJAX '+bookacti_localized.error+"</li></ul></div>").show();console.log("AJAX "+bookacti_localized.error);console.log(j)},complete:function(){$j("#bookacti-change-booking-quantity-dialog .bookacti-notices").show();bookacti_booking_row_exit_loading_state(e)}})}}},{text:bookacti_localized.dialog_button_cancel,click:function(){$j(this).dialog("close")}}]);$j("#bookacti-change-booking-quantity-dialog").dialog("open")}function bookacti_dialog_reschedule_booking(a){var f=$j('.bookacti-reschedule-booking[data-booking-id="'+a+'"]').closest("tr");var e=$j('.bookacti-reschedule-booking[data-booking-id="'+a+'"]').closest("tr, .bookacti-booking-row");var c=$j("#bookacti-booking-system-reschedule.bookacti-booking-system");var b=c.attr("id");var d=0;if(bookacti_localized.is_admin){$j("#bookacti-send-notifications-on-reschedule").prop("checked",false)}c.empty();bookacti_clear_booking_system_displayed_info(c);bookacti_booking_row_enter_loading_state(e);$j.ajax({url:bookacti_localized.ajaxurl,type:"POST",data:{action:"bookactiGetRescheduleBookingSystemData",booking_id:a,is_admin:bookacti_localized.is_admin?1:0},dataType:"json",success:function(h){if(h.status==="success"){var g=c.attr("id");d=h.booking_system_data.rescheduled_booking_data.quantity;c.closest("form").find("input.bookacti-quantity").val(d);bookacti.booking_system[g]=h.booking_system_data;c.trigger("bookacti_before_reschedule_booking_system_loads",[h]);bookacti_reload_booking_system(c)}else{if(h.status==="failed"){var i=typeof h.message!=="undefined"?h.message:bookacti_localized.error;c.siblings(".bookacti-notices").html("<ul class='bookacti-error-list'><li>"+i+"</li></ul>").show();console.log(i);console.log(h)}}$j("#bookacti-reschedule-booking-dialog").dialog("open")},error:function(g){console.log("AJAX "+bookacti_localized.error);console.log(g)},complete:function(){bookacti_booking_row_exit_loading_state(e)}});$j("#bookacti-reschedule-booking-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_reschedule,"class":"bookacti-dialog-delete-button",click:function(){var k=bookacti_validate_picked_events(c,d);if(!k){return}var j=bookacti.booking_system[b]["picked_events"];if(parseInt(j[0]["group_id"])>0){return}var g=1;if(bookacti_localized.is_admin&&$j("#bookacti-send-notifications-on-reschedule").length){g=$j("#bookacti-send-notifications-on-reschedule").prop("checked")?1:0}var h=[];f.find("td").each(function(){var l=$j(this).data("column-id");if(l){h.push(l)}});var i={action:"bookactiRescheduleBooking",booking_id:a,picked_events:j,columns:h,context:bookacti_localized.is_admin?"admin_booking_list":"user_booking_list",is_admin:bookacti_localized.is_admin?1:0,send_notifications:g,nonce:$j("#bookacti-reschedule-booking-dialog #nonce_reschedule_booking").val()};f.trigger("bookacti_booking_action_data",[i,a,"single","reschedule"]);bookacti_booking_row_enter_loading_state(e);bookacti_start_loading_booking_system(c);$j.ajax({url:bookacti_localized.ajaxurl,type:"POST",data:i,dataType:"json",success:function(l){if(l.status==="success"){$j("#bookacti-reschedule-booking-dialog").dialog("close");if(l.row){f.after(l.row);f.remove();bookacti_refresh_list_table_hidden_columns()}$j("body").trigger("bookacti_booking_rescheduled",[l])}else{var m=typeof l.message!=="undefined"?l.message:bookacti_localized.error;c.siblings(".bookacti-notices").html("<ul class='bookacti-error-list'><li>"+m+"</li></ul>").show();console.log(m);console.log(l)}},error:function(l){console.log("AJAX "+bookacti_localized.error);console.log(l)},complete:function(){bookacti_booking_row_exit_loading_state(e);bookacti_stop_loading_booking_system(c)}})}},{text:bookacti_localized.dialog_button_cancel,click:function(){$j(this).dialog("close")}}])}function bookacti_dialog_delete_booking(a,b){b=b==="group"?"group":"single";var d,c;if(b==="single"){c="bookactiDeleteBooking";d=$j('.bookacti-delete-booking[data-booking-id="'+a+'"]').closest("tr");$j(".bookacti-delete-booking-group-description").hide()}else{c="bookactiDeleteBookingGroup";d=$j('.bookacti-delete-booking-group[data-booking-group-id="'+a+'"]').closest("tr");$j(".bookacti-delete-booking-group-description").show()}$j('#bookacti-delete-booking-dialog input[name="action"]').val(c);$j('#bookacti-delete-booking-dialog input[name="booking_id"]').val(a);$j('#bookacti-delete-booking-dialog input[name="booking_type"]').val(b);$j("#bookacti-delete-booking-dialog .bookacti-notices").remove();$j("#bookacti-delete-booking-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_delete,"class":"bookacti-dialog-delete-button",click:function(){$j("#bookacti-delete-booking-dialog .bookacti-notices").remove();var e=$j("#bookacti-delete-booking-dialog form").serializeObject();e.is_admin=bookacti_localized.is_admin?1:0;e.context=bookacti_localized.is_admin?"admin_booking_list":"user_booking_list";d.trigger("bookacti_booking_action_data",[e,a,b,"delete"]);bookacti_booking_row_enter_loading_state(d);var f='<div class="bookacti-loading-alt"><img class="bookacti-loader" src="'+bookacti_localized.plugin_path+'/img/ajax-loader.gif" title="'+bookacti_localized.loading+'" /><span class="bookacti-loading-alt-text" >'+bookacti_localized.loading+"</span></div>";$j("#bookacti-delete-booking-dialog").append(f);$j.ajax({url:bookacti_localized.ajaxurl,type:"POST",data:e,dataType:"json",success:function(g){if(g.status==="success"){$j("#bookacti-delete-booking-dialog").dialog("close");if(b==="group"&&$j(".bookacti-booking-group-id-"+a).length){var h=$j(".bookacti-booking-group-id-"+a);h.removeClass("bookacti-gouped-booking").animate({opacity:0},function(){h.children("td, th").animate({padding:0}).wrapInner("<div></div>").children().slideUp(function(){h.remove()})})}d.animate({opacity:0},function(){d.children("td, th").animate({padding:0}).wrapInner("<div></div>").children().slideUp(function(){d.remove()})});$j("body").trigger("bookacti_booking_deleted",[a,b,g])}else{if(g.status==="failed"){var i=typeof g.message!=="undefined"?g.message:bookacti_localized.error;$j("#bookacti-delete-booking-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+i+"</li></ul></div>");console.log(i);console.log(g)}}},error:function(g){$j("#bookacti-delete-booking-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>AJAX '+bookacti_localized.error+"</li></ul></div>");console.log("AJAX "+bookacti_localized.error);console.log(g)},complete:function(){$j("#bookacti-delete-booking-dialog .bookacti-notices").show();$j("#bookacti-delete-booking-dialog .bookacti-loading-alt").remove();bookacti_booking_row_exit_loading_state(d)}})}},{text:bookacti_localized.dialog_button_cancel,"class":"bookacti-dialog-left-button",click:function(){$j(this).dialog("close")}}]);$j("#bookacti-delete-booking-dialog").dialog("open")}function bookacti_dialog_export_bookings(){$j("#bookacti-export-bookings-url-container").data("export-type","");bookacti_change_export_type_according_to_active_tab();$j("#bookacti_export_bookings_url_secret").val("");$j("#bookacti-export-bookings-url-container").hide();$j("#bookacti-export-bookings-dialog .bookacti-notices").remove();$j("#bookacti-export-bookings-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_generate_link,click:function(){bookacti_generate_export_bookings_url(false)}},{text:bookacti_localized.dialog_button_reset,"class":"bookacti-dialog-delete-button bookacti-dialog-left-button",click:function(){bookacti_generate_export_bookings_url(true)}}]);$j("#bookacti-export-bookings-dialog").dialog("open")}function bookacti_generate_export_bookings_url(b){b=b||false;$j("#bookacti-export-bookings-dialog .bookacti-notices").remove();var c='<div class="bookacti-loading-alt"><img class="bookacti-loader" src="'+bookacti_localized.plugin_path+'/img/ajax-loader.gif" title="'+bookacti_localized.loading+'" /><span class="bookacti-loading-alt-text" >'+bookacti_localized.loading+"</span></div>";$j("#bookacti-export-bookings-dialog").append(c);$j("#bookacti-export-bookings-dialog select[multiple].bookacti-items-select-box option").prop("selected",true);var a=$j("#bookacti-export-bookings-form").serializeObject();a.action="bookactiExportBookingsUrl";a.reset_key=b?1:0;a.booking_filters=$j("#bookacti-booking-list-filters-form").serializeObject();$j("#bookacti-export-bookings-form").trigger("bookacti_export_bookings_url_data",[a,b]);$j.ajax({url:ajaxurl,type:"POST",data:a,dataType:"json",success:function(d){if(d.status==="success"){$j("#bookacti_export_bookings_url_secret").val(d.url);$j("#bookacti-export-bookings-dialog").append('<div class="bookacti-notices"><ul class="bookacti-success-list"><li>'+d.message+"</li></ul></div>").show();$j("#bookacti-export-bookings-url-container").data("export-type",a.export_type);$j("#bookacti-export-bookings-url-container").show();$j("#bookacti-form-editor").trigger("bookacti_export_bookings_url",[d])}else{if(d.status==="failed"){var e=typeof d.message!=="undefined"?d.message:bookacti_localized.error;$j("#bookacti-export-bookings-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+e+"</li></ul></div>").show();console.log(e);console.log(d)}}},error:function(d){$j("#bookacti-export-bookings-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>AJAX '+bookacti_localized.error+"</li></ul></div>").show();console.log("AJAX "+bookacti_localized.error);console.log(d)},complete:function(){$j("#bookacti-export-bookings-dialog .bookacti-notices").show();$j("#bookacti-export-bookings-dialog .bookacti-loading-alt").remove()}})};