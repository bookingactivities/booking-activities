$j(document).ready(function(){bookacti_init_booking_actions();bookacti_init_booking_bulk_actions();$j(".bookacti-export-bookings-button").on("click",function(){bookacti_dialog_export_bookings()});$j("#bookacti-export-bookings-dialog").dialog({beforeClose:function(){}});$j("#bookacti-bookings-calendar-settings-dialog").dialog({beforeClose:function(){}});$j('.bookacti_export_button input[type="button"]').on("click",function(){var b=$j(this).closest(".bookacti_export_url").find(".bookacti_export_url_field input").val();
b&&window.open(b,"_blank")});$j("#bookacti-export-bookings-dialog").on("tabsactivate",".bookacti-tabs",function(b,a){bookacti_change_export_type_according_to_active_tab()})});
function bookacti_dialog_update_bookings_calendar_settings(){$j("#bookacti-bookings-calendar-settings-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_ok,click:function(){$j("#bookacti-bookings-calendar-settings-dialog .bookacti-notices").remove();var b=bookacti_serialize_object($j("#bookacti-bookings-calendar-settings-form"));$j("body").trigger("bookacti_bookings_calendar_settings_data",[b]);bookacti_add_loading_html($j("#bookacti-bookings-calendar-settings-dialog"));$j.ajax({url:bookacti_localized.ajaxurl,
type:"POST",data:b,dataType:"json",success:function(a){if("success"===a.status){bookacti.booking_system["bookacti-booking-system-bookings-page"].display_data=a.display_data;bookacti.booking_system["bookacti-booking-system-bookings-page"].tooltip_booking_list=a.calendar_settings.tooltip_booking_list;bookacti.booking_system["bookacti-booking-system-bookings-page"].tooltip_booking_list_columns=a.calendar_settings.tooltip_booking_list_columns;$j("body").trigger("bookacti_bookings_calendar_settings_updated",
[b,a]);var f=$j("#bookacti-booking-system-bookings-page");bookacti_reload_booking_system(f,!0);$j("#bookacti-submit-filter-button").attr("data-ajax",a.calendar_settings.ajax).data("ajax",a.calendar_settings.ajax);$j("#bookacti-bookings-calendar-settings-dialog").dialog("close")}else if("failed"===a.status){f="undefined"!==typeof a.message?a.message:"";if(!f){f+="Error while trying to update calendar settings";var e="undefined"!==typeof a.error?a.error:"";e&&(f+=" ("+e+")")}$j("#bookacti-bookings-calendar-settings-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+
f+"</li></ul></div>");console.log(f);console.log(a)}},error:function(a){$j("#bookacti-bookings-calendar-settings-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>AJAX error while trying to update calendar settings</li></ul></div>');console.log("AJAX error while trying to update calendar settings");console.log(a)},complete:function(){$j("#bookacti-bookings-calendar-settings-dialog .bookacti-notices").show();bookacti_remove_loading_html($j("#bookacti-bookings-calendar-settings-dialog"))}})}},
{text:bookacti_localized.dialog_button_cancel,click:function(){$j(this).dialog("close")}}]);$j("#bookacti-bookings-calendar-settings-dialog").dialog("open")}
function bookacti_dialog_cancel_booking(b,a){a="group"===a?"group":"single";var f="group"===a?"bookactiCancelBookingGroup":"bookactiCancelBooking";if("single"===a){var e=$j('.bookacti-cancel-booking[data-booking-id="'+b+'"]').closest("tr");var g=$j('.bookacti-cancel-booking[data-booking-id="'+b+'"]').closest("tr, .bookacti-booking-row")}else e=$j('.bookacti-cancel-booking-group[data-booking-group-id="'+b+'"]').closest("tr"),g=$j('.bookacti-cancel-booking-group[data-booking-group-id="'+b+'"]').closest("tr, .bookacti-booking-row");
bookacti_localized.is_admin&&"undefined"!==typeof bookacti_empty_all_dialog_forms||$j("#bookacti-cancel-booking-dialog").dialog({beforeClose:function(){$j("#bookacti-cancel-booking-dialog .bookacti-notices").remove()}});e.first().trigger("bookacti_booking_action_dialog_opened",[b,a,"cancel"]);$j("#bookacti-cancel-booking-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_cancel_booking,"class":"bookacti-dialog-delete-button",click:function(){$j("#bookacti-cancel-booking-dialog .bookacti-notices").remove();
var d=[];e.first().find("td").each(function(){var h=$j(this).data("column-id");h&&d.push(h)});var c={action:f,booking_id:b,context:bookacti_localized.is_admin?"admin_booking_list":"user_booking_list",columns:d,user_auth_key:"undefined"!==typeof user_auth_key?user_auth_key:"",nonce:bookacti_localized.nonce_cancel_booking};e.first().trigger("bookacti_booking_action_data",[c,b,a,"cancel"]);bookacti_add_loading_html($j("#bookacti-cancel-booking-dialog"));bookacti_booking_row_enter_loading_state(g);$j.ajax({url:bookacti_localized.ajaxurl,
type:"POST",data:c,dataType:"json",success:function(h){if("success"===h.status)h.row&&(e.last().after(h.row),e.remove(),bookacti_refresh_list_table_hidden_columns()),$j("#bookacti-cancel-booking-dialog").dialog("close"),h.allow_refund&&bookacti_dialog_refund_booking(b,a),$j("body").trigger("bookacti_booking_cancelled_by_user",[b,a]);else if("failed"===h.status){var k="undefined"!==typeof h.message?h.message:bookacti_localized.error;$j("#bookacti-cancel-booking-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+
k+"</li></ul></div>");console.log(k);console.log(h)}},error:function(h){$j("#bookacti-cancel-booking-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>AJAX '+bookacti_localized.error+"</li></ul></div>");console.log("AJAX "+bookacti_localized.error);console.log(h)},complete:function(){$j("#bookacti-cancel-booking-dialog .bookacti-notices").show();bookacti_remove_loading_html($j("#bookacti-cancel-booking-dialog"));bookacti_booking_row_exit_loading_state(g)}})}},{text:bookacti_localized.dialog_button_cancel,
click:function(){$j(this).dialog("close")}}]);$j("#bookacti-cancel-booking-dialog").dialog("open")}
function bookacti_dialog_refund_booking(b,a){a="group"===a?"group":"single";var f="group"===a?"bookactiGetBookingGroupRefundActionsHTML":"bookactiGetBookingRefundActionsHTML",e="group"===a?"bookactiRefundBookingGroup":"bookactiRefundBooking";$j("#bookacti-refund-booking-dialog #bookacti-refund-options").empty();$j("#bookacti-refund-booking-dialog #bookacti-refund-options-container").hide();$j("#bookacti-refund-booking-dialog #bookacti-no-refund-option").hide();$j("#bookacti-refund-booking-dialog #bookacti-refund-amount").empty();
$j("#bookacti-refund-booking-dialog #bookacti-refund-amount-container").hide();if("single"===a){var g=$j('.bookacti-refund-booking[data-booking-id="'+b+'"]').closest("tr");var d=$j('.bookacti-refund-booking[data-booking-id="'+b+'"]').closest("tr, .bookacti-booking-row")}else g=$j('.bookacti-refund-booking-group[data-booking-group-id="'+b+'"]').closest("tr"),d=$j('.bookacti-refund-booking-group[data-booking-group-id="'+b+'"]').closest("tr, .bookacti-booking-row");bookacti_localized.is_admin&&"undefined"!==
typeof bookacti_empty_all_dialog_forms||$j("#bookacti-refund-booking-dialog").dialog({beforeClose:function(){$j("#bookacti-refund-booking-dialog .bookacti-notices").remove()}});bookacti_add_loading_html($j("#bookacti-refund-booking-dialog"));$j.ajax({url:bookacti_localized.ajaxurl,type:"POST",data:{action:f,booking_id:b,is_admin:bookacti_localized.is_admin?1:0,user_auth_key:"undefined"!==typeof user_auth_key?user_auth_key:"",nonce:bookacti_localized.nonce_refund_booking},dataType:"json",success:function(c){if("success"===
c.status){var h=[];c.actions_html?($j("#bookacti-refund-booking-dialog #bookacti-refund-options").html(c.actions_html),$j("#bookacti-refund-booking-dialog #bookacti-refund-options-container").show(),c.amount&&($j("#bookacti-refund-booking-dialog #bookacti-refund-amount").html(c.amount),$j("#bookacti-refund-booking-dialog #bookacti-refund-amount-container").show()),$j('#bookacti-refund-booking-form input[type="radio"]:first').prop("checked",!0),g.first().trigger("bookacti_booking_action_dialog_opened",
[b,a,"refund"]),h.push({text:bookacti_localized.dialog_button_refund,"class":"bookacti-dialog-delete-button",click:function(){$j("#bookacti-refund-booking-dialog .bookacti-notices").remove();var k=0;g.first().closest("#bookacti-booking-list").length&&(k=g.next().hasClass("bookacti-gouped-booking")?1:0);d.find(".bookacti-booking-status").hide();bookacti_add_loading_html(d.find(".bookacti-booking-status"),"after");bookacti_add_loading_html($j("#bookacti-refund-booking-dialog"));var l=$j('#bookacti-refund-booking-form input[name="refund-action"]:checked').val(),
n=$j('#bookacti-refund-message textarea[name="refund-message"]').val(),p=[];g.first().find("td").each(function(){var m=$j(this).data("column-id");m&&p.push(m)});var q={action:e,booking_id:b,refund_action:l,refund_message:n,reload_grouped_bookings:k,is_admin:bookacti_localized.is_admin?1:0,context:bookacti_localized.is_admin?"admin_booking_list":"user_booking_list",columns:p,user_auth_key:"undefined"!==typeof user_auth_key?user_auth_key:"",nonce:bookacti_localized.nonce_refund_booking};g.first().trigger("bookacti_booking_action_data",
[q,b,a,"refund"]);$j.ajax({url:bookacti_localized.ajaxurl,type:"POST",data:q,dataType:"json",success:function(m){if("success"===m.status)k&&"undefined"!==typeof m.grouped_booking_rows&&g.each(function(){var t=$j(this).next().hasClass("hidden");$j(this).nextUntil("tr:not(.bookacti-gouped-booking)").remove();$j(this).after(m.grouped_booking_rows);t&&($j(this).nextUntil("tr:not(.bookacti-gouped-booking)").addClass("hidden"),$j(this).nextUntil("tr:not(.bookacti-gouped-booking)").length%2&&$j(this).after('<tr class="bookacti-gouped-booking hidden dummy"></tr>'))}),
m.row&&(g.last().after(m.row),g.remove(),bookacti_refresh_list_table_hidden_columns()),$j("body").trigger("bookacti_booking_refunded",[b,a,l,n,m]),$j("#bookacti-refund-booking-dialog").dialog("close"),m.message&&bookacti_dialog_refund_confirmation(m.message);else if("failed"===m.status){var r="undefined"!==typeof m.message?m.message:bookacti_localized.error;$j("#bookacti-refund-booking-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+r+"</li></ul></div>");console.log(r);
console.log(m)}},error:function(m){console.log("AJAX "+bookacti_localized.error);console.log(m)},complete:function(){$j("#bookacti-refund-booking-dialog .bookacti-notices").show();bookacti_remove_loading_html($j("#bookacti-refund-booking-dialog"));bookacti_remove_loading_html(d);d.find(".bookacti-booking-status").show()}})}})):$j("#bookacti-refund-booking-dialog #bookacti-no-refund-option").show();h.push({text:bookacti_localized.dialog_button_cancel,click:function(){$j(this).dialog("close")}});$j("#bookacti-refund-booking-dialog").dialog("option",
"buttons",h)}else"failed"===c.status&&(h="undefined"!==typeof c.message?c.message:bookacti_localized.error,$j("#bookacti-refund-booking-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+h+"</li></ul></div>"),console.log(h),console.log(c))},error:function(c){$j("#bookacti-refund-booking-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>AJAX '+bookacti_localized.error+"</li></ul></div>");console.log("AJAX "+bookacti_localized.error);
console.log(c)},complete:function(){bookacti_remove_loading_html($j("#bookacti-refund-booking-dialog"));$j("#bookacti-refund-booking-dialog .bookacti-notices").show()}});$j("#bookacti-refund-booking-dialog").dialog("open")}
function bookacti_dialog_refund_confirmation(b){$j("#bookacti-refund-booking-confirm-dialog").html(b);$j("#bookacti-refund-booking-confirm-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_ok,click:function(){$j(this).dialog("close")}}]);$j("#bookacti-refund-booking-confirm-dialog").dialog("open")}
function bookacti_dialog_change_bookings_status(b){var a=b.all?$j(".bookacti-single-booking, .bookacti-booking-group"):$j();b.all||($j.each(b.booking_ids,function(g,d){a=a.add($j('.bookacti-single-booking[data-booking-id="'+d+'"]').closest("tr"))}),$j.each(b.booking_group_ids,function(g,d){a=a.add($j('.bookacti-booking-group[data-booking-group-id="'+d+'"]').closest("tr"))}));var f=1===a.length?a.find(".bookacti-booking-status").data("booking-status"):"",e=1===a.length?a.find(".bookacti-payment-status").data("payment-status"):
"";$j("select#bookacti-select-booking-status").val(f);$j("select#bookacti-select-payment-status").val(e);$j("#bookacti-send-notifications-on-status-change").prop("checked",!1);$j("body").trigger("bookacti_booking_action_dialog_opened",[b,"change_booking_status"]);$j("#bookacti-change-booking-status-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_ok,click:function(){var g=$j("select#bookacti-select-booking-status").val(),d=$j("select#bookacti-select-payment-status").val();
if((g||d)&&(g!==f||d!==e)){$j("#bookacti-change-booking-status-dialog .bookacti-notices").remove();var c=[];a.first().find("td").each(function(){var k=$j(this).data("column-id");k&&c.push(k)});b.filters=b.all?bookacti_get_booking_list_filters():{};var h={form_data:new FormData($j("#bookacti-change-booking-status-form").get(0))};h.form_data.append("action","bookactiChangeBookingsStatus");h.form_data.append("booking_selection",JSON.stringify(b));h.form_data.append("columns",JSON.stringify(c));h.form_data.append("is_admin",
bookacti_localized.is_admin?1:0);$j("body").trigger("bookacti_booking_action_data",[h,b,"change_booking_status"]);bookacti_booking_row_enter_loading_state(a);bookacti_add_loading_html($j("#bookacti-change-booking-status-dialog"));$j.ajax({url:bookacti_localized.ajaxurl,type:"POST",data:h.form_data,dataType:"json",cache:!1,contentType:!1,processData:!1,success:function(k){if("success"===k.status){$j("#bookacti-change-booking-status-dialog").dialog("close");if(k.rows){var l=$j(k.rows);a.each(function(){var p=
$j(this).find(".bookacti-single-booking").addBack(".bookacti-single-booking").data("booking-id"),q=$j(this).find(".bookacti-booking-group").addBack(".bookacti-booking-group").data("booking-group-id");p=(p=p?'.bookacti-single-booking[data-booking-id="'+p+'"]':q?'.bookacti-booking-group[data-booking-group-id="'+q+'"]':"")?l.find(p).addBack(p).closest("tr"):$j();p.length&&$j(this).replaceWith(p);q&&$j('.bookacti-gouped-booking[data-booking-group-id="'+q+'"]').remove()});bookacti_refresh_list_table_hidden_columns()}a.remove();
g&&$j("body").trigger("bookacti_booking_status_changed",[k,b,g]);d&&$j("body").trigger("bookacti_payment_status_changed",[k,b,d]);k.rows||window.location.reload()}else if("failed"===k.status){var n="undefined"!==typeof k.message?k.message:bookacti_localized.error;$j("#bookacti-change-booking-status-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+n+"</li></ul></div>").show();console.log(n);console.log(k)}},error:function(k){$j("#bookacti-change-booking-status-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>AJAX '+
bookacti_localized.error+"</li></ul></div>").show();console.log("AJAX "+bookacti_localized.error);console.log(k)},complete:function(){$j("#bookacti-change-booking-status-dialog .bookacti-notices").show();bookacti_remove_loading_html($j("#bookacti-change-booking-status-dialog"));bookacti_booking_row_exit_loading_state(a)}})}}},{text:bookacti_localized.dialog_button_cancel,click:function(){$j(this).dialog("close")}}]);$j("#bookacti-change-booking-status-dialog").dialog("open")}
function bookacti_dialog_change_bookings_quantity(b){var a=b.all?$j(".bookacti-single-booking, .bookacti-booking-group"):$j();b.all||($j.each(b.booking_ids,function(e,g){a=a.add($j('.bookacti-single-booking[data-booking-id="'+g+'"]').closest("tr"))}),$j.each(b.booking_group_ids,function(e,g){a=a.add($j('.bookacti-booking-group[data-booking-group-id="'+g+'"]').closest("tr"))}));var f=1===a.length?parseInt(a.find(".column-quantity").text()):1;$j("#bookacti-new-quantity").val(f);$j("body").trigger("bookacti_booking_action_dialog_opened",
[b,"change_quantity"]);$j("#bookacti-change-booking-quantity-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_ok,click:function(){var e=parseInt($j("#bookacti-new-quantity").val());if(e){$j("#bookacti-change-booking-quantity-dialog .bookacti-notices").remove();var g=[];a.first().find("td").each(function(){var c=$j(this).data("column-id");c&&g.push(c)});b.filters=b.all?bookacti_get_booking_list_filters():{};var d={form_data:new FormData($j("#bookacti-change-booking-quantity-form").get(0))};
d.form_data.append("action","bookactiChangeBookingsQuantity");d.form_data.append("booking_selection",JSON.stringify(b));d.form_data.append("columns",JSON.stringify(g));d.form_data.append("is_admin",bookacti_localized.is_admin?1:0);$j("body").trigger("bookacti_booking_action_data",[d,b,"change_quantity"]);bookacti_booking_row_enter_loading_state(a);bookacti_add_loading_html($j("#bookacti-change-booking-quantity-dialog"));$j.ajax({url:bookacti_localized.ajaxurl,type:"POST",data:d.form_data,dataType:"json",
cache:!1,contentType:!1,processData:!1,success:function(c){if("success"===c.status){$j("#bookacti-change-booking-quantity-dialog").dialog("close");if(c.rows){var h=$j(c.rows);a.each(function(){var l=$j(this).find(".bookacti-single-booking").addBack(".bookacti-single-booking").data("booking-id"),n=$j(this).find(".bookacti-booking-group").addBack(".bookacti-booking-group").data("booking-group-id");l=(l=l?'.bookacti-single-booking[data-booking-id="'+l+'"]':n?'.bookacti-booking-group[data-booking-group-id="'+
n+'"]':"")?h.find(l).addBack(l).closest("tr"):$j();l.length&&$j(this).replaceWith(l);n&&$j('.bookacti-gouped-booking[data-booking-group-id="'+n+'"]').remove()});bookacti_refresh_list_table_hidden_columns()}a.remove();$j("body").trigger("bookacti_booking_quantity_changed",[c,b,e]);c.rows||window.location.reload()}else if("failed"===c.status){var k="undefined"!==typeof c.message?c.message:bookacti_localized.error;$j("#bookacti-change-booking-quantity-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+
k+"</li></ul></div>").show();console.log(k);console.log(c)}},error:function(c){$j("#bookacti-change-booking-quantity-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>AJAX '+bookacti_localized.error+"</li></ul></div>").show();console.log("AJAX "+bookacti_localized.error);console.log(c)},complete:function(){$j("#bookacti-change-booking-quantity-dialog .bookacti-notices").show();bookacti_remove_loading_html($j("#bookacti-change-booking-quantity-dialog"));bookacti_booking_row_exit_loading_state(a)}})}}},
{text:bookacti_localized.dialog_button_cancel,click:function(){$j(this).dialog("close")}}]);$j("#bookacti-change-booking-quantity-dialog").dialog("open")}
function bookacti_dialog_reschedule_booking(b){var a=$j('.bookacti-reschedule-booking[data-booking-id="'+b+'"]').closest("tr"),f=$j('.bookacti-reschedule-booking[data-booking-id="'+b+'"]').closest("tr, .bookacti-booking-row"),e=$j("#bookacti-booking-system-reschedule.bookacti-booking-system"),g=e.attr("id"),d=0;bookacti_localized.is_admin&&$j("#bookacti-send-notifications-on-reschedule").prop("checked",!1);e.empty();bookacti_clear_booking_system_displayed_info(e);bookacti_localized.is_admin&&"undefined"!==
typeof bookacti_empty_all_dialog_forms||$j("#bookacti-reschedule-booking-dialog").dialog({beforeClose:function(){$j("#bookacti-reschedule-booking-dialog .bookacti-notices").not("#bookacti-reschedule-booking-dialog .bookacti-booking-system-container .bookacti-notices").remove();$j("#bookacti-reschedule-booking-dialog .bookacti-booking-system-container .bookacti-notices").empty().hide()}});a.first().trigger("bookacti_booking_action_dialog_opened",[b,"single","reschedule"]);bookacti_booking_row_enter_loading_state(f);
$j.ajax({url:bookacti_localized.ajaxurl,type:"POST",data:{action:"bookactiGetRescheduleBookingSystemData",booking_id:b,user_auth_key:"undefined"!==typeof user_auth_key?user_auth_key:"",is_admin:bookacti_localized.is_admin?1:0},dataType:"json",success:function(c){if("success"===c.status){var h=e.attr("id");d=c.booking_system_data.rescheduled_booking_data.quantity;e.closest("form").find("input.bookacti-quantity").val(d);bookacti.booking_system[h]=c.booking_system_data;e.trigger("bookacti_before_reschedule_booking_system_loads",
[c]);bookacti_reload_booking_system(e)}else"failed"===c.status&&(h="undefined"!==typeof c.message?c.message:bookacti_localized.error,e.siblings(".bookacti-notices").html("<ul class='bookacti-error-list'><li>"+h+"</li></ul>").show(),console.log(h),console.log(c))},error:function(c){e.siblings(".bookacti-notices").html('<ul class="bookacti-error-list"><li>AJAX '+bookacti_localized.error+"</li></ul>").show();console.log("AJAX "+bookacti_localized.error);console.log(c)},complete:function(){bookacti_booking_row_exit_loading_state(f)}});
$j("#bookacti-reschedule-booking-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_reschedule,"class":"bookacti-dialog-delete-button",click:function(){if(bookacti_validate_picked_events(e,d)){var c=bookacti.booking_system[g].picked_events;if(!(0<parseInt(c[0].group_id))){var h=1;bookacti_localized.is_admin&&$j("#bookacti-send-notifications-on-reschedule").length&&(h=$j("#bookacti-send-notifications-on-reschedule").prop("checked")?1:0);var k=[];a.first().find("td").each(function(){var l=
$j(this).data("column-id");l&&k.push(l)});c={action:"bookactiRescheduleBooking",booking_id:b,picked_events:c,columns:k,context:bookacti_localized.is_admin?"admin_booking_list":"user_booking_list",is_admin:bookacti_localized.is_admin?1:0,send_notifications:h,user_auth_key:"undefined"!==typeof user_auth_key?user_auth_key:"",nonce:bookacti_localized.nonce_reschedule_booking};a.first().trigger("bookacti_booking_action_data",[c,b,"single","reschedule"]);bookacti_booking_row_enter_loading_state(f);bookacti_start_loading_booking_system(e);
bookacti_add_loading_html($j("#bookacti-reschedule-booking-dialog"));$j.ajax({url:bookacti_localized.ajaxurl,type:"POST",data:c,dataType:"json",success:function(l){if("success"===l.status)$j("#bookacti-reschedule-booking-dialog").dialog("close"),l.row&&(a.last().after(l.row),a.remove(),bookacti_refresh_list_table_hidden_columns()),$j("body").trigger("bookacti_booking_rescheduled",[l]);else{var n="undefined"!==typeof l.message?l.message:bookacti_localized.error;e.siblings(".bookacti-notices").html("<ul class='bookacti-error-list'><li>"+
n+"</li></ul>").show();console.log(n);console.log(l)}},error:function(l){console.log("AJAX "+bookacti_localized.error);console.log(l)},complete:function(){bookacti_remove_loading_html($j("#bookacti-reschedule-booking-dialog"));bookacti_booking_row_exit_loading_state(f);bookacti_stop_loading_booking_system(e)}})}}}},{text:bookacti_localized.dialog_button_cancel,click:function(){$j(this).dialog("close")}}]);$j("#bookacti-reschedule-booking-dialog").dialog("open")}
function bookacti_dialog_send_bookings_notification(b){var a=b.all?$j(".bookacti-single-booking, .bookacti-booking-group"):$j();b.all||($j.each(b.booking_ids,function(f,e){a=a.add($j('.bookacti-single-booking[data-booking-id="'+e+'"]').closest("tr"))}),$j.each(b.booking_group_ids,function(f,e){a=a.add($j('.bookacti-booking-group[data-booking-group-id="'+e+'"]').closest("tr"))}));$j("body").trigger("bookacti_booking_action_dialog_opened",[b,"send_notification"]);$j("#bookacti-send-booking-notification-dialog").dialog("option",
"buttons",[{text:bookacti_localized.dialog_button_send,click:function(){var f=$j("#bookacti-booking-notification-id").val();if(f){$j("#bookacti-send-booking-notification-dialog .bookacti-notices").remove();var e=[];a.first().find("td").each(function(){var d=$j(this).data("column-id");d&&e.push(d)});b.filters=b.all?bookacti_get_booking_list_filters():{};var g={form_data:new FormData($j("#bookacti-send-booking-notification-form").get(0))};g.form_data.append("action","bookactiSendBookingsNotification");
g.form_data.append("booking_selection",JSON.stringify(b));g.form_data.append("columns",JSON.stringify(e));g.form_data.append("is_admin",bookacti_localized.is_admin?1:0);$j("body").trigger("bookacti_booking_action_data",[g,b,"send_notification"]);bookacti_booking_row_enter_loading_state(a);bookacti_add_loading_html($j("#bookacti-send-booking-notification-dialog"));$j.ajax({url:bookacti_localized.ajaxurl,type:"POST",data:g.form_data,dataType:"json",cache:!1,contentType:!1,processData:!1,success:function(d){if("success"===
d.status)d.message?$j("#bookacti-send-booking-notification-dialog").append('<div class="bookacti-notices"><ul class="bookacti-success-list"><li>'+d.message+"</li></ul></div>").show():$j("#bookacti-send-booking-notification-dialog").dialog("close"),$j("body").trigger("bookacti_booking_notification_sent",[d,b,f]);else if("failed"===d.status){var c="undefined"!==typeof d.message?d.message:bookacti_localized.error;$j("#bookacti-send-booking-notification-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+
c+"</li></ul></div>").show();console.log(c);console.log(d)}},error:function(d){$j("#bookacti-send-booking-notification-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>AJAX '+bookacti_localized.error+"</li></ul></div>").show();console.log("AJAX "+bookacti_localized.error);console.log(d)},complete:function(){$j("#bookacti-send-booking-notification-dialog .bookacti-notices").show();bookacti_remove_loading_html($j("#bookacti-send-booking-notification-dialog"));bookacti_booking_row_exit_loading_state(a)}})}}},
{text:bookacti_localized.dialog_button_cancel,click:function(){$j(this).dialog("close")}}]);$j("#bookacti-send-booking-notification-dialog").dialog("open")}
function bookacti_dialog_send_booking_notification(b,a){a="group"===a?"group":"single";var f="single"===a?$j('.bookacti-change-booking-quantity[data-booking-id="'+b+'"]').closest("tr"):$j('.bookacti-change-booking-group-quantity[data-booking-group-id="'+b+'"]').closest("tr");var e=f.first().closest("#bookacti-booking-list").length?1:0;f.first().trigger("bookacti_booking_action_dialog_opened",[b,a,"send_notification"]);$j("#bookacti-send-booking-notification-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_send,
click:function(){var g=$j("#bookacti-booking-notification-id").val();if(g){$j("#bookacti-send-booking-notification-dialog .bookacti-notices").remove();var d=bookacti_serialize_object($j("#bookacti-send-booking-notification-dialog-form"));d.action="bookactiSendBookingNotification";d.booking_id=b;d.booking_type=a;d.is_bookings_page=e;d.is_admin=bookacti_localized.is_admin?1:0;d.context=bookacti_localized.is_admin?"admin_booking_list":"user_booking_list";f.first().trigger("bookacti_booking_action_data",
[d,b,a,"send_notification"]);bookacti_booking_row_enter_loading_state(f);bookacti_add_loading_html($j("#bookacti-send-booking-notification-dialog"));$j.ajax({url:bookacti_localized.ajaxurl,type:"POST",data:d,dataType:"json",success:function(c){if("success"===c.status)$j("#bookacti-send-booking-notification-dialog").dialog("close"),$j("body").trigger("bookacti_booking_notification_sent",[g,b,a]);else if("failed"===c.status){var h="undefined"!==typeof c.message?c.message:bookacti_localized.error;$j("#bookacti-send-booking-notification-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+
h+"</li></ul></div>").show();console.log(h);console.log(c)}},error:function(c){$j("#bookacti-send-booking-notification-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>AJAX '+bookacti_localized.error+"</li></ul></div>").show();console.log("AJAX "+bookacti_localized.error);console.log(c)},complete:function(){$j("#bookacti-send-booking-notification-dialog .bookacti-notices").show();bookacti_remove_loading_html($j("#bookacti-send-booking-notification-dialog"));bookacti_booking_row_exit_loading_state(f)}})}}},
{text:bookacti_localized.dialog_button_cancel,click:function(){$j(this).dialog("close")}}]);$j("#bookacti-send-booking-notification-dialog").dialog("open")}
function bookacti_dialog_delete_booking(b,a){a="group"===a?"group":"single";if("single"===a){var f="bookactiDeleteBooking";var e=$j('.bookacti-delete-booking[data-booking-id="'+b+'"]').closest("tr");$j(".bookacti-delete-booking-group-description").hide()}else f="bookactiDeleteBookingGroup",e=$j('.bookacti-delete-booking-group[data-booking-group-id="'+b+'"]').closest("tr"),$j(".bookacti-delete-booking-group-description").show();$j('#bookacti-delete-booking-dialog input[name="action"]').val(f);$j('#bookacti-delete-booking-dialog input[name="booking_id"]').val(b);
$j('#bookacti-delete-booking-dialog input[name="booking_type"]').val(a);e.first().trigger("bookacti_booking_action_dialog_opened",[b,a,"delete"]);$j("#bookacti-delete-booking-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_delete,"class":"bookacti-dialog-delete-button",click:function(){$j("#bookacti-delete-booking-dialog .bookacti-notices").remove();var g=bookacti_serialize_object($j("#bookacti-delete-booking-dialog form"));g.is_admin=bookacti_localized.is_admin?1:0;g.context=
bookacti_localized.is_admin?"admin_booking_list":"user_booking_list";e.first().trigger("bookacti_booking_action_data",[g,b,a,"delete"]);bookacti_booking_row_enter_loading_state(e);bookacti_add_loading_html($j("#bookacti-delete-booking-dialog"));$j.ajax({url:bookacti_localized.ajaxurl,type:"POST",data:g,dataType:"json",success:function(d){if("success"===d.status){$j("#bookacti-delete-booking-dialog").dialog("close");if("group"===a&&$j(".bookacti-booking-group-id-"+b).length){var c=$j(".bookacti-booking-group-id-"+
b);c.removeClass("bookacti-gouped-booking").animate({opacity:0},function(){c.children("td, th").animate({padding:0}).wrapInner("<div></div>").children().slideUp(function(){c.remove()})})}e.animate({opacity:0},function(){e.children("td, th").animate({padding:0}).wrapInner("<div></div>").children().slideUp(function(){e.remove()})});$j("body").trigger("bookacti_booking_deleted",[b,a,d])}else if("failed"===d.status){var h="undefined"!==typeof d.message?d.message:bookacti_localized.error;$j("#bookacti-delete-booking-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+
h+"</li></ul></div>");console.log(h);console.log(d)}},error:function(d){$j("#bookacti-delete-booking-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>AJAX '+bookacti_localized.error+"</li></ul></div>");console.log("AJAX "+bookacti_localized.error);console.log(d)},complete:function(){$j("#bookacti-delete-booking-dialog .bookacti-notices").show();bookacti_remove_loading_html($j("#bookacti-delete-booking-dialog"));bookacti_booking_row_exit_loading_state(e)}})}},{text:bookacti_localized.dialog_button_cancel,
"class":"bookacti-dialog-left-button",click:function(){$j(this).dialog("close")}}]);$j("#bookacti-delete-booking-dialog").dialog("open")}
function bookacti_dialog_export_bookings(){$j("#bookacti-export-bookings-url-container").data("export-type","");bookacti_change_export_type_according_to_active_tab();$j("#bookacti_export_bookings_url_secret").val("");$j("#bookacti-export-bookings-url-container").hide();$j("#bookacti-export-bookings-dialog").dialog("option","buttons",[{text:bookacti_localized.dialog_button_generate_link,click:function(){bookacti_generate_export_bookings_url(!1)}},{text:bookacti_localized.dialog_button_reset,"class":"bookacti-dialog-delete-button bookacti-dialog-left-button",
click:function(){bookacti_generate_export_bookings_url(!0)}}]);$j("#bookacti-export-bookings-dialog").dialog("open")}
function bookacti_generate_export_bookings_url(b){b=b||!1;$j("#bookacti-export-bookings-dialog .bookacti-notices").remove();bookacti_add_loading_html($j("#bookacti-export-bookings-dialog"));var a=bookacti_serialize_object($j("#bookacti-export-bookings-form"));a.action="bookactiExportBookingsUrl";a.reset_key=b?1:0;a.booking_filters=bookacti_serialize_object($j("#bookacti-booking-list-filters-form"));$j("#bookacti-export-bookings-form").trigger("bookacti_export_bookings_url_data",[a,b]);$j.ajax({url:ajaxurl,
type:"POST",data:a,dataType:"json",success:function(f){if("success"===f.status)$j("#bookacti_export_bookings_url_secret").val(f.url),$j("#bookacti-export-bookings-dialog").append('<div class="bookacti-notices"><ul class="bookacti-success-list"><li>'+f.message+"</li></ul></div>").show(),$j("#bookacti-export-bookings-url-container").data("export-type",a.export_type),$j("#bookacti-export-bookings-url-container").show(),$j("#bookacti-form-editor").trigger("bookacti_export_bookings_url",[f]);else if("failed"===
f.status){var e="undefined"!==typeof f.message?f.message:bookacti_localized.error;$j("#bookacti-export-bookings-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+e+"</li></ul></div>").show();console.log(e);console.log(f)}},error:function(f){$j("#bookacti-export-bookings-dialog").append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>AJAX '+bookacti_localized.error+"</li></ul></div>").show();console.log("AJAX "+bookacti_localized.error);console.log(f)},
complete:function(){$j("#bookacti-export-bookings-dialog .bookacti-notices").show();bookacti_remove_loading_html($j("#bookacti-export-bookings-dialog"))}})};
