$j(document).ready(function(){bookacti_init_tooltip();$j("body").on("keyup mouseup change",".bookacti-booking-form input[name=password], .bookacti-form-fields input[name=password]",function(){var a=$j(this),b=$j(this).closest(".bookacti-form-field-container").find(".bookacti-password-strength-meter"),c=[],d=a.closest("form, .bookacti-form-fields").find('input[name="login_type"]:checked').val();b.length&&d==="new_account"?(a=bookacti_check_password_strength(a,null,b,c),$j(this).closest(".bookacti-form-field-container").find("input[name=password_strength]").val(a)):
a.removeClass("short bad good strong")});$j("body").on("click",".bookacti-forgotten-password-link",function(a){$j(this).attr("href")&&$j(this).attr("href")!=="#"||(a.preventDefault(),a=$j(this).data("field-id"),bookacti_dialog_forgotten_password(a))});$j("body").on("click",".bookacti-login-link",function(a){var b=$j(this).data("field-id");b=$j(this).closest(".bookacti-booking-form, .bookacti-form-fields").find(".bookacti-form-field-id-"+b);var c=b.find('.bookacti-login-type-my_account input[type="radio"]');
c.length&&(a.preventDefault(),c.trigger("click"),bookacti_scroll_to(b,500,"middle"),$j(this).closest(".bookacti-booking-form, .bookacti-form-fields").find(".bookacti-notices").empty())});$j(".bookacti-form-field-container.bookacti-form-field-type-login").each(function(){bookacti_show_hide_register_fields($j(this))});$j("body").on("change",'.bookacti-form-field-container.bookacti-form-field-type-login input[name="login_type"]',function(){var a=$j(this).closest(".bookacti-form-field-container.bookacti-form-field-type-login");
bookacti_show_hide_register_fields(a)});$j("body").on("click",".bookacti-form-field-login-field-container .bookacti-login-button",function(a){a.preventDefault();typeof bookacti_localized.current_user_id!=="undefined"&&bookacti_localized.current_user_id||bookacti_submit_login_form($j(this))});$j("body").on("submit",".bookacti-booking-form",function(a){a.preventDefault();a=$j(this).find(".bookacti-form-field-type-calendar .bookacti-booking-system");a.length&&(bookacti_perform_form_action(a),$j(this).trigger("bookacti_submit_booking_form"))});
$j("body").on("click",".bookacti-booking-form .bookacti-new-booking-button",function(){if($j(this).hasClass("bookacti-reload-page"))window.location.reload(),$j(this).prop("disabled",!0);else{var a=$j(this).closest("form"),b=a.find(".bookacti-booking-system");bookacti_clear_booking_system_displayed_info(b);(a.find("> .bookacti-notices").length?a.find("> .bookacti-notices"):b.siblings(".bookacti-notices")).empty();a.find('.bookacti-form-field-container:not(.bookacti-hidden-field), button[type="submit"], input[type="submit"]').show();
$j(this).hide();a.trigger("bookacti_make_new_booking")}});$j("body").on("bookacti_displayed_info_cleared",".bookacti-booking-form .bookacti-booking-system, .bookacti-form-fields .bookacti-booking-system",function(){var a=$j(this).closest("form").length?$j(this).closest("form"):$j(this).closest(".bookacti-form-fields"),b=a.find('button[type="submit"], input[type="submit"]').first();a.find('input[name="quantity"]').attr("disabled",!1);b.attr("disabled",!1)});$j("body").on("bookacti_error_displayed",
".bookacti-booking-form .bookacti-booking-system, .bookacti-form-fields .bookacti-booking-system",function(){var a=$j(this).closest("form").length?$j(this).closest("form"):$j(this).closest(".bookacti-form-fields"),b=a.find('button[type="submit"], input[type="submit"]').first();a.find('input[name="quantity"]').attr("disabled",!0);b.attr("disabled",!0)});$j('form input[name="quantity"]').each(function(){var a=$j(this).closest("form").length?$j(this).closest("form"):$j(this).closest(".bookacti-form-fields");
a.length&&a.find(".bookacti-booking-system").length&&a.trigger("bookacti_booking_form_quantity_change",[$j(this).val(),$j(this)])});$j("body").on("keyup mouseup change",".bookacti-booking-form input.bookacti-quantity, .bookacti-form-fields input.bookacti-quantity",function(){var a=$j(this),b=a.closest("form").length?a.closest("form"):a.closest(".bookacti-form-fields");b.length&&(typeof bookacti_quantity_change_monitor!=="undefined"&&bookacti_quantity_change_monitor&&clearTimeout(bookacti_quantity_change_monitor),
bookacti_quantity_change_monitor=setTimeout(function(){var c=b.find(".bookacti-booking-system");c.length&&(bookacti_set_min_and_max_quantity(c,!1),bookacti_fill_picked_events_list(c));b.trigger("bookacti_booking_form_quantity_change",[a.val(),a])},1E3))});$j("body").on("bookacti_quantity_updated",".bookacti-booking-form input.bookacti-quantity, .bookacti-form-fields input.bookacti-quantity",function(a,b,c){a=$j(this).closest("form").length?$j(this).closest("form"):$j(this).closest(".bookacti-form-fields");
a.length&&a.trigger("bookacti_booking_form_quantity_change",[$j(this).val(),$j(this)])});$j("body").on("bookacti_booking_form_quantity_change","form, .bookacti-form-fields",function(a,b,c){a=$j(this).closest("form").length?$j(this).closest("form"):$j(this).closest(".bookacti-form-fields");a.length&&bookacti_refresh_total_price_field(a)});$j(".bookacti-form-field-type-total_price").length&&$j(".bookacti-form-field-type-total_price").each(function(){var a=$j(this).closest("form").length?$j(this).closest("form"):
$j(this).closest(".bookacti-form-fields");bookacti_refresh_total_price_field(a)})});
function bookacti_show_hide_register_fields(a){var b=a.find('input[name="login_type"]:checked').val(),c=a.find(".bookacti-password-strength"),d=a.find(".bookacti-forgotten-password"),f=a.find(".bookacti-login-field-password"),g=a.find(".bookacti-login-field-remember"),e=a.find(".bookacti-register-fields"),h=a.find(".bookacti-login-button");a=a.find(".bookacti-login-field-submit-button");b==="new_account"?(c.show(),d.hide(),f.hasClass("bookacti-generated-password")?(f.hide(),f.find('input[name="password"]').prop("required",
!1)):(f.show(),f.find('input[name="password"]').prop("required",!0)),g.show(),e.show(),e.find(".bookacti-required-field").prop("required",!0),h.val(h.data("register-label")).prop("disabled",!1),a.show()):b==="my_account"?(c.hide(),d.show(),f.show(),f.find('input[name="password"]').prop("required",!0),g.show(),e.hide(),e.find(".bookacti-required-field").prop("required",!1),h.val(h.data("login-label")).prop("disabled",!1),a.show()):b==="no_account"&&(f.hide(),f.find('input[name="password"]').prop("required",
!1),g.hide(),e.show(),e.find(".bookacti-required-field").prop("required",!0),h.prop("disabled",!0),a.hide())}
function bookacti_check_password_strength(a,b,c,d){if(typeof window.zxcvbn==="undefined"||typeof wp.passwordStrength==="undefined"||typeof pwsL10n==="undefined")return 4;var f=a.val();b=b!=null?b.val():f;d=typeof wp.passwordStrength.userInputDisallowedList==="function"?d.concat(wp.passwordStrength.userInputDisallowedList()):d.concat(wp.passwordStrength.userInputBlacklist());a.removeClass("short bad good strong");c.removeClass("short bad good strong");d=wp.passwordStrength.meter(f,d,b);switch(d){case 2:a.addClass("bad");
c.addClass("bad").html(pwsL10n.bad);break;case 3:a.addClass("good");c.addClass("good").html(pwsL10n.good);break;case 4:a.addClass("strong");c.addClass("strong").html(pwsL10n.strong);break;case 5:a.addClass("short");c.addClass("short").html(pwsL10n.mismatch);break;default:a.addClass("short"),c.addClass("short").html(pwsL10n["short"])}return d}
function bookacti_submit_login_form(a){if(a.closest(".bookacti-form-field-container").length&&a.closest(".bookacti-form-field-container").find(".bookacti-email").length){var b=a.closest(".bookacti-form-field-container");a.prop("disabled",!0);var c=a.closest("form").length;c||(b.closest(".bookacti-form-fields").length?b.closest(".bookacti-form-fields").wrap('<form class="bookacti-temporary-form"></form>'):b.wrap('<form class="bookacti-temporary-form"></form>'));var d=a.closest("form");d.find("> .bookacti-notices").length||
d.append('<div class="bookacti-notices"></div>');var f=d.find("> .bookacti-notices");f.empty();if(d.find('input[name="login_type"][value="new_account"]').is(":checked")&&!d.find(".bookacti-generated-password").length&&parseInt(d.find(".bookacti-password_strength").val())<parseInt(d.find(".bookacti-password_strength").attr("min")))f.append('<ul class="bookacti-error-list"><li>'+bookacti_localized.error_password_not_strong_enough+"</li></ul>").show(),a.prop("disabled",!1),bookacti_scroll_to(f,500,"middle");
else{var g={form_data:new FormData(d.get(0))};b.trigger("bookacti_before_submit_login_form",[g]);if(!(g.form_data instanceof FormData))return a.prop("disabled",!1),!1;g.form_data.set("action","bookactiSubmitLoginForm");g.form_data.set("current_url",window.location.href);bookacti_add_loading_html(a,"after");$j.ajax({url:bookacti_localized.ajaxurl,type:"POST",data:g.form_data,dataType:"json",cache:!1,contentType:!1,processData:!1,success:function(e){var h=e.message?e.message:e.messages?e.messages:"";
h&&(f.append('<ul class="'+(e.status==="success"?"bookacti-success-list":"bookacti-error-list")+'"><li>'+h+"</li></ul>").show(),bookacti_scroll_to(f,500,"middle"));e.status==="success"&&(h=typeof d.attr("action")!=="undefined"&&d.find('input[name="action"]').val()==="bookactiSubmitLoginForm"?d.attr("action"):window.location.href,g.redirect_url=e.redirect_url?e.redirect_url:h,d.trigger("bookacti_login_form_submitted",[e,g]),g.redirect_url&&(e=d.find(".bookacti-booking-system"),e.length?bookacti_redirect_booking_system_to_url(e,
g.redirect_url):window.location.assign(g.redirect_url)))},error:function(e){var h='<ul class="bookacti-error-list"><li>AJAX '+bookacti_localized.error+"</li></ul>";f.empty().append(h).show();bookacti_scroll_to(f,500,"middle");console.log("AJAX "+bookacti_localized.error);console.log(e)},complete:function(){bookacti_remove_loading_html(a.parent());a.prop("disabled",!1);c||b.unwrap("form.bookacti-temporary-form")}})}}}
function bookacti_submit_booking_form(a){var b=a.find(".bookacti-booking-system"),c=a.find('button[type="submit"], input[type="submit"]').first();c.length&&c.prop("disabled",!0);var d=a.find("> .bookacti-notices").length?a.find("> .bookacti-notices"):b.siblings(".bookacti-notices"),f=!1;typeof bookacti_localized.current_user_id!=="undefined"&&bookacti_localized.current_user_id&&(f=!0);var g=a.find(".bookacti-email").length?!0:!1;if(!f&&!g)return d.empty().append('<ul class="bookacti-error-list"><li>'+
bookacti_localized.error_user_not_logged_in+"</li></ul>").show(),c.length&&c.prop("disabled",!1),bookacti_scroll_to(d,500,"middle"),!1;if(g&&a.find('input[name="login_type"][value="new_account"]').is(":checked")&&!a.find(".bookacti-generated-password").length&&parseInt(a.find(".bookacti-password_strength").val())<parseInt(a.find(".bookacti-password_strength").attr("min")))return d.empty().append("<ul class='bookacti-error-list'><li>"+bookacti_localized.error_password_not_strong_enough+"</li></ul>").show(),
c.length&&c.prop("disabled",!1),bookacti_scroll_to(d,500,"middle"),!1;if(!bookacti_validate_picked_events(b,a.find(".bookacti-quantity").val()))return bookacti_scroll_to(b.siblings(".bookacti-notices"),500,"middle"),c.length&&c.prop("disabled",!1),!1;f={form_data:new FormData(a.get(0))};a.trigger("bookacti_before_submit_booking_form",[f]);if(!(f.form_data instanceof FormData))return c.length&&c.prop("disabled",!1),!1;f.form_data.set("action","bookactiSubmitBookingForm");f.form_data.set("current_url",
window.location.href);bookacti_start_loading_booking_system(b);c.length&&bookacti_add_loading_html(c,"after");$j.ajax({url:bookacti_localized.ajaxurl,type:"POST",data:f.form_data,dataType:"json",cache:!1,contentType:!1,processData:!1,success:function(e){var h=typeof e.redirect_url!=="undefined"?e.redirect_url:"";if(e.status!=="success")var k="<ul class='bookacti-error-list'><li>"+e.message+"</li></ul>";else a.find('.bookacti-form-field-container:not(.bookacti-form-field-name-submit):not(.bookacti-form-field-name-calendar), button[type="submit"], input[type="submit"]').hide(),
e.has_logged_in?a.find(".bookacti-new-booking-button").addClass("bookacti-reload-page"):a.find(".bookacti-new-booking-button").removeClass("bookacti-reload-page"),a.find(".bookacti-new-booking-button").show(),k="<ul class='bookacti-success-list bookacti-persistent-notice'><li>"+e.message+"</li></ul>",h.indexOf("://")<0&&bookacti_refresh_booking_numbers(b);k&&(d.empty().append(k).show(),e.status==="success"&&h||bookacti_scroll_to(d,500,"middle"));k=bookacti_serialize_object(a);a.trigger("bookacti_booking_form_submitted",
[e,k]);e.status==="success"&&h&&(bookacti_start_loading_booking_system(b),window.location.assign(h),bookacti_stop_loading_booking_system(b))},error:function(e){var h='<ul class="bookacti-error-list"><li>AJAX '+bookacti_localized.error+"</li></ul>";d.empty().append(h).show();bookacti_scroll_to(d,500,"middle");console.log("AJAX "+bookacti_localized.error);console.log(e)},complete:function(){c.length&&(bookacti_remove_loading_html(c.parent()),c.prop("disabled",!1));bookacti_stop_loading_booking_system(b)}})}
function bookacti_perform_form_action(a){var b={trigger:!0};a.closest("#bookacti-form-editor-page-form").length&&(b.trigger=!1);a.trigger("bookacti_trigger_perform_form_action",[b]);if(b.trigger&&(b=a.attr("id"),b=bookacti.booking_system[b],typeof b.form_action!=="undefined")){if(b.form_action==="default")!a.closest("form").length&&a.closest(".bookacti-form-fields").length&&a.closest(".bookacti-form-fields").wrap('<form class="bookacti-temporary-form"></form>'),(a.closest("form.bookacti-booking-form").length||
a.closest("form.bookacti-temporary-form").length)&&bookacti_submit_booking_form(a.closest("form"));else if(b.form_action==="redirect_to_url"){var c=a.closest(".bookacti-form-fields").length?a.closest(".bookacti-form-fields").find(".bookacti-quantity").length?a.closest(".bookacti-form-fields").find(".bookacti-quantity").val():1:1;if(!bookacti_validate_picked_events(a,c)){bookacti_scroll_to(a.siblings(".bookacti-notices"),500,"middle");return}c=parseInt(b.picked_events[0].group_id);b=b.picked_events[0];
c>0?bookacti_redirect_to_group_category_url(a,c):bookacti_redirect_to_activity_url(a,b)}a.trigger("bookacti_perform_form_action")}}
function bookacti_dialog_forgotten_password(a){var b=$j('.bookacti-forgotten-password-dialog[data-field-id="'+a+'"]');b.length||(b=$j(".bookacti-forgotten-password-dialog:first"));b.dialog("option","buttons",[{text:bookacti_localized.dialog_button_send,"class":"bookacti-dialog-send-button",click:function(){b.find(".bookacti-notices").remove();var c=b.find(".bookacti-forgotten-password-email").val();c&&(bookacti_add_loading_html(b),b.parent(".bookacti-dialog").find(".bookacti-dialog-send-button").prop("disabled",
!0),$j.ajax({url:bookacti_localized.ajaxurl,type:"POST",data:{action:"bookactiForgottenPassword",user_login:c},dataType:"json",success:function(d){if(d.status==="success")typeof d.message!=="undefined"&&b.append('<div class="bookacti-notices"><ul class="bookacti-success-list"><li>'+d.message+"</li></ul></div>"),b.parent(".bookacti-dialog").find(".bookacti-dialog-send-button").hide(),$j("body").trigger("bookacti_reset_password_notification_sent",[c,d]);else if(d.status==="failed"){var f=typeof d.message!==
"undefined"?d.message:bookacti_localized.error;b.append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+f+"</li></ul></div>");console.log(f);console.log(d)}},error:function(d){b.append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>AJAX '+bookacti_localized.error+"</li></ul></div>");console.log(d)},complete:function(){b.find(".bookacti-notices").show();bookacti_remove_loading_html(b);b.parent(".bookacti-dialog").find(".bookacti-dialog-send-button").prop("disabled",
!1)}}))}}]);b.parent(".bookacti-dialog").find(".bookacti-dialog-send-button").show();b.dialog("open")}
function bookacti_refresh_total_price_field(a){if(a.find(".bookacti-form-field-type-total_price").length&&a.attr("id")!=="bookacti-form-editor-page-form"){var b=a.attr("id"),c="bookacti_refresh_total_price_field_"+b;typeof window[c]!=="undefined"&&window[c]&&clearTimeout(window[c]);window[c]=setTimeout(function(){var d={form_data:new FormData(a.get(0))};a.trigger("bookacti_before_refresh_total_price_field",[d]);if(d.form_data instanceof FormData){d.form_data.set("action","bookactiGetTotalPriceField");
var f=a.find(".bookacti-form-field-type-total_price"),g="bookacti_ajax_refresh_total_price_field_"+b;window[g]=$j.ajax({url:bookacti_localized.ajaxurl,type:"POST",data:d.form_data,dataType:"json",cache:!1,contentType:!1,processData:!1,beforeSend:function(){window[g]!=null&&window[g].abort();a.find(".bookacti-total-price-table, .bookacti-grand-total-price-container").addClass("bookacti-hidden-field");bookacti_add_loading_html(f);f.show()},success:function(e){e.status==="success"&&(f.replaceWith(e.field_html),
$j.trim(a.find(".bookacti-total-price-table tbody").html())||$j.trim(a.find("span.bookacti-grand-total-price-container").html())||a.find(".bookacti-form-field-type-total_price").hide(),a.trigger("bookacti_total_price_field_refreshed",[e,d]))},error:function(e){e.statusText!="abort"&&(console.log("AJAX "+bookacti_localized.error),console.log(e))},complete:function(){bookacti_remove_loading_html(f);a.find(".bookacti-total-price-table, .bookacti-grand-total-price-container").removeClass("bookacti-hidden-field")}})}},
200)}};
