$j(document).ready(function(){$j("form#bookacti-settings.bookacti_save_settings_with_ajax").on("submit",function(b){b.preventDefault();if(tinyMCE){tinyMCE.triggerSave()}var a=$j(this);var c=a.serializeObject();$j.ajax({url:bookacti_localized.ajaxurl,type:"POST",data:c,dataType:"json",success:function(d){if(d.status!=="success"){console.log(bookacti_localized.error_update_settings);console.log(d)}else{if(a.attr("action")){window.location.replace(a.attr("action"))}else{window.location.reload(true)}}},error:function(d){console.log("AJAX "+bookacti_localized.error_update_settings);console.log(d)},complete:function(){}})});$j(".bookacti-archive-options").on("click","#bookacti-archive-button-analyse",function(){var a=$j("#bookacti-archive-date").val();if(!a){return}var c=confirm(bookacti_localized.advice_archive_data.replace("{date}",a).replace(/\\n/g,"\n"));if(c!=true){return}$j(".bookacti-archive-feedbacks-step").empty();$j(".bookacti-archive-feedbacks-step-container").hide();$j("#bookacti-archive-feedbacks-step1-container").show();var b=$j("#nonce_archive_data").val();var d=$j("#bookacti-archive-feedbacks-step1");bookacti_archive_analyse(a,b,d,bookacti_display_archive_step2)});$j(".bookacti-archive-options").on("click","#bookacti-archive-button-dump",function(){var c=$j("#bookacti-archive-button-dump").data("file-already-exists");var d=true;if(typeof c!=="undefined"){if(c){d=confirm(bookacti_localized.advice_archive_data_override.replace(/\\n/g,"\n"))}}if(d!=true){return}var a=$j(this).data("date");if(!a){return}$j(".bookacti-archive-feedbacks-step:not(#bookacti-archive-feedbacks-step1)").empty();$j(".bookacti-archive-feedbacks-step-container:not(#bookacti-archive-feedbacks-step1-container)").hide();$j("#bookacti-archive-feedbacks-step2-container").show();var b=$j("#nonce_archive_data").val();var e=$j("#bookacti-archive-feedbacks-step2");bookacti_archive_dump(a,b,e,bookacti_display_archive_step3)});$j(".bookacti-archive-options").on("click","#bookacti-archive-button-delete",function(){var a=$j(this).data("date");if(!a){return}$j("#bookacti-archive-feedbacks-step3").empty();$j("#bookacti-archive-feedbacks-step3-container").show();var b=$j("#nonce_archive_data").val();var c=$j("#bookacti-archive-feedbacks-step3");bookacti_archive_delete(a,b,c,null)});$j(".bookacti-archive-options").on("click",".bookacti-archive-restore-data a",function(){var a=$j(this).data("filename");if(!file){return}var d=confirm(bookacti_localized.advice_archive_restore_data.replace("{filename}",a).replace(/\\n/g,"\n"));if(d!=true){return}$j("#bookacti-archive-feedbacks-restore-data").empty();$j("#bookacti-archive-feedbacks-restore-data-container").show();var c=$j("#nonce_archive_data").val();var b=$j("#bookacti-archive-feedbacks-restore-data");bookacti_archive_restore_data(a,c,b)});$j(".bookacti-archive-options").on("click",".bookacti-show-archive-ids",function(){$j(this).toggleClass("dashicons-visibility dashicons-hidden");$j(this).siblings(".bookacti-archive-ids").toggle()})});function bookacti_archive_analyse(b,c,a,e){a.find(".bookacti-notices").remove();a.find(".bookacti-loading-alt").remove();var d='<div class="bookacti-loading-alt"><img class="bookacti-loader" src="'+bookacti_localized.plugin_path+'/img/ajax-loader.gif" title="'+bookacti_localized.loading+'" /><span class="bookacti-loading-alt-text" >'+bookacti_localized.loading+"</span></div>";a.append(d);$j.ajax({url:bookacti_localized.ajaxurl,type:"POST",data:{action:"bookactiArchiveDataAnalyse",date:b,nonce:c},dataType:"json",success:function(f){if(f.status==="success"){var g="<ul>";$j.each(f.ids_per_type,function(i,h){g+="<li>"+i+": "+h.length+' <span class="bookacti-show-archive-ids dashicons dashicons-visibility"></span><div class="bookacti-archive-ids"><code>'+h.join(", ")+"</code></div></li>"});g+="</ul>";a.append('<div class="bookacti-archive-results">'+f.message+g+"</div>");if($j.isFunction(e)){e(b,f.file_already_exists)}}else{if(f.status==="failed"){a.append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+f.message+"</li></ul></div>");console.log(f)}}},error:function(f){console.log("AJAX error occured while trying to archive data");console.log(f)},complete:function(){a.find(".bookacti-notices").show();a.find(".bookacti-loading-alt").remove()}})}function bookacti_archive_dump(b,c,a,e){a.find(".bookacti-notices").remove();a.find(".bookacti-loading-alt").remove();var d='<div class="bookacti-loading-alt"><img class="bookacti-loader" src="'+bookacti_localized.plugin_path+'/img/ajax-loader.gif" title="'+bookacti_localized.loading+'" /><span class="bookacti-loading-alt-text" >'+bookacti_localized.loading+"</span></div>";a.append(d);$j.ajax({url:bookacti_localized.ajaxurl,type:"POST",data:{action:"bookactiArchiveDataDump",date:b,nonce:c},dataType:"json",success:function(f){if(f.status==="success"){$j("#bookacti-database-archives-options").replaceWith(f.archive_list);a.append('<div class="bookacti-archive-dump-results">'+f.message+"</div>");if($j.isFunction(e)){e(b)}}else{if(f.status==="failed"){a.append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+f.message+"</li></ul></div>");console.log(f)}}},error:function(f){console.log("AJAX error occured while trying to archive data");console.log(f)},complete:function(){a.find(".bookacti-notices").show();a.find(".bookacti-loading-alt").remove()}})}function bookacti_archive_delete(b,c,a,e){a.find(".bookacti-notices").remove();a.find(".bookacti-loading-alt").remove();var d='<div class="bookacti-loading-alt"><img class="bookacti-loader" src="'+bookacti_localized.plugin_path+'/img/ajax-loader.gif" title="'+bookacti_localized.loading+'" /><span class="bookacti-loading-alt-text" >'+bookacti_localized.loading+"</span></div>";a.append(d);$j.ajax({url:bookacti_localized.ajaxurl,type:"POST",data:{action:"bookactiArchiveDataDelete",date:b,nonce:c},dataType:"json",success:function(f){if(f.status==="success"){var g="<ul>";$j.each(f.nb_per_type,function(i,h){g+="<li>"+i+": "+h+"</li>"});g+="</ul>";a.append('<div class="bookacti-archive-results">'+f.message+g+"</div>");if($j.isFunction(e)){e(b)}}else{if(f.status==="failed"){a.append('<div class="bookacti-notices"><ul class="bookacti-error-list"><li>'+f.message+"</li></ul></div>");console.log(f)}}},error:function(f){console.log("AJAX error occured while trying to archive data");console.log(f)},complete:function(){a.find(".bookacti-notices").show();a.find(".bookacti-loading-alt").remove()}})}function bookacti_display_archive_step2(a,b){$j("#bookacti-archive-feedbacks-step2-container").show();$j("#bookacti-archive-button-dump").attr("data-date",a).data("date",a);$j("#bookacti-archive-button-dump").attr("data-file-already-exists",b).data("file-already-exists",b)}function bookacti_display_archive_step3(a){$j("#bookacti-archive-feedbacks-step3-container").show();$j("#bookacti-archive-button-delete").attr("data-date",a).data("date",a)};