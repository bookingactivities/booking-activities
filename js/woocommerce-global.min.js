$j(document).ready(function(){$j("body").on("bookacti_perform_form_action",".bookacti-booking-system",function(){var a=$j(this);bookacti_wc_perform_form_action(a)})});function bookacti_wc_perform_form_action(a){var g=a.attr("id");var d=bookacti.booking_system[g];var e=d.form_action;if($j.inArray(e,["default","redirect_to_product_page","add_product_to_cart"])===-1){return}if(e==="default"&&a.closest("form.cart").length){if(a.closest("form.cart").find(".single_add_to_cart_button").length){a.closest("form.cart").find(".single_add_to_cart_button").trigger("click")}return}var c=a.closest(".bookacti-form-fields").length?(a.closest(".bookacti-form-fields").find(".bookacti-quantity").length?parseInt(a.closest(".bookacti-form-fields").find(".bookacti-quantity").val()):1):1;var h=a.closest("form.cart").length?(a.closest("form.cart").find('input[name="quantity"]').length?parseInt(a.closest("form.cart").find('input[name="quantity"]').val()):1):1;var i=bookacti_validate_picked_events(a,Math.max(c,h));if(!i){bookacti_scroll_to(a.siblings(".bookacti-notices"),500,"middle");return}var f=parseInt(d.picked_events[0]["group_id"]);var b=d.picked_events[0];if(e==="redirect_to_product_page"){if(f>0){bookacti_redirect_to_group_category_product_page(a,f)}else{bookacti_redirect_to_activity_product_page(a,b.id)}}else{if(e==="add_product_to_cart"){bookacti_add_product_to_cart_via_booking_system(a)}}}function bookacti_redirect_to_activity_product_page(c,g){var b=c.attr("id");var d=bookacti.booking_system[b];if(typeof d.events_data[g]==="undefined"){return}var f=d.events_data[g]["activity_id"];if(typeof d.product_by_activity==="undefined"){return}if(typeof d.product_by_activity[f]==="undefined"){return}var e=d.product_by_activity[f];if(typeof d.products_page_url==="undefined"){return}if(typeof d.products_page_url[e]==="undefined"){return}var a=d.products_page_url[e];bookacti_redirect_booking_system_to_url(c,a)}function bookacti_redirect_to_group_category_product_page(c,g){var b=c.attr("id");var d=bookacti.booking_system[b];if(typeof d.groups_data[g]==="undefined"){return}var f=d.groups_data[g]["category_id"];if(typeof d.product_by_group_category==="undefined"){return}if(typeof d.product_by_group_category[f]==="undefined"){return}var e=d.product_by_group_category[f];if(typeof d.products_page_url==="undefined"){return}if(typeof d.products_page_url[e]==="undefined"){return}var a=d.products_page_url[e];bookacti_redirect_booking_system_to_url(c,a)}function bookacti_add_product_to_cart_via_booking_system(a){var d=a.closest("form").length;if(!d){a.closest(".bookacti-form-fields").wrap('<form class="bookacti-temporary-form"></form>')}var b=a.closest("form");var c=b.find('input[type="submit"]').length?b.find('input[type="submit"]'):null;if(c.length){c.prop("disabled",true)}var i=b.find("> .bookacti-notices").length?b.find("> .bookacti-notices"):a.siblings(".bookacti-notices");i.empty();var h=b.find('input[name="action"]').length;var g=h?b.find('input[name="action"]').val():"";if(h){b.find('input[name="action"]').val("bookactiAddBoundProductToCart")}else{b.append('<input type="hidden" name="action" value="bookactiAddBoundProductToCart"/>')}var f={form_data:new FormData(b.get(0))};a.trigger("bookacti_before_add_product_to_cart",[f]);if(h){b.find('input[name="action"]').val(g)}else{b.find('input[name="action"]').remove()}if(!d){a.closest(".bookacti-form-fields").unwrap("form.bookacti-temporary-form")}if(!(f.form_data instanceof FormData)){if(c.length){c.prop("disabled",false)}return false}if(c.length){var e='<div class="bookacti-loading-alt"><img class="bookacti-loader" src="'+bookacti_localized.plugin_path+'/img/ajax-loader.gif" title="'+bookacti_localized.loading+'" /><span class="bookacti-loading-alt-text" >'+bookacti_localized.loading+"</span></div>";c.after(e)}bookacti_start_loading_booking_system(a);$j.ajax({url:bookacti_localized.ajaxurl,type:"POST",data:f.form_data,dataType:"json",cache:false,contentType:false,processData:false,success:function(k){var j=typeof k.redirect_url!=="undefined"?k.redirect_url:"";if(k.status==="success"){if(j.indexOf("://")<0){bookacti_refresh_booking_numbers(a)}a.trigger("bookacti_product_added_to_cart",[k,f]);if(j){bookacti_start_loading_booking_system(a);window.location.replace(j);bookacti_stop_loading_booking_system(a)}}else{console.log(k)}if(k.messages){var m=k.status==="success"?"bookacti-success-list woocommerce":"bookacti-error-list";var l='<ul class="'+m+'"><li>'+k.messages+"</li></ul>";i.empty().append(l).show();if(!j){bookacti_scroll_to(i,500,"middle")}}},error:function(k){var j='<ul class="bookacti-error-list"><li>AJAX error occurred while trying to add the product to cart</li></ul>';i.empty().append(j).show();bookacti_scroll_to(i,500,"middle");console.log("AJAX error occurred while trying to add the product to cart");console.log(k)},complete:function(){if(c.length){c.next(".bookacti-loading-alt").remove();c.prop("disabled",false)}bookacti_stop_loading_booking_system(a)}})};