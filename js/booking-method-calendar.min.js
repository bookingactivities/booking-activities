$j(document).ready(function(){$j("body").on("bookacti_booking_method_set_up",".bookacti-booking-system",function(a,d,c){"calendar"===d&&$j(this).find(".bookacti-calendar").length&&bookacti_set_calendar_up($j(this),c)});$j("body").on("bookacti_booking_method_display_events",".bookacti-booking-system",function(a,d,c){"calendar"===d&&$j(this).find(".bookacti-calendar").length&&bookacti_fc_add_events($j(this),c)});$j("body").on("bookacti_refetch_events",".bookacti-booking-system",function(a,d){"calendar"===
d&&(a=$j(this).attr("id"),"undefined"!==typeof bookacti.fc_calendar[a]&&bookacti.fc_calendar[a].removeAllEvents(),bookacti_get_booking_system_data_by_interval($j(this)))});$j("body").on("bookacti_rerender_events",".bookacti-booking-system",function(a,d){"calendar"===d&&(a=$j(this).attr("id"),"undefined"!==typeof bookacti.fc_calendar[a]&&bookacti.fc_calendar[a].render())});$j("body").on("bookacti_clear_events",".bookacti-booking-system",function(a,d){"calendar"===d&&(a=$j(this).attr("id"),"undefined"!==
typeof bookacti.fc_calendar[a]&&bookacti.fc_calendar[a].removeAllEvents())});$j("body").on("bookacti_booking_system_reloaded",".bookacti-booking-system",function(a,d){$j(this).find(".bookacti-calendar").length&&bookacti_refresh_picked_events_on_calendar($j(this))});$j("body").on("bookacti_start_loading",".bookacti-booking-system, .bookacti-booking-system-editor",function(a,d){"calendar"===d&&(a=$j(this),a.find(".bookacti-calendar.fc").length?(d=a.attr("id"),0!==bookacti.booking_system[d].loading_number&&
a.find(".bookacti-loading-overlay").length||(bookacti_remove_loading_html(a),bookacti_enter_calendar_loading_state(a.find(".bookacti-calendar")))):a.find(".bookacti-loading-container").length||bookacti_add_loading_html(a))});$j("body").on("bookacti_exit_loading_state",".bookacti-booking-system, .bookacti-booking-system-editor",function(a,d){"calendar"===d&&(bookacti_remove_loading_html($j(this)),$j(this).find(".bookacti-calendar").length&&bookacti_exit_calendar_loading_state($j(this).find(".bookacti-calendar")))});
$j("body").on("change",".bookacti-go-to-datepicker",function(){var a=$j(this).prev(".fc-goTo-button");a.find(".bookacti-spinner").length||a.append('<span class="bookacti-spinner"></span>');"undefined"!==typeof bookacti_go_to_date&&bookacti_go_to_date&&clearTimeout(bookacti_go_to_date);var d=$j(this).val(),c=$j(this).closest(".bookacti-booking-system").length?$j(this).closest(".bookacti-booking-system").attr("id"):"bookacti-template-calendar";d&&"undefined"!==typeof bookacti.fc_calendar[c]&&10===d.length&&
/^\d{4}-(0[1-9]|1[0-2])-(0[1-9]|[12]\d|3[01])$/.test(d)&&(bookacti_go_to_date=setTimeout(function(){bookacti.fc_calendar[c].gotoDate(d);a.find(".bookacti-spinner").remove()},750))});$j("body").on("click",".bookacti-booking-system .bookacti-calendar .fc-more",function(){bookacti_refresh_picked_events_on_calendar(booking_system)});$j("body").on("touchstart touchmove touchend touchcancel",".bookacti-booking-system .bookacti-calendar .fc-event",function(a){var d={touchstart:"bookacti_calendar_event_touch_start",
touchmove:"bookacti_calendar_event_touch_move",touchend:"bookacti_calendar_event_touch_end",touchcancel:"bookacti_calendar_event_touch_cancel"};if("undefined"!==typeof d[a.type]){var c=$j(this).closest(".bookacti-booking-system"),f=$j(this),h={id:parseInt(f.data("event-id")),start:moment.utc(f.data("event-start")),end:moment.utc(f.data("event-end"))};c.trigger(d[a.type],[{event:h,el:f,jsEvent:a}])}});$j("body").on("bookacti_pick_event",".bookacti-booking-system, #bookacti-template-calendar",function(a,
d,c,f){$j(this).find(".bookacti-calendar").length&&bookacti_refresh_picked_events_on_calendar($j(this))});$j("body").on("bookacti_unpick_all_events",".bookacti-booking-system",function(){$j(this).find(".bookacti-calendar").length&&bookacti_unpick_all_events_on_calendar($j(this))})});
function bookacti_set_calendar_up(a,d){d=d?1:0;var c=a.attr("id");bookacti.booking_system[c].load_events=!1;var f=bookacti_get_availability_period(a),h="undefined"!==typeof bookacti.booking_system[c].display_data?bookacti.booking_system[c].display_data:{},l="undefined"!==typeof bookacti_localized.event_tiny_height?parseInt(bookacti_localized.event_tiny_height):32,r="undefined"!==typeof h.slotMinTime?h.slotMinTime:"00:00";h="undefined"!==typeof h.slotMaxTime?h.slotMaxTime:"24:00";var t=moment.utc("1992-12-26 "+
r).add(1,"minutes").format("HH:mm");f={locale:bookacti_localized.fullcalendar_locale,timeZone:bookacti_localized.fullcalendar_timezone,now:new Date(bookacti_localized.current_time.substr(0,10)),initialView:a.find(".bookacti-calendar:first").width()<bookacti_localized.initial_view_threshold?"timeGridDay":"timeGridWeek",allDaySlot:!1,defaultAllDay:!1,fixedWeekCount:!1,height:"auto",contentHeight:"auto",editable:!1,droppable:!1,eventDurationEditable:!1,showNonCurrentDates:!1,dayMaxEvents:!1,moreLinkClick:"popover",
eventDisplay:"block",dragRevertDuration:0,eventShortHeight:0,slotDuration:"00:30",slotEventOverlap:!1,eventMinHeight:l,nextDayThreshold:t,slotMinTime:r,slotMaxTime:h,validRange:{start:f.start?moment.utc(f.start.substr(0,10)).format("YYYY-MM-DD"):null,end:f.end?moment.utc(f.end.substr(0,10)).add(1,"days").format("YYYY-MM-DD"):null},headerToolbar:{start:"prev,next today",center:"title",end:"dayGridMonth,timeGridWeek,timeGridDay"},events:function(b,e,g){e([])},viewClassNames:function(b){var e={class_names:[]};
a.find(".fc-today-button").length&&!a.find(".fc-day-today").length&&(moment().isBetween(b.view.currentStart,b.view.currentEnd,"day","[)")||a.find(".fc-today-button").attr("disabled",!1));a.trigger("bookacti_calendar_view_class_names",[e,b]);return e.class_names},dayHeaderClassNames:function(b){var e={class_names:[]};if("undefined"!==typeof bookacti.booking_system[c].days_off){var g=bookacti.booking_system[c].days_off,q=moment.utc(b.date);$j.each(g,function(n,m){n=moment.utc(m.from+" 00:00:00");m=
moment.utc(m.to+" 23:59:59");if(q.isBetween(n,m,"second","[]"))return e.class_names.push("fc-day-disabled"),!1})}a.trigger("bookacti_calendar_day_header_class_names",[e,b]);return e.class_names},dayCellClassNames:function(b){var e={class_names:[]};if("undefined"!==typeof bookacti.booking_system[c].days_off){var g=bookacti.booking_system[c].days_off,q=moment.utc(b.date);$j.each(g,function(n,m){n=moment.utc(m.from+" 00:00:00");m=moment.utc(m.to+" 23:59:59");if(q.isBetween(n,m,"second","[]"))return e.class_names.push("fc-day-disabled"),
!1})}a.trigger("bookacti_calendar_day_cell_class_names",[e,b]);return e.class_names},datesSet:function(b){if(!0===bookacti.booking_system[c].load_events){var e={start:moment.utc(moment.utc(b.view.currentStart).clone().locale("en").format("YYYY-MM-DD")+" 00:00:00"),end:moment.utc(moment.utc(b.view.currentEnd).clone().subtract(1,"days").locale("en").format("YYYY-MM-DD")+" 23:59:59")};e=bookacti_get_interval_of_events(a,e);$j.isEmptyObject(e)||bookacti_get_booking_system_data_by_interval(a,e)}a.trigger("bookacti_calendar_view_render",
[b])},eventDidMount:function(b){if(!b.isMirror&&"undefined"!==typeof b.event){var e="undefined"!==typeof b.event.groupId?parseInt(b.event.groupId):parseInt(b.event.id);if("undefined"!==typeof bookacti.booking_system[c].events_data[e]){var g=moment.utc(b.event.start).clone().locale("en").format("YYYY-MM-DD HH:mm:ss"),q=moment.utc(b.event.end).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");$j(b.el).data("event-id",e);$j(b.el).attr("data-event-id",e);$j(b.el).data("event-start",g);$j(b.el).attr("data-event-start",
g);$j(b.el).data("event-end",q);$j(b.el).attr("data-event-end",q);e=bookacti.booking_system[c].events_data[e];"undefined"!==typeof e.activity_id&&($j(b.el).data("activity-id",e.activity_id),$j(b.el).attr("data-activity-id",e.activity_id));a.trigger("bookacti_calendar_event_did_mount",[b])}}},eventClassNames:function(b){var e={class_names:[]};if("undefined"===typeof b.event)return e.class_names;var g="undefined"!==typeof b.event.groupId?parseInt(b.event.groupId):parseInt(b.event.id);if("undefined"===
typeof bookacti.booking_system[c].events_data[g]||b.isMirror||"none"===b.event.display)return e.class_names;var q=moment.utc(b.event.start).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");$j.each(bookacti.booking_system[c].picked_events,function(m,u){m=moment.utc(u.start).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");u.id==g&&q===m&&e.class_names.push("bookacti-picked-event")});var n=moment.utc(b.event.start).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");"undefined"!==typeof bookacti.booking_system[c].bookings[g]&&
"undefined"!==typeof bookacti.booking_system[c].bookings[g][n]&&parseInt(bookacti.booking_system[c].bookings[g][n].current_user_bookings)&&e.class_names.push("bookacti-event-booked-by-current-user");1!=bookacti.booking_system[c].bookings_only&&(bookacti_is_event_available(a,b.event)||e.class_names.push("bookacti-event-unavailable"));if(-1<b.view.type.indexOf("dayGrid")||-1<b.view.type.indexOf("timeGrid"))n=bookacti_fc_get_event_size_classes(a,b.event,b.view),n.length&&(e.class_names=$j.merge(e.class_names,
n));a.trigger("bookacti_calendar_event_class_names",[e,b]);return e.class_names},eventContent:function(b){var e={domNodes:[]};if("undefined"===typeof b.event)return e;var g="undefined"!==typeof b.event.groupId?parseInt(b.event.groupId):parseInt(b.event.id);if("undefined"===typeof bookacti.booking_system[c].events_data[g]||"none"===b.event.display)return e;g="LT";-1<b.view.type.indexOf("timeGrid")&&(g=moment.localeData().longDateFormat("LT").replace(/[aA]/g,""));"wp_settings"===bookacti_localized.calendar_localization&&
(g=bookacti_convert_php_datetime_format_to_moment_js(bookacti_localized.wp_time_format));g=$j("<div></div>",{"class":"fc-event-time",html:'<span class="bookacti-event-time-start">'+moment.utc(b.event.start).format(g)+'</span><span class="bookacti-event-time-separator"> - </span><span class="bookacti-event-time-end">'+moment.utc(b.event.end).format(g)+"</span>"});e.domNodes.push(g[0]);g=$j("<div></div>",{"class":"fc-event-title-container",html:'<div class="fc-event-title">'+b.event.title+"</div>"});
e.domNodes.push(g[0]);(g=1==bookacti.booking_system[c].bookings_only?bookacti_get_event_number_of_bookings_div(a,b.event):bookacti_get_event_availability_div(a,b.event))&&e.domNodes.push(g[0]);a.trigger("bookacti_calendar_event_content",[e,b]);return e},eventClick:function(b){var e={click:!0};$j(b.el).hasClass("bookacti-event-unavailable")&&(e.click=!1);a.trigger("bookacti_trigger_event_click",[e,b]);e.click&&bookacti_event_click(a,b.event)},eventMouseEnter:function(b){bookacti.is_touch_device||a.trigger("bookacti_calendar_event_mouse_enter",
[b])},eventMouseLeave:function(b){bookacti.is_touch_device||a.trigger("bookacti_calendar_event_mouse_leave",[b])}};"wp_settings"===bookacti_localized.calendar_localization&&(l=bookacti_convert_php_datetime_format_to_fc_date_formatting_object(bookacti_localized.wp_time_format),f.firstDay=bookacti_localized.wp_start_of_week,f.slotLabelFormat=l,f.eventTimeFormat=l);a.trigger("bookacti_calendar_init_data",[f]);bookacti.fc_calendar[c]=new FullCalendar.Calendar(a.find(".bookacti-calendar:first")[0],f);
bookacti.fc_calendar[c].render();f=bookacti.fc_calendar[c].view;f={start:moment.utc(moment.utc(f.currentStart).clone().locale("en").format("YYYY-MM-DD")+" 00:00:00"),end:moment.utc(moment.utc(f.currentEnd).clone().subtract(1,"days").locale("en").format("YYYY-MM-DD")+" 23:59:59")};l=!1;if("undefined"!==typeof bookacti.booking_system[c].events_interval){r=moment.utc(bookacti.booking_system[c].events_interval.start);h=moment.utc(bookacti.booking_system[c].events_interval.end);t=bookacti.booking_system[c].past_events;
var p=moment.utc(bookacti_localized.current_time.substr(0,10));if((t||r.isAfter(p))&&r.isAfter(f.start)||h.isBefore(f.end))l=!0}d&&!l||"undefined"===typeof bookacti.booking_system[c].events||bookacti_fc_add_events(a,bookacti.booking_system[c].events);if(d||l)d=bookacti_get_interval_of_events(a,f),$j.isEmptyObject(d)||bookacti_get_booking_system_data_by_interval(a,d);bookacti.booking_system[c].load_events=!0;d=bookacti.booking_system[c].picked_events;$j.isEmptyObject(bookacti.booking_system[c].picked_events)||
bookacti.fc_calendar[c].gotoDate(d[0].start);d=bookacti_localized.calendar_width_classes;var k=a.find(".bookacti-calendar:first").width();$j.each(d,function(b,e){if(k<=b)return a.find(".bookacti-calendar:first").addClass(e),!1});a.trigger("bookacti_calendar_after_set_up")}function bookacti_fc_get_events_by_groupId(a,d){a=a.attr("id");return $j.grep(bookacti.fc_calendar[a].getEvents(),function(c){return c.groupId==d})}
function bookacti_fc_add_events(a,d){if(d.length){var c=[];$j.each(d,function(h,l){h=$j.extend(!0,{},l);h.groupId=parseInt(l.id);h.id=l.id+"_"+l.start;c.push(h)});d=a.attr("id");var f={events:c,editable:"bookacti-template-calendar"===d};a.trigger("bookacti_fc_events",[f]);bookacti.fc_calendar[d].addEventSource(f)}}
function bookacti_refresh_picked_events_on_calendar(a){var d=a.attr("id");d=bookacti.booking_system[d].picked_events;bookacti_unpick_all_events_on_calendar(a);d&&$j.each(d,function(c,f){c=moment.utc(f.start).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");a.find('.fc-event[data-event-id="'+f.id+'"][data-event-start="'+c+'"]').addClass("bookacti-picked-event")});a.trigger("bookacti_refresh_picked_events_on_calendar")}
function bookacti_unpick_all_events_on_calendar(a){a.find(".bookacti-picked-event").removeClass("bookacti-picked-event");a.trigger("bookacti_unpick_all_events_on_calendar")}
function bookacti_fc_get_event_size_classes(a,d,c){var f=[];if(0>c.type.indexOf("timeGrid")&&0>c.type.indexOf("dayGrid"))return f;var h="undefined"!==typeof bookacti_localized.event_tiny_height?parseInt(bookacti_localized.event_tiny_height):32,l="undefined"!==typeof bookacti_localized.event_small_height?parseInt(bookacti_localized.event_small_height):75,r="undefined"!==typeof bookacti_localized.event_narrow_width?parseInt(bookacti_localized.event_narrow_width):70,t="undefined"!==typeof bookacti_localized.event_wide_width?
parseInt(bookacti_localized.event_wide_width):250;if(-1<c.type.indexOf("timeGrid")){var p=a.attr("id");c=bookacti.fc_calendar[p].getOption("eventMinHeight");p=bookacti.fc_calendar[p].getOption("slotDuration");"undefined"===typeof c&&(c=0);"undefined"===typeof p&&(p="00:30");p=60*parseInt(p.substr(0,2))+parseInt(p.substr(-2));d=parseInt(moment.duration(moment.utc(d.end).diff(moment.utc(d.start))).asMinutes());var k=a.find(".fc-timegrid-slot").length?a.find(".fc-timegrid-slot").outerHeight():0;k||(k=
a.css("line-height").replace("px",""),k=$j.isNumeric(k)?parseFloat(k):0,k||(k=a.css("font-size").replace("px",""),k=$j.isNumeric(k)?1.5*parseFloat(k):0),k=k?k:20);c=Math.max(parseInt(c),k/p*d);c<=h?f.push("bookacti-tiny-event"):c<=l&&f.push("bookacti-small-event")}a=a.find(".fc-col-header-cell.fc-day").innerWidth();a=a-.025*a-2;a>=t?f.push("bookacti-wide-event"):a<=r&&f.push("bookacti-narrow-event");return f}
function bookacti_enter_calendar_loading_state(a){a.find(".fc-toolbar button:disabled").addClass("bookacti-was-disabled");a.find(".fc-toolbar button").attr("disabled",!0);a.find(".fc-view-harness").append('<div class="bookacti-loading-overlay"><div class="bookacti-loading-overlay-content">'+bookacti_get_loading_html()+"</div></div>")}
function bookacti_exit_calendar_loading_state(a){a.find(".fc-toolbar button:not(.bookacti-was-disabled)").attr("disabled",!1);a.find(".fc-toolbar button.bookacti-was-disabled").removeClass("bookacti-was-disabled");a.find(".bookacti-loading-overlay").remove()};
