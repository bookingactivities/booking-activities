$j(document).ready(function(){$j("body").on("bookacti_booking_method_set_up",".bookacti-booking-system",function(b,a,c){if(a==="calendar"&&$j(this).find(".bookacti-calendar").length){bookacti_set_calendar_up($j(this),c)}});$j("body").on("bookacti_booking_method_display_events",".bookacti-booking-system",function(c,b,a){if(b==="calendar"&&$j(this).find(".bookacti-calendar").length){bookacti_fc_add_events($j(this),a)}});$j("body").on("bookacti_refetch_events",".bookacti-booking-system",function(c,b){if(b==="calendar"){var a=$j(this).attr("id");if(typeof bookacti.fc_calendar[a]!=="undefined"){bookacti.fc_calendar[a].removeAllEvents()}bookacti_get_booking_system_data_by_interval($j(this))}});$j("body").on("bookacti_rerender_events",".bookacti-booking-system",function(c,b){if(b==="calendar"){var a=$j(this).attr("id");if(typeof bookacti.fc_calendar[a]!=="undefined"){bookacti.fc_calendar[a].render()}}});$j("body").on("bookacti_clear_events",".bookacti-booking-system",function(c,b){if(b==="calendar"){var a=$j(this).attr("id");if(typeof bookacti.fc_calendar[a]!=="undefined"){bookacti.fc_calendar[a].removeAllEvents()}}});$j("body").on("bookacti_booking_system_reloaded",".bookacti-booking-system",function(b,a){if($j(this).find(".bookacti-calendar").length){bookacti_refresh_picked_events_on_calendar($j(this))}});$j("body").on("bookacti_start_loading",".bookacti-booking-system, .bookacti-booking-system-editor",function(d,c){if(c==="calendar"){var b=$j(this);if(b.find(".bookacti-calendar.fc").length){var a=b.attr("id");if(bookacti.booking_system[a]["loading_number"]===0||!b.find(".bookacti-loading-overlay").length){bookacti_remove_loading_html(b);bookacti_enter_calendar_loading_state(b.find(".bookacti-calendar"))}}else{if(!b.find(".bookacti-loading-container").length){bookacti_add_loading_html(b)}}}});$j("body").on("bookacti_exit_loading_state",".bookacti-booking-system, .bookacti-booking-system-editor",function(b,a){if(a==="calendar"){bookacti_remove_loading_html($j(this));if($j(this).find(".bookacti-calendar").length){bookacti_exit_calendar_loading_state($j(this).find(".bookacti-calendar"))}}});$j("body").on("change",".bookacti-go-to-datepicker",function(){var b=$j(this).val();var a=$j(this).closest(".bookacti-booking-system").length?$j(this).closest(".bookacti-booking-system").attr("id"):"bookacti-template-calendar";if(!b||typeof bookacti.fc_calendar[a]==="undefined"){return}if(parseInt(b.substr(0,4))<1970){return}bookacti.fc_calendar[a].gotoDate(b)});$j("body").on("click",".bookacti-booking-system .bookacti-calendar .fc-more",function(){bookacti_refresh_picked_events_on_calendar(booking_system)});$j("body").on("touchstart",".bookacti-booking-system .bookacti-calendar .fc-event, .bookacti-booking-system .bookacti-calendar .fc-list-event",function(d){var a=$j(this).closest(".bookacti-booking-system");var b=$j(this);var c={id:parseInt(b.data("event-id")),start:moment.utc(b.data("event-start")),end:moment.utc(b.data("event-end"))};a.trigger("bookacti_calendar_event_touch_start",[{event:c,el:b,jsEvent:d}])});$j("body").on("touchend",".bookacti-booking-system .bookacti-calendar .fc-event, .bookacti-booking-system .bookacti-calendar .fc-list-event",function(d){var a=$j(this).closest(".bookacti-booking-system");var b=$j(this);var c={id:parseInt(b.data("event-id")),start:moment.utc(b.data("event-start")),end:moment.utc(b.data("event-end"))};a.trigger("bookacti_calendar_event_touch_end",[{event:c,el:b,jsEvent:d}])});$j("body").on("bookacti_pick_event",".bookacti-booking-system, #bookacti-template-calendar",function(c,b,a,d){if(!$j(this).find(".bookacti-calendar").length){return}bookacti_refresh_picked_events_on_calendar($j(this))});$j("body").on("bookacti_unpick_all_events",".bookacti-booking-system",function(){if(!$j(this).find(".bookacti-calendar").length){return}bookacti_unpick_all_events_on_calendar($j(this))})});function bookacti_set_calendar_up(b,o){o=o?1:0;var q=b.attr("id");bookacti.booking_system[q]["load_events"]=false;var f=bookacti_get_availability_period(b);var e=typeof bookacti.booking_system[q]["display_data"]!=="undefined"?bookacti.booking_system[q]["display_data"]:{};var j=typeof bookacti_localized.event_tiny_height!=="undefined"?parseInt(bookacti_localized.event_tiny_height):32;var i=typeof e.slotMinTime!=="undefined"?e.slotMinTime:"00:00";var c=typeof e.slotMaxTime!=="undefined"?e.slotMaxTime:"24:00";var h={locale:bookacti_localized.fullcalendar_locale,timeZone:bookacti_localized.fullcalendar_timezone,initialView:b.find(".bookacti-calendar:first").width()<bookacti_localized.initial_view_threshold?"timeGridDay":"timeGridWeek",allDaySlot:false,defaultAllDay:false,fixedWeekCount:false,height:"auto",contentHeight:"auto",editable:false,droppable:false,eventDurationEditable:false,showNonCurrentDates:false,dayMaxEvents:false,moreLinkClick:"popover",eventDisplay:"block",dragRevertDuration:0,eventShortHeight:0,slotDuration:"00:30",slotEventOverlap:false,eventMinHeight:j,slotMinTime:i,slotMaxTime:c,validRange:{start:f.start?moment.utc(f.start.substr(0,10)).format("YYYY-MM-DD"):"",end:f.end?moment.utc(f.end.substr(0,10)).add(1,"days").format("YYYY-MM-DD"):""},headerToolbar:{start:"prev,next today",center:"title",end:"dayGridMonth,timeGridWeek,timeGridDay"},events:function(s,r,t){r([])},viewClassNames:function(s){var r={class_names:[]};b.trigger("bookacti_calendar_view_class_names",[r,s]);return r.class_names},dayHeaderClassNames:function(u){var r={class_names:[]};if(typeof bookacti.booking_system[q]["days_off"]!=="undefined"){var s=bookacti.booking_system[q]["days_off"];var t=moment.utc(u.date);$j.each(s,function(w,y){var x=moment.utc(y.from+" 00:00:00");var v=moment.utc(y.to+" 23:59:59");if(t.isBetween(x,v,"second","[]")){r.class_names.push("fc-day-disabled");return false}})}b.trigger("bookacti_calendar_day_header_class_names",[r,u]);return r.class_names},dayCellClassNames:function(u){var r={class_names:[]};if(typeof bookacti.booking_system[q]["days_off"]!=="undefined"){var s=bookacti.booking_system[q]["days_off"];var t=moment.utc(u.date);$j.each(s,function(w,y){var x=moment.utc(y.from+" 00:00:00");var v=moment.utc(y.to+" 23:59:59");if(t.isBetween(x,v,"second","[]")){r.class_names.push("fc-day-disabled");return false}})}b.trigger("bookacti_calendar_day_cell_class_names",[r,u]);return r.class_names},datesSet:function(s){if(bookacti.booking_system[q]["load_events"]===true){var r={start:moment.utc(moment.utc(s.view.currentStart).clone().locale("en").format("YYYY-MM-DD")+" 00:00:00"),end:moment.utc(moment.utc(s.view.currentEnd).clone().subtract(1,"days").locale("en").format("YYYY-MM-DD")+" 23:59:59")};var t=bookacti_get_interval_of_events(b,r);if(!$j.isEmptyObject(t)){bookacti_get_booking_system_data_by_interval(b,t)}}b.trigger("bookacti_calendar_view_render",[s])},eventDidMount:function(u){if(u.isMirror){return}var r=moment.utc(u.event.start).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");var t=moment.utc(u.event.end).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");$j(u.el).data("event-id",u.event.groupId);$j(u.el).attr("data-event-id",u.event.groupId);$j(u.el).data("event-start",r);$j(u.el).attr("data-event-start",r);$j(u.el).data("event-end",t);$j(u.el).attr("data-event-end",t);var s=bookacti.booking_system[q]["events_data"][u.event.groupId];if(typeof s.activity_id!=="undefined"){$j(u.el).data("activity-id",s.activity_id);$j(u.el).attr("data-activity-id",s.activity_id)}b.trigger("bookacti_calendar_event_did_mount",[u])},eventClassNames:function(x){var t={class_names:[]};if(x.isMirror||x.event.display==="none"){return t}var v=moment.utc(x.event.start).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");$j.each(bookacti.booking_system[q]["picked_events"],function(A,B){var z=moment.utc(B.start).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");if(B.id==x.event.groupId&&v===z){t.class_names.push("bookacti-picked-event")}});var s=moment.utc(x.event.start).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");if(typeof bookacti.booking_system[q]["bookings"][x.event.groupId]!=="undefined"){if(typeof bookacti.booking_system[q]["bookings"][x.event.groupId][s]!=="undefined"){var w=parseInt(bookacti.booking_system[q]["bookings"][x.event.groupId][s]["current_user_bookings"]);if(w){t.class_names.push("bookacti-event-booked-by-current-user")}}}var r=bookacti.booking_system[q]["bookings_only"]==1?true:false;if(!r){var y=bookacti_is_event_available(b,x.event);if(!y){t.class_names.push("bookacti-event-unavailable")}}if(x.view.type.indexOf("dayGrid")>-1||x.view.type.indexOf("timeGrid")>-1){var u=bookacti_fc_get_event_size_classes(b,x.event,x.view);if(u.length){t.class_names=$j.merge(t.class_names,u)}}b.trigger("bookacti_calendar_event_class_names",[t,x]);return t.class_names},eventContent:function(x){var s={domNodes:[]};if(x.event.display==="none"){return s}var y="LT";if(x.view.type.indexOf("timeGrid")>-1){var u=moment.localeData().longDateFormat("LT");y=u.replace(/[aA]/g,"")}if(bookacti_localized.calendar_localization==="wp_settings"){y=bookacti_convert_php_datetime_format_to_moment_js(bookacti_localized.wp_time_format)}var v=$j("<div></div>",{"class":"fc-event-time",html:'<span class="bookacti-event-time-start">'+moment.utc(x.event.start).format(y)+'</span><span class="bookacti-event-time-separator"> - </span><span class="bookacti-event-time-end">'+moment.utc(x.event.end).format(y)+"</span>"});s.domNodes.push(v[0]);var w=$j("<div></div>",{"class":"fc-event-title-container",html:'<div class="fc-event-title">'+x.event.title+"</div>"});s.domNodes.push(w[0]);var r=bookacti.booking_system[q]["bookings_only"]==1?true:false;var t=r?bookacti_get_event_number_of_bookings_div(b,x.event):bookacti_get_event_availability_div(b,x.event);if(t){s.domNodes.push(t[0])}b.trigger("bookacti_calendar_event_content",[s,x]);return s},eventClick:function(s){var r={click:true};if($j(s.el).hasClass("bookacti-event-unavailable")){r.click=false}b.trigger("bookacti_trigger_event_click",[r,s]);if(r.click){bookacti_event_click(b,s.event)}},eventMouseEnter:function(r){b.trigger("bookacti_calendar_event_mouse_enter",[r])},eventMouseLeave:function(r){b.trigger("bookacti_calendar_event_mouse_leave",[r])}};if(bookacti_localized.calendar_localization==="wp_settings"){var k=bookacti_convert_php_datetime_format_to_fc_date_formatting_object(bookacti_localized.wp_time_format);h.firstDay=bookacti_localized.wp_start_of_week;h.slotLabelFormat=k;h.eventTimeFormat=k}b.trigger("bookacti_calendar_init_data",[h]);bookacti.fc_calendar[q]=new FullCalendar.Calendar(b.find(".bookacti-calendar:first")[0],h);bookacti.fc_calendar[q].render();var n=bookacti.fc_calendar[q].view;var d={start:moment.utc(moment.utc(n.currentStart).clone().locale("en").format("YYYY-MM-DD")+" 00:00:00"),end:moment.utc(moment.utc(n.currentEnd).clone().subtract(1,"days").locale("en").format("YYYY-MM-DD")+" 23:59:59")};var l=false;if(typeof bookacti.booking_system[q]["events_interval"]!=="undefined"){var g=moment.utc(bookacti.booking_system[q]["events_interval"]["start"]);var m=moment.utc(bookacti.booking_system[q]["events_interval"]["end"]);if(g.isAfter(d.start)||m.isBefore(d.end)){l=true}}if((!o||l)&&typeof bookacti.booking_system[q]["events"]!=="undefined"){bookacti_fc_add_events(b,bookacti.booking_system[q]["events"])}if(o||l){var a=bookacti_get_interval_of_events(b,d);if(!$j.isEmptyObject(a)){bookacti_get_booking_system_data_by_interval(b,a)}}bookacti.booking_system[q]["load_events"]=true;var p=bookacti.booking_system[q]["picked_events"];if(!$j.isEmptyObject(bookacti.booking_system[q]["picked_events"])){bookacti.fc_calendar[q].gotoDate(moment.utc(p[0]["start"]))}b.trigger("bookacti_calendar_after_set_up")}function bookacti_fc_get_events_by_groupId(c,d){var b=c.attr("id");var a=$j.grep(bookacti.fc_calendar[b].getEvents(),function(e){return e.groupId==d});return a}function bookacti_fc_add_events(b,c){if(!c.length){return}$j.each(c,function(e,f){f.groupId=parseInt(f.id);f.id=f.id+"_"+f.start});var a=b.attr("id");var d={events:c,editable:a==="bookacti-template-calendar"};b.trigger("bookacti_fc_events",[d]);bookacti.fc_calendar[a].addEventSource(d)}function bookacti_refresh_picked_events_on_calendar(b){var a=b.attr("id");var c=bookacti.booking_system[a]["picked_events"];bookacti_unpick_all_events_on_calendar(b);if(c){$j.each(c,function(e,g){var d=moment.utc(g.start).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");var f=b.find('.fc-event[data-event-id="'+g.id+'"][data-event-start="'+d+'"]');f.addClass("bookacti-picked-event")})}b.trigger("bookacti_refresh_picked_events_on_calendar")}function bookacti_unpick_all_events_on_calendar(a){a.find(".bookacti-picked-event").removeClass("bookacti-picked-event");a.trigger("bookacti_unpick_all_events_on_calendar")}function bookacti_fc_get_event_size_classes(a,j,k){var c=[];if(k.type.indexOf("timeGrid")<0&&k.type.indexOf("dayGrid")<0){return c}var h={tiny_height:typeof bookacti_localized.event_tiny_height!=="undefined"?parseInt(bookacti_localized.event_tiny_height):32,small_height:typeof bookacti_localized.event_small_height!=="undefined"?parseInt(bookacti_localized.event_small_height):75,narrow_width:typeof bookacti_localized.event_narrow_width!=="undefined"?parseInt(bookacti_localized.event_narrow_width):70,wide_width:typeof bookacti_localized.event_wide_width!=="undefined"?parseInt(bookacti_localized.event_wide_width):250};if(k.type.indexOf("timeGrid")>-1){var o=a.attr("id");var e=bookacti.fc_calendar[o].getOption("eventMinHeight");var g=bookacti.fc_calendar[o].getOption("slotDuration");if(typeof e==="undefined"){e=0}if(typeof g==="undefined"){g="00:30"}var i=(parseInt(g.substr(0,2))*60)+parseInt(g.substr(-2));var d=parseInt(moment.duration(moment.utc(j.end).diff(moment.utc(j.start))).asMinutes());var p=a.find(".fc-timegrid-slot").length?a.find(".fc-timegrid-slot").outerHeight():0;if(!p){var n=a.css("line-height").replace("px","");n=$j.isNumeric(n)?parseFloat(n):0;if(!n){var b=a.css("font-size").replace("px","");n=$j.isNumeric(b)?parseFloat(b)*1.5:0}if(n){p=n}else{p=20}}var f=Math.max(parseInt(e),(p/i)*d);if(f<=h.tiny_height){c.push("bookacti-tiny-event")}else{if(f<=h.small_height){c.push("bookacti-small-event")}}}var m=a.find(".fc-col-header-cell.fc-day").innerWidth();var l=m-(m*0.025)-2;if(l>=h.wide_width){c.push("bookacti-wide-event")}else{if(l<=h.narrow_width){c.push("bookacti-narrow-event")}}return c}function bookacti_enter_calendar_loading_state(a){a.find(".fc-toolbar button").attr("disabled",true);a.find(".fc-view-harness").append('<div class="bookacti-loading-overlay"><div class="bookacti-loading-overlay-content">'+bookacti_get_loading_html()+"</div></div>")}function bookacti_exit_calendar_loading_state(a){a.find(".fc-toolbar button").attr("disabled",false);a.find(".bookacti-loading-overlay").remove()};