$j(document).ready(function(){$j("body").on("bookacti_booking_method_set_up",".bookacti-booking-system",function(a,d,b){d==="calendar"&&$j(this).find(".bookacti-calendar").length&&bookacti_set_calendar_up($j(this),b)});$j("body").on("bookacti_booking_method_update_availability_period",".bookacti-booking-system",function(a,d,b){d==="calendar"&&$j(this).find(".bookacti-calendar").length&&(a=$j(this).attr("id"),typeof bookacti.fc_calendar[a]!=="undefined"&&(b={start:b.start?moment.utc(b.start.substr(0,
10)).format("YYYY-MM-DD"):null,end:b.end?moment.utc(b.end.substr(0,10)).add(1,"days").format("YYYY-MM-DD"):null},bookacti.fc_calendar[a].setOption("validRange",b)))});$j("body").on("bookacti_booking_method_display_events",".bookacti-booking-system",function(a,d,b){d==="calendar"&&$j(this).find(".bookacti-calendar").length&&bookacti_fc_add_events($j(this),b)});$j("body").on("bookacti_fc_events_added",".bookacti-booking-system",function(){var a=$j(this).attr("id");parseInt(bookacti.booking_system?.[a]?.trim)&&
bookacti_fc_hide_daygrid_empty_rows($j(this))});$j("body").on("bookacti_refetch_events",".bookacti-booking-system",function(a,d){d==="calendar"&&(a=$j(this).attr("id"),typeof bookacti.fc_calendar[a]!=="undefined"&&bookacti.fc_calendar[a].removeAllEvents(),bookacti_get_booking_system_data_by_interval($j(this)))});$j("body").on("bookacti_rerender_events",".bookacti-booking-system",function(a,d){d==="calendar"&&(a=$j(this).attr("id"),typeof bookacti.fc_calendar[a]!=="undefined"&&bookacti.fc_calendar[a].render())});
$j("body").on("bookacti_clear_events",".bookacti-booking-system",function(a,d){d==="calendar"&&(a=$j(this).attr("id"),typeof bookacti.fc_calendar[a]!=="undefined"&&bookacti.fc_calendar[a].removeAllEvents())});$j("body").on("bookacti_booking_system_reloaded",".bookacti-booking-system",function(a,d,b,f){$j(this).find(".bookacti-calendar").length&&bookacti_refresh_picked_events_on_calendar($j(this))});$j("body").on("bookacti_start_loading",".bookacti-booking-system, .bookacti-booking-system-editor",
function(a,d){d==="calendar"&&(a=$j(this),a.find(".bookacti-calendar.fc").length?(d=a.attr("id"),bookacti.booking_system[d].loading_number!==0&&a.find(".bookacti-loading-overlay").length||(bookacti_remove_loading_html(a),bookacti_enter_calendar_loading_state(a.find(".bookacti-calendar")))):a.find(".bookacti-loading-container").length||bookacti_add_loading_html(a))});$j("body").on("bookacti_exit_loading_state",".bookacti-booking-system, .bookacti-booking-system-editor",function(a,d){d==="calendar"&&
(bookacti_remove_loading_html($j(this)),$j(this).find(".bookacti-calendar").length&&bookacti_exit_calendar_loading_state($j(this).find(".bookacti-calendar")))});$j("body").on("change",".bookacti-go-to-datepicker",function(){var a=$j(this).prev(".fc-goTo-button");a.find(".bookacti-spinner").length||a.append('<span class="bookacti-spinner"></span>');typeof bookacti_go_to_date!=="undefined"&&bookacti_go_to_date&&clearTimeout(bookacti_go_to_date);var d=$j(this).val(),b=$j(this).closest(".bookacti-booking-system").length?
$j(this).closest(".bookacti-booking-system").attr("id"):"bookacti-template-calendar";d&&typeof bookacti.fc_calendar[b]!=="undefined"&&d.length===10&&/^\d{4}-(0[1-9]|1[0-2])-(0[1-9]|[12]\d|3[01])$/.test(d)&&(bookacti_go_to_date=setTimeout(function(){bookacti.fc_calendar[b].gotoDate(d);a.find(".bookacti-spinner").remove()},750))});$j("body").on("click",".bookacti-booking-system .bookacti-calendar .fc-more",function(){bookacti_refresh_picked_events_on_calendar(booking_system)});$j("body").on("touchstart touchmove touchend touchcancel",
".bookacti-booking-system .bookacti-calendar .fc-event",function(a){var d={touchstart:"bookacti_calendar_event_touch_start",touchmove:"bookacti_calendar_event_touch_move",touchend:"bookacti_calendar_event_touch_end",touchcancel:"bookacti_calendar_event_touch_cancel"};if(typeof d[a.type]!=="undefined"){var b=$j(this).closest(".bookacti-booking-system"),f=$j(this),h={id:parseInt(f.data("event-id")),start:moment.utc(f.data("event-start")),end:moment.utc(f.data("event-end"))};b.trigger(d[a.type],[{event:h,
el:f,jsEvent:a}])}});$j("body").on("bookacti_pick_event",".bookacti-booking-system, #bookacti-template-calendar",function(a,d,b,f){$j(this).find(".bookacti-calendar").length&&bookacti_refresh_picked_events_on_calendar($j(this))});$j("body").on("bookacti_unpick_all_events",".bookacti-booking-system",function(){$j(this).find(".bookacti-calendar").length&&bookacti_unpick_all_events_on_calendar($j(this))})});
function bookacti_set_calendar_up(a,d){d=d?1:0;var b=a.attr("id");bookacti.booking_system[b].load_events=!1;var f=bookacti_get_availability_period(a),h=typeof bookacti.booking_system[b].display_data!=="undefined"?bookacti.booking_system[b].display_data:{},l=typeof bookacti_localized.event_tiny_height!=="undefined"?parseInt(bookacti_localized.event_tiny_height):32,q=typeof h.slotMinTime!=="undefined"?h.slotMinTime:"00:00";h=typeof h.slotMaxTime!=="undefined"?h.slotMaxTime:"24:00";var r=moment.utc("1992-12-26 "+
q).add(1,"minutes").format("HH:mm");f={locale:bookacti_localized.fullcalendar_locale,timeZone:bookacti_localized.fullcalendar_timezone,now:new Date(bookacti_localized.current_time.substr(0,10)),initialView:a.find(".bookacti-calendar:first").width()<bookacti_localized.initial_view_threshold?"timeGridDay":"timeGridWeek",allDaySlot:!1,defaultAllDay:!1,fixedWeekCount:!1,height:"auto",contentHeight:"auto",editable:!1,droppable:!1,eventDurationEditable:!1,showNonCurrentDates:!1,dayMaxEvents:!1,moreLinkClick:"popover",
eventDisplay:"block",dragRevertDuration:0,eventShortHeight:0,slotDuration:"00:30",slotEventOverlap:!1,eventMinHeight:l,nextDayThreshold:r,slotMinTime:q,slotMaxTime:h,validRange:{start:f.start?moment.utc(f.start.substr(0,10)).format("YYYY-MM-DD"):null,end:f.end?moment.utc(f.end.substr(0,10)).add(1,"days").format("YYYY-MM-DD"):null},headerToolbar:{start:"prev,next today",center:"title",end:"dayGridMonth,timeGridWeek,timeGridDay"},events:function(c,e,g){e([])},eventDataTransform:function(c){a.trigger("bookacti_calendar_event_data_transform",
[c]);return c},viewClassNames:function(c){var e={class_names:[]};a.find(".fc-today-button").length&&!a.find(".fc-day-today").length&&(moment().isBetween(c.view.currentStart,c.view.currentEnd,"day","[)")||a.find(".fc-today-button").attr("disabled",!1));a.trigger("bookacti_calendar_view_class_names",[e,c]);return e.class_names},dayHeaderClassNames:function(c){var e={class_names:[]};if(typeof bookacti.booking_system[b].days_off!=="undefined"){var g=bookacti.booking_system[b].days_off,t=moment.utc(c.date);
$j.each(g,function(m,p){m=moment.utc(p.from+" 00:00:00");p=moment.utc(p.to+" 23:59:59");if(t.isBetween(m,p,"second","[]"))return e.class_names.push("fc-day-disabled"),!1})}a.trigger("bookacti_calendar_day_header_class_names",[e,c]);return e.class_names},dayCellClassNames:function(c){var e={class_names:[]};if(typeof bookacti.booking_system[b].days_off!=="undefined"){var g=bookacti.booking_system[b].days_off,t=moment.utc(c.date);$j.each(g,function(m,p){m=moment.utc(p.from+" 00:00:00");p=moment.utc(p.to+
" 23:59:59");if(t.isBetween(m,p,"second","[]"))return e.class_names.push("fc-day-disabled"),!1})}a.trigger("bookacti_calendar_day_cell_class_names",[e,c]);return e.class_names},datesSet:function(c){var e={};bookacti.booking_system[b].load_events===!0&&(e={start:moment.utc(moment.utc(c.view.currentStart).clone().locale("en").format("YYYY-MM-DD")+" 00:00:00"),end:moment.utc(moment.utc(c.view.currentEnd).clone().subtract(1,"days").locale("en").format("YYYY-MM-DD")+" 23:59:59")},e=bookacti_get_interval_of_events(a,
e),$j.isEmptyObject(e)||bookacti_get_booking_system_data_by_interval(a,e));$j.isEmptyObject(e)&&parseInt(bookacti.booking_system?.[b]?.trim)&&bookacti_fc_hide_daygrid_empty_rows(a);a.trigger("bookacti_calendar_view_render",[c,e])},eventDidMount:function(c){if(!c.isMirror&&typeof c.event!=="undefined"){var e=typeof c.event.groupId!=="undefined"?parseInt(c.event.groupId):parseInt(c.event.id);if(typeof bookacti.booking_system[b].events_data[e]!=="undefined"){var g=moment.utc(c.event.start).clone().locale("en").format("YYYY-MM-DD HH:mm:ss"),
t=moment.utc(c.event.end).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");$j(c.el).data("event-id",e);$j(c.el).attr("data-event-id",e);$j(c.el).data("event-start",g);$j(c.el).attr("data-event-start",g);$j(c.el).data("event-end",t);$j(c.el).attr("data-event-end",t);e=bookacti.booking_system[b].events_data[e];typeof e.activity_id!=="undefined"&&($j(c.el).data("activity-id",e.activity_id),$j(c.el).attr("data-activity-id",e.activity_id));a.trigger("bookacti_calendar_event_did_mount",[c])}}},eventClassNames:function(c){var e=
{class_names:[]};if(typeof c.event==="undefined")return e.class_names;var g=typeof c.event.groupId!=="undefined"?parseInt(c.event.groupId):parseInt(c.event.id);if(typeof bookacti.booking_system[b].events_data[g]==="undefined"||c.isMirror||c.event.display==="none")return e.class_names;var t=moment.utc(c.event.start).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");$j.each(bookacti.booking_system[b].picked_events,function(u,v){u=moment.utc(v.start).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");
v.id==g&&t===u&&e.class_names.push("bookacti-picked-event")});var m=moment.utc(c.event.start).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");typeof bookacti.booking_system[b].bookings[g]!=="undefined"&&typeof bookacti.booking_system[b].bookings[g][m]!=="undefined"&&parseInt(bookacti.booking_system[b].bookings[g][m].current_user_bookings)&&e.class_names.push("bookacti-event-booked-by-current-user");if(bookacti.booking_system[b].bookings_only!=1){m=bookacti_is_event_available(a,c.event);var p=bookacti_is_event_in_available_group(a,
c.event);m||p||e.class_names.push("bookacti-event-unavailable")}if(c.view.type.indexOf("dayGrid")>-1||c.view.type.indexOf("timeGrid")>-1)m=bookacti_fc_get_event_size_classes(a,c.event,c.view),m.length&&(e.class_names=$j.merge(e.class_names,m));a.trigger("bookacti_calendar_event_class_names",[e,c]);return e.class_names},eventContent:function(c){var e={domNodes:[]};if(typeof c.event==="undefined")return e;var g=typeof c.event.groupId!=="undefined"?parseInt(c.event.groupId):parseInt(c.event.id);if(typeof bookacti.booking_system[b].events_data[g]===
"undefined"||c.event.display==="none")return e;g="LT";c.view.type.indexOf("timeGrid")>-1&&(g=moment.localeData().longDateFormat("LT").replace(/[aA]/g,""));bookacti_localized.calendar_localization==="wp_settings"&&(g=bookacti_convert_php_datetime_format_to_moment_js(bookacti_localized.wp_time_format));g=$j("<div></div>",{"class":"fc-event-time",html:'<span class="bookacti-event-time-start">'+moment.utc(c.event.start).format(g)+'</span><span class="bookacti-event-time-separator"> - </span><span class="bookacti-event-time-end">'+
moment.utc(c.event.end).format(g)+"</span>"});e.domNodes.push(g[0]);g=$j("<div></div>",{"class":"fc-event-title-container",html:'<div class="fc-event-title">'+c.event.title+"</div>"});e.domNodes.push(g[0]);(g=bookacti.booking_system[b].bookings_only==1?bookacti_get_event_number_of_bookings_div(a,c.event):bookacti_get_event_availability_div(a,c.event))&&e.domNodes.push(g[0]);a.trigger("bookacti_calendar_event_content",[e,c]);return e},eventClick:function(c){var e={click:!0};$j(c.el).hasClass("bookacti-event-unavailable")&&
(e.click=!1);a.trigger("bookacti_trigger_event_click",[e,c]);e.click&&bookacti_event_click(a,c.event)},eventMouseEnter:function(c){bookacti.is_touch_device||a.trigger("bookacti_calendar_event_mouse_enter",[c])},eventMouseLeave:function(c){bookacti.is_touch_device||a.trigger("bookacti_calendar_event_mouse_leave",[c])}};bookacti_localized.calendar_localization==="wp_settings"&&(l=bookacti_convert_php_datetime_format_to_fc_date_formatting_object(bookacti_localized.wp_time_format),f.firstDay=bookacti_localized.wp_start_of_week,
f.slotLabelFormat=l,f.eventTimeFormat=l);a.trigger("bookacti_calendar_init_data",[f]);bookacti.fc_calendar[b]=new FullCalendar.Calendar(a.find(".bookacti-calendar:first")[0],f);bookacti.fc_calendar[b].render();f=bookacti.fc_calendar[b].view;f={start:moment.utc(moment.utc(f.currentStart).clone().locale("en").format("YYYY-MM-DD")+" 00:00:00"),end:moment.utc(moment.utc(f.currentEnd).clone().subtract(1,"days").locale("en").format("YYYY-MM-DD")+" 23:59:59")};l=!1;if(typeof bookacti.booking_system[b].events_interval!==
"undefined"){q=moment.utc(bookacti.booking_system[b].events_interval.start);h=moment.utc(bookacti.booking_system[b].events_interval.end);r=bookacti.booking_system[b].past_events;var n=moment.utc(bookacti_localized.current_time.substr(0,10));if((r||q.isAfter(n))&&q.isAfter(f.start)||h.isBefore(f.end))l=!0}d&&!l||typeof bookacti.booking_system[b].events==="undefined"||bookacti_fc_add_events(a,bookacti.booking_system[b].events);if(d||l)d=bookacti_get_interval_of_events(a,f),$j.isEmptyObject(d)||bookacti_get_booking_system_data_by_interval(a,
d);bookacti.booking_system[b].load_events=!0;d=bookacti.booking_system[b].picked_events;$j.isEmptyObject(bookacti.booking_system[b].picked_events)||bookacti.fc_calendar[b].gotoDate(d[0].start);d=bookacti_localized.calendar_width_classes;var k=a.find(".bookacti-calendar:first").width();$j.each(d,function(c,e){if(k<=c)return a.find(".bookacti-calendar:first").addClass(e),!1});a.trigger("bookacti_calendar_after_set_up")}
function bookacti_fc_get_events_by_groupId(a,d){a=a.attr("id");return $j.grep(bookacti.fc_calendar[a].getEvents(),function(b){return b.groupId==d})}
function bookacti_fc_add_events(a,d){if(d.length){var b=[];$j.each(d,function(h,l){h=$j.extend(!0,{},l);h.groupId=parseInt(l.id);h.id=l.id+"_"+l.start;b.push(h)});d=a.attr("id");var f={events:b,editable:d==="bookacti-template-calendar"};a.trigger("bookacti_fc_events",[f]);bookacti.fc_calendar[d].addEventSource(f);a.trigger("bookacti_fc_events_added",[f])}}
function bookacti_refresh_picked_events_on_calendar(a){var d=a.attr("id");d=bookacti.booking_system[d].picked_events;bookacti_unpick_all_events_on_calendar(a);d&&$j.each(d,function(b,f){b=moment.utc(f.start).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");a.find('.fc-event[data-event-id="'+f.id+'"][data-event-start="'+b+'"]').addClass("bookacti-picked-event")});a.trigger("bookacti_refresh_picked_events_on_calendar")}
function bookacti_unpick_all_events_on_calendar(a){a.find(".bookacti-picked-event").removeClass("bookacti-picked-event");a.trigger("bookacti_unpick_all_events_on_calendar")}
function bookacti_fc_get_event_size_classes(a,d,b){var f=[];if(b.type.indexOf("timeGrid")<0&&b.type.indexOf("dayGrid")<0)return f;var h=typeof bookacti_localized.event_tiny_height!=="undefined"?parseInt(bookacti_localized.event_tiny_height):32,l=typeof bookacti_localized.event_small_height!=="undefined"?parseInt(bookacti_localized.event_small_height):75,q=typeof bookacti_localized.event_narrow_width!=="undefined"?parseInt(bookacti_localized.event_narrow_width):70,r=typeof bookacti_localized.event_wide_width!==
"undefined"?parseInt(bookacti_localized.event_wide_width):250;if(b.type.indexOf("timeGrid")>-1){var n=a.attr("id");b=bookacti.fc_calendar[n].getOption("eventMinHeight");n=bookacti.fc_calendar[n].getOption("slotDuration");typeof b==="undefined"&&(b=0);typeof n==="undefined"&&(n="00:30");n=parseInt(n.substr(0,2))*60+parseInt(n.substr(-2));d=parseInt(moment.duration(moment.utc(d.end).diff(moment.utc(d.start))).asMinutes());var k=a.find(".fc-timegrid-slot").length?a.find(".fc-timegrid-slot").outerHeight():
0;k||(k=a.css("line-height").replace("px",""),k=$j.isNumeric(k)?parseFloat(k):0,k||(k=a.css("font-size").replace("px",""),k=$j.isNumeric(k)?parseFloat(k)*1.5:0),k=k?k:20);b=Math.max(parseInt(b),k/n*d);b<=h?f.push("bookacti-tiny-event"):b<=l&&f.push("bookacti-small-event")}a=a.find(".fc-col-header-cell.fc-day").innerWidth();a=a-a*.025-2;a>=r?f.push("bookacti-wide-event"):a<=q&&f.push("bookacti-narrow-event");return f}
function bookacti_enter_calendar_loading_state(a){a.find(".fc-toolbar button:disabled").addClass("bookacti-was-disabled");a.find(".fc-toolbar button").attr("disabled",!0);a.find(".fc-view-harness").append('<div class="bookacti-loading-overlay"><div class="bookacti-loading-overlay-content">'+bookacti_get_loading_html()+"</div></div>")}
function bookacti_exit_calendar_loading_state(a){a.find(".fc-toolbar button:not(.bookacti-was-disabled)").attr("disabled",!1);a.find(".fc-toolbar button.bookacti-was-disabled").removeClass("bookacti-was-disabled");a.find(".bookacti-loading-overlay").remove()}
function bookacti_fc_hide_daygrid_empty_rows(a){var d=a.attr("id");if(typeof bookacti.fc_calendar[d]!=="undefined"&&!(typeof bookacti.fc_calendar[d].view.type.indexOf("dayGrid")<0)){var b=a.find(".bookacti-calendar");if(b.length&&b.find(".fc-daygrid-body").length){var f=bookacti.fc_calendar[d].getEvents();b.find("tr.bookacti-no-events-row").remove();b.find(".fc-daygrid-body > table > tbody > tr").removeClass("bookacti-daygrid-week-month-start bookacti-daygrid-week-disabled bookacti-daygrid-week-empty");
b.find(".fc-daygrid-body > table > tbody > tr").each(function(){var h=!0,l=!0;$j(this).find("> td").each(function(){var q=$j(this).data("date");if(!q)return!0;var r=!1,n=moment.utc(q);$j.each(f,function(k,c){k=moment.utc(c.startStr.substr(0,10)+" 00:00:00");c=moment.utc(c.endStr.substr(0,10)+" 23:59:59");if(n.isBetween(k,c,"second","[]"))return r=!0,!1});$j(this).hasClass("fc-day-disabled")||(l=!1,r&&(h=!1))});$j(this).find(".fc-daygrid-month-start").length&&$j(this).addClass("bookacti-daygrid-week-month-start");
l&&$j(this).addClass("bookacti-daygrid-week-disabled");h&&$j(this).addClass("bookacti-daygrid-week-empty")});b.find(".fc-daygrid-body > table > tbody > tr:visible").length?bookacti_booking_method_rerender_events(a):(a=b.find(".fc-daygrid-body > table > tbody > tr:first > td").length,d=typeof bookacti_localized.no_events!=="undefined"?bookacti_localized.no_events:"No events.",b.find(".fc-daygrid-body > table > tbody").append('<tr class="bookacti-no-events-row" colspan="'+a+'"><td><div class="bookacti-no-events">'+
d+"</div></td></tr>"))}}};
