$j(document).ready(function(){$j("body").on("bookacti_booking_method_set_up",".bookacti-booking-system",function(a,e,c){"calendar"===e&&$j(this).find(".bookacti-calendar").length&&bookacti_set_calendar_up($j(this),c)});$j("body").on("bookacti_booking_method_display_events",".bookacti-booking-system",function(a,e,c){"calendar"===e&&$j(this).find(".bookacti-calendar").length&&bookacti_fc_add_events($j(this),c)});$j("body").on("bookacti_refetch_events",".bookacti-booking-system",function(a,e){"calendar"===
e&&(a=$j(this).attr("id"),"undefined"!==typeof bookacti.fc_calendar[a]&&bookacti.fc_calendar[a].removeAllEvents(),bookacti_get_booking_system_data_by_interval($j(this)))});$j("body").on("bookacti_rerender_events",".bookacti-booking-system",function(a,e){"calendar"===e&&(a=$j(this).attr("id"),"undefined"!==typeof bookacti.fc_calendar[a]&&bookacti.fc_calendar[a].render())});$j("body").on("bookacti_clear_events",".bookacti-booking-system",function(a,e){"calendar"===e&&(a=$j(this).attr("id"),"undefined"!==
typeof bookacti.fc_calendar[a]&&bookacti.fc_calendar[a].removeAllEvents())});$j("body").on("bookacti_booking_system_reloaded",".bookacti-booking-system",function(a,e){$j(this).find(".bookacti-calendar").length&&bookacti_refresh_picked_events_on_calendar($j(this))});$j("body").on("bookacti_start_loading",".bookacti-booking-system, .bookacti-booking-system-editor",function(a,e){"calendar"===e&&(a=$j(this),a.find(".bookacti-calendar.fc").length?(e=a.attr("id"),0!==bookacti.booking_system[e].loading_number&&
a.find(".bookacti-loading-overlay").length||(bookacti_remove_loading_html(a),bookacti_enter_calendar_loading_state(a.find(".bookacti-calendar")))):a.find(".bookacti-loading-container").length||bookacti_add_loading_html(a))});$j("body").on("bookacti_exit_loading_state",".bookacti-booking-system, .bookacti-booking-system-editor",function(a,e){"calendar"===e&&(bookacti_remove_loading_html($j(this)),$j(this).find(".bookacti-calendar").length&&bookacti_exit_calendar_loading_state($j(this).find(".bookacti-calendar")))});
$j("body").on("change",".bookacti-go-to-datepicker",function(){var a=$j(this).val(),e=$j(this).closest(".bookacti-booking-system").length?$j(this).closest(".bookacti-booking-system").attr("id"):"bookacti-template-calendar";a&&"undefined"!==typeof bookacti.fc_calendar[e]&&(1970>parseInt(a.substr(0,4))||bookacti.fc_calendar[e].gotoDate(a))});$j("body").on("click",".bookacti-booking-system .bookacti-calendar .fc-more",function(){bookacti_refresh_picked_events_on_calendar(booking_system)});$j("body").on("touchstart",
".bookacti-booking-system .bookacti-calendar .fc-event, .bookacti-booking-system .bookacti-calendar .fc-list-event",function(a){var e=$j(this).closest(".bookacti-booking-system"),c=$j(this),f={id:parseInt(c.data("event-id")),start:moment.utc(c.data("event-start")),end:moment.utc(c.data("event-end"))};e.trigger("bookacti_calendar_event_touch_start",[{event:f,el:c,jsEvent:a}])});$j("body").on("touchend",".bookacti-booking-system .bookacti-calendar .fc-event, .bookacti-booking-system .bookacti-calendar .fc-list-event",
function(a){var e=$j(this).closest(".bookacti-booking-system"),c=$j(this),f={id:parseInt(c.data("event-id")),start:moment.utc(c.data("event-start")),end:moment.utc(c.data("event-end"))};e.trigger("bookacti_calendar_event_touch_end",[{event:f,el:c,jsEvent:a}])});$j("body").on("bookacti_pick_event",".bookacti-booking-system, #bookacti-template-calendar",function(a,e,c,f){$j(this).find(".bookacti-calendar").length&&bookacti_refresh_picked_events_on_calendar($j(this))});$j("body").on("bookacti_unpick_all_events",
".bookacti-booking-system",function(){$j(this).find(".bookacti-calendar").length&&bookacti_unpick_all_events_on_calendar($j(this))})});
function bookacti_set_calendar_up(a,e){e=e?1:0;var c=a.attr("id");bookacti.booking_system[c].load_events=!1;var f=bookacti_get_availability_period(a),h="undefined"!==typeof bookacti.booking_system[c].display_data?bookacti.booking_system[c].display_data:{},k="undefined"!==typeof bookacti_localized.event_tiny_height?parseInt(bookacti_localized.event_tiny_height):32,p="undefined"!==typeof h.slotMinTime?h.slotMinTime:"00:00";h="undefined"!==typeof h.slotMaxTime?h.slotMaxTime:"24:00";var q=moment.utc("1970-02-01 "+
p).add(1,"minutes").format("HH:mm");f={locale:bookacti_localized.fullcalendar_locale,timeZone:bookacti_localized.fullcalendar_timezone,initialView:a.find(".bookacti-calendar:first").width()<bookacti_localized.initial_view_threshold?"timeGridDay":"timeGridWeek",allDaySlot:!1,defaultAllDay:!1,fixedWeekCount:!1,height:"auto",contentHeight:"auto",editable:!1,droppable:!1,eventDurationEditable:!1,showNonCurrentDates:!1,dayMaxEvents:!1,moreLinkClick:"popover",eventDisplay:"block",dragRevertDuration:0,eventShortHeight:0,
slotDuration:"00:30",slotEventOverlap:!1,eventMinHeight:k,nextDayThreshold:q,slotMinTime:p,slotMaxTime:h,validRange:{start:f.start?moment.utc(f.start.substr(0,10)).format("YYYY-MM-DD"):"",end:f.end?moment.utc(f.end.substr(0,10)).add(1,"days").format("YYYY-MM-DD"):""},headerToolbar:{start:"prev,next today",center:"title",end:"dayGridMonth,timeGridWeek,timeGridDay"},events:function(b,d,g){d([])},viewClassNames:function(b){var d={class_names:[]};a.trigger("bookacti_calendar_view_class_names",[d,b]);
return d.class_names},dayHeaderClassNames:function(b){var d={class_names:[]};if("undefined"!==typeof bookacti.booking_system[c].days_off){var g=bookacti.booking_system[c].days_off,m=moment.utc(b.date);$j.each(g,function(n,l){n=moment.utc(l.from+" 00:00:00");l=moment.utc(l.to+" 23:59:59");if(m.isBetween(n,l,"second","[]"))return d.class_names.push("fc-day-disabled"),!1})}a.trigger("bookacti_calendar_day_header_class_names",[d,b]);return d.class_names},dayCellClassNames:function(b){var d={class_names:[]};
if("undefined"!==typeof bookacti.booking_system[c].days_off){var g=bookacti.booking_system[c].days_off,m=moment.utc(b.date);$j.each(g,function(n,l){n=moment.utc(l.from+" 00:00:00");l=moment.utc(l.to+" 23:59:59");if(m.isBetween(n,l,"second","[]"))return d.class_names.push("fc-day-disabled"),!1})}a.trigger("bookacti_calendar_day_cell_class_names",[d,b]);return d.class_names},datesSet:function(b){if(!0===bookacti.booking_system[c].load_events){var d={start:moment.utc(moment.utc(b.view.currentStart).clone().locale("en").format("YYYY-MM-DD")+
" 00:00:00"),end:moment.utc(moment.utc(b.view.currentEnd).clone().subtract(1,"days").locale("en").format("YYYY-MM-DD")+" 23:59:59")};d=bookacti_get_interval_of_events(a,d);$j.isEmptyObject(d)||bookacti_get_booking_system_data_by_interval(a,d)}a.trigger("bookacti_calendar_view_render",[b])},eventDidMount:function(b){if(!b.isMirror){var d=moment.utc(b.event.start).clone().locale("en").format("YYYY-MM-DD HH:mm:ss"),g=moment.utc(b.event.end).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");$j(b.el).data("event-id",
b.event.groupId);$j(b.el).attr("data-event-id",b.event.groupId);$j(b.el).data("event-start",d);$j(b.el).attr("data-event-start",d);$j(b.el).data("event-end",g);$j(b.el).attr("data-event-end",g);d=bookacti.booking_system[c].events_data[b.event.groupId];"undefined"!==typeof d.activity_id&&($j(b.el).data("activity-id",d.activity_id),$j(b.el).attr("data-activity-id",d.activity_id));a.trigger("bookacti_calendar_event_did_mount",[b])}},eventClassNames:function(b){var d={class_names:[]};if(b.isMirror||"none"===
b.event.display)return d;var g=moment.utc(b.event.start).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");$j.each(bookacti.booking_system[c].picked_events,function(n,l){n=moment.utc(l.start).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");l.id==b.event.groupId&&g===n&&d.class_names.push("bookacti-picked-event")});var m=moment.utc(b.event.start).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");"undefined"!==typeof bookacti.booking_system[c].bookings[b.event.groupId]&&"undefined"!==typeof bookacti.booking_system[c].bookings[b.event.groupId][m]&&
parseInt(bookacti.booking_system[c].bookings[b.event.groupId][m].current_user_bookings)&&d.class_names.push("bookacti-event-booked-by-current-user");1!=bookacti.booking_system[c].bookings_only&&(bookacti_is_event_available(a,b.event)||d.class_names.push("bookacti-event-unavailable"));if(-1<b.view.type.indexOf("dayGrid")||-1<b.view.type.indexOf("timeGrid"))m=bookacti_fc_get_event_size_classes(a,b.event,b.view),m.length&&(d.class_names=$j.merge(d.class_names,m));a.trigger("bookacti_calendar_event_class_names",
[d,b]);return d.class_names},eventContent:function(b){var d={domNodes:[]};if("none"===b.event.display)return d;var g="LT";-1<b.view.type.indexOf("timeGrid")&&(g=moment.localeData().longDateFormat("LT").replace(/[aA]/g,""));"wp_settings"===bookacti_localized.calendar_localization&&(g=bookacti_convert_php_datetime_format_to_moment_js(bookacti_localized.wp_time_format));g=$j("<div></div>",{"class":"fc-event-time",html:'<span class="bookacti-event-time-start">'+moment.utc(b.event.start).format(g)+'</span><span class="bookacti-event-time-separator"> - </span><span class="bookacti-event-time-end">'+
moment.utc(b.event.end).format(g)+"</span>"});d.domNodes.push(g[0]);g=$j("<div></div>",{"class":"fc-event-title-container",html:'<div class="fc-event-title">'+b.event.title+"</div>"});d.domNodes.push(g[0]);(g=1==bookacti.booking_system[c].bookings_only?bookacti_get_event_number_of_bookings_div(a,b.event):bookacti_get_event_availability_div(a,b.event))&&d.domNodes.push(g[0]);a.trigger("bookacti_calendar_event_content",[d,b]);return d},eventClick:function(b){var d={click:!0};$j(b.el).hasClass("bookacti-event-unavailable")&&
(d.click=!1);a.trigger("bookacti_trigger_event_click",[d,b]);d.click&&bookacti_event_click(a,b.event)},eventMouseEnter:function(b){a.trigger("bookacti_calendar_event_mouse_enter",[b])},eventMouseLeave:function(b){a.trigger("bookacti_calendar_event_mouse_leave",[b])}};"wp_settings"===bookacti_localized.calendar_localization&&(k=bookacti_convert_php_datetime_format_to_fc_date_formatting_object(bookacti_localized.wp_time_format),f.firstDay=bookacti_localized.wp_start_of_week,f.slotLabelFormat=k,f.eventTimeFormat=
k);a.trigger("bookacti_calendar_init_data",[f]);bookacti.fc_calendar[c]=new FullCalendar.Calendar(a.find(".bookacti-calendar:first")[0],f);bookacti.fc_calendar[c].render();f=bookacti.fc_calendar[c].view;f={start:moment.utc(moment.utc(f.currentStart).clone().locale("en").format("YYYY-MM-DD")+" 00:00:00"),end:moment.utc(moment.utc(f.currentEnd).clone().subtract(1,"days").locale("en").format("YYYY-MM-DD")+" 23:59:59")};k=!1;"undefined"!==typeof bookacti.booking_system[c].events_interval&&(p=moment.utc(bookacti.booking_system[c].events_interval.start),
h=moment.utc(bookacti.booking_system[c].events_interval.end),p.isAfter(f.start)||h.isBefore(f.end))&&(k=!0);e&&!k||"undefined"===typeof bookacti.booking_system[c].events||bookacti_fc_add_events(a,bookacti.booking_system[c].events);if(e||k)e=bookacti_get_interval_of_events(a,f),$j.isEmptyObject(e)||bookacti_get_booking_system_data_by_interval(a,e);bookacti.booking_system[c].load_events=!0;e=bookacti.booking_system[c].picked_events;$j.isEmptyObject(bookacti.booking_system[c].picked_events)||bookacti.fc_calendar[c].gotoDate(moment.utc(e[0].start));
a.trigger("bookacti_calendar_after_set_up")}function bookacti_fc_get_events_by_groupId(a,e){a=a.attr("id");return $j.grep(bookacti.fc_calendar[a].getEvents(),function(c){return c.groupId==e})}
function bookacti_fc_add_events(a,e){if(e.length){var c=[];$j.each(e,function(h,k){h=$j.extend(!0,{},k);h.groupId=parseInt(k.id);h.id=k.id+"_"+k.start;c.push(h)});e=a.attr("id");var f={events:c,editable:"bookacti-template-calendar"===e};a.trigger("bookacti_fc_events",[f]);bookacti.fc_calendar[e].addEventSource(f)}}
function bookacti_refresh_picked_events_on_calendar(a){var e=a.attr("id");e=bookacti.booking_system[e].picked_events;bookacti_unpick_all_events_on_calendar(a);e&&$j.each(e,function(c,f){c=moment.utc(f.start).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");a.find('.fc-event[data-event-id="'+f.id+'"][data-event-start="'+c+'"]').addClass("bookacti-picked-event")});a.trigger("bookacti_refresh_picked_events_on_calendar")}
function bookacti_unpick_all_events_on_calendar(a){a.find(".bookacti-picked-event").removeClass("bookacti-picked-event");a.trigger("bookacti_unpick_all_events_on_calendar")}
function bookacti_fc_get_event_size_classes(a,e,c){var f=[];if(0>c.type.indexOf("timeGrid")&&0>c.type.indexOf("dayGrid"))return f;var h="undefined"!==typeof bookacti_localized.event_tiny_height?parseInt(bookacti_localized.event_tiny_height):32,k="undefined"!==typeof bookacti_localized.event_small_height?parseInt(bookacti_localized.event_small_height):75,p="undefined"!==typeof bookacti_localized.event_narrow_width?parseInt(bookacti_localized.event_narrow_width):70,q="undefined"!==typeof bookacti_localized.event_wide_width?
parseInt(bookacti_localized.event_wide_width):250;if(-1<c.type.indexOf("timeGrid")){var b=a.attr("id");c=bookacti.fc_calendar[b].getOption("eventMinHeight");b=bookacti.fc_calendar[b].getOption("slotDuration");"undefined"===typeof c&&(c=0);"undefined"===typeof b&&(b="00:30");b=60*parseInt(b.substr(0,2))+parseInt(b.substr(-2));e=parseInt(moment.duration(moment.utc(e.end).diff(moment.utc(e.start))).asMinutes());var d=a.find(".fc-timegrid-slot").length?a.find(".fc-timegrid-slot").outerHeight():0;d||(d=
a.css("line-height").replace("px",""),d=$j.isNumeric(d)?parseFloat(d):0,d||(d=a.css("font-size").replace("px",""),d=$j.isNumeric(d)?1.5*parseFloat(d):0),d=d?d:20);c=Math.max(parseInt(c),d/b*e);c<=h?f.push("bookacti-tiny-event"):c<=k&&f.push("bookacti-small-event")}a=a.find(".fc-col-header-cell.fc-day").innerWidth();a=a-.025*a-2;a>=q?f.push("bookacti-wide-event"):a<=p&&f.push("bookacti-narrow-event");return f}
function bookacti_enter_calendar_loading_state(a){a.find(".fc-toolbar button").attr("disabled",!0);a.find(".fc-view-harness").append('<div class="bookacti-loading-overlay"><div class="bookacti-loading-overlay-content">'+bookacti_get_loading_html()+"</div></div>")}function bookacti_exit_calendar_loading_state(a){a.find(".fc-toolbar button").attr("disabled",!1);a.find(".bookacti-loading-overlay").remove()};
