$j(document).ready(function(){$j("body").on("bookacti_booking_method_set_up",".bookacti-booking-system",function(b,a,c){if(a==="calendar"&&$j(this).find(".bookacti-calendar").length){bookacti_set_calendar_up($j(this),c)}});$j("body").on("bookacti_booking_method_display_events",".bookacti-booking-system",function(c,b,a){if(b==="calendar"&&$j(this).find(".bookacti-calendar").length){bookacti_display_events_on_calendar($j(this),a)}});$j("body").on("bookacti_refetch_events",".bookacti-booking-system",function(b,a){if(a==="calendar"){if($j(this).find(".bookacti-calendar").length){$j(this).find(".bookacti-calendar").fullCalendar("removeEvents")}bookacti_get_booking_system_data_by_interval($j(this))}});$j("body").on("bookacti_rerender_events",".bookacti-booking-system",function(b,a){if(a==="calendar"&&$j(this).find(".bookacti-calendar").length){$j(this).find(".bookacti-calendar").fullCalendar("rerenderEvents")}});$j("body").on("bookacti_clear_events",".bookacti-booking-system",function(b,a){if(a==="calendar"&&$j(this).find(".bookacti-calendar").length){$j(this).find(".bookacti-calendar").fullCalendar("removeEvents")}});$j("body").on("bookacti_booking_system_reloaded",".bookacti-booking-system",function(b,a){if($j(this).find(".bookacti-calendar").length){bookacti_refresh_picked_events_on_calendar($j(this))}});$j("body").on("bookacti_start_loading",".bookacti-booking-system",function(f,c){if(c==="calendar"){var b=$j(this);if(b.find(".bookacti-calendar.fc").length){var a=b.attr("id");if(bookacti.booking_system[a]["loading_number"]===0||!b.find(".bookacti-loading-overlay").length){b.find(".bookacti-loading-alt").remove();bookacti_enter_calendar_loading_state(b.find(".bookacti-calendar"))}}else{if(!b.find(".bookacti-loading-alt").length){var d='<div class="bookacti-loading-alt"><img class="bookacti-loader" src="'+bookacti_localized.plugin_path+'/img/ajax-loader.gif" title="'+bookacti_localized.loading+'" /><span class="bookacti-loading-alt-text" >'+bookacti_localized.loading+"</span></div>";b.append(d)}}}});$j("body").on("bookacti_exit_loading_state",".bookacti-booking-system",function(b,a){if(a==="calendar"){$j(this).find(".bookacti-loading-alt").remove();if($j(this).find(".bookacti-calendar").length){bookacti_exit_calendar_loading_state($j(this).find(".bookacti-calendar"))}}});$j("body").on("change",".bookacti-go-to-datepicker",function(){var a=$j(this).val();var b=$j(this).closest(".bookacti-calendar");if(!a||!b){return}if(!b.hasClass("fc")){return}b.fullCalendar("gotoDate",a)});$j("body").on("click",".bookacti-booking-system .bookacti-calendar .fc-more",function(){bookacti_refresh_picked_events_on_calendar(booking_system)});$j("body").on("touchstart",".bookacti-booking-system .bookacti-calendar .fc-event, .bookacti-booking-system .bookacti-calendar .fc-list-item",function(d){var a=$j(this).closest(".bookacti-booking-system");var b=$j(this);var c={id:parseInt(b.data("event-id")),start:moment.utc(b.data("event-start")),end:moment.utc(b.data("event-end"))};a.trigger("bookacti_event_touch_start",[c,b,d])});$j("body").on("touchend",".bookacti-booking-system .bookacti-calendar .fc-event, .bookacti-booking-system .bookacti-calendar .fc-list-item",function(d){var a=$j(this).closest(".bookacti-booking-system");var b=$j(this);var c={id:parseInt(b.data("event-id")),start:moment.utc(b.data("event-start")),end:moment.utc(b.data("event-end"))};a.trigger("bookacti_event_touch_end",[c,b,d])});$j("body").on("bookacti_pick_event",".bookacti-booking-system",function(c,b,a,d){if(!$j(this).find(".bookacti-calendar").length){return}bookacti_refresh_picked_events_on_calendar($j(this))});$j("body").on("bookacti_unpick_all_events",".bookacti-booking-system",function(){if(!$j(this).find(".bookacti-calendar").length){return}bookacti_unpick_all_events_on_calendar($j(this))})});function bookacti_set_calendar_up(b,m){m=m?1:0;var o=b.attr("id");var i=b.find(".bookacti-calendar:first");bookacti.booking_system[o]["load_events"]=false;var f=bookacti_get_availability_period(b);var e=typeof bookacti.booking_system[o]["display_data"]!=="undefined"?bookacti.booking_system[o]["display_data"]:{};var d=typeof e.minTime!=="undefined"?e.minTime:"00:00";var p=typeof e.maxTime!=="undefined"?e.maxTime:"24:00";var h={header:{left:"prev,next today",center:"title",right:"month,agendaWeek,agendaDay"},locale:bookacti_localized.fullcalendar_locale,defaultView:i.width()<bookacti_localized.default_view_threshold?"agendaDay":"agendaWeek",weekNumbersWithinDays:1,allDaySlot:false,allDayDefault:false,fixedWeekCount:false,aspectRatio:"auto",editable:false,droppable:false,eventDurationEditable:false,showNonCurrentDates:false,eventLimit:false,eventLimitClick:"popover",dragRevertDuration:0,slotLabelFormat:"LT",slotDuration:"00:30",slotEventOverlap:true,minTime:d,maxTime:p,validRange:{start:f.start?moment.utc(f.start.substr(0,10)):"",end:f.end?moment.utc(f.end.substr(0,10)).add(1,"days"):""},events:function(t,q,r,s){s([])},viewRender:function(q,t){if(bookacti.booking_system[o]["load_events"]===true){var r={start:moment.utc(moment.utc(q.intervalStart).clone().locale("en").format("YYYY-MM-DD")+" 00:00:00").locale("en"),end:moment.utc(moment.utc(q.intervalEnd).clone().subtract(1,"days").locale("en").format("YYYY-MM-DD")+" 23:59:59").locale("en")};var u=bookacti_get_interval_of_events(b,r);if(!$j.isEmptyObject(u)){bookacti_get_booking_system_data_by_interval(b,u)}}if(q.name.indexOf("agenda")>-1){var s=typeof e.slotEventOverlap!=="undefined"?e.slotEventOverlap:i.fullCalendar("option","slotEventOverlap");if(s){t.addClass("bookacti-events-overlap")}}b.trigger("bookacti_view_render",[q,t])},eventRender:function(q,v,z){if(!q.start||!q.end||q.start===q.end){return false}var x=moment.utc(q.start).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");var B=moment.utc(q.end).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");v.data("event-id",q.id);v.attr("data-event-id",q.id);v.data("event-start",x);v.attr("data-event-start",x);v.data("event-end",B);v.attr("data-event-end",B);q.render=1;if(typeof event_data!=="undefined"){v.data("activity-id",event_data.activity_id);v.attr("data-activity-id",event_data.activity_id)}var A=v.find(".fc-title");A.html(A.text());var s="LT";if(z.name.indexOf("agenda")>-1){s=i.fullCalendar("option","noMeridiemTimeFormat")}if(bookacti_localized.calendar_localization==="wp_settings"){s=bookacti_convert_php_datetime_format_to_moment_js(bookacti_localized.wp_time_format)}v.find(".fc-time").html('<span class="bookacti-event-time-start">'+q.start.format(s)+'</span><span class="bookacti-event-time-separator"> - </span><span class="bookacti-event-time-end">'+q.end.format(s)+"</span>");if(z.hasOwnProperty("dayGrid")){var u=$j("<div></div>",{"class":"fc-bg"});v.append(u)}var r=bookacti.booking_system[o]["bookings_only"]==1?true:false;var w="";if(r){w=bookacti_get_event_number_of_bookings_div(b,q)}else{var t=bookacti_is_event_available(b,q);if(!t){v.addClass("bookacti-event-unavailable")}w=bookacti_get_event_availability_div(b,q)}if(typeof bookacti.booking_system[o]["bookings"][q.id]!=="undefined"){if(typeof bookacti.booking_system[o]["bookings"][q.id][x]!=="undefined"){var y=parseInt(bookacti.booking_system[o]["bookings"][q.id][x]["current_user_bookings"]);if(y){v.addClass("bookacti-event-booked-by-current-user")}}}if(w){v.append(w)}b.trigger("bookacti_event_render",[q,v,z]);if(!q.render){return false}},eventAfterRender:function(s,r,q){bookacti_add_class_according_to_event_size(r);b.trigger("bookacti_event_after_render",[s,r,q])},eventAfterAllRender:function(q){$j.each(bookacti.booking_system[o]["picked_events"],function(s,t){var r=moment.utc(t.start).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");i.find('.fc-event[data-event-id="'+t.id+'"][data-event-start="'+r+'"]').addClass("bookacti-picked-event")});bookacti_refresh_picked_events_on_calendar(b);b.trigger("bookacti_event_after_all_render",[q])},eventClick:function(t,r,q){var s={click:true};if($j(this).hasClass("bookacti-event-unavailable")){s.click=false}b.trigger("bookacti_trigger_event_click",[s,t,r,q]);if(s.click){bookacti_event_click(b,t)}},eventMouseover:function(t,r,q){var s=$j(this);b.trigger("bookacti_event_mouse_over",[t,s])},eventMouseout:function(t,r,q){var s=$j(this);b.trigger("bookacti_event_mouse_out",[t,s])}};if(bookacti_localized.calendar_localization==="wp_settings"){h.firstDay=bookacti_localized.wp_start_of_week;h.slotLabelFormat=bookacti_convert_php_datetime_format_to_moment_js(bookacti_localized.wp_time_format);h.timeFormat=bookacti_convert_php_datetime_format_to_moment_js(bookacti_localized.wp_time_format)}b.trigger("bookacti_calendar_init_data",[h]);i.fullCalendar(h);var l=i.fullCalendar("getView");var c={start:moment.utc(moment.utc(l.intervalStart).clone().locale("en").format("YYYY-MM-DD")+" 00:00:00").locale("en"),end:moment.utc(moment.utc(l.intervalEnd).clone().subtract(1,"days").locale("en").format("YYYY-MM-DD")+" 23:59:59").locale("en")};var j=false;if(typeof bookacti.booking_system[o]["events_interval"]!=="undefined"){var g=moment.utc(bookacti.booking_system[o]["events_interval"]["start"]);var k=moment.utc(bookacti.booking_system[o]["events_interval"]["end"]);if(g.isAfter(c.start)||k.isBefore(c.end)){j=true}}if((!m||j)&&typeof bookacti.booking_system[o]["events"]!=="undefined"){if(bookacti.booking_system[o]["events"].length){bookacti_display_events_on_calendar(b)}}if(m||j){var a=bookacti_get_interval_of_events(b,c);if(!$j.isEmptyObject(a)){bookacti_get_booking_system_data_by_interval(b,a)}}bookacti.booking_system[o]["load_events"]=true;var n=bookacti.booking_system[o]["picked_events"];if(!$j.isEmptyObject(bookacti.booking_system[o]["picked_events"])){i.fullCalendar("gotoDate",moment.utc(n[0]["start"]))}b.trigger("bookacti_after_calendar_set_up")}function bookacti_display_events_on_calendar(b,c){var a=b.attr("id");var d=b.find(".bookacti-calendar:first");c=typeof c==="undefined"?bookacti.booking_system[a]["events"]:c;d.fullCalendar("addEventSource",c)}function bookacti_display_event_source_on_calendar(a,b){var c=a.hasClass("fc")?a:a.find(".bookacti-calendar:first");c.fullCalendar("addEventSource",b)}function bookacti_refresh_picked_events_on_calendar(b){var a=b.attr("id");var c=bookacti.booking_system[a]["picked_events"];bookacti_unpick_all_events_on_calendar(b);if(c){$j.each(c,function(e,g){var d=moment.utc(g.start).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");var f=b.find('.fc-event[data-event-id="'+g.id+'"][data-event-start="'+d+'"]');f.addClass("bookacti-picked-event")})}b.trigger("bookacti_refresh_picked_events_on_calendar")}function bookacti_unpick_all_events_on_calendar(a){a.find(".bookacti-picked-event").removeClass("bookacti-picked-event")}function bookacti_add_class_according_to_event_size(a){a.removeClass("bookacti-tiny-event bookacti-small-event bookacti-narrow-event bookacti-wide-event");var b=$j.extend({},bookacti.event_sizes);$j(a).trigger("bookacti_event_sizes",[a,b]);var c="";var d="";if($j(a).innerHeight()<b.small_height){c+=" bookacti-small-event"}if($j(a).innerHeight()<b.tiny_height){c+=" bookacti-tiny-event";d+=" bookacti-small-event"}if($j(a).innerWidth()<b.narrow_width){c+=" bookacti-narrow-event"}if($j(a).innerWidth()>b.wide_width){c+=" bookacti-wide-event";d+=" bookacti-narrow-event fc-short"}if(c){a.addClass(c)}if(d){a.removeClass(d)}}function bookacti_enter_calendar_loading_state(a){a.find(".fc-toolbar button").addClass("fc-state-disabled").attr("disabled",true);bookacti_append_loading_overlay(a.find(".fc-view-container"))}function bookacti_exit_calendar_loading_state(a){a.find(".fc-toolbar button").removeClass("fc-state-disabled").attr("disabled",false);bookacti_remove_loading_overlay(a.find(".fc-view-container"))}function bookacti_append_loading_overlay(a){a.append('<div class="bookacti-loading-overlay" ><div class="bookacti-loading-content" ><div class="bookacti-loading-box" ><div class="bookacti-loading-image" ><img class="bookacti-loader" src="'+bookacti_localized.plugin_path+'/img/ajax-loader.gif" title="'+bookacti_localized.loading+'" /></div><div class="bookacti-loading-text" >'+bookacti_localized.loading+"</div></div></div></div>").css("position","relative")}function bookacti_remove_loading_overlay(a){a.find(".bookacti-loading-overlay").remove().css("position","static")};