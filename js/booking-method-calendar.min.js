function bookacti_set_calendar_up(a,l){l=l?1:0;var n=a.attr("id");var h=a.find(".bookacti-calendar:first");bookacti.booking_system[n]["load_events"]=false;var d=bookacti_get_availability_period(a);var g=typeof bookacti.booking_system[n]["template_data"]["settings"]!=="undefined"?bookacti.booking_system[n]["template_data"]["settings"]:{};var c=typeof g.minTime!=="undefined"?g.minTime:"00:00";var o=typeof g.maxTime!=="undefined"?(g.maxTime==="00:00"?"24:00":g.maxTime):"24:00";var f={header:{left:"prev,next today",center:"title",right:"month,agendaWeek,agendaDay"},locale:bookacti_localized.fullcalendar_locale,defaultView:h.width()<bookacti_localized.default_view_threshold?"agendaDay":"agendaWeek",weekNumbersWithinDays:1,allDaySlot:false,allDayDefault:false,fixedWeekCount:false,aspectRatio:"auto",editable:false,droppable:false,eventDurationEditable:false,showNonCurrentDates:false,eventLimit:false,eventLimitClick:"popover",dragRevertDuration:0,slotLabelFormat:"LT",slotDuration:"00:30",minTime:c,maxTime:o,validRange:{start:moment(d.start),end:moment(d.end).add(1,"days")},events:function(s,p,q,r){r([])},viewRender:function(p){if(bookacti.booking_system[n]["load_events"]===true){var q={start:moment.utc(p.intervalStart),end:moment.utc(p.intervalEnd).subtract(1,"days")};bookacti_fetch_events_from_interval(a,q)}},eventRender:function(p,u,w){u.data("event-id",p.id);u.attr("data-event-id",p.id);u.data("event-start",p.start.format("YYYY-MM-DD HH:mm:ss"));u.attr("data-event-start",p.start.format("YYYY-MM-DD HH:mm:ss"));u.data("event-end",p.end.format("YYYY-MM-DD HH:mm:ss"));u.attr("data-event-end",p.end.format("YYYY-MM-DD HH:mm:ss"));u.data("activity-id",bookacti.booking_system[n]["events_data"][p.id]["activity_id"]);u.attr("data-activity-id",bookacti.booking_system[n]["events_data"][p.id]["activity_id"]);p.render=1;var x=u.find(".fc-title");x.html(x.text());var q="LT";if(w.name.indexOf("agenda")>-1){q=h.fullCalendar("option","noMeridiemTimeFormat")}if(bookacti_localized.calendar_localization==="wp_settings"){q=bookacti_convert_php_datetime_format_to_moment_js(bookacti_localized.wp_time_format)}u.find(".fc-time").html('<span class="bookacti-event-time-start">'+p.start.format(q)+'</span><span class="bookacti-event-time-separator"> - </span><span class="bookacti-event-time-end">'+p.end.format(q)+"</span>");if(bookacti_get_event_number_of_bookings(a,p)!=null){var r=bookacti.booking_system[n]["bookings_only"]==1?true:false;var v="";if(r){v=bookacti_get_event_number_of_bookings_div(a,p)}else{var s=bookacti_is_event_available(a,p);if(!s){u.addClass("bookacti-event-unavailable")}v=bookacti_get_event_availability_div(a,p)}u.append(v)}if(w.hasOwnProperty("dayGrid")){var t=$j("<div />",{"class":"fc-bg"});u.append(t)}a.trigger("bookacti_event_render",[p,u,w]);if(!p.render){return false}},eventAfterRender:function(r,q,p){bookacti_add_class_according_to_event_size(q)},eventAfterAllRender:function(p){$j.each(bookacti.booking_system[n]["picked_events"],function(q,r){h.find('.fc-event[data-event-id="'+r.id+'"][data-event-start="'+r.start+'"]').addClass("bookacti-picked-event")});bookacti_refresh_picked_events_on_calendar(a)},eventClick:function(r,q,p){bookacti_event_click(a,r)},eventMouseover:function(s,q,p){var r=$j(this);a.trigger("bookacti_event_mouse_over",[s,r])},eventMouseout:function(s,q,p){var r=$j(this);a.trigger("bookacti_event_mouse_out",[s,r])}};if(bookacti_localized.calendar_localization==="wp_settings"){f.firstDay=bookacti_localized.wp_start_of_week;f.slotLabelFormat=bookacti_convert_php_datetime_format_to_moment_js(bookacti_localized.wp_time_format);f.timeFormat=bookacti_convert_php_datetime_format_to_moment_js(bookacti_localized.wp_time_format)}a.trigger("bookacti_calendar_init_data",[f]);h.fullCalendar(f);var k=h.fullCalendar("getView");var b={start:moment.utc(k.start),end:moment.utc(k.end).subtract(1,"days")};var i=false;if(typeof bookacti.booking_system[n]["events_interval"]!=="undefined"){var e=moment.utc(bookacti.booking_system[n]["events_interval"]["start"]);var j=moment.utc(bookacti.booking_system[n]["events_interval"]["end"]);if(e.isAfter(b.start)||j.isBefore(b.end)){i=true}}if((!l||i)&&typeof bookacti.booking_system[n]["events"]!=="undefined"){if(bookacti.booking_system[n]["events"].length){bookacti_display_events_on_calendar(a)}}if(l||i){bookacti_fetch_events_from_interval(a,b)}h.off("click",".fc-more").on("click",".fc-more",function(){bookacti_refresh_picked_events_on_calendar(a)});a.off("bookacti_pick_event").on("bookacti_pick_event",function(q,p){bookacti_pick_event_on_calendar($j(this),p)});a.off("bookacti_unpick_event").on("bookacti_unpick_event",function(r,q,p){bookacti_unpick_event_on_calendar($j(this),q,p)});a.off("bookacti_unpick_all_events").on("bookacti_unpick_all_events",function(){bookacti_unpick_all_events_on_calendar($j(this))});bookacti.booking_system[n]["load_events"]=true;var m=bookacti.booking_system[n]["picked_events"];if(!$j.isEmptyObject(bookacti.booking_system[n]["picked_events"])){h.fullCalendar("gotoDate",moment(m[0]["start"]))}a.trigger("bookacti_after_calendar_set_up")}function bookacti_display_events_on_calendar(b,c){var a=b.attr("id");var d=b.find(".bookacti-calendar:first");c=typeof c==="undefined"?bookacti.booking_system[a]["events"]:c;d.fullCalendar("addEventSource",c)}function bookacti_clear_events_on_calendar(a,b){b=b||null;var c=null;var d=a.hasClass("fc")?a:a.find(".fc");if(b!==null){if(b._id!==undefined){if(b._id.indexOf("_")>=0){d.fullCalendar("removeEvents",b._id)}}d.fullCalendar("removeEvents",b.id);c=b.id}else{d.fullCalendar("removeEvents")}return c}function bookacti_display_event_source_on_calendar(a,b){var c=a.hasClass("fc")?a:a.find(".bookacti-calendar:first");c.fullCalendar("addEventSource",b)}function bookacti_pick_event_on_calendar(a,c){var d=c.start instanceof moment?c.start.format("YYYY-MM-DD HH:mm:ss"):c.start;var b=a.find('.fc-event[data-event-id="'+c.id+'"][data-event-start="'+d+'"]');b.addClass("bookacti-picked-event")}function bookacti_unpick_event_on_calendar(a,c,b){var e=c.start instanceof moment?c.start.format("YYYY-MM-DD HH:mm:ss"):c.start;var d=a.find('.fc-event[data-event-id="'+c.id+'"]');if(!b&&c.start){d=a.find('.fc-event[data-event-id="'+c.id+'"][data-event-start="'+e+'"]')}d.removeClass("bookacti-picked-event")}function bookacti_unpick_all_events_on_calendar(a){a.find(".bookacti-picked-event").removeClass("bookacti-picked-event")}function bookacti_refresh_picked_events_on_calendar(b){var a=b.attr("id");bookacti_unpick_all_events_on_calendar(b);$j.each(bookacti.booking_system[a]["picked_events"],function(d,e){var c=b.find('.fc-event[data-event-id="'+e.id+'"][data-event-start="'+e.start+'"]');c.addClass("bookacti-picked-event")});b.trigger("bookacti_refresh_picked_events_on_calendar")}function bookacti_get_first_and_last_events_on_calendar(c){var b=c.fullCalendar("getEventSources");var a={first:false,last:false};if(!b.length){return a}$j.each(b,function(e,d){if(typeof d.rawEventDefs==="undefined"||d.rawEventDefs.length===0){return true}var f=d.rawEventDefs;if(d.id.substr(0,8)==="activity"){f=bookacti_sort_events_array_by_dates(f)}if(!a.first||(a.first&&moment(f[0].start).isBefore(a.first.start))){a.first=f[0]}if(d.id.substr(0,8)==="activity"){f=bookacti_sort_events_array_by_dates(f,true)}if(!a.last||(a.last&&moment(f[f.length-1].end).isAfter(a.last.end))){a.last=f[f.length-1]}});return a}function bookacti_add_class_according_to_event_size(a){var b=bookacti.event_sizes;$j(a).trigger("bookacti_event_sizes",[a,b]);if($j(a).innerHeight()<b.tiny_height){a.addClass("bookacti-tiny-event").removeClass("bookacti-small-event")}if($j(a).innerHeight()<b.small_height){a.addClass("bookacti-small-event").removeClass("bookacti-tiny-event")}if($j(a).innerWidth()<b.narrow_width){a.addClass("bookacti-narrow-event").removeClass("bookacti-wide-event")}if($j(a).innerWidth()>b.wide_width){a.addClass("bookacti-wide-event").removeClass("bookacti-narrow-event");a.removeClass("fc-short")}}function bookacti_enter_calendar_loading_state(a){a.find(".fc-toolbar button").addClass("fc-state-disabled").attr("disabled",true);bookacti_append_loading_overlay(a.find(".fc-view-container"))}function bookacti_exit_calendar_loading_state(a){a.find(".fc-toolbar button").removeClass("fc-state-disabled").attr("disabled",false);bookacti_remove_loading_overlay(a.find(".fc-view-container"))}function bookacti_append_loading_overlay(a){a.append('<div class="bookacti-loading-overlay" ><div class="bookacti-loading-content" ><div class="bookacti-loading-box" ><div class="bookacti-loading-image" ><img class="bookacti-loader" src="'+bookacti_localized.plugin_path+'/img/ajax-loader.gif" title="'+bookacti_localized.loading+'" /></div><div class="bookacti-loading-text" >'+bookacti_localized.loading+"</div></div></div></div>").css("position","relative")}function bookacti_remove_loading_overlay(a){a.find(".bookacti-loading-overlay").remove().css("position","static")};