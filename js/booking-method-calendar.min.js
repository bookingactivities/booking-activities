$j(document).ready(function(){$j("body").on("bookacti_refetch_events",".bookacti-booking-system",function(b,a){if(a==="calendar"&&$j(this).find(".bookacti-calendar").length){$j(this).find(".bookacti-calendar").fullCalendar("removeEvents");bookacti_fetch_events($j(this))}});$j("body").on("bookacti_refetch_events",".bookacti-booking-system",function(b,a){if(a==="calendar"&&$j(this).find(".bookacti-calendar").length){$j(this).find(".bookacti-calendar").fullCalendar("rerenderEvents")}});$j("body").on("change",".bookacti-go-to-datepicker",function(){var a=$j(this).val();var b=$j(this).closest(".bookacti-calendar");if(!a||!b){return}if(!b.hasClass("fc")){return}b.fullCalendar("gotoDate",a)});$j("body").on("click",".bookacti-booking-system .bookacti-calendar .fc-more",function(){bookacti_refresh_picked_events_on_calendar(booking_system)});$j("body").on("touchstart",".bookacti-booking-system .bookacti-calendar .fc-event, .bookacti-booking-system .bookacti-calendar .fc-list-item",function(d){var a=$j(this).closest(".bookacti-booking-system");var b=$j(this);var c={id:parseInt(b.data("event-id")),start:moment.utc(b.data("event-start")),end:moment.utc(b.data("event-end"))};a.trigger("bookacti_event_touch_start",[c,b,d])});$j("body").on("touchend",".bookacti-booking-system .bookacti-calendar .fc-event, .bookacti-booking-system .bookacti-calendar .fc-list-item",function(d){var a=$j(this).closest(".bookacti-booking-system");var b=$j(this);var c={id:parseInt(b.data("event-id")),start:moment.utc(b.data("event-start")),end:moment.utc(b.data("event-end"))};a.trigger("bookacti_event_touch_end",[c,b,d])});$j("body").on("bookacti_pick_event",".bookacti-booking-system",function(c,b,a,d){if(!$j(this).find(".bookacti-calendar").length){return}bookacti_refresh_picked_events_on_calendar($j(this))});$j("body").on("bookacti_unpick_all_events",".bookacti-booking-system",function(){if(!$j(this).find(".bookacti-calendar").length){return}bookacti_unpick_all_events_on_calendar($j(this))})});function bookacti_set_calendar_up(a,l){l=l?1:0;var n=a.attr("id");var h=a.find(".bookacti-calendar:first");bookacti.booking_system[n]["load_events"]=false;var e=bookacti_get_availability_period(a);var d=typeof bookacti.booking_system[n]["display_data"]!=="undefined"?bookacti.booking_system[n]["display_data"]:{};var c=typeof d.minTime!=="undefined"?d.minTime:"00:00";var o=typeof d.maxTime!=="undefined"?d.maxTime:"24:00";var g={header:{left:"prev,next today",center:"title",right:"month,agendaWeek,agendaDay"},locale:bookacti_localized.fullcalendar_locale,defaultView:h.width()<bookacti_localized.default_view_threshold?"agendaDay":"agendaWeek",weekNumbersWithinDays:1,allDaySlot:false,allDayDefault:false,fixedWeekCount:false,aspectRatio:"auto",editable:false,droppable:false,eventDurationEditable:false,showNonCurrentDates:false,eventLimit:false,eventLimitClick:"popover",dragRevertDuration:0,slotLabelFormat:"LT",slotDuration:"00:30",slotEventOverlap:true,minTime:c,maxTime:o,validRange:{start:e.start?moment.utc(e.start.substr(0,10)):"",end:e.end?moment.utc(e.end.substr(0,10)).add(1,"days"):""},events:function(s,p,q,r){r([])},viewRender:function(p,s){if(bookacti.booking_system[n]["load_events"]===true){var q={start:moment.utc(moment.utc(p.intervalStart).clone().locale("en").format("YYYY-MM-DD")+" 00:00:00").locale("en"),end:moment.utc(moment.utc(p.intervalEnd).clone().subtract(1,"days").locale("en").format("YYYY-MM-DD")+" 23:59:59").locale("en")};bookacti_fetch_events_from_interval(a,q)}if(p.name.indexOf("agenda")>-1){var r=typeof d.slotEventOverlap!=="undefined"?d.slotEventOverlap:h.fullCalendar("option","slotEventOverlap");if(r){s.addClass("bookacti-events-overlap")}}a.trigger("bookacti_view_render",[p,s])},eventRender:function(p,u,y){if(!p.start||!p.end||p.start===p.end){return false}var w=moment.utc(p.start).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");var A=moment.utc(p.end).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");u.data("event-id",p.id);u.attr("data-event-id",p.id);u.data("event-start",w);u.attr("data-event-start",w);u.data("event-end",A);u.attr("data-event-end",A);u.data("activity-id",bookacti.booking_system[n]["events_data"][p.id]["activity_id"]);u.attr("data-activity-id",bookacti.booking_system[n]["events_data"][p.id]["activity_id"]);p.render=1;var z=u.find(".fc-title");z.html(z.text());var q="LT";if(y.name.indexOf("agenda")>-1){q=h.fullCalendar("option","noMeridiemTimeFormat")}if(bookacti_localized.calendar_localization==="wp_settings"){q=bookacti_convert_php_datetime_format_to_moment_js(bookacti_localized.wp_time_format)}u.find(".fc-time").html('<span class="bookacti-event-time-start">'+p.start.format(q)+'</span><span class="bookacti-event-time-separator"> - </span><span class="bookacti-event-time-end">'+p.end.format(q)+"</span>");var r=bookacti.booking_system[n]["bookings_only"]==1?true:false;var v="";if(r){v=bookacti_get_event_number_of_bookings_div(a,p)}else{var s=bookacti_is_event_available(a,p);if(!s){u.addClass("bookacti-event-unavailable")}v=bookacti_get_event_availability_div(a,p)}if(typeof bookacti.booking_system[n]["bookings"][p.id]!=="undefined"){if(typeof bookacti.booking_system[n]["bookings"][p.id][w]!=="undefined"){var x=parseInt(bookacti.booking_system[n]["bookings"][p.id][w]["current_user_bookings"]);if(x){u.addClass("bookacti-event-booked-by-current-user")}}}if(v){u.append(v)}if(y.hasOwnProperty("dayGrid")){var t=$j("<div></div>",{"class":"fc-bg"});u.append(t)}a.trigger("bookacti_event_render",[p,u,y]);if(!p.render){return false}},eventAfterRender:function(r,q,p){bookacti_add_class_according_to_event_size(q);a.trigger("bookacti_event_after_render",[r,q,p])},eventAfterAllRender:function(p){$j.each(bookacti.booking_system[n]["picked_events"],function(r,s){var q=moment.utc(s.start).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");h.find('.fc-event[data-event-id="'+s.id+'"][data-event-start="'+q+'"]').addClass("bookacti-picked-event")});bookacti_refresh_picked_events_on_calendar(a);a.trigger("bookacti_event_after_all_render",[p])},eventClick:function(s,q,p){var r={click:true};if($j(this).hasClass("bookacti-event-unavailable")){r.click=false}a.trigger("bookacti_trigger_event_click",[r,s,q,p]);if(r.click){bookacti_event_click(a,s)}},eventMouseover:function(s,q,p){var r=$j(this);a.trigger("bookacti_event_mouse_over",[s,r])},eventMouseout:function(s,q,p){var r=$j(this);a.trigger("bookacti_event_mouse_out",[s,r])}};if(bookacti_localized.calendar_localization==="wp_settings"){g.firstDay=bookacti_localized.wp_start_of_week;g.slotLabelFormat=bookacti_convert_php_datetime_format_to_moment_js(bookacti_localized.wp_time_format);g.timeFormat=bookacti_convert_php_datetime_format_to_moment_js(bookacti_localized.wp_time_format)}a.trigger("bookacti_calendar_init_data",[g]);h.fullCalendar(g);var k=h.fullCalendar("getView");var b={start:moment.utc(moment.utc(k.intervalStart).clone().locale("en").format("YYYY-MM-DD")+" 00:00:00").locale("en"),end:moment.utc(moment.utc(k.intervalEnd).clone().subtract(1,"days").locale("en").format("YYYY-MM-DD")+" 23:59:59").locale("en")};var i=false;if(typeof bookacti.booking_system[n]["events_interval"]!=="undefined"){var f=moment.utc(bookacti.booking_system[n]["events_interval"]["start"]);var j=moment.utc(bookacti.booking_system[n]["events_interval"]["end"]);if(f.isAfter(b.start)||j.isBefore(b.end)){i=true}}if((!l||i)&&typeof bookacti.booking_system[n]["events"]!=="undefined"){if(bookacti.booking_system[n]["events"].length){bookacti_display_events_on_calendar(a)}}if(l||i){bookacti_fetch_events_from_interval(a,b)}bookacti.booking_system[n]["load_events"]=true;var m=bookacti.booking_system[n]["picked_events"];if(!$j.isEmptyObject(bookacti.booking_system[n]["picked_events"])){h.fullCalendar("gotoDate",moment.utc(m[0]["start"]))}a.trigger("bookacti_after_calendar_set_up")}function bookacti_display_events_on_calendar(b,c){var a=b.attr("id");var d=b.find(".bookacti-calendar:first");c=typeof c==="undefined"?bookacti.booking_system[a]["events"]:c;d.fullCalendar("addEventSource",c)}function bookacti_clear_events_on_calendar(a,b){b=b||null;var c=null;var d=a.hasClass("fc")?a:a.find(".fc");if(b!==null){if(b._id!==undefined){if(b._id.indexOf("_")>=0){d.fullCalendar("removeEvents",b._id)}}d.fullCalendar("removeEvents",b.id);c=b.id}else{d.fullCalendar("removeEvents")}return c}function bookacti_display_event_source_on_calendar(a,b){var c=a.hasClass("fc")?a:a.find(".bookacti-calendar:first");c.fullCalendar("addEventSource",b)}function bookacti_refresh_picked_events_on_calendar(b){var a=b.attr("id");var c=bookacti.booking_system[a]["picked_events"];bookacti_unpick_all_events_on_calendar(b);if(c){$j.each(c,function(e,g){var d=moment.utc(g.start).clone().locale("en").format("YYYY-MM-DD HH:mm:ss");var f=b.find('.fc-event[data-event-id="'+g.id+'"][data-event-start="'+d+'"]');f.addClass("bookacti-picked-event")})}b.trigger("bookacti_refresh_picked_events_on_calendar")}function bookacti_unpick_all_events_on_calendar(a){a.find(".bookacti-picked-event").removeClass("bookacti-picked-event")}function bookacti_add_class_according_to_event_size(a){a.removeClass("bookacti-tiny-event bookacti-small-event bookacti-narrow-event bookacti-wide-event");var b=$j.extend({},bookacti.event_sizes);$j(a).trigger("bookacti_event_sizes",[a,b]);var c="";var d="";if($j(a).innerHeight()<b.small_height){c+=" bookacti-small-event"}if($j(a).innerHeight()<b.tiny_height){c+=" bookacti-tiny-event";d+=" bookacti-small-event"}if($j(a).innerWidth()<b.narrow_width){c+=" bookacti-narrow-event"}if($j(a).innerWidth()>b.wide_width){c+=" bookacti-wide-event";d+=" bookacti-narrow-event fc-short"}if(c){a.addClass(c)}if(d){a.removeClass(d)}}function bookacti_enter_calendar_loading_state(a){a.find(".fc-toolbar button").addClass("fc-state-disabled").attr("disabled",true);bookacti_append_loading_overlay(a.find(".fc-view-container"))}function bookacti_exit_calendar_loading_state(a){a.find(".fc-toolbar button").removeClass("fc-state-disabled").attr("disabled",false);bookacti_remove_loading_overlay(a.find(".fc-view-container"))}function bookacti_append_loading_overlay(a){a.append('<div class="bookacti-loading-overlay" ><div class="bookacti-loading-content" ><div class="bookacti-loading-box" ><div class="bookacti-loading-image" ><img class="bookacti-loader" src="'+bookacti_localized.plugin_path+'/img/ajax-loader.gif" title="'+bookacti_localized.loading+'" /></div><div class="bookacti-loading-text" >'+bookacti_localized.loading+"</div></div></div></div>").css("position","relative")}function bookacti_remove_loading_overlay(a){a.find(".bookacti-loading-overlay").remove().css("position","static")};